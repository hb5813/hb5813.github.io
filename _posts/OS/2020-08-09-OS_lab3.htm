---
layout: article
title: SYSU-《操作系统原理》-实验3：用汇编与C语言开发独立内核
tag: OS
key: OS_lab2
show_subscribe: false
license: false
---

<html>

<head>
<meta http-equiv=Content-Type content="text/html; charset=x-cp20936">
<meta name=Generator content="Microsoft Word 15 (filtered)">
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Helvetica;
	panose-1:2 11 6 4 2 2 2 2 2 4;}
@font-face
	{font-family:Courier;
	panose-1:2 7 4 9 2 2 5 2 4 4;}
@font-face
	{font-family:"Tms Rmn";
	panose-1:2 2 6 3 4 5 5 2 3 4;}
@font-face
	{font-family:Helv;
	panose-1:2 11 6 4 2 2 2 3 2 4;}
@font-face
	{font-family:"New York";
	panose-1:2 4 5 3 6 5 6 2 3 4;}
@font-face
	{font-family:System;
	panose-1:0 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:Wingdings;
	panose-1:5 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:"MS Mincho";
	panose-1:2 2 6 9 4 2 5 8 3 4;}
@font-face
	{font-family:Batang;
	panose-1:2 3 6 0 0 1 1 1 1 1;}
@font-face
	{font-family:宋体;
	panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
	{font-family:PMingLiU;
	panose-1:2 1 6 1 0 1 1 1 1 1;}
@font-face
	{font-family:"MS Gothic";
	panose-1:2 11 6 9 7 2 5 8 2 4;}
@font-face
	{font-family:Dotum;
	panose-1:2 11 6 0 0 1 1 1 1 1;}
@font-face
	{font-family:黑体;
	panose-1:2 1 6 9 6 1 1 1 1 1;}
@font-face
	{font-family:MingLiU;
	panose-1:2 1 6 9 0 1 1 1 1 1;}
@font-face
	{font-family:Mincho;
	panose-1:2 2 6 9 4 3 5 8 3 5;}
@font-face
	{font-family:Gulim;
	panose-1:2 11 6 0 0 1 1 1 1 1;}
@font-face
	{font-family:Century;
	panose-1:2 4 6 4 5 5 5 2 3 4;}
@font-face
	{font-family:"Angsana New";
	panose-1:2 2 6 3 5 4 5 2 3 4;}
@font-face
	{font-family:"Cordia New";
	panose-1:2 11 3 4 2 2 2 2 2 4;}
@font-face
	{font-family:Mangal;
	panose-1:0 0 4 0 0 0 0 0 0 0;}
@font-face
	{font-family:Latha;
	panose-1:2 0 4 0 0 0 0 0 0 0;}
@font-face
	{font-family:Sylfaen;
	panose-1:1 10 5 2 5 3 6 3 3 3;}
@font-face
	{font-family:Vrinda;
	panose-1:0 0 4 0 0 0 0 0 0 0;}
@font-face
	{font-family:Raavi;
	panose-1:2 0 5 0 0 0 0 0 0 0;}
@font-face
	{font-family:Shruti;
	panose-1:2 0 5 0 0 0 0 0 0 0;}
@font-face
	{font-family:Sendnya;
	panose-1:0 0 4 0 0 0 0 0 0 0;}
@font-face
	{font-family:Gautami;
	panose-1:2 0 5 0 0 0 0 0 0 0;}
@font-face
	{font-family:Tunga;
	panose-1:0 0 4 0 0 0 0 0 0 0;}
@font-face
	{font-family:"Estrangelo Edessa";
	panose-1:0 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:"Yu Gothic";
	panose-1:2 11 4 0 0 0 0 0 0 0;}
@font-face
	{font-family:等线;
	panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;}
@font-face
	{font-family:"Calibri Light";
	panose-1:2 15 3 2 2 2 4 3 2 4;}
@font-face
	{font-family:"Palatino Linotype";
	panose-1:2 4 5 2 5 5 5 3 3 4;}
@font-face
	{font-family:Verdana;
	panose-1:2 11 6 4 3 5 4 4 2 4;}
@font-face
	{font-family:"Arial Unicode MS";
	panose-1:2 11 6 4 2 2 2 2 2 4;}
@font-face
	{font-family:"等线 Light";
	panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
	{font-family:"Segoe UI Emoji";
	panose-1:2 11 5 2 4 2 4 2 2 3;}
@font-face
	{font-family:华文中宋;
	panose-1:2 1 6 0 4 1 1 1 1 1;}
@font-face
	{font-family:Georgia;
	panose-1:2 4 5 2 5 4 5 2 3 3;}
@font-face
	{font-family:Consolas;
	panose-1:2 11 6 9 2 2 4 3 2 4;}
@font-face
	{font-family:"\@华文中宋";}
@font-face
	{font-family:"\@宋体";
	panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
	{font-family:"\@等线";
	panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
	{font-family:"\@等线 Light";}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin:0cm;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	font-size:10.5pt;
	font-family:"Times New Roman",serif;}
h1
	{mso-style-link:"标题 1 字符";
	margin-top:5.0pt;
	margin-right:0cm;
	margin-bottom:15.0pt;
	margin-left:0cm;
	text-align:center;
	line-height:150%;
	page-break-after:avoid;
	font-size:22.0pt;
	font-family:"Times New Roman",serif;}
p.MsoToc1, li.MsoToc1, div.MsoToc1
	{margin:0cm;
	margin-bottom:.0001pt;
	line-height:12.0pt;
	font-size:11.0pt;
	font-family:华文中宋;}
p.MsoToc2, li.MsoToc2, div.MsoToc2
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:10.0pt;
	margin-bottom:.0001pt;
	line-height:12.0pt;
	font-size:11.0pt;
	font-family:华文中宋;}
p.MsoToc3, li.MsoToc3, div.MsoToc3
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:20.0pt;
	margin-bottom:.0001pt;
	line-height:12.0pt;
	font-size:11.0pt;
	font-family:华文中宋;}
p.MsoToc4, li.MsoToc4, div.MsoToc4
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:30.0pt;
	margin-bottom:.0001pt;
	line-height:12.0pt;
	font-size:10.5pt;
	font-family:华文中宋;}
p.MsoToc5, li.MsoToc5, div.MsoToc5
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:84.0pt;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	font-size:10.5pt;
	font-family:"Times New Roman",serif;}
p.MsoHeader, li.MsoHeader, div.MsoHeader
	{margin:0cm;
	margin-bottom:.0001pt;
	text-align:center;
	layout-grid-mode:char;
	border:none;
	padding:0cm;
	font-size:9.0pt;
	font-family:"Times New Roman",serif;}
p.MsoFooter, li.MsoFooter, div.MsoFooter
	{mso-style-link:"页脚 字符";
	margin:0cm;
	margin-bottom:.0001pt;
	layout-grid-mode:char;
	font-size:9.0pt;
	font-family:"Times New Roman",serif;}
p.MsoTitle, li.MsoTitle, div.MsoTitle
	{mso-style-link:"标题 字符";
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:10.0pt;
	margin-left:0cm;
	text-align:center;
	line-height:150%;
	font-size:22.0pt;
	font-family:"等线 Light";
	font-weight:bold;}
p.MsoSubtitle, li.MsoSubtitle, div.MsoSubtitle
	{mso-style-link:"副标题 字符";
	margin:0cm;
	margin-bottom:.0001pt;
	text-indent:0cm;
	line-height:150%;
	font-size:10.5pt;
	font-family:"等线 Light";
	font-weight:bold;}
a:link, span.MsoHyperlink
	{color:#0563C1;
	text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
	{color:#954F72;
	text-decoration:underline;}
pre
	{mso-style-link:"HTML 预设格式 字符";
	margin:0cm;
	margin-bottom:.0001pt;
	font-size:12.0pt;
	font-family:宋体;}
span.MsoPlaceholderText
	{color:gray;}
p.MsoListParagraph, li.MsoListParagraph, div.MsoListParagraph
	{margin:0cm;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	text-indent:21.0pt;
	font-size:10.5pt;
	font-family:"Times New Roman",serif;}
p.MsoTocHeading, li.MsoTocHeading, div.MsoTocHeading
	{margin-top:12.0pt;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:0cm;
	margin-bottom:.0001pt;
	line-height:107%;
	page-break-after:avoid;
	font-size:16.0pt;
	font-family:"等线 Light";
	color:#2F5496;}
p.a, li.a, div.a
	{mso-style-name:列出段落;
	margin:0cm;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	text-indent:21.0pt;
	font-size:10.5pt;
	font-family:等线;}
span.1
	{mso-style-name:"标题 1 字符";
	mso-style-link:"标题 1";
	font-family:华文中宋;
	font-weight:bold;}
span.a0
	{mso-style-name:"副标题 字符";
	mso-style-link:副标题;
	font-family:"等线 Light";
	font-weight:bold;}
span.a1
	{mso-style-name:"标题 字符";
	mso-style-link:标题;
	font-family:"等线 Light";
	font-weight:bold;}
span.a2
	{mso-style-name:"页脚 字符";
	mso-style-link:页脚;}
p.3, li.3, div.3
	{mso-style-name:标题3;
	mso-style-link:"标题3 字符";
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:10.0pt;
	margin-bottom:.0001pt;
	text-indent:0cm;
	line-height:150%;
	text-autospace:none;
	font-size:10.5pt;
	font-family:华文中宋;
	font-weight:bold;}
span.30
	{mso-style-name:"标题3 字符";
	mso-style-link:标题3;
	font-family:华文中宋;
	font-weight:bold;}
p.4, li.4, div.4
	{mso-style-name:标题4;
	mso-style-link:"标题4 字符";
	margin:0cm;
	margin-bottom:.0001pt;
	text-indent:0cm;
	line-height:150%;
	font-size:10.5pt;
	font-family:华文中宋;}
span.40
	{mso-style-name:"标题4 字符";
	mso-style-link:标题4;
	font-family:华文中宋;}
span.HTML
	{mso-style-name:"HTML 预设格式 字符";
	mso-style-link:"HTML 预设格式";
	font-family:宋体;}
p.TableParagraph, li.TableParagraph, div.TableParagraph
	{mso-style-name:"Table Paragraph";
	margin-top:1.1pt;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:5.35pt;
	margin-bottom:.0001pt;
	text-autospace:none;
	font-size:11.0pt;
	font-family:宋体;}
span.msoIns
	{mso-style-name:"";
	text-decoration:underline;
	color:teal;}
span.msoDel
	{mso-style-name:"";
	text-decoration:line-through;
	color:red;}
.MsoChpDefault
	{font-size:10.0pt;}
 /* Page Definitions */
 @page WordSection1
	{size:595.3pt 841.9pt;
	margin:72.0pt 90.0pt 72.0pt 90.0pt;
	layout-grid:15.6pt;}
div.WordSection1
	{page:WordSection1;}
@page WordSection2
	{size:595.3pt 841.9pt;
	margin:72.0pt 90.0pt 72.0pt 90.0pt;
	layout-grid:15.6pt;}
div.WordSection2
	{page:WordSection2;}
 /* List Definitions */
 ol
	{margin-bottom:0cm;}
ul
	{margin-bottom:0cm;}
-->
</style>

</head>

<body lang=ZH-CN link="#0563C1" vlink="#954F72" style='text-justify-trim:punctuation'>

<div class=WordSection1 style='layout-grid:15.6pt'>

<p class=MsoNormal align=center style='text-align:center;line-height:18.0pt'><b><span
style='font-size:16.0pt;font-family:华文中宋'>目 录</span></b></p>

<p class=MsoToc1><span lang=EN-US><a href="#_Toc10938155"><span lang=EN-US><span
lang=EN-US>前言</span></span><span style='color:windowtext;display:none;
text-decoration:none'>.. </span><span
style='color:windowtext;display:none;text-decoration:none'>1</span></a></span></p>

<p class=MsoToc1><span lang=EN-US><a href="#_Toc10938156"><span lang=EN-US><span
lang=EN-US>实验三：用汇编与C</span></span><span lang=EN-US><span lang=EN-US>语言开发独立内核</span></span><span
style='color:windowtext;display:none;text-decoration:none'>.. </span><span
style='color:windowtext;display:none;text-decoration:none'>2</span></a></span></p>

<p class=MsoToc2 style='margin-left:21.0pt'><span lang=EN-US><a
href="#_Toc10938157"><span lang=EN-US><span lang=EN-US>一、</span></span><span
style='font-size:10.5pt;font-family:等线;color:windowtext;text-decoration:none'>&nbsp; </span><span
lang=EN-US><span lang=EN-US>实验目的</span></span><span style='color:windowtext;
display:none;text-decoration:none'>.. </span><span
style='color:windowtext;display:none;text-decoration:none'>2</span></a></span></p>

<p class=MsoToc2 style='margin-left:21.0pt'><span lang=EN-US><a
href="#_Toc10938158"><span lang=EN-US><span lang=EN-US>二、</span></span><span
style='font-size:10.5pt;font-family:等线;color:windowtext;text-decoration:none'>&nbsp; </span><span
lang=EN-US><span lang=EN-US>实验要求</span></span><span style='color:windowtext;
display:none;text-decoration:none'>.. </span><span
style='color:windowtext;display:none;text-decoration:none'>2</span></a></span></p>

<p class=MsoToc2 style='margin-left:21.0pt'><span lang=EN-US><a
href="#_Toc10938159"><span lang=EN-US><span lang=EN-US>三、</span></span><span
style='font-size:10.5pt;font-family:等线;color:windowtext;text-decoration:none'>&nbsp; </span><span
lang=EN-US><span lang=EN-US>实验方案</span></span><span style='color:windowtext;
display:none;text-decoration:none'>.. </span><span
style='color:windowtext;display:none;text-decoration:none'>2</span></a></span></p>

<p class=MsoToc3 style='margin-left:42.0pt'><span lang=EN-US><a
href="#_Toc10938160">1.<span style='font-size:10.5pt;font-family:等线;color:windowtext;
text-decoration:none'>&nbsp;&nbsp; </span>lsyOS<span lang=EN-US><span
lang=EN-US>的启动原理：二次引导</span></span><span style='color:windowtext;display:none;
text-decoration:none'>.. </span><span
style='color:windowtext;display:none;text-decoration:none'>2</span></a></span></p>

<p class=MsoToc3 style='margin-left:42.0pt'><span lang=EN-US><a
href="#_Toc10938161">2.<span style='font-size:10.5pt;font-family:等线;color:windowtext;
text-decoration:none'>&nbsp;&nbsp; </span>lsyOS<span lang=EN-US><span
lang=EN-US>的内存划分</span></span><span style='color:windowtext;display:none;
text-decoration:none'>.. </span><span
style='color:windowtext;display:none;text-decoration:none'>3</span></a></span></p>

<p class=MsoToc3 style='margin-left:42.0pt'><span lang=EN-US><a
href="#_Toc10938162">3.<span style='font-size:10.5pt;font-family:等线;color:windowtext;
text-decoration:none'>&nbsp;&nbsp; </span>lsyOS<span lang=EN-US><span
lang=EN-US>内核的组成部分与源码的文<span lang=EN-US>件结构</span></span></span><span
style='color:windowtext;display:none;text-decoration:none'>.. </span><span
style='color:windowtext;display:none;text-decoration:none'>4</span></a></span></p>

<p class=MsoToc2 style='margin-left:21.0pt'><span lang=EN-US><a
href="#_Toc10938163"><span lang=EN-US><span lang=EN-US>四、</span></span><span
style='font-size:10.5pt;font-family:等线;color:windowtext;text-decoration:none'>&nbsp; </span><span
lang=EN-US><span lang=EN-US>实验内容</span></span><span style='color:windowtext;
display:none;text-decoration:none'>.. </span><span
style='color:windowtext;display:none;text-decoration:none'>4</span></a></span></p>

<p class=MsoToc3 style='margin-left:42.0pt'><span lang=EN-US><a
href="#_Toc10938164">1.<span style='font-size:10.5pt;font-family:等线;color:windowtext;
text-decoration:none'>&nbsp;&nbsp; </span>FAT12<span lang=EN-US><span
lang=EN-US>文件系统</span></span><span style='color:windowtext;display:none;
text-decoration:none'>.. </span><span
style='color:windowtext;display:none;text-decoration:none'>4</span></a></span></p>

<p class=MsoToc4 style='margin-left:63.0pt'><span lang=EN-US><a
href="#_Toc10938165">1)<span style='font-family:等线;color:windowtext;text-decoration:
none'>&nbsp;&nbsp;&nbsp; </span>FAT12<span lang=EN-US><span lang=EN-US>的软盘扇区组织</span></span><span
style='color:windowtext;display:none;text-decoration:none'>.. </span><span
style='color:windowtext;display:none;text-decoration:none'>5</span></a></span></p>

<p class=MsoToc4 style='margin-left:63.0pt'><span lang=EN-US><a
href="#_Toc10938166">2)<span style='font-family:等线;color:windowtext;text-decoration:
none'>&nbsp;&nbsp;&nbsp; </span>FAT12<span lang=EN-US><span lang=EN-US>的软盘引导扇区格式</span></span><span
style='color:windowtext;display:none;text-decoration:none'>.. </span><span
style='color:windowtext;display:none;text-decoration:none'>5</span></a></span></p>

<p class=MsoToc4 style='margin-left:63.0pt'><span lang=EN-US><a
href="#_Toc10938167">3)<span style='font-family:等线;color:windowtext;text-decoration:
none'>&nbsp;&nbsp;&nbsp; </span>FAT12<span lang=EN-US><span lang=EN-US>的根目录区</span></span><span
style='color:windowtext;display:none;text-decoration:none'>.. </span><span
style='color:windowtext;display:none;text-decoration:none'>7</span></a></span></p>

<p class=MsoToc4 style='margin-left:63.0pt'><span lang=EN-US><a
href="#_Toc10938168">4)<span style='font-family:等线;color:windowtext;text-decoration:
none'>&nbsp;&nbsp;&nbsp; </span>FAT12<span lang=EN-US><span lang=EN-US>的文件分配表与数据区</span></span><span
style='color:windowtext;display:none;text-decoration:none'>.. </span><span
style='color:windowtext;display:none;text-decoration:none'>10</span></a></span></p>

<p class=MsoToc3 style='margin-left:42.0pt'><span lang=EN-US><a
href="#_Toc10938169">2.<span style='font-size:10.5pt;font-family:等线;color:windowtext;
text-decoration:none'>&nbsp;&nbsp; </span><span lang=EN-US><span lang=EN-US>引导程序</span></span><span
style='color:windowtext;display:none;text-decoration:none'>.. </span><span
style='color:windowtext;display:none;text-decoration:none'>14</span></a></span></p>

<p class=MsoToc4 style='margin-left:63.0pt'><span lang=EN-US><a
href="#_Toc10938170">1)<span style='font-family:等线;color:windowtext;text-decoration:
none'>&nbsp;&nbsp;&nbsp; </span><span lang=EN-US><span lang=EN-US>读软盘扇区</span></span><span
style='color:windowtext;display:none;text-decoration:none'>.. </span><span
style='color:windowtext;display:none;text-decoration:none'>14</span></a></span></p>

<p class=MsoToc4 style='margin-left:63.0pt'><span lang=EN-US><a
href="#_Toc10938171">2)<span style='font-family:等线;color:windowtext;text-decoration:
none'>&nbsp;&nbsp;&nbsp; </span><span lang=EN-US><span lang=EN-US>读入FAT</span></span><span
lang=EN-US><span lang=EN-US>表</span></span><span style='color:windowtext;
display:none;text-decoration:none'>.. </span><span
style='color:windowtext;display:none;text-decoration:none'>15</span></a></span></p>

<p class=MsoToc4 style='margin-left:63.0pt'><span lang=EN-US><a
href="#_Toc10938172">3)<span style='font-family:等线;color:windowtext;text-decoration:
none'>&nbsp;&nbsp;&nbsp; </span><span lang=EN-US><span lang=EN-US>取FAT</span></span><span
lang=EN-US><span lang=EN-US>表的下一个表项</span></span><span style='color:windowtext;
display:none;text-decoration:none'>.. </span><span
style='color:windowtext;display:none;text-decoration:none'>16</span></a></span></p>

<p class=MsoToc4 style='margin-left:63.0pt'><span lang=EN-US><a
href="#_Toc10938173">4)<span style='font-family:等线;color:windowtext;text-decoration:
none'>&nbsp;&nbsp;&nbsp; </span><span lang=EN-US><span lang=EN-US>寻找loader</span></span><span
style='color:windowtext;display:none;text-decoration:none'> </span><span
style='color:windowtext;display:none;text-decoration:none'>17</span></a></span></p>

<p class=MsoToc4 style='margin-left:63.0pt'><span lang=EN-US><a
href="#_Toc10938174">5)<span style='font-family:等线;color:windowtext;text-decoration:
none'>&nbsp;&nbsp;&nbsp; </span><span lang=EN-US><span lang=EN-US>读取并跳入loader</span></span><span
style='color:windowtext;display:none;text-decoration:none'> </span><span
style='color:windowtext;display:none;text-decoration:none'>19</span></a></span></p>

<p class=MsoToc3 style='margin-left:42.0pt'><span lang=EN-US><a
href="#_Toc10938175">3.<span style='font-size:10.5pt;font-family:等线;color:windowtext;
text-decoration:none'>&nbsp;&nbsp; </span><span lang=EN-US><span lang=EN-US>保护模式下的段式内存管理</span></span><span
style='color:windowtext;display:none;text-decoration:none'>.. </span><span
style='color:windowtext;display:none;text-decoration:none'>19</span></a></span></p>

<p class=MsoToc4 style='margin-left:63.0pt'><span lang=EN-US><a
href="#_Toc10938176">1)<span style='font-family:等线;color:windowtext;text-decoration:
none'>&nbsp;&nbsp;&nbsp; </span><span lang=EN-US><span lang=EN-US>全局描述符</span></span><span
style='color:windowtext;display:none;text-decoration:none'>.. </span><span
style='color:windowtext;display:none;text-decoration:none'>21</span></a></span></p>

<p class=MsoToc4 style='margin-left:63.0pt'><span lang=EN-US><a
href="#_Toc10938177">2)<span style='font-family:等线;color:windowtext;text-decoration:
none'>&nbsp;&nbsp;&nbsp; </span><span lang=EN-US><span lang=EN-US>全局描述符表</span></span><span
style='color:windowtext;display:none;text-decoration:none'>.. </span><span
style='color:windowtext;display:none;text-decoration:none'>24</span></a></span></p>

<p class=MsoToc4 style='margin-left:63.0pt'><span lang=EN-US><a
href="#_Toc10938178">3)<span style='font-family:等线;color:windowtext;text-decoration:
none'>&nbsp;&nbsp;&nbsp; </span><span lang=EN-US><span lang=EN-US>全局描述符表寄存器</span></span><span
style='color:windowtext;display:none;text-decoration:none'>.. </span><span
style='color:windowtext;display:none;text-decoration:none'>25</span></a></span></p>

<p class=MsoToc4 style='margin-left:63.0pt'><span lang=EN-US><a
href="#_Toc10938179">4)<span style='font-family:等线;color:windowtext;text-decoration:
none'>&nbsp;&nbsp;&nbsp; </span><span lang=EN-US><span lang=EN-US>段选择子</span></span><span
style='color:windowtext;display:none;text-decoration:none'>.. </span><span
style='color:windowtext;display:none;text-decoration:none'>25</span></a></span></p>

<p class=MsoToc4 style='margin-left:63.0pt'><span lang=EN-US><a
href="#_Toc10938180">5)<span style='font-family:等线;color:windowtext;text-decoration:
none'>&nbsp;&nbsp;&nbsp; </span><span lang=EN-US><span lang=EN-US>段寄存器</span></span><span
style='color:windowtext;display:none;text-decoration:none'>.. </span><span
style='color:windowtext;display:none;text-decoration:none'>27</span></a></span></p>

<p class=MsoToc3 style='margin-left:42.0pt'><span lang=EN-US><a
href="#_Toc10938181">4.<span style='font-size:10.5pt;font-family:等线;color:windowtext;
text-decoration:none'>&nbsp;&nbsp; </span><span lang=EN-US><span lang=EN-US>二次引导程序</span></span><span
style='color:windowtext;display:none;text-decoration:none'>.. </span><span
style='color:windowtext;display:none;text-decoration:none'>28</span></a></span></p>

<p class=MsoToc4 style='margin-left:63.0pt'><span lang=EN-US><a
href="#_Toc10938182">1)<span style='font-family:等线;color:windowtext;text-decoration:
none'>&nbsp;&nbsp;&nbsp; </span>A20 Gate<span style='color:windowtext;
display:none;text-decoration:none'> </span><span
style='color:windowtext;display:none;text-decoration:none'>28</span></a></span></p>

<p class=MsoToc4 style='margin-left:63.0pt'><span lang=EN-US><a
href="#_Toc10938183">2)<span style='font-family:等线;color:windowtext;text-decoration:
none'>&nbsp;&nbsp;&nbsp; </span>ELF<span lang=EN-US><span lang=EN-US>文件的结构与加载执行</span></span><span
style='color:windowtext;display:none;text-decoration:none'>.. </span><span
style='color:windowtext;display:none;text-decoration:none'>31</span></a></span></p>

<p class=MsoToc4 style='margin-left:63.0pt'><span lang=EN-US><a
href="#_Toc10938184">3)<span style='font-family:等线;color:windowtext;text-decoration:
none'>&nbsp;&nbsp;&nbsp; </span><span lang=EN-US><span lang=EN-US>进入保护模式</span></span><span
style='color:windowtext;display:none;text-decoration:none'>.. </span><span
style='color:windowtext;display:none;text-decoration:none'>37</span></a></span></p>

<p class=MsoToc4 style='margin-left:63.0pt'><span lang=EN-US><a
href="#_Toc10938185">4)<span style='font-family:等线;color:windowtext;text-decoration:
none'>&nbsp;&nbsp;&nbsp; </span><span lang=EN-US><span lang=EN-US>跳入内核</span></span><span
style='color:windowtext;display:none;text-decoration:none'>.. </span><span
style='color:windowtext;display:none;text-decoration:none'>40</span></a></span></p>

<p class=MsoToc3 style='margin-left:42.0pt'><span lang=EN-US><a
href="#_Toc10938186">5.<span style='font-size:10.5pt;font-family:等线;color:windowtext;
text-decoration:none'>&nbsp;&nbsp; </span><span lang=EN-US><span lang=EN-US>辅助跳入内核函数</span></span><span
style='color:windowtext;display:none;text-decoration:none'>.. </span><span
style='color:windowtext;display:none;text-decoration:none'>41</span></a></span></p>

<p class=MsoToc3 style='margin-left:42.0pt'><span lang=EN-US><a
href="#_Toc10938187">6.<span style='font-size:10.5pt;font-family:等线;color:windowtext;
text-decoration:none'>&nbsp;&nbsp; </span><span lang=EN-US><span lang=EN-US>内核</span></span><span
style='color:windowtext;display:none;text-decoration:none'>.. </span><span
style='color:windowtext;display:none;text-decoration:none'>42</span></a></span></p>

<p class=MsoToc3 style='margin-left:42.0pt'><span lang=EN-US><a
href="#_Toc10938188">7.<span style='font-size:10.5pt;font-family:等线;color:windowtext;
text-decoration:none'>&nbsp;&nbsp; </span>C<span lang=EN-US><span lang=EN-US>语言标准函数库</span></span><span
style='color:windowtext;display:none;text-decoration:none'>.. </span><span
style='color:windowtext;display:none;text-decoration:none'>43</span></a></span></p>

<p class=MsoToc4 style='margin-left:63.0pt'><span lang=EN-US><a
href="#_Toc10938189">1)<span style='font-family:等线;color:windowtext;text-decoration:
none'>&nbsp;&nbsp;&nbsp; </span>bool.h<span style='color:windowtext;display:
none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>43</span></a></span></p>

<p class=MsoToc4 style='margin-left:63.0pt'><span lang=EN-US><a
href="#_Toc10938190">2)<span style='font-family:等线;color:windowtext;text-decoration:
none'>&nbsp;&nbsp;&nbsp; </span>ctype.h<span style='color:windowtext;
display:none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>44</span></a></span></p>

<p class=MsoToc4 style='margin-left:63.0pt'><span lang=EN-US><a
href="#_Toc10938191">3)<span style='font-family:等线;color:windowtext;text-decoration:
none'>&nbsp;&nbsp;&nbsp; </span>stddef.h<span style='color:windowtext;
display:none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>44</span></a></span></p>

<p class=MsoToc4 style='margin-left:63.0pt'><span lang=EN-US><a
href="#_Toc10938192">4)<span style='font-family:等线;color:windowtext;text-decoration:
none'>&nbsp;&nbsp;&nbsp; </span>stdio.h<span style='color:windowtext;
display:none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>44</span></a></span></p>

<p class=MsoToc4 style='margin-left:63.0pt'><span lang=EN-US><a
href="#_Toc10938193">5)<span style='font-family:等线;color:windowtext;text-decoration:
none'>&nbsp;&nbsp;&nbsp; </span>stdlib.h<span style='color:windowtext;
display:none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>46</span></a></span></p>

<p class=MsoToc4 style='margin-left:63.0pt'><span lang=EN-US><a
href="#_Toc10938194">6)<span style='font-family:等线;color:windowtext;text-decoration:
none'>&nbsp;&nbsp;&nbsp; </span>string.h<span style='color:windowtext;
display:none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>47</span></a></span></p>

<p class=MsoToc3 style='margin-left:42.0pt'><span lang=EN-US><a
href="#_Toc10938195">8.<span style='font-size:10.5pt;font-family:等线;color:windowtext;
text-decoration:none'>&nbsp;&nbsp; </span><span lang=EN-US><span lang=EN-US>保护模式下的中断机制</span></span><span
style='color:windowtext;display:none;text-decoration:none'>.. </span><span
style='color:windowtext;display:none;text-decoration:none'>48</span></a></span></p>

<p class=MsoToc4 style='margin-left:63.0pt'><span lang=EN-US><a
href="#_Toc10938196">1)<span style='font-family:等线;color:windowtext;text-decoration:
none'>&nbsp;&nbsp;&nbsp; </span><span lang=EN-US><span lang=EN-US>门描述符、中段描述符表与中段描述符表寄存器</span></span><span
style='color:windowtext;display:none;text-decoration:none'>.. </span><span
style='color:windowtext;display:none;text-decoration:none'>49</span></a></span></p>

<p class=MsoToc4 style='margin-left:63.0pt'><span lang=EN-US><a
href="#_Toc10938197">2)<span style='font-family:等线;color:windowtext;text-decoration:
none'>&nbsp;&nbsp;&nbsp; </span><span lang=EN-US><span lang=EN-US>中断处理函数</span></span><span
style='color:windowtext;display:none;text-decoration:none'>.. </span><span
style='color:windowtext;display:none;text-decoration:none'>52</span></a></span></p>

<p class=MsoToc4 style='margin-left:63.0pt'><span lang=EN-US><a
href="#_Toc10938198">3)<span style='font-family:等线;color:windowtext;text-decoration:
none'>&nbsp;&nbsp;&nbsp; </span>8259A<span lang=EN-US><span lang=EN-US>可编程中断控制器</span></span><span
style='color:windowtext;display:none;text-decoration:none'>.. </span><span
style='color:windowtext;display:none;text-decoration:none'>54</span></a></span></p>

<p class=MsoToc4 style='margin-left:63.0pt'><span lang=EN-US><a
href="#_Toc10938199">4)<span style='font-family:等线;color:windowtext;text-decoration:
none'>&nbsp;&nbsp;&nbsp; </span><span lang=EN-US><span lang=EN-US>时钟中断</span></span><span
style='color:windowtext;display:none;text-decoration:none'>.. </span><span
style='color:windowtext;display:none;text-decoration:none'>57</span></a></span></p>

<p class=MsoToc3 style='margin-left:42.0pt'><span lang=EN-US><a
href="#_Toc10938200">9.<span style='font-size:10.5pt;font-family:等线;color:windowtext;
text-decoration:none'>&nbsp;&nbsp; </span><span lang=EN-US><span lang=EN-US>驱动程序</span></span><span
style='color:windowtext;display:none;text-decoration:none'>.. </span><span
style='color:windowtext;display:none;text-decoration:none'>58</span></a></span></p>

<p class=MsoToc4 style='margin-left:63.0pt'><span lang=EN-US><a
href="#_Toc10938201">1)<span style='font-family:等线;color:windowtext;text-decoration:
none'>&nbsp;&nbsp;&nbsp; </span>I/O<span lang=EN-US><span lang=EN-US>驱动</span></span><span
style='color:windowtext;display:none;text-decoration:none'>.. </span><span
style='color:windowtext;display:none;text-decoration:none'>59</span></a></span></p>

<p class=MsoToc4 style='margin-left:63.0pt'><span lang=EN-US><a
href="#_Toc10938202">2)<span style='font-family:等线;color:windowtext;text-decoration:
none'>&nbsp;&nbsp;&nbsp; </span><span lang=EN-US><span lang=EN-US>键盘驱动</span></span><span
style='color:windowtext;display:none;text-decoration:none'>.. </span><span
style='color:windowtext;display:none;text-decoration:none'>61</span></a></span></p>

<p class=MsoToc4 style='margin-left:63.0pt'><span lang=EN-US><a
href="#_Toc10938203">3)<span style='font-family:等线;color:windowtext;text-decoration:
none'>&nbsp;&nbsp;&nbsp; </span><span lang=EN-US><span lang=EN-US>软盘驱动</span></span><span
style='color:windowtext;display:none;text-decoration:none'>.. </span><span
style='color:windowtext;display:none;text-decoration:none'>64</span></a></span></p>

<p class=MsoToc4 style='margin-left:63.0pt'><span lang=EN-US><a
href="#_Toc10938204">4)<span style='font-family:等线;color:windowtext;text-decoration:
none'>&nbsp;&nbsp;&nbsp; </span><span lang=EN-US><span lang=EN-US>文件系统驱动</span></span><span
style='color:windowtext;display:none;text-decoration:none'>.. </span><span
style='color:windowtext;display:none;text-decoration:none'>75</span></a></span></p>

<p class=MsoToc3 style='margin-left:42.0pt'><span lang=EN-US><a
href="#_Toc10938205">10.<span style='font-size:10.5pt;font-family:等线;
color:windowtext;text-decoration:none'> </span><span lang=EN-US><span
lang=EN-US>终端与shell</span></span><span style='color:windowtext;display:none;
text-decoration:none'> </span><span
style='color:windowtext;display:none;text-decoration:none'>76</span></a></span></p>

<p class=MsoToc4 style='margin-left:63.0pt'><span lang=EN-US><a
href="#_Toc10938206">1)<span style='font-family:等线;color:windowtext;text-decoration:
none'>&nbsp;&nbsp;&nbsp; </span><span lang=EN-US><span lang=EN-US>终端</span></span><span
style='color:windowtext;display:none;text-decoration:none'>.. </span><span
style='color:windowtext;display:none;text-decoration:none'>76</span></a></span></p>

<p class=MsoToc4 style='margin-left:63.0pt'><span lang=EN-US><a
href="#_Toc10938207">2)<span style='font-family:等线;color:windowtext;text-decoration:
none'>&nbsp;&nbsp;&nbsp; </span>shell<span style='color:windowtext;display:
none;text-decoration:none'> </span><span
style='color:windowtext;display:none;text-decoration:none'>77</span></a></span></p>

<p class=MsoToc3 style='margin-left:42.0pt'><span lang=EN-US><a
href="#_Toc10938208">11.<span style='font-size:10.5pt;font-family:等线;
color:windowtext;text-decoration:none'> </span>lsyOS<span lang=EN-US><span
lang=EN-US>的编译、镜像制作和运行测试示例</span></span><span style='color:windowtext;
display:none;text-decoration:none'>.. </span><span
style='color:windowtext;display:none;text-decoration:none'>78</span></a></span></p>

<p class=MsoToc2 style='margin-left:21.0pt'><span lang=EN-US><a
href="#_Toc10938209"><span lang=EN-US><span lang=EN-US>五、</span></span><span
style='font-size:10.5pt;font-family:等线;color:windowtext;text-decoration:none'>&nbsp; </span><span
lang=EN-US><span lang=EN-US>实验总结</span></span><span style='color:windowtext;
display:none;text-decoration:none'>.. </span><span
style='color:windowtext;display:none;text-decoration:none'>84</span></a></span></p>

<p class=MsoToc2 style='margin-left:21.0pt'><span lang=EN-US><a
href="#_Toc10938210"><span lang=EN-US><span lang=EN-US>六、</span></span><span
style='font-size:10.5pt;font-family:等线;color:windowtext;text-decoration:none'>&nbsp; </span><span
lang=EN-US><span lang=EN-US>参考文献</span></span><span style='color:windowtext;
display:none;text-decoration:none'>.. </span><span
style='color:windowtext;display:none;text-decoration:none'>87</span></a></span></p>

<p class=MsoNormal style='line-height:12.0pt'></p>

</div>

<span lang=EN-US style='font-size:11.0pt;font-family:华文中宋'><br clear=all
style='page-break-before:always'>
</span>

<div class=WordSection2 style='layout-grid:15.6pt'>

<h1><a name="_Toc10938155"></a><a name="_Toc10748852"></a><a name="_Toc10655565"></a><a
name="_Toc10252854"></a><a name="_Toc10138908"></a><a name="_Toc9694005"></a><a
name="_Toc9550111"></a><a name="_Toc9539582"></a><a name="_Toc9539545"></a><a
name="_Toc9539511"></a><a name="_Toc9342809"></a><a name="_Toc9342619"></a><a
name="_Toc9361256"><span style='font-family:华文中宋'>前言</span></a></h1>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>其实，前言的话语本只是零散地遍布实验报告。然而，近日发生的诸多事件与自己在撰写实验报告时的万千思绪若合一契，便打算将之整合，同时写下新的想法，展现在前言中。同时，还将以下面所提及的思想为指导进行写作，使之贯穿于本实验报告的行文中。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>最近日益紧迫的国际局势，让本人不得不居安思危。这些事让人预感到，即使在如今这样一个经济全球化，全球价值链下国际贸易分工十分成熟的时代下，经典的经济学理论对于当今的美国来说是非常不管用的。那么，我们如今所用的操作系统在不久的将来也必然会面临美国的大面积封锁，因此，自己现在做的东西还是十分有意义的。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>虽然我知道，也许我们国家缺乏的并不一定是制作操作系统的技术，缺乏的只是基于自研系统的生态链，但我想，如果能为我们国家的操作系统事业培养更多的后备力量，甚至让许多中、小学生，或是非科班出身的爱好者，也能够亲手实现自己的操作系统，这才是这一系列实验报告的真正价值。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>因而，本人打算将该系列实验报告在学期结束后进行整理、发布。所以，该系列实验报告将在保有实验报告严谨、翔实特征的基础上，以教学式的语言进行描述，让读者站在系统、系统部件的设计者角度理解大部分设计产生的初衷和缘由。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>以<span lang=EN-US>FAT12</span>文件系统的文件分配表的设计为例，本报告中将读者代入文件分配表的设计者的角色，让他们自行思考，如果将由自己来设计文件分配表，在了解文件分配表应实现的功能后，该如何着手设计呢？之后通过一个个假想设计的提出与否定，来得出一个比较合理的方案，从而自然而然地形成现有的<span
lang=EN-US>FAT</span>设计。而后，再以此为基础，稍微拓展一些与文件系统和<span lang=EN-US>FAT</span>得名的有关知识，来使得读者对文件系统的感性认识上升为理性认识。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>回到本实验的主题中来，从本实验开始，本人改做保护模式下的操作系统。由于本人的个人兴趣（突发奇想），打算采用纯<span
lang=EN-US>GCC</span>编写内核（<span lang=EN-US>GCC+</span>内联汇编）。这当中难免遇到在正常路径下无法遇到的许多困难，而其中的一些已写在了实验总结部分，还有一些便留给自己当作宝贵财富吧。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>由于在保护模式下，<span lang=EN-US>BIOS</span>中断变得不再可用，完成一件简单的工作都有可能要从底层的驱动写起，因而，本次实验的作业量还是十分之大的，本人也花了许多时间来攻坚克难。正是因为如此巨大的实验量，实验报告的内容当然也变得如此之多。因而，本人在本次实验报告中增添了含超链接的目录以及<span
lang=EN-US>PDF</span>的书签导航，以方便读者阅读。</span></p>

<p class=MsoNormal align=right style='text-align:right;text-indent:21.0pt;
line-height:150%'><span lang=EN-US style='font-family:华文中宋'>2019年5月10日</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>

<h1><a name="_Toc10938156"></a><a name="_Toc10748853"></a><a name="_Toc10655566"></a><a
name="_Toc10252855"></a><a name="_Toc10138909"></a><a name="_Toc9694006"></a><a
name="_Toc9550112"></a><a name="_Toc9539583"></a><a name="_Toc9539546"></a><a
name="_Toc9539512"></a><a name="_Toc9342810"></a><a name="_Toc9342620"></a><a
name="_Toc9361257"></a><a name="_Toc9340649"></a><a name="_Toc9282815"></a><a
name="_Toc9270554"></a><a name="_Toc9103882"><span style='font-family:华文中宋'>实验三：</span></a><span
style='font-family:华文中宋'>用汇编与</span><span lang=EN-US>C</span><span
style='font-family:华文中宋'>语言开发独立内核</span></h1>

<p class=MsoSubtitle style='margin-left:0cm;text-indent:0cm'><a
name="_Toc10938157"></a><a name="_Toc10748854"></a><a name="_Toc10655567"></a><a
name="_Toc10252856"></a><a name="_Toc10138910"></a><a name="_Toc9694007"></a><a
name="_Toc9550113"></a><a name="_Toc9539584"></a><a name="_Toc9539547"></a><a
name="_Toc9539513"></a><a name="_Toc9342811"></a><a name="_Toc9342621"></a><a
name="_Toc9361258"></a><a name="_Toc9340650"></a><a name="_Toc9282816"></a><a
name="_Toc9270555"></a><a name="_Toc9103883"></a><a name="_Toc9103822">一、<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='font-family:华文中宋'>实验目的</span></a></p>

<p class=MsoNormal style='margin-left:42.0pt;text-indent:-21.0pt;line-height:
150%'><a name="_Toc9282817"></a><a name="_Toc9270556"><span lang=EN-US
style='line-height:150%;font-family:华文中宋'>1.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='line-height:150%;font-family:华文中宋'>掌握<span
lang=EN-US>NASM</span>汇编语言与<span lang=EN-US>GCC</span>联合编程的方法；</span></a></p>

<p class=MsoNormal style='margin-left:42.0pt;text-indent:-21.0pt;line-height:
150%'><a name="_Toc9282818"></a><a name="_Toc9270557"><span lang=EN-US
style='line-height:150%;font-family:华文中宋'>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='line-height:150%;font-family:华文中宋'>实现内核与引导程序分离，掌握软盘上引导操作系统方法；</span></a></p>

<p class=MsoNormal style='margin-left:42.0pt;text-indent:-21.0pt;line-height:
150%'><a name="_Toc9282819"></a><a name="_Toc9270558"><span lang=EN-US
style='line-height:150%;font-family:华文中宋'>3.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='line-height:150%;font-family:华文中宋'>设计并实现一种简单的作业控制语言，建立具有较友好的控制命令的批处理原型操作系统，掌握操作系统提供用户界面和内部功能的实现方法</span></a><span
style='line-height:150%;font-family:华文中宋'>。</span></p>

<p class=MsoNormal style='margin-left:17.0pt;line-height:150%;text-autospace:
none'><span style='line-height:150%;font-family:华文中宋'>&nbsp;</span></p>

<p class=MsoSubtitle style='margin-left:0cm;text-indent:0cm'><a
name="_Toc10938158"></a><a name="_Toc10748855"></a><a name="_Toc10655568"></a><a
name="_Toc10252857"></a><a name="_Toc10138911"></a><a name="_Toc9694008"></a><a
name="_Toc9550114"></a><a name="_Toc9539585"></a><a name="_Toc9539548"></a><a
name="_Toc9539514"></a><a name="_Toc9342812"></a><a name="_Toc9342622"></a><a
name="_Toc9361259"></a><a name="_Toc9340651"></a><a name="_Toc9282820"></a><a
name="_Toc9270559"></a><a name="_Toc9103884"></a><a name="_Toc9103823">二、<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='font-family:华文中宋'>实验要求</span></a></p>

<p class=MsoNormal style='margin-left:42.0pt;text-indent:-21.0pt;line-height:
150%;text-autospace:none'><span style='line-height:150%;font-family:Wingdings'>n<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
style='line-height:150%;font-family:华文中宋'>用C和汇编实现操作系统内核</span></p>

<p class=MsoNormal style='margin-left:42.0pt;text-indent:-21.0pt;line-height:
150%;text-autospace:none'><span style='line-height:150%;font-family:Wingdings'>n<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
style='line-height:150%;font-family:华文中宋'>增加批处理能力</span></p>

<p class=MsoNormal style='margin-left:63.0pt;text-indent:-21.0pt;line-height:
150%;text-autospace:none'><span style='line-height:150%;font-family:Wingdings'>n<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
style='line-height:150%;font-family:华文中宋'>提供用户返回内核的一种解决方案</span></p>

<p class=MsoNormal style='margin-left:63.0pt;text-indent:-21.0pt;line-height:
150%;text-autospace:none'><span style='line-height:150%;font-family:Wingdings'>n<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
style='line-height:150%;font-family:华文中宋'>在内核的C模块中实现</span></p>

<p class=MsoNormal style='margin-left:84.0pt;text-indent:-21.0pt;line-height:
150%;text-autospace:none'><span style='line-height:150%;font-family:Wingdings'>n<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
style='line-height:150%;font-family:华文中宋'>在磁盘上建立一个表，记录用户程序的存储安排</span></p>

<p class=MsoNormal style='margin-left:84.0pt;text-indent:-21.0pt;line-height:
150%;text-autospace:none'><span style='line-height:150%;font-family:Wingdings'>n<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
style='line-height:150%;font-family:华文中宋'>可以在控制台查到用户程序的信息，如程序名、字节数、在磁盘映像文件中的位置等</span></p>

<p class=MsoNormal style='margin-left:84.0pt;text-indent:-21.0pt;line-height:
150%;text-autospace:none'><span style='line-height:150%;font-family:Wingdings'>n<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
style='line-height:150%;font-family:华文中宋'>设计一种命令，命令中可加载多个用户程序，依次执行，并能在控制台发出命令</span></p>

<p class=MsoNormal style='margin-left:84.0pt;text-indent:-21.0pt;line-height:
150%;text-autospace:none'><span style='line-height:150%;font-family:Wingdings'>n<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
style='line-height:150%;font-family:华文中宋'>在引导系统前，将一组命令存放在磁盘映像中，系统可以解释执行</span></p>

<p class=MsoNormal style='line-height:150%;text-autospace:none'><span
style='line-height:150%;font-family:华文中宋'>&nbsp;</span></p>

<p class=MsoSubtitle style='margin-left:0cm;text-indent:0cm'><a
name="_Toc10938159"></a><a name="_Toc10748856"></a><a name="_Toc10655569"></a><a
name="_Toc10252858"></a><a name="_Toc10138912"></a><a name="_Toc9694009"></a><a
name="_Toc9550115"></a><a name="_Toc9539586"></a><a name="_Toc9539549"></a><a
name="_Toc9539515"></a><a name="_Toc9342813"></a><a name="_Toc9342623"></a><a
name="_Toc9361260"></a><a name="_Toc9340652"></a><a name="_Toc9282821"></a><a
name="_Toc9270560"></a><a name="_Toc9103885"></a><a name="_Toc9103824">三、<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='font-family:华文中宋'>实验方案</span></a></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%;text-autospace:
none'><span style='line-height:150%;font-family:华文中宋'>下面，本人以图表为主，文字为辅的方式，展现在新内核下，lsyOS的启动原理、内存划分、内核的各个组成部分和源码文件结构。</span></p>

<p class=3 style='margin-left:21.0pt;text-indent:0cm'><a name="_Toc10938160"></a><a
name="_Toc10748857"></a><a name="_Toc10655570"></a><a name="_Toc10252859"></a><a
name="_Toc10138913"></a><a name="_Toc9694010"></a><a name="_Toc9550116"></a><a
name="_Toc9539587"></a><a name="_Toc9539550"></a><a name="_Toc9539516"></a><a
name="_Toc9342814"></a><a name="_Toc9342624"></a><a name="_Toc9361261"></a><a
name="_Toc9340653"></a><a name="_Toc9282822"></a><a name="_Toc9270561"><span
lang=EN-US>1.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span>lsyOS的启动原理：二次引导</a></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>由于新内核采用了<span lang=EN-US>FAT12</span>作为软盘的文件系统，而<span
lang=EN-US>FAT12</span>文件系统中规定了引导扇区的格式，这一格式已经占用了许多引导扇区的空间，若仍想只使用<span
lang=EN-US>boot</span>直接把<span lang=EN-US>kernel</span>加载至内存，并且同时进入保护模式的话，剩余空间非常有限，那么剩下的汇编代码将只能在十分拘谨的状态下编写，以防<span
lang=EN-US>boot</span>的大小大于一个扇区的大小。因而，新的<span lang=EN-US>lsyOS</span>采用了二次引导的方式进行系统的引导。具体过程如下表所示：</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=568 valign=top style='width:426.1pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <div align=center>
  <table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0 width=546
   style='width:409.25pt;border-collapse:collapse;border:none'>
   <tr>
    <td width=183 style='width:137.2pt;border:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>boot</span></p>
    </td>
    <td width=28 rowspan=2 style='width:21.3pt;border:none;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>→</span></p>
    </td>
    <td width=242 style='width:181.7pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>loader</span></p>
    </td>
    <td width=28 rowspan=2 style='width:21.3pt;border:none;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>→</span></p>
    </td>
    <td width=64 rowspan=2 style='width:47.75pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>kernel</span></p>
    </td>
   </tr>
   <tr>
    <td width=183 style='width:137.2pt;border:solid windowtext 1.0pt;
    border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=left style='margin-left:18.0pt;text-align:left;
    text-indent:-18.0pt;line-height:150%'><span lang=EN-US style='font-family:
    华文中宋'>1、<span style='font:7.0pt "Times New Roman"'> </span></span><span
    style='font-family:华文中宋'>加载<span lang=EN-US>FAT</span>的根目录区到内存</span></p>
    <p class=MsoNormal align=left style='margin-left:18.0pt;text-align:left;
    text-indent:-18.0pt;line-height:150%'><span lang=EN-US style='font-family:
    华文中宋'>2、<span style='font:7.0pt "Times New Roman"'> </span></span><span
    style='font-family:华文中宋'>从根目录区寻找<span lang=EN-US>loader</span>并加载至内存中</span></p>
    <p class=MsoNormal align=left style='margin-left:18.0pt;text-align:left;
    text-indent:-18.0pt;line-height:150%'><span lang=EN-US style='font-family:
    华文中宋'>3、<span style='font:7.0pt "Times New Roman"'> </span></span><span
    style='font-family:华文中宋'>跳入<span lang=EN-US>loader</span></span></p>
    </td>
    <td width=242 style='width:181.7pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=left style='margin-left:18.0pt;text-align:left;
    text-indent:-18.0pt;line-height:150%'><span lang=EN-US style='font-family:
    华文中宋'>1、<span style='font:7.0pt "Times New Roman"'> </span></span><span
    style='font-family:华文中宋'>从根目录区寻找<span lang=EN-US>kernel</span>并加载至内存中</span></p>
    <p class=MsoNormal align=left style='margin-left:18.0pt;text-align:left;
    text-indent:-18.0pt;line-height:150%'><span lang=EN-US style='font-family:
    华文中宋'>2、<span style='font:7.0pt "Times New Roman"'> </span></span><span
    style='font-family:华文中宋'>根据<span lang=EN-US>ELF</span>头中的相关信息将<span
    lang=EN-US>kernel</span>的程序段加载至指定位置</span></p>
    <p class=MsoNormal align=left style='margin-left:18.0pt;text-align:left;
    text-indent:-18.0pt;line-height:150%'><span lang=EN-US style='font-family:
    华文中宋'>3、<span style='font:7.0pt "Times New Roman"'> </span></span><span
    style='font-family:华文中宋'>进入保护模式</span></p>
    <p class=MsoNormal align=left style='margin-left:18.0pt;text-align:left;
    text-indent:-18.0pt;line-height:150%'><span lang=EN-US style='font-family:
    华文中宋'>4、<span style='font:7.0pt "Times New Roman"'> </span></span><span
    style='font-family:华文中宋'>跳入<span lang=EN-US>kernel</span></span></p>
    </td>
   </tr>
  </table>
  </div>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>图（<span lang=EN-US>1</span>） &nbsp;<span lang=EN-US>lsyOS</span>的引导过程</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='line-height:150%'><span lang=EN-US style='font-family:
华文中宋'>&nbsp;</span></p>

<p class=3 style='margin-left:21.0pt;text-indent:0cm'><a name="_Toc10938161"></a><a
name="_Toc10748858"></a><a name="_Toc10655571"></a><a name="_Toc10252860"></a><a
name="_Toc10138914"></a><a name="_Toc9694011"></a><a name="_Toc9550117"></a><a
name="_Toc9539588"></a><a name="_Toc9539551"></a><a name="_Toc9539517"></a><a
name="_Toc9342815"></a><a name="_Toc9342625"></a><a name="_Toc9361262"></a><a
name="_Toc9340654"></a><a name="_Toc9282823"></a><a name="_Toc9270562"><span
lang=EN-US>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span>lsyOS的内存划分</a></p>

<div align=center>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0 width=309
 style='width:232.0pt;border-collapse:collapse'>
 <tr style='height:24.95pt'>
  <td width=89 nowrap valign=bottom style='width:67.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:24.95pt'>
  <p class=MsoNormal align=right style='text-align:right'><span lang=EN-US
  style='font-size:11.0pt;color:black'>0x1000000</span></p>
  </td>
  <td width=220 nowrap style='width:165.0pt;border:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt;height:24.95pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-size:11.0pt;font-family:等线;color:black'>未用</span></p>
  </td>
 </tr>
 <tr style='height:24.95pt'>
  <td width=89 nowrap valign=bottom style='width:67.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:24.95pt'>
  <p class=MsoNormal align=right style='text-align:right'><span lang=EN-US
  style='font-size:11.0pt;color:black'>0x9FC000</span></p>
  </td>
  <td width=220 nowrap style='width:165.0pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt;height:24.95pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-size:11.0pt;font-family:等线;color:black'>扩展<span lang=EN-US>BIOS</span>数据区（<span
  lang=EN-US>EBDA</span>）</span></p>
  </td>
 </tr>
 <tr style='height:24.75pt'>
  <td width=89 nowrap valign=bottom style='width:67.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:24.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span lang=EN-US
  style='font-size:11.0pt;color:black'>0xC0000</span></p>
  </td>
  <td width=220 nowrap style='width:165.0pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt;height:24.75pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-size:11.0pt;font-family:等线;color:black'>未用</span></p>
  </td>
 </tr>
 <tr style='height:24.95pt'>
  <td width=89 nowrap valign=bottom style='width:67.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:24.95pt'>
  <p class=MsoNormal align=right style='text-align:right'><span lang=EN-US
  style='font-size:11.0pt;color:black'>0xB8000</span></p>
  </td>
  <td width=220 nowrap style='width:165.0pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt;height:24.95pt'>
  <p class=MsoNormal align=center style='text-align:center'><b><span
  style='font-size:12.0pt;font-family:等线;color:black'>显存</span></b></p>
  </td>
 </tr>
 <tr style='height:24.95pt'>
  <td width=89 nowrap valign=bottom style='width:67.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:24.95pt'></td>
  <td width=220 nowrap style='width:165.0pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt;height:24.95pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-size:11.0pt;font-family:等线;color:black'>未用</span></p>
  </td>
 </tr>
 <tr style='height:24.95pt'>
  <td width=89 nowrap valign=bottom style='width:67.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:24.95pt'>
  <p class=MsoNormal align=right style='text-align:right'><span lang=EN-US
  style='font-size:11.0pt;color:black'>0x90100</span></p>
  </td>
  <td width=220 nowrap style='width:165.0pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt;height:24.95pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-size:11.0pt;font-family:等线;color:black'>loader</span></p>
  </td>
 </tr>
 <tr style='height:24.95pt'>
  <td width=89 nowrap valign=bottom style='width:67.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:24.95pt'>
  <p class=MsoNormal align=right style='text-align:right'><span lang=EN-US
  style='font-size:11.0pt;color:black'>0x7c000</span></p>
  </td>
  <td width=220 nowrap style='width:165.0pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt;height:24.95pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-size:11.0pt;font-family:等线;color:black'>引导扇区</span></p>
  </td>
 </tr>
 <tr style='height:24.95pt'>
  <td width=89 nowrap valign=bottom style='width:67.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:24.95pt'>
  <p class=MsoNormal align=right style='text-align:right'><span lang=EN-US
  style='font-size:11.0pt;color:black'>0x69200</span></p>
  </td>
  <td width=220 nowrap style='width:165.0pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt;height:24.95pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-size:11.0pt;font-family:等线;color:black'>未用</span></p>
  </td>
 </tr>
 <tr style='height:24.95pt'>
  <td width=89 nowrap valign=bottom style='width:67.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:24.95pt'>
  <p class=MsoNormal align=right style='text-align:right'><span lang=EN-US
  style='font-size:11.0pt;color:black'>0x68000</span></p>
  </td>
  <td width=220 nowrap style='width:165.0pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt;height:24.95pt'>
  <p class=MsoNormal align=center style='text-align:center'><b><span
  style='font-size:12.0pt;font-family:等线;color:black'>根目录区缓存</span></b></p>
  </td>
 </tr>
 <tr style='height:24.95pt'>
  <td width=89 nowrap valign=bottom style='width:67.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:24.95pt'></td>
  <td width=220 nowrap style='width:165.0pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt;height:24.95pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-size:11.0pt;font-family:等线;color:black'>未用</span></p>
  </td>
 </tr>
 <tr style='height:24.95pt'>
  <td width=89 nowrap valign=bottom style='width:67.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:24.95pt'>
  <p class=MsoNormal align=right style='text-align:right'><span lang=EN-US
  style='font-size:11.0pt;color:black'>0x21000</span></p>
  </td>
  <td width=220 nowrap style='width:165.0pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt;height:24.95pt'>
  <p class=MsoNormal align=center style='text-align:center'><b><span
  lang=EN-US style='font-size:12.0pt;font-family:等线;color:black'>kernel</span></b></p>
  </td>
 </tr>
 <tr style='height:24.95pt'>
  <td width=89 nowrap valign=bottom style='width:67.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:24.95pt'>
  <p class=MsoNormal align=right style='text-align:right'><span lang=EN-US
  style='font-size:11.0pt;color:black'>0x5000</span></p>
  </td>
  <td width=220 nowrap style='width:165.0pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt;height:24.95pt'>
  <p class=MsoNormal align=center style='text-align:center'><b><span
  style='font-size:12.0pt;font-family:等线;color:black'>栈</span></b></p>
  </td>
 </tr>
 <tr style='height:24.95pt'>
  <td width=89 nowrap valign=bottom style='width:67.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:24.95pt'>
  <p class=MsoNormal align=right style='text-align:right'><span lang=EN-US
  style='font-size:11.0pt;color:black'>0x4000</span></p>
  </td>
  <td width=220 nowrap style='width:165.0pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt;height:24.95pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-size:11.0pt;font-family:等线;color:black'>BIOS</span><span
  style='font-size:11.0pt;font-family:等线;color:black'>参数区</span></p>
  </td>
 </tr>
 <tr style='height:24.95pt'>
  <td width=89 nowrap valign=bottom style='width:67.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:24.95pt'>
  <p class=MsoNormal align=right style='text-align:right'><span lang=EN-US
  style='font-size:11.0pt;color:black'>0x0</span></p>
  </td>
  <td width=220 nowrap style='width:165.0pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt;height:24.95pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-size:11.0pt;font-family:等线;color:black'>BIOS</span><span
  style='font-size:11.0pt;font-family:等线;color:black'>中断向量</span></p>
  </td>
 </tr>
</table>

</div>

<p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>

<p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
style='font-family:华文中宋'>图（<span lang=EN-US>2</span>） &nbsp;<span lang=EN-US>lsyOS</span>的内存划分</span></p>

<p class=3 style='margin-left:21.0pt;text-indent:0cm'><a name="_Toc10938162"></a><a
name="_Toc10748859"></a><a name="_Toc10655572"></a><a name="_Toc10252861"></a><a
name="_Toc10138915"></a><a name="_Toc9694012"></a><a name="_Toc9550118"></a><a
name="_Toc9539589"></a><a name="_Toc9539552"></a><a name="_Toc9539518"></a><a
name="_Toc9342816"></a><a name="_Toc9342626"></a><a name="_Toc9361263"></a><a
name="_Toc9340655"></a><a name="_Toc9282824"></a><a name="_Toc9270563"><span
lang=EN-US>3.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span>lsyOS内核的组成部分与源码的文件结构</a></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=568 valign=top style='width:426.1pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'><img width=493 height=225 id="图片 4"
  src="/assets/source/OS/2020-08-09-OS_lab3.files/image001.png"></span></p>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'><img width=552 height=415 id="图片 13"
  src="/assets/source/OS/2020-08-09-OS_lab3.files/image002.png"></span></p>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>图（<span lang=EN-US>3</span>）<span lang=EN-US>&nbsp;
  lsyOS</span>的内核的组成部分与源码的文件结构</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='line-height:150%'><span lang=EN-US style='font-family:
华文中宋'>&nbsp;</span></p>

<p class=MsoSubtitle style='margin-left:0cm;text-indent:0cm'><a
name="_Toc10938163"></a><a name="_Toc10748860"></a><a name="_Toc10655573"></a><a
name="_Toc10252862"></a><a name="_Toc10138916"></a><a name="_Toc9694013"></a><a
name="_Toc9550119"></a><a name="_Toc9539590"></a><a name="_Toc9539553"></a><a
name="_Toc9539519"></a><a name="_Toc9342817"></a><a name="_Toc9342627"></a><a
name="_Toc9361264"></a><a name="_Toc9340656"></a><a name="_Toc9282825"></a><a
name="_Toc9270564"></a><a name="_Toc9103886"></a><a name="_Toc9103825">四、<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='font-family:华文中宋'>实验</span></a><span style='font-family:华文中宋'>内容</span></p>

<p class=3 style='margin-left:0cm;text-indent:0cm'><a name="_Toc10938164"></a><a
name="_Toc10748861"></a><a name="_Toc10655574"></a><a name="_Toc10252863"></a><a
name="_Toc10138917"></a><a name="_Toc9694014"></a><a name="_Toc9550120"></a><a
name="_Toc9539591"></a><a name="_Toc9539554"></a><a name="_Toc9539520"></a><a
name="_Toc9342818"></a><a name="_Toc9342628"></a><a name="_Toc9361265"></a><a
name="_Toc9340657"></a><a name="_Toc9282826"><span lang=EN-US>1.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span>FAT12文件系统</a></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt;
line-height:150%'><span style='font-family:华文中宋'>由于无论是<span lang=EN-US>boot</span>寻找<span
lang=EN-US>loader</span>、<span lang=EN-US>loader</span>寻找<span lang=EN-US>kernel</span>，还是内核提供的控制台查询磁盘上的程序的指令、运行批处理的命令、批量执行程序的命令，甚至是引导扇区的结构，都与<span
lang=EN-US>FAT12</span>文件系统息息相关。因此，既然它如此重要，几乎处于“总揽全局”的地位，我们就先以它为线索，对与之相关的一些技术在<span
lang=EN-US>lsyOS</span>中的应用进行简要介绍。</span></p>

<p class=4 style='margin-left:0cm;text-indent:0cm'><a name="_Toc10938165"></a><a
name="_Toc10655575"></a><a name="_Toc10252864"></a><a name="_Toc10138918"></a><a
name="_Toc9694015"></a><a name="_Toc9550121"></a><a name="_Toc9539592"></a><a
name="_Toc9539555"></a><a name="_Toc9539521"></a><a name="_Toc9342819"><b><span
lang=EN-US>1)<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></b><b><span
lang=EN-US>FAT12</span>的软盘扇区组织</b></a></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>在<span lang=EN-US>FAT12</span>文件系统中，软盘内容由引导扇区、主<span
lang=EN-US>FAT</span>表、备份<span lang=EN-US>FAT</span>表、根目录区和数据区组成，具体的结构与各扇区的大小如下图所示：</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=568 valign=top style='width:426.1pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <div align=center>
  <table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0
   style='border-collapse:collapse;border:none'>
   <tr>
    <td width=53 style='width:39.6pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-size:9.0pt;font-family:华文中宋'>扇区号</span></p>
    </td>
    <td width=215 style='width:160.9pt;border:none;border-bottom:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>扇区内容</span></p>
    </td>
   </tr>
   <tr>
    <td width=53 style='width:39.6pt;border:none;border-right:dashed windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=right style='text-align:right'><span lang=EN-US
    style='font-size:9.0pt'>2879</span></p>
    <p class=MsoNormal align=right style='text-align:right'><span lang=EN-US
    style='font-size:9.0pt'>&nbsp;</span></p>
    </td>
    <td width=215 style='width:160.9pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:dashed windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>数据区（大小浮动）</span></p>
    </td>
   </tr>
   <tr>
    <td width=53 style='width:39.6pt;border:none;border-right:dashed windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=right style='text-align:right'><span lang=EN-US
    style='font-size:9.0pt'>&nbsp;</span></p>
    <p class=MsoNormal align=right style='text-align:right'><span lang=EN-US
    style='font-size:9.0pt'>19</span></p>
    </td>
    <td width=215 style='width:160.9pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:dashed windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>根目录区（大小浮动）</span></p>
    </td>
   </tr>
   <tr>
    <td width=53 style='width:39.6pt;border:none;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=right style='text-align:right'><span lang=EN-US
    style='font-size:9.0pt'>18</span></p>
    <p class=MsoNormal align=right style='text-align:right'><span lang=EN-US
    style='font-size:9.0pt'>&nbsp;</span></p>
    <p class=MsoNormal align=right style='text-align:right'><span lang=EN-US
    style='font-size:9.0pt'>10</span></p>
    </td>
    <td width=215 style='width:160.9pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>FAT2</span></p>
    </td>
   </tr>
   <tr>
    <td width=53 style='width:39.6pt;border:none;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=right style='text-align:right'><span lang=EN-US
    style='font-size:9.0pt'>9</span></p>
    <p class=MsoNormal align=right style='text-align:right'><span lang=EN-US
    style='font-size:9.0pt'>&nbsp;</span></p>
    <p class=MsoNormal align=right style='text-align:right'><span lang=EN-US
    style='font-size:9.0pt'>1</span></p>
    </td>
    <td width=215 style='width:160.9pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>FAT1</span></p>
    </td>
   </tr>
   <tr>
    <td width=53 style='width:39.6pt;border:none;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=right style='text-align:right'><span lang=EN-US
    style='font-size:9.0pt'>0</span></p>
    </td>
    <td width=215 style='width:160.9pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>引导扇区</span></p>
    </td>
   </tr>
  </table>
  </div>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>图（<span lang=EN-US>4</span>）<span lang=EN-US> <a
  name="_Hlk9341764">FAT12</a></span>的软盘扇区组织</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt;
line-height:150%'><span lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt;
line-height:150%'><span style='font-family:华文中宋'>下面，我们分别对各个软盘扇区组分及其在<span
lang=EN-US>lsyOS</span>中的应用进行简介。</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:150%'><span
lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>

<p class=4 style='margin-left:0cm;text-indent:0cm'><a name="_Toc10938166"></a><a
name="_Toc10655576"></a><a name="_Toc10252865"></a><a name="_Toc10138919"></a><a
name="_Toc9694016"></a><a name="_Toc9550122"></a><a name="_Toc9539593"></a><a
name="_Toc9539556"></a><a name="_Toc9539522"></a><a name="_Toc9342820"><b><span
lang=EN-US>2)<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></b><b><span
lang=EN-US>FAT12</span>的软盘引导扇区格式</b></a></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>首先介绍位于<span lang=EN-US>0</span>号扇区的引导扇区。在<span
lang=EN-US>FAT12</span>文件系统中，软盘引导扇区与硬盘的分区引导扇区<span lang=EN-US>DBR</span>类似，有着如下相同的格式规定：</span></p>

<div align=center>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=568 valign=top style='width:426.1pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0
   style='border-collapse:collapse;border:none'>
   <tr>
    <td width=54 valign=top style='width:40.85pt;border-top:solid #7F7F7F 1.0pt;
    border-left:none;border-bottom:solid #7F7F7F 1.0pt;border-right:none;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=left style='text-align:left'><b><span
    style='font-family:华文中宋'>序号</span></b></p>
    </td>
    <td width=151 valign=top style='width:4.0cm;border-top:solid #7F7F7F 1.0pt;
    border-left:none;border-bottom:solid #7F7F7F 1.0pt;border-right:none;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=left style='text-align:left'><b><span
    style='font-family:华文中宋'>字段</span></b></p>
    </td>
    <td width=76 valign=top style='width:2.0cm;border-top:solid #7F7F7F 1.0pt;
    border-left:none;border-bottom:solid #7F7F7F 1.0pt;border-right:none;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=left style='text-align:left'><b><span
    style='font-family:华文中宋'>字节</span></b></p>
    </td>
    <td width=287 valign=top style='width:215.15pt;border-top:solid #7F7F7F 1.0pt;
    border-left:none;border-bottom:solid #7F7F7F 1.0pt;border-right:none;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=left style='text-align:left'><b><span
    style='font-family:华文中宋'>备注</span></b></p>
    </td>
   </tr>
   <tr>
    <td width=54 valign=top style='width:40.85pt;border:none;border-bottom:
    solid #7F7F7F 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=left style='text-align:left'><b><span lang=EN-US
    style='font-family:华文中宋'>1</span></b></p>
    </td>
    <td width=151 valign=top style='width:4.0cm;border:none;border-bottom:solid #7F7F7F 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=left style='text-align:left'><span
    style='font-family:华文中宋'>跳转指令</span></p>
    </td>
    <td width=76 valign=top style='width:2.0cm;border:none;border-bottom:solid #7F7F7F 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=left style='text-align:left'><span lang=EN-US
    style='font-family:华文中宋'>3</span></p>
    </td>
    <td width=287 valign=top style='width:215.15pt;border:none;border-bottom:
    solid #7F7F7F 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=left style='text-align:left'><span
    style='font-family:华文中宋'>跳转至引导代码</span></p>
    </td>
   </tr>
   <tr>
    <td width=54 valign=top style='width:40.85pt;border:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=left style='text-align:left'><b><span lang=EN-US
    style='font-family:华文中宋'>2</span></b></p>
    </td>
    <td width=151 valign=top style='width:4.0cm;border:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=left style='text-align:left'><span
    style='font-family:华文中宋'>厂商、系统标识</span></p>
    </td>
    <td width=76 valign=top style='width:2.0cm;border:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=left style='text-align:left'><span lang=EN-US
    style='font-family:华文中宋'>8</span></p>
    </td>
    <td width=287 valign=top style='width:215.15pt;border:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=left style='text-align:left'><span
    style='font-family:华文中宋'>不同厂商和系统自定</span></p>
    </td>
   </tr>
   <tr>
    <td width=54 valign=top style='width:40.85pt;border-top:solid #7F7F7F 1.0pt;
    border-left:none;border-bottom:solid #7F7F7F 1.0pt;border-right:none;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=left style='text-align:left'><b><span lang=EN-US
    style='font-family:华文中宋'>3</span></b></p>
    </td>
    <td width=151 valign=top style='width:4.0cm;border-top:solid #7F7F7F 1.0pt;
    border-left:none;border-bottom:solid #7F7F7F 1.0pt;border-right:none;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=left style='text-align:left'><span lang=EN-US
    style='font-family:华文中宋'>BPB</span></p>
    </td>
    <td width=76 valign=top style='width:2.0cm;border-top:solid #7F7F7F 1.0pt;
    border-left:none;border-bottom:solid #7F7F7F 1.0pt;border-right:none;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=left style='text-align:left'><span lang=EN-US
    style='font-family:华文中宋'>51</span></p>
    </td>
    <td width=287 valign=top style='width:215.15pt;border-top:solid #7F7F7F 1.0pt;
    border-left:none;border-bottom:solid #7F7F7F 1.0pt;border-right:none;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=left style='text-align:left'><span lang=EN-US
    style='font-family:华文中宋'>BIOS Parameter Block</span></p>
    </td>
   </tr>
   <tr>
    <td width=54 valign=top style='width:40.85pt;border:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=left style='text-align:left'><b><span lang=EN-US
    style='font-family:华文中宋'>4</span></b></p>
    </td>
    <td width=151 valign=top style='width:4.0cm;border:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=left style='text-align:left'><span
    style='font-family:华文中宋'>操作系统引导程序</span></p>
    </td>
    <td width=76 valign=top style='width:2.0cm;border:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=left style='text-align:left'><span lang=EN-US
    style='font-family:华文中宋'>448</span></p>
    </td>
    <td width=287 valign=top style='width:215.15pt;border:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=left style='text-align:left'><span
    style='font-family:华文中宋'>引导代码、数据等</span></p>
    <p class=MsoNormal align=left style='text-align:left'><span
    style='font-family:华文中宋'>（不足<span lang=EN-US>448</span>字节处需<span
    lang=EN-US>0</span>填充）</span></p>
    </td>
   </tr>
   <tr>
    <td width=54 valign=top style='width:40.85pt;border-top:solid #7F7F7F 1.0pt;
    border-left:none;border-bottom:solid #7F7F7F 1.0pt;border-right:none;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=left style='text-align:left'><b><span lang=EN-US
    style='font-family:华文中宋'>5</span></b></p>
    </td>
    <td width=151 valign=top style='width:4.0cm;border-top:solid #7F7F7F 1.0pt;
    border-left:none;border-bottom:solid #7F7F7F 1.0pt;border-right:none;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=left style='text-align:left'><span
    style='font-family:华文中宋'>结束标志字</span></p>
    </td>
    <td width=76 valign=top style='width:2.0cm;border-top:solid #7F7F7F 1.0pt;
    border-left:none;border-bottom:solid #7F7F7F 1.0pt;border-right:none;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=left style='text-align:left'><span lang=EN-US
    style='font-family:华文中宋'>2</span></p>
    </td>
    <td width=287 valign=top style='width:215.15pt;border-top:solid #7F7F7F 1.0pt;
    border-left:none;border-bottom:solid #7F7F7F 1.0pt;border-right:none;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=left style='text-align:left'><span
    style='font-family:华文中宋'>值为<span lang=EN-US>0xAA55</span>，处于引导扇区最后</span></p>
    </td>
   </tr>
  </table>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>图（<span lang=EN-US>5</span>） &nbsp;<span lang=EN-US>FAT12</span>引导扇区的格式规定</span></p>
  </td>
 </tr>
</table>

</div>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>值得说明的是，按照这一格式规定进行我们的引导扇区编写并不是必要的。我们完全可以和原来没有加入<span
lang=EN-US>FAT12</span>文件系统时一样，从引导扇区的一开始就写引导程序。因为在<a name="_Hlk10052751">传统的<span
lang=EN-US>BIOS + MBR</span>的引导方式</a>下，<span lang=EN-US>BIOS</span>只关心引导扇区的最后两个字节的值是否为<span
lang=EN-US>0xAA55</span>，若满足条件，<span lang=EN-US>BIOS</span>便将引导扇区的内容复制到内存的指定区域。但若想让我们的软盘镜像成为一个真正的软盘镜像，且能够被镜像查看工具识别与正常加载，严格按照这一约定实现我们的操作系统的引导扇区还是很有必要的。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>那么，按照上述规定，我们便可编写<span lang=EN-US>lsyOS</span>相应的引导扇区代码。在<span
lang=EN-US>lsyOS</span>中，软盘引导扇区的具体内容如下表所示：</span></p>

<table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=568 valign=top style='width:426.1pt;border:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <div align=center>
  <table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0
   style='border-collapse:collapse;border:none'>
   <tr>
    <td width=133 style='width:99.8pt;border-top:solid #7F7F7F 1.0pt;
    border-left:none;border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    style='font-family:华文中宋'>名称</span></b></p>
    </td>
    <td width=44 style='width:32.9pt;border-top:solid #7F7F7F 1.0pt;border-left:
    none;border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    style='font-family:华文中宋'>偏移</span></b></p>
    </td>
    <td width=46 style='width:34.7pt;border-top:solid #7F7F7F 1.0pt;border-left:
    none;border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    style='font-family:华文中宋'>长度</span></b></p>
    </td>
    <td width=185 style='width:138.55pt;border-top:solid #7F7F7F 1.0pt;
    border-left:none;border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    style='font-family:华文中宋'>内容</span></b></p>
    </td>
    <td width=131 style='width:98.3pt;border-top:solid #7F7F7F 1.0pt;
    border-left:none;border-bottom:solid #D0CECE 1.0pt;border-right:none;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    lang=EN-US style='font-family:华文中宋'>lsyOS</span></b><b><span
    style='font-family:华文中宋'>的值</span></b></p>
    </td>
   </tr>
   <tr>
    <td width=133 style='width:99.8pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    lang=EN-US style='font-family:华文中宋'>BS_jmpBoot</span></b></p>
    </td>
    <td width=44 style='width:32.9pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>0</span></p>
    </td>
    <td width=46 style='width:34.7pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>3</span></p>
    </td>
    <td width=185 style='width:138.55pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>一个短跳转指令</span></p>
    </td>
    <td width=131 style='width:98.3pt;border:none;border-bottom:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=left style='text-align:left'><span lang=EN-US
    style='font-size:10.0pt;font-family:华文中宋'>jmp LABEL_START</span></p>
    <p class=MsoNormal align=left style='text-align:left'><span lang=EN-US
    style='font-size:10.0pt;font-family:华文中宋'>nop(</span><span
    style='font-size:10.0pt;font-family:华文中宋'>为凑够<span lang=EN-US>3byte)</span></span></p>
    </td>
   </tr>
   <tr>
    <td width=133 style='width:99.8pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    lang=EN-US style='font-family:华文中宋'>BS_OEMName</span></b></p>
    </td>
    <td width=44 style='width:32.9pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>3</span></p>
    </td>
    <td width=46 style='width:34.7pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>8</span></p>
    </td>
    <td width=185 style='width:138.55pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>厂商名</span></p>
    </td>
    <td width=131 style='width:98.3pt;border:none;border-bottom:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>“lsyOS&nbsp;&nbsp; ”</span></p>
    </td>
   </tr>
   <tr>
    <td width=133 style='width:99.8pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    lang=EN-US style='font-family:华文中宋'>BPB_BytsPerSec</span></b></p>
    </td>
    <td width=44 style='width:32.9pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>11</span></p>
    </td>
    <td width=46 style='width:34.7pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>2</span></p>
    </td>
    <td width=185 style='width:138.55pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>每扇区字节数</span></p>
    </td>
    <td width=131 style='width:98.3pt;border:none;border-bottom:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>0x200 (512)</span></p>
    </td>
   </tr>
   <tr>
    <td width=133 style='width:99.8pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    lang=EN-US style='font-family:华文中宋'>BPB_SecPerClus</span></b></p>
    </td>
    <td width=44 style='width:32.9pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>13</span></p>
    </td>
    <td width=46 style='width:34.7pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>1</span></p>
    </td>
    <td width=185 style='width:138.55pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>每簇扇区数</span></p>
    </td>
    <td width=131 style='width:98.3pt;border:none;border-bottom:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>0x1</span></p>
    </td>
   </tr>
   <tr>
    <td width=133 style='width:99.8pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    lang=EN-US style='font-family:华文中宋'>BPB_RsvdSecCnt</span></b></p>
    </td>
    <td width=44 style='width:32.9pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>14</span></p>
    </td>
    <td width=46 style='width:34.7pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>2</span></p>
    </td>
    <td width=185 style='width:138.55pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>Boot</span><span style='font-family:华文中宋'>占用扇区数</span></p>
    </td>
    <td width=131 style='width:98.3pt;border:none;border-bottom:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>0x1</span></p>
    </td>
   </tr>
   <tr>
    <td width=133 style='width:99.8pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    lang=EN-US style='font-family:华文中宋'>BPB_NumFATs</span></b></p>
    </td>
    <td width=44 style='width:32.9pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>16</span></p>
    </td>
    <td width=46 style='width:34.7pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>1</span></p>
    </td>
    <td width=185 style='width:138.55pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>FAT</span><span style='font-family:华文中宋'>表数</span></p>
    </td>
    <td width=131 style='width:98.3pt;border:none;border-bottom:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>0x2</span></p>
    </td>
   </tr>
   <tr>
    <td width=133 style='width:99.8pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    lang=EN-US style='font-family:华文中宋'>BPB_RootEntCnt</span></b></p>
    </td>
    <td width=44 style='width:32.9pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>17</span></p>
    </td>
    <td width=46 style='width:34.7pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>2</span></p>
    </td>
    <td width=185 style='width:138.55pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>根目录文件最大值</span></p>
    </td>
    <td width=131 style='width:98.3pt;border:none;border-bottom:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>0xE0</span></p>
    </td>
   </tr>
   <tr>
    <td width=133 style='width:99.8pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    lang=EN-US style='font-family:华文中宋'>BPB_TotSec16</span></b></p>
    </td>
    <td width=44 style='width:32.9pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>19</span></p>
    </td>
    <td width=46 style='width:34.7pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>2</span></p>
    </td>
    <td width=185 style='width:138.55pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>扇区总数</span></p>
    </td>
    <td width=131 style='width:98.3pt;border:none;border-bottom:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>0xB40</span></p>
    </td>
   </tr>
   <tr>
    <td width=133 style='width:99.8pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    lang=EN-US style='font-family:华文中宋'>BPB_Media</span></b></p>
    </td>
    <td width=44 style='width:32.9pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>21</span></p>
    </td>
    <td width=46 style='width:34.7pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>1</span></p>
    </td>
    <td width=185 style='width:138.55pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>介质描述符</span></p>
    </td>
    <td width=131 style='width:98.3pt;border:none;border-bottom:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>0xF0</span></p>
    </td>
   </tr>
   <tr>
    <td width=133 style='width:99.8pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    lang=EN-US style='font-family:华文中宋'>BPB_FATSz16</span></b></p>
    </td>
    <td width=44 style='width:32.9pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>22</span></p>
    </td>
    <td width=46 style='width:34.7pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>2</span></p>
    </td>
    <td width=185 style='width:138.55pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>一个<span lang=EN-US>FAT</span>表占用的扇区数</span></p>
    </td>
    <td width=131 style='width:98.3pt;border:none;border-bottom:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>0x9</span></p>
    </td>
   </tr>
   <tr>
    <td width=133 style='width:99.8pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    lang=EN-US style='font-family:华文中宋'>BPB_SecPerTrk</span></b></p>
    </td>
    <td width=44 style='width:32.9pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>24</span></p>
    </td>
    <td width=46 style='width:34.7pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>2</span></p>
    </td>
    <td width=185 style='width:138.55pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>每磁道扇区数</span></p>
    </td>
    <td width=131 style='width:98.3pt;border:none;border-bottom:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>0x12</span></p>
    </td>
   </tr>
   <tr>
    <td width=133 style='width:99.8pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    lang=EN-US style='font-family:华文中宋'>BPB_NumHeads</span></b></p>
    </td>
    <td width=44 style='width:32.9pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>26</span></p>
    </td>
    <td width=46 style='width:34.7pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>2</span></p>
    </td>
    <td width=185 style='width:138.55pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>磁头数（面数）</span></p>
    </td>
    <td width=131 style='width:98.3pt;border:none;border-bottom:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>0x2</span></p>
    </td>
   </tr>
   <tr>
    <td width=133 style='width:99.8pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    lang=EN-US style='font-family:华文中宋'>BPB_HiddSec</span></b></p>
    </td>
    <td width=44 style='width:32.9pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>28</span></p>
    </td>
    <td width=46 style='width:34.7pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>4</span></p>
    </td>
    <td width=185 style='width:138.55pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>隐藏扇区数</span></p>
    </td>
    <td width=131 style='width:98.3pt;border:none;border-bottom:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>0</span></p>
    </td>
   </tr>
   <tr>
    <td width=133 style='width:99.8pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    lang=EN-US style='font-family:华文中宋'>BPB_TotSec32</span></b></p>
    </td>
    <td width=44 style='width:32.9pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>32</span></p>
    </td>
    <td width=46 style='width:34.7pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>4</span></p>
    </td>
    <td width=185 style='width:138.55pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>若<span lang=EN-US>BPB_TotSec16</span>值为<span
    lang=EN-US>0</span>该项生效，记录扇区总数</span></p>
    </td>
    <td width=131 style='width:98.3pt;border:none;border-bottom:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>0</span></p>
    </td>
   </tr>
   <tr>
    <td width=133 style='width:99.8pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    lang=EN-US style='font-family:华文中宋'>BS_DrvNum</span></b></p>
    </td>
    <td width=44 style='width:32.9pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>36</span></p>
    </td>
    <td width=46 style='width:34.7pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>1</span></p>
    </td>
    <td width=185 style='width:138.55pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>中断<span lang=EN-US>13</span>的驱动器号</span></p>
    </td>
    <td width=131 style='width:98.3pt;border:none;border-bottom:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>0</span></p>
    </td>
   </tr>
   <tr>
    <td width=133 style='width:99.8pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    lang=EN-US style='font-family:华文中宋'>BS_Reserved1</span></b></p>
    </td>
    <td width=44 style='width:32.9pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>37</span></p>
    </td>
    <td width=46 style='width:34.7pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>1</span></p>
    </td>
    <td width=185 style='width:138.55pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>保留字，供应用程序使用</span></p>
    </td>
    <td width=131 style='width:98.3pt;border:none;border-bottom:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>0</span></p>
    </td>
   </tr>
   <tr>
    <td width=133 style='width:99.8pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    lang=EN-US style='font-family:华文中宋'>BS_BootSig</span></b></p>
    </td>
    <td width=44 style='width:32.9pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>38</span></p>
    </td>
    <td width=46 style='width:34.7pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>1</span></p>
    </td>
    <td width=185 style='width:138.55pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>扩展引导标记<span lang=EN-US>(29h)</span></span></p>
    </td>
    <td width=131 style='width:98.3pt;border:none;border-bottom:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>0x29</span></p>
    </td>
   </tr>
   <tr>
    <td width=133 style='width:99.8pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    lang=EN-US style='font-family:华文中宋'>BS_VolID</span></b></p>
    </td>
    <td width=44 style='width:32.9pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>39</span></p>
    </td>
    <td width=46 style='width:34.7pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>4</span></p>
    </td>
    <td width=185 style='width:138.55pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>卷序列号</span></p>
    </td>
    <td width=131 style='width:98.3pt;border:none;border-bottom:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>0</span></p>
    </td>
   </tr>
   <tr>
    <td width=133 style='width:99.8pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    lang=EN-US style='font-family:华文中宋'>BS_VolLab</span></b></p>
    </td>
    <td width=44 style='width:32.9pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>43</span></p>
    </td>
    <td width=46 style='width:34.7pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>11</span></p>
    </td>
    <td width=185 style='width:138.55pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>卷标</span></p>
    </td>
    <td width=131 style='width:98.3pt;border:none;border-bottom:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>“lsyOS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
    style='font-family:华文中宋'>”</span></p>
    </td>
   </tr>
   <tr>
    <td width=133 style='width:99.8pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    lang=EN-US style='font-family:华文中宋'>BS_FileSysType</span></b></p>
    </td>
    <td width=44 style='width:32.9pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>54</span></p>
    </td>
    <td width=46 style='width:34.7pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>8</span></p>
    </td>
    <td width=185 style='width:138.55pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>文件系统类型</span></p>
    </td>
    <td width=131 style='width:98.3pt;border:none;border-bottom:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>“FAT12”</span></p>
    </td>
   </tr>
   <tr>
    <td width=133 style='width:99.8pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    style='font-family:华文中宋'>引导程序</span></b></p>
    </td>
    <td width=44 style='width:32.9pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>62</span></p>
    </td>
    <td width=46 style='width:34.7pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>448</span></p>
    </td>
    <td width=185 style='width:138.55pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>引导代码、数据及填充字符</span></p>
    </td>
    <td width=131 style='width:98.3pt;border:none;border-bottom:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>引导代码（剩余空间<span lang=EN-US>0</span>填充）</span></p>
    </td>
   </tr>
   <tr>
    <td width=133 style='width:99.8pt;border-top:none;border-left:none;
    border-bottom:solid #7F7F7F 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    style='font-family:华文中宋'>结束标志</span></b></p>
    </td>
    <td width=44 style='width:32.9pt;border-top:none;border-left:none;
    border-bottom:solid #7F7F7F 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>510</span></p>
    </td>
    <td width=46 style='width:34.7pt;border-top:none;border-left:none;
    border-bottom:solid #7F7F7F 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>2</span></p>
    </td>
    <td width=185 style='width:138.55pt;border-top:none;border-left:none;
    border-bottom:solid #7F7F7F 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>0xAA55</span></p>
    </td>
    <td width=131 style='width:98.3pt;border:none;border-bottom:solid #7F7F7F 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>0xAA55</span></p>
    </td>
   </tr>
  </table>
  </div>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>表（<span lang=EN-US>6</span>） &nbsp;<span lang=EN-US>lsyOS</span>引导扇区的具体内容</span></p>
  <p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
  style='font-family:华文中宋'>由于<span lang=EN-US>lsyOS</span>把<span lang=EN-US>boot</span>作为引导扇区程序，因而，如图（<span
  lang=EN-US>7</span>）所示，我们只需要按上表，在<span lang=EN-US>boot</span>的开头写入对应代码，即可让我们的引导扇区成为<span
  lang=EN-US>FAT12</span>格式的引导扇区：</span></p>
  <table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
   style='border-collapse:collapse'>
   <tr>
    <td width=553 valign=top style='width:414.55pt;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
    background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;
    color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;</span><span lang=EN-US
    style='font-family:Consolas;color:#569CD6'>jmp</span><span lang=EN-US
    style='font-family:Consolas;color:#D4D4D4'> short start</span></p>
    <p class=MsoNormal align=left style='text-align:left;text-indent:23.25pt;
    line-height:14.25pt;background:#1E1E1E'><span lang=EN-US style='font-family:
    Consolas;color:#569CD6'>nop</span><span lang=EN-US style='font-family:Consolas;
    color:#D4D4D4'> </span><span lang=EN-US style='font-family:Consolas;
    color:#6A9955'>; </span><span style='font-family:宋体;color:#6A9955'>用</span><span
    lang=EN-US style='font-family:Consolas;color:#6A9955'>nop</span><span
    style='font-family:宋体;color:#6A9955'>填充满开头需要的</span><span lang=EN-US
    style='font-family:Consolas;color:#6A9955'>3</span><span style='font-family:
    宋体;color:#6A9955'>个字节</span></p>
    <p class=MsoNormal align=left style='text-align:left;text-indent:23.25pt;
    line-height:14.25pt;background:#1E1E1E'><span lang=EN-US style='font-family:
    Consolas;color:#6A9955'>&nbsp;</span></p>
    <p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
    background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;
    color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;BS_OEMName&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </span><span lang=EN-US style='font-family:Consolas;color:#4EC9B0'>DB</span><span
    lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;
    'lsyOS'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
    lang=EN-US style='font-family:Consolas;color:#6A9955'>; OEM</span><span
    style='font-family:宋体;color:#6A9955'>信息</span><span lang=EN-US
    style='font-family:Consolas;color:#6A9955'>, </span><span style='font-family:
    宋体;color:#6A9955'>必须</span><span lang=EN-US style='font-family:Consolas;
    color:#6A9955'> 8 </span><span style='font-family:宋体;color:#6A9955'>个字节</span></p>
    <p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
    background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;
    color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;BPB_BytsPerSec&nbsp; </span><span
    lang=EN-US style='font-family:Consolas;color:#4EC9B0'>DW</span><span
    lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp; </span><span
    lang=EN-US style='font-family:Consolas;color:#B5CEA8'>512</span><span
    lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    &nbsp;&nbsp;&nbsp;&nbsp;</span><span lang=EN-US style='font-family:Consolas;
    color:#6A9955'>; </span><span style='font-family:宋体;color:#6A9955'>每扇区字节数</span></p>
    <p class=MsoNormal align=left style='text-align:left;text-indent:23.25pt;
    line-height:14.25pt;background:#1E1E1E'><span lang=EN-US style='font-family:
    Consolas;color:#D4D4D4'>BPB_SecPerClus&nbsp; </span><span lang=EN-US
    style='font-family:Consolas;color:#4EC9B0'>DB</span><span lang=EN-US
    style='font-family:Consolas;color:#D4D4D4'>&nbsp; </span><span lang=EN-US
    style='font-family:Consolas;color:#B5CEA8'>1</span><span lang=EN-US
    style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    &nbsp;&nbsp;&nbsp;&nbsp;</span><span lang=EN-US style='font-family:Consolas;
    color:#6A9955'>; </span><span style='font-family:宋体;color:#6A9955'>每簇多少扇区</span></p>
    <p class=MsoNormal align=left style='text-align:left;text-indent:23.25pt;
    line-height:14.25pt;background:#1E1E1E'><span style='font-family:宋体;
    color:#6A9955'>……</span><span style='font-family:Consolas;color:#6A9955'> </span><span
    style='font-family:宋体;color:#6A9955'>……</span></p>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>图（<span lang=EN-US>7</span>） <span lang=EN-US>&nbsp;boot</span>加入<span
    lang=EN-US>FAT12</span>引导扇区的代码（节选）</span></p>
    </td>
   </tr>
  </table>
  <p class=MsoNormal style='line-height:150%'></p>
  </td>
 </tr>
</table>

<p class=4 style='margin-left:0cm;text-indent:0cm'><a name="_Toc10938167"></a><a
name="_Toc10655577"></a><a name="_Toc10252866"></a><a name="_Toc10138920"></a><a
name="_Toc9694017"></a><a name="_Toc9550123"></a><a name="_Toc9539594"></a><a
name="_Toc9539557"></a><a name="_Toc9539523"></a><a name="_Toc9342821"><b><span
lang=EN-US>3)<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></b><b><span
lang=EN-US>FAT12</span>的根目录区</b></a></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>诶？为啥我们没有按照扇区组织的顺序先介绍<span lang=EN-US>FAT</span>表，而是直接跳到根目录区了呢？因为<span
lang=EN-US>FAT</span>表的内容其实是根目录区对应条目的索引，因而，优先介绍根目录区，才能更好地理解<span lang=EN-US>FAT</span>表。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>根目录区位于备份<span lang=EN-US>FAT</span>表之后，起始扇区号为<span
lang=EN-US>19</span>，它由若干个目录条目（<span lang=EN-US>Directory Entry</span>）组成，条目的上限由引导扇区中<span
lang=EN-US>BPB_RootEntCnt</span>的值所规定，因而大小浮动。在<span lang=EN-US>lsyOS</span>中，规定<span
lang=EN-US>BPB_RootEntCnt=0xE0=224</span>，这意味着我们软盘的根目录区最多可以有<span lang=EN-US>224</span>个条目，也就是我们的软盘最多可以储存<span
lang=EN-US>224</span>个文件（含目录）。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>而每一个条目的长度为<span lang=EN-US>32</span>字节，内容及其格式如下表所示：</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=568 valign=top style='width:426.1pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <div align=center>
  <table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0 width=574
   style='width:430.4pt;border-collapse:collapse;border:none'>
   <tr>
    <td width=143 style='width:106.95pt;border-top:solid #7F7F7F 1.0pt;
    border-left:none;border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    style='font-family:华文中宋'>名称</span></b></p>
    </td>
    <td width=44 style='width:33.2pt;border-top:solid #7F7F7F 1.0pt;border-left:
    none;border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    style='font-family:华文中宋'>偏移</span></b></p>
    </td>
    <td width=47 style='width:35.2pt;border-top:solid #7F7F7F 1.0pt;border-left:
    none;border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    style='font-family:华文中宋'>长度</span></b></p>
    </td>
    <td width=340 style='width:255.05pt;border-top:solid #7F7F7F 1.0pt;
    border-left:none;border-bottom:solid #D0CECE 1.0pt;border-right:none;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    style='font-family:华文中宋'>内容</span></b></p>
    </td>
   </tr>
   <tr>
    <td width=143 style='width:106.95pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    lang=EN-US style='font-family:华文中宋'>DIR_Name</span></b></p>
    </td>
    <td width=44 style='width:33.2pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>0</span></p>
    </td>
    <td width=47 style='width:35.2pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>8</span></p>
    </td>
    <td width=340 style='width:255.05pt;border:none;border-bottom:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=left style='text-align:left'><span lang=EN-US
    style='font-family:华文中宋'>File name</span></p>
    <p class=MsoNormal align=left style='text-align:left'><span
    style='font-family:华文中宋'>文件名（大写字母储存，不足<span lang=EN-US>8</span>字节处用空格填充）</span></p>
    </td>
   </tr>
   <tr>
    <td width=143 style='width:106.95pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    lang=EN-US style='font-family:华文中宋'>DIR_Extname</span></b></p>
    </td>
    <td width=44 style='width:33.2pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>8</span></p>
    </td>
    <td width=47 style='width:35.2pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>3</span></p>
    </td>
    <td width=340 style='width:255.05pt;border:none;border-bottom:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=left style='text-align:left'><span lang=EN-US
    style='font-family:华文中宋'>Extension name</span></p>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>扩展名（大写字母储存，不足<span lang=EN-US>3</span>字节处用空格填充）</span></p>
    </td>
   </tr>
   <tr>
    <td width=143 style='width:106.95pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    lang=EN-US style='font-family:华文中宋'>DIR_Attr</span></b></p>
    </td>
    <td width=44 style='width:33.2pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>11</span></p>
    </td>
    <td width=47 style='width:35.2pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>1</span></p>
    </td>
    <td width=340 style='width:255.05pt;border:none;border-bottom:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=left style='text-align:left'><span lang=EN-US
    style='font-family:华文中宋'>File attributes</span></p>
    <p class=MsoNormal align=left style='text-align:left'><span
    style='font-family:华文中宋'>文件属性</span></p>
    <p class=MsoNormal align=left style='text-align:left'><span lang=EN-US
    style='font-family:华文中宋'>ATTR_READ_ONLY</span><span lang=EN-US>  </span><span
    lang=EN-US style='font-family:华文中宋'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0x01</span></p>
    <p class=MsoNormal align=left style='text-align:left'><span lang=EN-US
    style='font-family:华文中宋'>ATTR_HIDDEN</span><span lang=EN-US> </span><span
    lang=EN-US style='font-family:华文中宋'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0x02</span></p>
    <p class=MsoNormal align=left style='text-align:left'><span lang=EN-US
    style='font-family:华文中宋'>ATTR_SYSTEM</span><span lang=EN-US> </span><span
    lang=EN-US style='font-family:华文中宋'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0x04</span></p>
    <p class=MsoNormal align=left style='text-align:left'><span lang=EN-US
    style='font-family:华文中宋'>ATTR_VOLUME_ID</span><span lang=EN-US> </span><span
    lang=EN-US style='font-family:华文中宋'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0x08</span></p>
    <p class=MsoNormal align=left style='text-align:left'><span lang=EN-US
    style='font-family:华文中宋'>ATTR_DIRECTORY</span><span lang=EN-US> </span><span
    lang=EN-US style='font-family:华文中宋'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0x10</span></p>
    <p class=MsoNormal align=left style='text-align:left'><span lang=EN-US
    style='font-family:华文中宋'>ATTR_ARCHIVE &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0x20</span></p>
    <p class=MsoNormal align=left style='text-align:left'><span lang=EN-US
    style='font-family:华文中宋'>ATTR_LONG_NAME</span><span lang=EN-US> </span><span
    lang=EN-US style='font-family:华文中宋'>&nbsp;&nbsp;&nbsp;&nbsp; ATTR_READ_ONLY
    | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ATTR_HIDDEN
    |</span></p>
    <p class=MsoNormal align=left style='text-align:left'><span lang=EN-US
    style='font-family:华文中宋'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ATTR_SYSTEM
    |</span></p>
    <p class=MsoNormal align=left style='text-align:left'><span lang=EN-US
    style='font-family:华文中宋'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ATTR_VOLUME_ID</span></p>
    <p class=MsoNormal align=left style='text-align:left'><span
    style='font-family:华文中宋'>该属性字节的高两位为保留位，文件创建时应将其置<span lang=EN-US>0</span>，且之后不应对其进行修改或访问。</span></p>
    </td>
   </tr>
   <tr>
    <td width=143 style='width:106.95pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    lang=EN-US style='font-family:华文中宋'>DIR_NTRes</span></b></p>
    </td>
    <td width=44 style='width:33.2pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>12</span></p>
    </td>
    <td width=47 style='width:35.2pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>1</span></p>
    </td>
    <td width=340 style='width:255.05pt;border:none;border-bottom:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=left style='text-align:left'><span lang=EN-US
    style='font-family:华文中宋'>Windows NT reserved</span></p>
    <p class=MsoNormal align=left style='text-align:left'><span
    style='font-family:华文中宋'>为<span lang=EN-US>Windows NT</span>预留。文件创建时应将该字节置为<span
    lang=EN-US>0</span>，且之后不应对其进行修改或访问。</span></p>
    </td>
   </tr>
   <tr>
    <td width=143 style='width:106.95pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    lang=EN-US style='font-family:华文中宋'>DIR_CrtTimeTenth</span></b></p>
    </td>
    <td width=44 style='width:33.2pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>13</span></p>
    </td>
    <td width=47 style='width:35.2pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>1</span></p>
    </td>
    <td width=340 style='width:255.05pt;border:none;border-bottom:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=left style='text-align:left'><span
    style='font-family:华文中宋'>文件创建时间的毫秒时间戳。此字段为<span lang=EN-US>1/10</span>秒的计数。由于<span
    lang=EN-US>DIR_CrtTime</span>字段中“秒”的粒度为<span lang=EN-US>2</span>秒，因而该字段的取值范围为<span
    lang=EN-US>[0, 199]</span>。</span></p>
    </td>
   </tr>
   <tr>
    <td width=143 style='width:106.95pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    lang=EN-US style='font-family:华文中宋'>DIR_CrtTime</span></b></p>
    </td>
    <td width=44 style='width:33.2pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>14</span></p>
    </td>
    <td width=47 style='width:35.2pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>2</span></p>
    </td>
    <td width=340 style='width:255.05pt;border:none;border-bottom:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=left style='text-align:left'><span
    style='font-family:华文中宋'>文件创建时间</span></p>
    </td>
   </tr>
   <tr>
    <td width=143 style='width:106.95pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    lang=EN-US style='font-family:华文中宋'>DIR_CrtDate</span></b></p>
    </td>
    <td width=44 style='width:33.2pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>16</span></p>
    </td>
    <td width=47 style='width:35.2pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>2</span></p>
    </td>
    <td width=340 style='width:255.05pt;border:none;border-bottom:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=left style='text-align:left'><span
    style='font-family:华文中宋'>文件创建日期</span></p>
    </td>
   </tr>
   <tr>
    <td width=143 style='width:106.95pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    lang=EN-US style='font-family:华文中宋'>DIR_LstAccDate</span></b></p>
    </td>
    <td width=44 style='width:33.2pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>18</span></p>
    </td>
    <td width=47 style='width:35.2pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>2</span></p>
    </td>
    <td width=340 style='width:255.05pt;border:none;border-bottom:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=left style='text-align:left'><span
    style='font-family:华文中宋'>最后访问日期。注意，没有最后访问时间，只有日期！这是最后一次读取或写入的日期。若最后一次访问是写入，该项的值应与<span
    lang=EN-US>DIR_WrtDate</span>相同。</span></p>
    </td>
   </tr>
   <tr>
    <td width=143 style='width:106.95pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    lang=EN-US style='font-family:华文中宋'>DIR_FstClusHI</span></b></p>
    </td>
    <td width=44 style='width:33.2pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>20</span></p>
    </td>
    <td width=47 style='width:35.2pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>2</span></p>
    </td>
    <td width=340 style='width:255.05pt;border:none;border-bottom:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=left style='text-align:left'><span lang=EN-US
    style='font-family:华文中宋'>First cluster number high word</span></p>
    <p class=MsoNormal align=left style='text-align:left'><span
    style='font-family:华文中宋'>该条目对应的开始簇号的高字节。（<span lang=EN-US>FAT12</span>或<span
    lang=EN-US>FAT16</span>的卷中，该项应置为<span lang=EN-US>0</span>）</span></p>
    </td>
   </tr>
   <tr>
    <td width=143 style='width:106.95pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><a
    name="_Hlk9361249"><b><span lang=EN-US style='font-family:华文中宋'>DIR_WrtTime</span></b></a></p>
    </td>
    <td width=44 style='width:33.2pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>22</span></p>
    </td>
    <td width=47 style='width:35.2pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>2</span></p>
    </td>
    <td width=340 style='width:255.05pt;border:none;border-bottom:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=left style='text-align:left'><span
    style='font-family:华文中宋'>最后写入时间。注意，文件创建被视为写入。</span></p>
    </td>
   </tr>
   <tr>
    <td width=143 style='width:106.95pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    lang=EN-US style='font-family:华文中宋'>DIR_WrtDate</span></b></p>
    </td>
    <td width=44 style='width:33.2pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>24</span></p>
    </td>
    <td width=47 style='width:35.2pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>2</span></p>
    </td>
    <td width=340 style='width:255.05pt;border:none;border-bottom:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=left style='text-align:left'><span
    style='font-family:华文中宋'>最后写入日期。注意，文件创建被视为写入。</span></p>
    </td>
   </tr>
   <tr>
    <td width=143 style='width:106.95pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    lang=EN-US style='font-family:华文中宋'>DIR_FstClusHO</span></b></p>
    </td>
    <td width=44 style='width:33.2pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>26</span></p>
    </td>
    <td width=47 style='width:35.2pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>2</span></p>
    </td>
    <td width=340 style='width:255.05pt;border:none;border-bottom:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=left style='text-align:left'><span lang=EN-US
    style='font-family:华文中宋'>First cluster number low word</span></p>
    <p class=MsoNormal align=left style='text-align:left'><span
    style='font-family:华文中宋'>该条目对应的开始簇号的低字节。</span></p>
    </td>
   </tr>
   <tr>
    <td width=143 style='width:106.95pt;border-top:none;border-left:none;
    border-bottom:solid #7F7F7F 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    lang=EN-US style='font-family:华文中宋'>DIR_FileSize</span></b></p>
    </td>
    <td width=44 style='width:33.2pt;border-top:none;border-left:none;
    border-bottom:solid #7F7F7F 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>28</span></p>
    </td>
    <td width=47 style='width:35.2pt;border-top:none;border-left:none;
    border-bottom:solid #7F7F7F 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>4</span></p>
    </td>
    <td width=340 style='width:255.05pt;border:none;border-bottom:solid #7F7F7F 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=left style='text-align:left'><span
    style='font-family:华文中宋'>文件大小</span></p>
    </td>
   </tr>
  </table>
  </div>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>图（<span lang=EN-US>8</span>） &nbsp;<span lang=EN-US>FAT</span>文件系统的根目录区条目格式</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='line-height:150%'><span lang=EN-US style='font-family:
华文中宋'>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>下面，仅对本系统中目前用到的项加以解释，其余特殊项（如属性项、长文件名的条目形式等）的阐述详见参考文献<span
lang=EN-US>[3]</span>&#8212;&#8212;微软的<span lang=EN-US>FAT32</span>文件系统白皮书。</span></p>

<p class=MsoNormal style='margin-left:21.0pt;text-indent:-21.0pt;line-height:
150%'><span lang=EN-US style='font-family:Wingdings'>n<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span><b><span lang=EN-US style='font-family:华文中宋'>DIR_Name[0]</span></b></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>我们特别注意<span lang=EN-US>FAT</span>条目的第一个字节<span
lang=EN-US>DIR_Name[0]</span>。</span></p>

<p class=MsoNormal style='margin-left:42.0pt;text-indent:-21.0pt;line-height:
150%'><span lang=EN-US style='font-family:Wingdings'>l<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span><span style='font-family:华文中宋'>若<span lang=EN-US>DIR_Name[0] ==
0xE5</span>，则该条目为空（该条目中无文件名或目录名）。</span></p>

<p class=MsoNormal style='margin-left:42.0pt;text-indent:-21.0pt;line-height:
150%'><span lang=EN-US style='font-family:Wingdings'>l<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span><span style='font-family:华文中宋'>若<span lang=EN-US>DIR_Name[0] ==
0x00</span>，则该条目为空（同<span lang=EN-US>0xE5</span>），且该条目后的所有条目都为空。（它们的<span
lang=EN-US>DIR_Name[0]</span>也均被设为<span lang=EN-US>0x00</span>）。</span></p>

<p class=MsoNormal style='margin-left:21.0pt;text-indent:21.0pt;line-height:
150%'><span style='font-family:华文中宋'>不同于<span lang=EN-US>0xE5</span>，<span
lang=EN-US>0x00</span>表明在编写<span lang=EN-US>FAT</span>文件驱动的代码时，不必再对根目录区中的其余目录进行检测，因为它们都是空的。</span></p>

<p class=MsoNormal style='margin-left:42.0pt;text-indent:-21.0pt;line-height:
150%'><span lang=EN-US style='font-family:Wingdings'>l<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span><span style='font-family:华文中宋'>若<span lang=EN-US>DIR_Name[0] ==
0x05 </span>，则文件名在该字节的真实字符为<span lang=EN-US>0xE5</span>。<span lang=EN-US>0xE5</span>实际上是日本所用的字符集中日文汉字的一个有效的前导字节的值。做这个<span
lang=EN-US>0x05</span>的替换，是为了能正确处理日文汉字中的这个特殊文件名的情况，且不会被<span lang=EN-US>FAT</span>文件系统认为该条目为空。</span></p>

<p class=MsoNormal style='line-height:150%'><span lang=EN-US style='font-family:
华文中宋'>&nbsp;</span></p>

<p class=MsoNormal style='margin-left:21.0pt;text-indent:-21.0pt;line-height:
150%'><span lang=EN-US style='font-family:Wingdings'>n<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span><b><span style='font-family:华文中宋'>日期和时间的格式</span></b></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>许多<span lang=EN-US>FAT</span>文件系统并不支持除了<span
lang=EN-US>DIR_WrtDate</span>和<span lang=EN-US>DIR_WrtTime</span>以外的其他日期、时间字段。因此，<span
lang=EN-US>DIR_CrtTimeTenth</span>、<span lang=EN-US>DIR_CrtTime</span>、<span
lang=EN-US>DIR_CrtDate</span>和<span lang=EN-US>DIR_LstAccDate</span>实际上是可选字段。但是，<span
lang=EN-US>DIR_WrtDate</span>和<span lang=EN-US>DIR_WrtTime</span>是必须支持的。如果不支持其他日期和时间字段，则应在文件创建时将相应字段设置为<span
lang=EN-US>0</span>，并在其他文件操作中将其忽略。</span></p>

<p class=MsoNormal style='line-height:150%'><b><span style='font-size:11.0pt;
line-height:150%;font-family:华文中宋'>日期的格式</span></b></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
lang=EN-US style='font-family:华文中宋'>FAT</span><span style='font-family:华文中宋'>目录条目的日期戳是一个<span
lang=EN-US>16</span>位字段，它一般是相对于<span lang=EN-US>01/01/1980</span>的<span
lang=EN-US>MS-DOS</span>纪元的日期。具体格式如下图所示：</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=568 valign=top style='width:426.1pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <div align=center>
  <table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0
   style='border-collapse:collapse;border:none'>
   <tr>
    <td width=33 style='width:25.05pt;border:solid windowtext 1.0pt;padding:
    0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span style='font-family:华文中宋'>位</span></p>
    </td>
    <td width=33 style='width:25.05pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>15</span></p>
    </td>
    <td width=33 style='width:25.05pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>14</span></p>
    </td>
    <td width=33 style='width:25.05pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>13</span></p>
    </td>
    <td width=33 style='width:25.05pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>12</span></p>
    </td>
    <td width=33 style='width:25.05pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>11</span></p>
    </td>
    <td width=33 style='width:25.05pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>10</span></p>
    </td>
    <td width=33 style='width:25.05pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>9</span></p>
    </td>
    <td width=33 style='width:25.05pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>8</span></p>
    </td>
    <td width=33 style='width:25.05pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>7</span></p>
    </td>
    <td width=33 style='width:25.05pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>6</span></p>
    </td>
    <td width=33 style='width:25.05pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>5</span></p>
    </td>
    <td width=33 style='width:25.1pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>4</span></p>
    </td>
    <td width=33 style='width:25.1pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>3</span></p>
    </td>
    <td width=33 style='width:25.1pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>2</span></p>
    </td>
    <td width=33 style='width:25.1pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>1</span></p>
    </td>
    <td width=33 style='width:25.1pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>0</span></p>
    </td>
   </tr>
   <tr style='height:27.1pt'>
    <td width=33 rowspan=2 style='width:25.05pt;border:solid windowtext 1.0pt;
    border-top:none;padding:0cm 5.4pt 0cm 5.4pt;height:27.1pt'>
    <p class=MsoNormal style='line-height:150%'><span style='font-family:华文中宋'>含义</span></p>
    </td>
    <td width=234 colspan=7 style='width:175.35pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt;height:27.1pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>年</span></p>
    </td>
    <td width=134 colspan=4 style='width:100.2pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt;height:27.1pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>月</span></p>
    </td>
    <td width=167 colspan=5 style='width:125.5pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt;height:27.1pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>日</span></p>
    </td>
   </tr>
   <tr style='height:27.05pt'>
    <td width=234 colspan=7 style='width:175.35pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt;height:27.05pt'>
    <p class=MsoNormal style='line-height:150%'><span style='font-family:华文中宋'>从<span
    lang=EN-US>1980</span>年开始计数，范围为<span lang=EN-US>[0, 127]</span>，即可表示<span
    lang=EN-US>1980~2107</span>年。</span></p>
    </td>
    <td width=134 colspan=4 style='width:100.2pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt;height:27.05pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>范围为<span lang=EN-US>[1, 12]</span></span></p>
    </td>
    <td width=167 colspan=5 style='width:125.5pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt;height:27.05pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>范围为<span lang=EN-US>[0, 31]</span></span></p>
    </td>
   </tr>
  </table>
  </div>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>图（<span lang=EN-US>9</span>）<span lang=EN-US>&nbsp;
  FAT</span>条目中日期的格式</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='line-height:150%'><b><span style='font-size:11.0pt;
line-height:150%;font-family:华文中宋'>时间的格式</span></b></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
lang=EN-US style='font-family:华文中宋'>FAT</span><span style='font-family:华文中宋'>目录条目的时间戳是一个<span
lang=EN-US>16</span>位字段，计时精度为<span lang=EN-US>2</span>秒。具体格式如下图所示：</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=568 valign=top style='width:426.1pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <div align=center>
  <table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0
   style='border-collapse:collapse;border:none'>
   <tr>
    <td width=33 style='width:24.6pt;border:solid windowtext 1.0pt;padding:
    0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span style='font-family:华文中宋'>位</span></p>
    </td>
    <td width=33 style='width:24.95pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>15</span></p>
    </td>
    <td width=33 style='width:24.9pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>14</span></p>
    </td>
    <td width=33 style='width:24.9pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>13</span></p>
    </td>
    <td width=33 style='width:24.9pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>12</span></p>
    </td>
    <td width=33 style='width:24.9pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>11</span></p>
    </td>
    <td width=33 style='width:24.9pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>10</span></p>
    </td>
    <td width=32 style='width:24.05pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>9</span></p>
    </td>
    <td width=32 style='width:24.05pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>8</span></p>
    </td>
    <td width=32 style='width:24.05pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>7</span></p>
    </td>
    <td width=32 style='width:24.05pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>6</span></p>
    </td>
    <td width=32 style='width:24.05pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>5</span></p>
    </td>
    <td width=32 style='width:24.1pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>4</span></p>
    </td>
    <td width=32 style='width:24.1pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>3</span></p>
    </td>
    <td width=32 style='width:24.1pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>2</span></p>
    </td>
    <td width=32 style='width:24.1pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>1</span></p>
    </td>
    <td width=32 style='width:24.1pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>0</span></p>
    </td>
   </tr>
   <tr style='height:27.1pt'>
    <td width=33 rowspan=2 style='width:24.6pt;border:solid windowtext 1.0pt;
    border-top:none;padding:0cm 5.4pt 0cm 5.4pt;height:27.1pt'>
    <p class=MsoNormal style='line-height:150%'><span style='font-family:华文中宋'>含义</span></p>
    </td>
    <td width=166 colspan=5 style='width:124.55pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt;height:27.1pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>时</span></p>
    </td>
    <td width=194 colspan=6 style='width:145.15pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt;height:27.1pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>分</span></p>
    </td>
    <td width=161 colspan=5 style='width:120.5pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt;height:27.1pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>秒</span></p>
    </td>
   </tr>
   <tr style='height:27.05pt'>
    <td width=166 colspan=5 style='width:124.55pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt;height:27.05pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>范围为<span lang=EN-US>[0, 23]</span></span></p>
    </td>
    <td width=194 colspan=6 style='width:145.15pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt;height:27.05pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>范围为<span lang=EN-US>[0, 59]</span></span></p>
    </td>
    <td width=161 colspan=5 style='width:120.5pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt;height:27.05pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>范围为<span lang=EN-US>[0, 29]</span>，</span></p>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>表示<span lang=EN-US>0~58</span>秒</span></p>
    </td>
   </tr>
  </table>
  </div>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>图（<span lang=EN-US>10</span>）<span lang=EN-US>&nbsp;
  FAT</span>条目中时间的格式</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>由上图可以看出，<span lang=EN-US>FAT</span>条目中有效的时间范围为<span
lang=EN-US>00:00:00</span>至<span lang=EN-US>23:59:58</span>。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>了解微软关于<span lang=EN-US>FAT12</span>根目录区的格式规定以后，我们以<span
lang=EN-US>lsyOS</span>的软盘镜像为例，选取根目录区的一个条目进行具体分析。首先，查看镜像中的当前内容，如下图所示：</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=568 valign=top style='width:426.1pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US><img width=289 height=106
  src="/assets/source/OS/2020-08-09-OS_lab3.files/image003.png"></span></p>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>图（<span lang=EN-US>11</span>）<span lang=EN-US>&nbsp;
  lsyOS.img</span>镜像文件中的内容</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>然后，执行命令“<span lang=EN-US>hexdump -C lsyOS.img</span>”。这表示用<span
lang=EN-US>hexdump</span>以十六进制形式打开<span lang=EN-US>lsyOS.img</span>，并附加运行参数<span
lang=EN-US>-C</span>，以显示每个字节对应的<span lang=EN-US>ASCII</span>码，从而方便阅读。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>查看根目录区的首扇区（第<span lang=EN-US>19</span>个扇区）对应的位置<span
lang=EN-US>0x2600</span>（<span lang=EN-US>19</span>×<span lang=EN-US>512</span>），结果如下图所示：</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0 width=624
 style='width:467.8pt;margin-left:-22.95pt;border-collapse:collapse'>
 <tr>
  <td width=624 valign=top style='width:467.8pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>00002600&nbsp;
  4c 4f 41 44 45 52 20 20&nbsp; 20 20 20 00 08 c2 ca 7a&nbsp;
  |LOADER&nbsp;&nbsp;&nbsp;&nbsp; ....z|</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>00002610&nbsp;
  9b 4e 00 00 00 00 4d 63&nbsp; 9b 4e 02 00 ba 01 00 00&nbsp;
  |.N....Mc.N......|</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>00002620&nbsp;
  4b 45 52 4e 45 4c 20 20&nbsp; 20 20 20 00 08 07 fc 02&nbsp;
  |KERNEL&nbsp;&nbsp;&nbsp;&nbsp; .....|</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>00002630&nbsp;
  a1 4e 00 00 00 00 5b 82&nbsp; a1 4e 03 00 2c 62 00 00&nbsp;
  |.N....[..N..,b..|</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>00002640&nbsp;
  41 42 4f 55 54 20 20 20&nbsp; 4c 53 59 00 18 46 75 a4&nbsp;
  |ABOUT&nbsp;&nbsp; LSY..Fu.|</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>00002650&nbsp;
  a1 4e 00 00 00 00 76 a4&nbsp; a1 4e 35 00 00 02 00 00&nbsp;
  |.N....v..N5.....|</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas;color:red'>00002660&nbsp;
  43 4f 4d 4d 41 4e 44 20&nbsp; 42 41 54 00 18 90 0a 88&nbsp; |COMMAND
  BAT.....|</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas;color:red'>00002670&nbsp;
  a1 4e 00 00 00 00 f0 a3&nbsp; a1 4e 36 00 14 00 00 00&nbsp;
  |.N.......N6.....|</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>00002680&nbsp;
  4c 45 54 54 45 52 20 20&nbsp; 4c 53 59 00 18 30 70 a4&nbsp; |LETTER&nbsp;
  LSY..0p.|</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>00002690&nbsp;
  a1 4e 00 00 00 00 71 a4 &nbsp;a1 4e 37 00 0b 01 00 00&nbsp;
  |.N....q..N7.....|</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>000026a0&nbsp;
  00 00 00 00 00 00 00 00&nbsp; 00 00 00 00 00 00 00 00&nbsp;
  |................|</span></p>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>图（<span lang=EN-US>12</span>）<span lang=EN-US>&nbsp;
  lsyOS.img</span>镜像文件中的根目录区的内容</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>其中，每两行表示<span lang=EN-US>32</span>字节，为一个条目。由此可以看出，根目录区有<span
lang=EN-US>5</span>个条目。当然，也能很明显地看出表示文件名的字符串有<span lang=EN-US>5</span>个。那么我们以第四个文件“<span
lang=EN-US>COMMAND BAT</span>”（已用红色标出），即起始于<span lang=EN-US>0x2660</span>的第四个条目为例，查看该条目的具体内容：</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=568 valign=top style='width:426.1pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <div align=center>
  <table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0 width=574
   style='width:430.4pt;border-collapse:collapse;border:none'>
   <tr>
    <td width=143 style='width:106.95pt;border-top:solid #7F7F7F 1.0pt;
    border-left:none;border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    style='font-family:华文中宋'>名称</span></b></p>
    </td>
    <td width=102 style='width:76.2pt;border-top:solid #7F7F7F 1.0pt;
    border-left:none;border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    style='font-family:华文中宋'>值</span></b></p>
    </td>
    <td width=330 style='width:247.25pt;border-top:solid #7F7F7F 1.0pt;
    border-left:none;border-bottom:solid #D0CECE 1.0pt;border-right:none;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    style='font-family:华文中宋'>内容</span></b></p>
    </td>
   </tr>
   <tr>
    <td width=143 style='width:106.95pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    lang=EN-US style='font-family:华文中宋'>DIR_Name</span></b></p>
    </td>
    <td width=102 style='width:76.2pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>43 4f 4d 4d 41 4e 44 20</span></p>
    </td>
    <td width=330 style='width:247.25pt;border:none;border-bottom:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>“<span lang=EN-US>COMMAND </span>”</span></p>
    </td>
   </tr>
   <tr>
    <td width=143 style='width:106.95pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    lang=EN-US style='font-family:华文中宋'>DIR_Extname</span></b></p>
    </td>
    <td width=102 style='width:76.2pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>42 41 54</span></p>
    </td>
    <td width=330 style='width:247.25pt;border:none;border-bottom:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>“<span lang=EN-US>BAT</span>”</span></p>
    </td>
   </tr>
   <tr>
    <td width=143 style='width:106.95pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    lang=EN-US style='font-family:华文中宋'>DIR_Attr</span></b></p>
    </td>
    <td width=102 style='width:76.2pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>00</span></p>
    </td>
    <td width=330 style='width:247.25pt;border:none;border-bottom:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>表示普通文件</span></p>
    </td>
   </tr>
   <tr>
    <td width=143 style='width:106.95pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    lang=EN-US style='font-family:华文中宋'>DIR_NTRes</span></b></p>
    </td>
    <td width=102 style='width:76.2pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>18</span></p>
    </td>
    <td width=330 style='width:247.25pt;border:none;border-bottom:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>为<span lang=EN-US>Windows NT</span>预留</span></p>
    </td>
   </tr>
   <tr>
    <td width=143 style='width:106.95pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    lang=EN-US style='font-family:华文中宋'>DIR_CrtTimeTenth</span></b></p>
    </td>
    <td width=102 style='width:76.2pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>90</span></p>
    </td>
    <td width=330 style='width:247.25pt;border:none;border-bottom:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>文件创建的毫秒时间为<span lang=EN-US>144ms</span></span></p>
    </td>
   </tr>
   <tr>
    <td width=143 style='width:106.95pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    lang=EN-US style='font-family:华文中宋'>DIR_CrtTime</span></b></p>
    </td>
    <td width=102 style='width:76.2pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>0a 88</span></p>
    </td>
    <td width=330 style='width:247.25pt;border:none;border-bottom:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>0x880a = 10001 000000 01010b</span></p>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>时：<span lang=EN-US>10001b = 11</span>（时）</span></p>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>分：<span lang=EN-US>000001b = 0</span>（分）</span></p>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>秒：<span lang=EN-US>01010b = 17</span>（<span
    lang=EN-US>2</span>秒）<span lang=EN-US>= 34</span>秒</span></p>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>文件创建时间为<span lang=EN-US>11:00:34</span>。</span></p>
    </td>
   </tr>
   <tr>
    <td width=143 style='width:106.95pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    lang=EN-US style='font-family:华文中宋'>DIR_CrtDate</span></b></p>
    </td>
    <td width=102 style='width:76.2pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>a1 4e</span></p>
    </td>
    <td width=330 style='width:247.25pt;border:none;border-bottom:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>0x4ea2 = 0100111 0101 00010</span></p>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>年：<span lang=EN-US>0100111 = 39</span>（相对于<span
    lang=EN-US>1980</span>年）</span></p>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>月：<span lang=EN-US>0101 = 5</span>（月）</span></p>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>日：<span lang=EN-US>00010 = 1</span>（日）</span></p>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>文件创建日期为<span lang=EN-US>2019/05/01</span>。</span></p>
    </td>
   </tr>
   <tr>
    <td width=143 style='width:106.95pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    lang=EN-US style='font-family:华文中宋'>DIR_LstAccDate</span></b></p>
    </td>
    <td width=102 style='width:76.2pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>00 00</span></p>
    </td>
    <td width=330 style='width:247.25pt;border:none;border-bottom:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>最后访问日期为空，表明未曾访问该文件。</span></p>
    </td>
   </tr>
   <tr>
    <td width=143 style='width:106.95pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    lang=EN-US style='font-family:华文中宋'>DIR_FstClusHI</span></b></p>
    </td>
    <td width=102 style='width:76.2pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>00 00</span></p>
    </td>
    <td width=330 style='width:247.25pt;border:none;border-bottom:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>FAT12</span><span style='font-family:华文中宋'>的卷中，该项置为<span
    lang=EN-US>0</span></span></p>
    </td>
   </tr>
   <tr>
    <td width=143 style='width:106.95pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    lang=EN-US style='font-family:华文中宋'>DIR_WrtTime</span></b></p>
    </td>
    <td width=102 style='width:76.2pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>f0 a3</span></p>
    </td>
    <td width=330 style='width:247.25pt;border:none;border-bottom:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>最后写入时间为<span lang=EN-US>20:31:32</span></span></p>
    </td>
   </tr>
   <tr>
    <td width=143 style='width:106.95pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    lang=EN-US style='font-family:华文中宋'>DIR_WrtDate</span></b></p>
    </td>
    <td width=102 style='width:76.2pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>a1 4e</span></p>
    </td>
    <td width=330 style='width:247.25pt;border:none;border-bottom:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>最后写入日期为<span lang=EN-US>2019/05/01</span></span></p>
    </td>
   </tr>
   <tr>
    <td width=143 style='width:106.95pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    lang=EN-US style='font-family:华文中宋'>DIR_FstClusHO</span></b></p>
    </td>
    <td width=102 style='width:76.2pt;border-top:none;border-left:none;
    border-bottom:solid #D0CECE 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>36 00</span></p>
    </td>
    <td width=330 style='width:247.25pt;border:none;border-bottom:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>该条目对应的开始簇号为<span lang=EN-US>54</span></span></p>
    </td>
   </tr>
   <tr>
    <td width=143 style='width:106.95pt;border-top:none;border-left:none;
    border-bottom:solid #7F7F7F 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    lang=EN-US style='font-family:华文中宋'>DIR_FileSize</span></b></p>
    </td>
    <td width=102 style='width:76.2pt;border-top:none;border-left:none;
    border-bottom:solid #7F7F7F 1.0pt;border-right:solid #D0CECE 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>14 00 00 00</span></p>
    </td>
    <td width=330 style='width:247.25pt;border:none;border-bottom:solid #7F7F7F 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>文件大小为<span lang=EN-US>20</span>字节</span></p>
    </td>
   </tr>
  </table>
  </div>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>图（<span lang=EN-US>13</span>） &nbsp;<span
  lang=EN-US>FAT</span>文件系统的根目录区条目格式</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>至此，我们对根目录区条目的基本格式的探索已经完成。</span></p>

<p class=MsoNormal style='line-height:150%'><span lang=EN-US style='font-family:
华文中宋'>&nbsp;</span></p>

<p class=4 style='margin-left:0cm;text-indent:0cm'><a name="_Toc10938168"></a><a
name="_Toc10655578"></a><a name="_Toc10252867"></a><a name="_Toc10138921"></a><a
name="_Toc9694018"></a><a name="_Toc9550124"></a><a name="_Toc9539595"></a><a
name="_Toc9539558"></a><a name="_Toc9539524"></a><a name="_Toc9342822"><b><span
lang=EN-US>4)<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></b><b><span
lang=EN-US>FAT12</span>的文件分配表与数据区</b></a></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>在大多数文件系统中，磁盘空间的分配以簇为单位，即使某文件只有<span lang=EN-US>1</span>个字节，它也会占用一个簇的数据区的空间。当文件系统中原有的某些文件被删除后，新添加的大于一个簇大小的文件可能将不在数据区中连续存放，因而便需要一个文件分配表<span
lang=EN-US>FAT</span>（<span lang=EN-US>File Allocation Table</span>）来指明该文件被储存于哪些簇中，这也是这一文件系统的名称来源。当然，毕竟这是实现文件索引最基本的思想，迄今为止出现的<span
lang=EN-US>NTFS</span>、<span lang=EN-US>EXT4</span>等较为现代的文件系统也都使用了文件分配表，只是承载表的数据结构和<span
lang=EN-US>FAT</span>文件系统中的有所差异。但由于从<span lang=EN-US>FAT</span>这个角度命名已并不是什么新鲜事儿，这些新的文件系统当然要转而寻求新的命名方式。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>言归正传，既然要记录文件所处的一系列不连续簇，那么使用线性表充当这一载体便是很直接、很自然的想法。但具体而言该怎么操作呢？</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>假如我们采用顺序表<span lang=EN-US>array</span>作为这一载体，令表中的每一个元素<span
lang=EN-US>array[i]</span>表示文件的第<span lang=EN-US>i - 1</span>部分所处的簇，将其连续存放在指定的扇区中。那么，读取这一<span
lang=EN-US>FAT</span>表时，只需要知道表的首部所在的位置（“头指针”）和文件的大小，便可唯一确定该表。其中，表的长度由文件大小除以每一个簇的大小所确定。</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=568 valign=top style='width:426.1pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <div align=center>
  <table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0
   style='border-collapse:collapse;border:none'>
   <tr>
    <td width=59 valign=top style='width:43.95pt;border:none;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=right style='text-align:right'><span lang=EN-US
    style='font-family:华文中宋'>array</span></p>
    </td>
    <td width=144 valign=top style='width:107.65pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>array[0]</span></p>
    </td>
    <td width=118 valign=top style='width:88.25pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>array[1]</span></p>
    </td>
    <td width=28 valign=top style='width:21.3pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>…</span></p>
    </td>
    <td width=123 valign=top style='width:92.4pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>array[i]</span></p>
    </td>
    <td width=61 valign=top style='width:45.85pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>…</span></p>
    </td>
   </tr>
   <tr>
    <td width=59 valign=top style='width:43.95pt;border:none;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=right style='text-align:right'><span
    style='font-family:华文中宋'>内容</span></p>
    </td>
    <td width=144 valign=top style='width:107.65pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=left style='text-align:left'><span
    style='font-family:华文中宋'>文件第<span lang=EN-US>1</span>部分所处簇</span></p>
    </td>
    <td width=118 valign=top style='width:88.25pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>第<span lang=EN-US>2</span>部分所处簇</span></p>
    </td>
    <td width=28 valign=top style='width:21.3pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>&nbsp;</span></p>
    </td>
    <td width=123 valign=top style='width:92.4pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>第<span lang=EN-US>i</span>部分所处簇</span></p>
    </td>
    <td width=61 valign=top style='width:45.85pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>&nbsp;</span></p>
    </td>
   </tr>
   <tr>
    <td width=533 colspan=6 valign=top style='width:399.4pt;border:none;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=right style='text-align:right'><span lang=EN-US
    style='font-family:华文中宋'><img width=447 height=445 id="AutoShape 5"
    src="/assets/source/OS/2020-08-09-OS_lab3.files/image004.png"></span></p>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>表长度<span lang=EN-US> = </span>文件大小 <span
    lang=EN-US>/ </span>簇大小</span></p>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>文件信息表中（即根目录区条目）记录文件大小和头指针<span lang=EN-US>array[0]</span></span></p>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>&nbsp;</span></p>
    </td>
   </tr>
  </table>
  </div>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>图（<span lang=EN-US>14</span>） &nbsp;一种朴素的<span
  lang=EN-US>FAT</span>设计方法</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>这样的数据结构似乎很符合我们的需求，但回过头来想想我们刚刚讲过的知识，根目录区的条目用于标识某一文件基本信息，而条目中只保存着文件大小，却没有储存对应<span
lang=EN-US>FAT</span>表的“头指针”。也就是说，其实<span lang=EN-US>FAT</span>文件系统中的<span
lang=EN-US>FAT</span>表并没有采用我们上述最原始淳朴、简单易行的想法，这是为什么呢？</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>设想这么一个的情景，磁盘中某时刻的储存内容如下：文件<span lang=EN-US>1</span>，占据簇<span
lang=EN-US>1</span>、<span lang=EN-US>2</span>；文件<span lang=EN-US>2</span>，占据簇<span
lang=EN-US>3</span>；文件<span lang=EN-US>3</span>，占据簇<span lang=EN-US>4</span>、<span
lang=EN-US>5</span>；文件<span lang=EN-US>4</span>，占据簇<span lang=EN-US>6</span>；剩下的簇也被其他文件所占满。此时，磁盘<span
lang=EN-US>FAT</span>表的内容如下图所示，相同颜色的表项表示其为同一文件的<span lang=EN-US>FAT</span>表。</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=568 valign=top style='width:426.1pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <div align=center>
  <table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0
   style='border-collapse:collapse;border:none'>
   <tr>
    <td width=35 valign=top style='width:26.6pt;border:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><b><span
    lang=EN-US style='font-family:华文中宋;color:gray'>1</span></b></p>
    </td>
    <td width=35 valign=top style='width:26.6pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><b><span
    lang=EN-US style='font-family:华文中宋;color:gray'>2</span></b></p>
    </td>
    <td width=35 valign=top style='width:26.6pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><b><span
    lang=EN-US style='font-family:华文中宋;color:#0066FF'>3</span></b></p>
    </td>
    <td width=35 valign=top style='width:26.6pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><b><span
    lang=EN-US style='font-family:华文中宋;color:#70AD47'>4</span></b></p>
    </td>
    <td width=35 valign=top style='width:26.6pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><b><span
    lang=EN-US style='font-family:华文中宋;color:#70AD47'>5</span></b></p>
    </td>
    <td width=35 valign=top style='width:26.6pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><b><span
    lang=EN-US style='font-family:华文中宋;color:red'>6</span></b></p>
    </td>
    <td width=40 valign=top style='width:30.1pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><b><span
    style='font-family:华文中宋'>……</span></b></p>
    </td>
   </tr>
  </table>
  </div>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>图（<span lang=EN-US>15</span>） &nbsp;磁盘中某时刻的<span
  lang=EN-US>FAT</span>表的内容</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>此时，若将文件<span lang=EN-US>2</span>和<span lang=EN-US>4</span>删去，也即从上述<span
lang=EN-US>FAT</span>表中移出蓝色和红色对应的表项，则<span lang=EN-US>FAT</span>表变成：</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=568 valign=top style='width:426.1pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <div align=center>
  <table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0
   style='border-collapse:collapse;border:none'>
   <tr>
    <td width=35 valign=top style='width:26.6pt;border:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><b><span
    lang=EN-US style='font-family:华文中宋;color:gray'>1</span></b></p>
    </td>
    <td width=35 valign=top style='width:26.6pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><b><span
    lang=EN-US style='font-family:华文中宋;color:gray'>2</span></b></p>
    </td>
    <td width=35 valign=top style='width:26.6pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><b><span
    lang=EN-US style='font-family:华文中宋;color:#0066FF'>&nbsp;</span></b></p>
    </td>
    <td width=35 valign=top style='width:26.6pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><b><span
    lang=EN-US style='font-family:华文中宋;color:#70AD47'>4</span></b></p>
    </td>
    <td width=35 valign=top style='width:26.6pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><b><span
    lang=EN-US style='font-family:华文中宋;color:#70AD47'>5</span></b></p>
    </td>
    <td width=35 valign=top style='width:26.6pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><b><span
    lang=EN-US style='font-family:华文中宋;color:red'>&nbsp;</span></b></p>
    </td>
    <td width=40 valign=top style='width:30.1pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><b><span
    style='font-family:华文中宋'>……</span></b></p>
    </td>
   </tr>
  </table>
  </div>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>图（<span lang=EN-US>16</span>） &nbsp;删除两个文件后<span
  lang=EN-US>FAT</span>表的内容</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>若下一时刻需写入一个占据两个簇的文件，则该文件对应的<span lang=EN-US>FAT</span>表的长度为<span
lang=EN-US>2</span>。此时<span lang=EN-US>FAT</span>虽有两个空位，但由于空位并不连续，因而无法将该文件对应的<span
lang=EN-US>FAT</span>表记录下来。可想而知，若磁盘中储存的大量小文件被删除，这样的碎片空间会变得越来越多，而它们很可能无法被使用，从而造成极大的资源浪费。这便是我们设计的朴素的<span
lang=EN-US>FAT</span>表的缺陷所在。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>既然上述方法是因为连续的顺序表难以利用离散的空间而产生了缺陷，那似乎我们只需把线性表的实现换成离散的链表，就可以完美地解决这一缺陷了。事实确实如此，在现有的<span
lang=EN-US>FAT</span>文件系统中，<span lang=EN-US>FAT</span>确实就是一个链表，是定义一个文件所处范围（簇）的单链表。这里先提一些有关数据区的知识，数据区便是储存文件的内容的磁盘区域，<span
lang=EN-US>FAT</span>文件系统中规定数据区中的起始簇号为<span lang=EN-US>2</span>，那么数据区中第<span
lang=EN-US>i</span>（从<span lang=EN-US>0</span>算起）个簇的簇号为<span lang=EN-US>i + 2</span>。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>而数据区的簇号与<span lang=EN-US>FAT</span>表中的表项具有一一对应关系，数据区中的簇号为<span
lang=EN-US>i</span>的簇对应着<span lang=EN-US>FAT</span>表中的第<span lang=EN-US>i</span>（从<span
lang=EN-US>0</span>算起）个表项。而由于数据区起始簇号为<span lang=EN-US>2</span>，<span
lang=EN-US>FAT</span>表中的第<span lang=EN-US>0</span>个和第<span lang=EN-US>1</span>个表项便不使用。表项的值<span
lang=EN-US>table_value</span>为有这几种情况：</span></p>

<p class=MsoNormal style='margin-left:42.0pt;text-indent:-21.0pt;line-height:
150%'><span lang=EN-US style='font-family:Wingdings'>l<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span><b><span lang=EN-US style='font-family:华文中宋'>table_value </span></b><b><span
style='font-family:华文中宋'>≥<span lang=EN-US> 0xFF8</span></span></b></p>

<p class=MsoNormal style='margin-left:42.0pt;line-height:150%'><span
style='font-family:华文中宋'>表明已达到链表的结尾，没有下一个簇了，相当于<span lang=EN-US>C</span>语言中的<span
lang=EN-US>NULL</span>。</span></p>

<p class=MsoNormal style='margin-left:42.0pt;text-indent:-21.0pt;line-height:
150%'><span lang=EN-US style='font-family:Wingdings'>l<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span><b><span lang=EN-US style='font-family:华文中宋'>table_value = 0xFF7</span></b></p>

<p class=MsoNormal style='margin-left:42.0pt;line-height:150%'><span
style='font-family:华文中宋'>表明该簇是坏簇。当然，我们虚拟制作的软盘镜像中不会出现这种情况。</span></p>

<p class=MsoNormal style='margin-left:42.0pt;text-indent:-21.0pt;line-height:
150%'><span lang=EN-US style='font-family:Wingdings'>l<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span><b><span lang=EN-US style='font-family:华文中宋'>table_value</span></b><b><span
style='font-family:华文中宋'>为其他值</span></b></p>

<p class=MsoNormal style='margin-left:42.0pt;line-height:150%'><span
style='font-family:华文中宋'>表明文件的下一个簇的簇号为<span lang=EN-US>table_value</span>的值。<span
lang=EN-US> </span></span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>依照这样的规定，便形成了文件所处簇的单链表。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>下面具体来看<span lang=EN-US>FAT</span>的表项。因为它需要储存簇号，而<span
lang=EN-US>1.44MB</span>的<span lang=EN-US>3.5</span>英寸软盘共有<span lang=EN-US>1440</span>个簇，假设这些簇全用于储存数据，则需<span
lang=EN-US>1440</span>个簇号，而<span lang=EN-US>1440 = 101 1010 0000B</span>，则一个表项至少需要<span
lang=EN-US>11</span>个二进制位。在使用软盘的时代，一点一滴的储存空间都显得弥足珍贵，能节省一个位便节省一个位。但若直接把<span
lang=EN-US>11</span>个位作为一个表项的长度，会带来很高的编程复杂度。因而，<span lang=EN-US>FAT</span>设计者采取折中的方式，使用<span
lang=EN-US>12</span>个位作为表项长度，<span lang=EN-US>FAT12</span>也因此得名。同理，<span
lang=EN-US>FAT16</span>、<span lang=EN-US>FAT32</span>便是指<span lang=EN-US>FAT</span>表项长度分别为<span
lang=EN-US>16</span>位和<span lang=EN-US>32</span>位的文件系统。</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=568 valign=top style='width:426.1pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0
   style='border-collapse:collapse;border:none'>
   <tr>
    <td width=179 colspan=8 valign=top style='width:134.4pt;border:none;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>Byte 3</span></p>
    </td>
    <td width=15 valign=top style='width:11.05pt;border:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal><span lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
    </td>
    <td width=180 colspan=8 valign=top style='width:134.75pt;border:none;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>Byte 2</span></p>
    </td>
    <td width=15 valign=top style='width:11.1pt;border:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal><span lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
    </td>
    <td width=180 colspan=8 valign=top style='width:134.8pt;border:none;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>Byte 1</span></p>
    </td>
   </tr>
   <tr>
    <td width=22 valign=top style='width:16.8pt;border:none;border-bottom:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal><span lang=EN-US style='font-family:华文中宋'>7</span></p>
    </td>
    <td width=22 valign=top style='width:16.8pt;border:none;border-bottom:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal><span lang=EN-US style='font-family:华文中宋'>6</span></p>
    </td>
    <td width=22 valign=top style='width:16.8pt;border:none;border-bottom:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal><span lang=EN-US style='font-family:华文中宋'>5</span></p>
    </td>
    <td width=22 valign=top style='width:16.8pt;border:none;border-bottom:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal><span lang=EN-US style='font-family:华文中宋'>4</span></p>
    </td>
    <td width=22 valign=top style='width:16.8pt;border:none;border-bottom:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal><span lang=EN-US style='font-family:华文中宋'>3</span></p>
    </td>
    <td width=22 valign=top style='width:16.8pt;border:none;border-bottom:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal><span lang=EN-US style='font-family:华文中宋'>2</span></p>
    </td>
    <td width=22 valign=top style='width:16.8pt;border:none;border-bottom:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal><span lang=EN-US style='font-family:华文中宋'>1</span></p>
    </td>
    <td width=22 valign=top style='width:16.8pt;border:none;border-bottom:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal><span lang=EN-US style='font-family:华文中宋'>0</span></p>
    </td>
    <td width=15 valign=top style='width:11.05pt;border:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal><span lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
    </td>
    <td width=22 valign=top style='width:16.8pt;border:none;border-bottom:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal><span lang=EN-US style='font-family:华文中宋'>7</span></p>
    </td>
    <td width=22 valign=top style='width:16.85pt;border:none;border-bottom:
    solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal><span lang=EN-US style='font-family:华文中宋'>6</span></p>
    </td>
    <td width=22 valign=top style='width:16.85pt;border:none;border-bottom:
    solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal><span lang=EN-US style='font-family:华文中宋'>5</span></p>
    </td>
    <td width=22 valign=top style='width:16.85pt;border:none;border-bottom:
    solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal><span lang=EN-US style='font-family:华文中宋'>4</span></p>
    </td>
    <td width=22 valign=top style='width:16.85pt;border:none;border-bottom:
    solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal><span lang=EN-US style='font-family:华文中宋'>3</span></p>
    </td>
    <td width=22 valign=top style='width:16.85pt;border:none;border-bottom:
    solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal><span lang=EN-US style='font-family:华文中宋'>2</span></p>
    </td>
    <td width=22 valign=top style='width:16.85pt;border:none;border-bottom:
    solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal><span lang=EN-US style='font-family:华文中宋'>1</span></p>
    </td>
    <td width=22 valign=top style='width:16.85pt;border:none;border-bottom:
    solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal><span lang=EN-US style='font-family:华文中宋'>0</span></p>
    </td>
    <td width=15 valign=top style='width:11.1pt;border:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal><span lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
    </td>
    <td width=22 valign=top style='width:16.85pt;border:none;border-bottom:
    solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal><span lang=EN-US style='font-family:华文中宋'>7</span></p>
    </td>
    <td width=22 valign=top style='width:16.85pt;border:none;border-bottom:
    solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal><span lang=EN-US style='font-family:华文中宋'>6</span></p>
    </td>
    <td width=22 valign=top style='width:16.85pt;border:none;border-bottom:
    solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal><span lang=EN-US style='font-family:华文中宋'>5</span></p>
    </td>
    <td width=22 valign=top style='width:16.85pt;border:none;border-bottom:
    solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal><span lang=EN-US style='font-family:华文中宋'>4</span></p>
    </td>
    <td width=22 valign=top style='width:16.85pt;border:none;border-bottom:
    solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal><span lang=EN-US style='font-family:华文中宋'>3</span></p>
    </td>
    <td width=22 valign=top style='width:16.85pt;border:none;border-bottom:
    solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal><span lang=EN-US style='font-family:华文中宋'>2</span></p>
    </td>
    <td width=22 valign=top style='width:16.85pt;border:none;border-bottom:
    solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal><span lang=EN-US style='font-family:华文中宋'>1</span></p>
    </td>
    <td width=22 valign=top style='width:16.85pt;border:none;border-bottom:
    solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal><span lang=EN-US style='font-family:华文中宋'>0</span></p>
    </td>
   </tr>
   <tr>
    <td width=22 valign=top style='width:16.8pt;border:solid windowtext 1.0pt;
    border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>x</span></p>
    </td>
    <td width=22 valign=top style='width:16.8pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>x</span></p>
    </td>
    <td width=22 valign=top style='width:16.8pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>x</span></p>
    </td>
    <td width=22 valign=top style='width:16.8pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>x</span></p>
    </td>
    <td width=22 valign=top style='width:16.8pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>x</span></p>
    </td>
    <td width=22 valign=top style='width:16.8pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>x</span></p>
    </td>
    <td width=22 valign=top style='width:16.8pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>x</span></p>
    </td>
    <td width=22 valign=top style='width:16.8pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>x</span></p>
    </td>
    <td width=15 valign=top style='width:11.05pt;border:none;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>&nbsp;</span></p>
    </td>
    <td width=22 valign=top style='width:16.8pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>x</span></p>
    </td>
    <td width=22 valign=top style='width:16.85pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>x</span></p>
    </td>
    <td width=22 valign=top style='width:16.85pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>x</span></p>
    </td>
    <td width=22 valign=top style='width:16.85pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>x</span></p>
    </td>
    <td width=22 valign=top style='width:16.85pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>x</span></p>
    </td>
    <td width=22 valign=top style='width:16.85pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>x</span></p>
    </td>
    <td width=22 valign=top style='width:16.85pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>x</span></p>
    </td>
    <td width=22 valign=top style='width:16.85pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>x</span></p>
    </td>
    <td width=15 valign=top style='width:11.1pt;border:none;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>&nbsp;</span></p>
    </td>
    <td width=22 valign=top style='width:16.85pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>x</span></p>
    </td>
    <td width=22 valign=top style='width:16.85pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>x</span></p>
    </td>
    <td width=22 valign=top style='width:16.85pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>x</span></p>
    </td>
    <td width=22 valign=top style='width:16.85pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>x</span></p>
    </td>
    <td width=22 valign=top style='width:16.85pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>x</span></p>
    </td>
    <td width=22 valign=top style='width:16.85pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>x</span></p>
    </td>
    <td width=22 valign=top style='width:16.85pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>x</span></p>
    </td>
    <td width=22 valign=top style='width:16.85pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>x</span></p>
    </td>
   </tr>
  </table>
  <p class=MsoNormal><span lang=EN-US style='font-family:华文中宋'><img width=268
  height=265 id="AutoShape 7" src="/assets/source/OS/2020-08-09-OS_lab3.files/image005.png"></span><span
  lang=EN-US style='font-family:华文中宋'>&nbsp;<img width=264 height=262
  id="AutoShape 8" src="/assets/source/OS/2020-08-09-OS_lab3.files/image006.png"></span></p>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>FAT</span><span style='font-family:华文中宋'>表项<span
  lang=EN-US>2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  FAT</span>表项<span lang=EN-US>1</span></span></p>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-family:华文中宋'>图（<span lang=EN-US>17</span>）<span lang=EN-US>&nbsp;
  FAT</span>表的表项格式</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>虽然这种<span lang=EN-US>1.5</span>字节的表项令现在的我们看着还是很别扭，但在当时的环境下，这已经是十分优异的方案了。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>了解文件分配表与数据区以后，我们具体地来看看<span lang=EN-US>lsyOS.img</span>中<span
lang=EN-US>FAT</span>表的内容吧，并试着能不能利用<span lang=EN-US>FAT</span>表，找寻到数据区的文件，查看文件的内容。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>还记得先前我们画的<span lang=EN-US>FAT12</span>的软盘扇区组织图吗，软盘的<span
lang=EN-US>1-9</span>扇区为<span lang=EN-US>FAT1</span>，<span lang=EN-US>10-18</span>扇区为<span
lang=EN-US>FAT2</span>。其中，<span lang=EN-US>FAT1</span>就是我们先前所讲的<span
lang=EN-US>FAT</span>表，而<span lang=EN-US>FAT2</span>是<span lang=EN-US>FAT1</span>的备份，内容与<span
lang=EN-US>FAT1</span>完全一样。那我们便以十六进制的形式查看<span lang=EN-US>lsyOS.img</span>，并查看扇区<span
lang=EN-US>1</span>对应偏移量<span lang=EN-US>0x200</span>的内容。</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0 width=624
 style='width:467.8pt;margin-left:-22.95pt;border-collapse:collapse'>
 <tr>
  <td width=624 valign=top style='width:467.8pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>00000200&nbsp;
  <span style='color:red'>f0 </span><span style='color:#5B9BD5'>f</span><span
  style='color:red'>f</span><span style='color:#5B9BD5'> ff</span> ff 4f 00 05
  60&nbsp; 00 07 80 00 09 a0 00 0b&nbsp; |....O..`........|</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>00000210&nbsp;
  c0 00 0d e0 00 0f 00 01&nbsp; 11 20 01 13 40 01 15 60&nbsp; |.........
  ..@..`|</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>00000220&nbsp;
  01 17 80 01 19 a0 01 1b&nbsp; c0 01 1d e0 01 1f 00 02&nbsp;
  |................|</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>00000230&nbsp;
  21 20 02 23 40 02 25 60&nbsp; 02 27 80 02 29 a0 02 2b&nbsp; |!
  .#@.%`.'..)..+|</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>00000240&nbsp;
  c0 02 2d e0 02 2f 00 03&nbsp; 31 20 03 33 40 03 <span style='color:red'>ff </span>f<span
  style='color:red'>f</span>&nbsp; |..-../..1 .3@...|</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>00000250&nbsp;
  ff ff ff ff 00 00 00 00&nbsp; 00 00 00 00 00 00 00 00&nbsp;
  |................|</span></p>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>图（<span lang=EN-US>18</span>）<span lang=EN-US>&nbsp;
  lsyOS.img</span>镜像文件中的<span lang=EN-US>FAT1</span>的内容</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>其中，第<span lang=EN-US>0</span>和第<span lang=EN-US>1</span>个表项不使用，可以看出它们的默认值分别为<span
lang=EN-US>0xFF0</span>（开头红色部分）和<span lang=EN-US>0xFF</span>（蓝色部分）。而第<span
lang=EN-US>2</span>个表项为<span lang=EN-US>0xFFF</span>，表明为最后一个簇，结合图（<span
lang=EN-US>12</span>）可知，该簇对应文件<span lang=EN-US>LOADER</span>，而<span lang=EN-US>LOADER</span>只占用一个簇，符合表项。而第<span
lang=EN-US>3</span>个表项的值为<span lang=EN-US>0x004</span>，表明簇号为<span lang=EN-US>3</span>的簇的下一部分为簇号为<span
lang=EN-US>4</span>的簇，这对应文件<span lang=EN-US>kernel</span>。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>尝试查看簇号为<span lang=EN-US>3</span>的簇的内容。根据<span
lang=EN-US>FAT12</span>的软盘扇区组织图很容易知道，数据区的起始扇区位于软盘上的位置可以如下计算：</span></p>

<p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
style='font-family:华文中宋'>数据区起始扇区<span lang=EN-US> = </span>引导扇区长度 <span
lang=EN-US>+ FAT1</span>长度 <span lang=EN-US>+ FAT2</span>长度 <span lang=EN-US>+ </span>根目录区长度</span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt;
line-height:150%'><span style='font-family:华文中宋'>而根目录区条目数量为<span lang=EN-US>BPB_RootEntCnt
= 224</span>，每一个条目的长度为<span lang=EN-US>32</span>字节，那么根目录区共占用<span lang=EN-US>224
* 32 / 512 = 14</span>个扇区。因而可得到：</span></p>

<p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
style='font-family:华文中宋'>数据区起始扇区<span lang=EN-US> = 1 + 9 + 9 + 14 = 33</span>。</span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt;
line-height:150%'><span style='font-family:华文中宋'>那么簇号为<span lang=EN-US>3</span>的簇便为第<span
lang=EN-US>34</span>个扇区，偏移量为<span lang=EN-US>34 * 512 = 0x4400</span>，查看<span
lang=EN-US>lsyOS.img</span>相应位置的内容，可以看到：</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0 width=624
 style='width:467.8pt;margin-left:-22.95pt;border-collapse:collapse'>
 <tr>
  <td width=624 valign=top style='width:467.8pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>00004400&nbsp;
  7f 45 4c 46 01 01 01 00&nbsp; 00 00 00 00 00 00 00 00&nbsp;
  |.ELF............|</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>00004410&nbsp;
  02 00 03 00 01 00 00 00&nbsp; d0 10 02 00 34 00 00 00&nbsp;
  |............4...|</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>00004420&nbsp;
  9c 60 00 00 00 00 00 00&nbsp; 34 00 20 00 04 00 28 00&nbsp; |.`......4.
  ...(.|</span></p>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-family:华文中宋'>图（<span lang=EN-US>19</span>）<span lang=EN-US>&nbsp;
  lsyOS.img</span>镜像文件中的簇号为<span lang=EN-US>3</span>的数据区内容</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt;
line-height:150%'><span style='font-family:华文中宋'>这是一个典型的<span lang=EN-US>ELF</span>文件的文件头，而我们的镜像中只有<span
lang=EN-US>kernel</span>为<span lang=EN-US>ELF</span>文件，这说明我们依照<span lang=EN-US>FAT</span>表找寻到了正确的文件内容。</span></p>

<p class=3 style='margin-left:0cm;text-indent:0cm'><a name="_Toc9361266"></a><a
name="_Toc10938169"></a><a name="_Toc10748862"></a><a name="_Toc10655579"></a><a
name="_Toc10252868"></a><a name="_Toc10138922"></a><a name="_Toc9694019"></a><a
name="_Toc9550125"></a><a name="_Toc9539596"></a><a name="_Toc9539559"></a><a
name="_Toc9539525"></a><a name="_Toc9342823"></a><a name="_Toc9342629"></a><a
name="_Toc9340658"><span lang=EN-US>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;
</span></span>引导程序</a></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>本部分对应源代码“<span lang=EN-US>boot\boot.asm</span>”。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>因为从本实验开始，我们引入了<span lang=EN-US>FAT12</span>文件系统，且需要二次引导，那么引导程序便不应该和以前一样，直接从软盘的指定扇区加载<span
lang=EN-US>kernel</span>，而应该在根目录区中寻找<span lang=EN-US>loader</span>的对应条目，然后根据条目中的信息找寻到对应的<span
lang=EN-US>FAT</span>表的首地址，再根据<span lang=EN-US>FAT</span>表从数据区中读取<span
lang=EN-US>loader</span>所处的扇区到内存中，最后跳入<span lang=EN-US>loader</span>，从而完成最初的引导。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>接下来，我们分模块讲解如何实现这些功能。</span></p>

<p class=4 style='margin-left:0cm;text-indent:0cm'><a name="_Toc10938170"></a><a
name="_Toc10655580"></a><a name="_Toc10252869"></a><a name="_Toc10138923"></a><a
name="_Toc9694020"></a><a name="_Toc9550126"></a><a name="_Toc9539597"></a><a
name="_Toc9539560"></a><a name="_Toc9539526"><b><span lang=EN-US>1)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></b><b>读软盘扇区</b></a></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>由于读<span lang=EN-US>FAT</span>表、读根目录区、读数据区都需要读软盘扇区，这次我们便将读软盘写成一个函数，以实现代码重用。先来回忆一下<span
lang=EN-US>BIOS</span>中断<span lang=EN-US>int 13h</span>的用法吧。</span></p>

<table class=MsoTableGrid border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=568 valign=top style='width:426.1pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <div align=center>
  <table class=MsoTable15Plain2 border=1 cellspacing=0 cellpadding=0
   style='border-collapse:collapse;border:none'>
   <tr>
    <td width=64 style='width:47.95pt;border-top:solid #7F7F7F 1.0pt;
    border-left:none;border-bottom:solid #7F7F7F 1.0pt;border-right:solid #AEAAAA 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    style='font-family:华文中宋'>中断号</span></b></p>
    </td>
    <td width=315 style='width:236.1pt;border-top:solid #7F7F7F 1.0pt;
    border-left:none;border-bottom:solid #7F7F7F 1.0pt;border-right:solid #AEAAAA 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    style='font-family:华文中宋'>寄存器作用</span></b></p>
    </td>
    <td width=189 style='width:142.05pt;border-top:solid #7F7F7F 1.0pt;
    border-left:none;border-bottom:solid #7F7F7F 1.0pt;border-right:none;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    style='font-family:华文中宋'>中断功能</span></b></p>
    </td>
   </tr>
   <tr>
    <td width=64 style='width:47.95pt;border-top:none;border-left:none;
    border-bottom:solid #7F7F7F 1.0pt;border-right:solid #AEAAAA 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><b><span
    lang=EN-US style='font-family:华文中宋'>13h</span></b></p>
    </td>
    <td width=315 style='width:236.1pt;border-top:none;border-left:none;
    border-bottom:solid #7F7F7F 1.0pt;border-right:solid #AEAAAA 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal><span lang=EN-US style='font-family:华文中宋'>ah = 02h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; al
    = </span><span style='font-family:华文中宋'>欲读取的扇区数</span></p>
    <p class=MsoNormal><span lang=EN-US style='font-family:华文中宋'>es:bx </span><span
    style='font-family:华文中宋'>作为数据缓冲区</span></p>
    <p class=MsoNormal><span lang=EN-US style='font-family:华文中宋'>ch = </span><span
    style='font-family:华文中宋'>柱面号<span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cl
    = </span>起始扇区号</span></p>
    <p class=MsoNormal><span lang=EN-US style='font-family:华文中宋'>dh = </span><span
    style='font-family:华文中宋'>磁头号<span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dl
    = </span>驱动器号（<span lang=EN-US>0</span>表示<span lang=EN-US>A</span>盘）</span></p>
    </td>
    <td width=189 style='width:142.05pt;border:none;border-bottom:solid #7F7F7F 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal><span style='font-family:华文中宋'>从磁盘将指定的一个或多个扇区的数据读入<span
    lang=EN-US>es:bx</span>读入指向的数据缓冲区中</span></p>
    </td>
   </tr>
  </table>
  </div>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>图（<span lang=EN-US>20</span>）<span lang=EN-US>&nbsp;
  BIOS</span>中断<span lang=EN-US>int 13h</span>的用法</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>通常情况下，我们总是习惯用软盘扇区的编号来指明某个扇区，如引导扇区位于扇区<span lang=EN-US>0</span>，<span
lang=EN-US>FAT1</span>起始于扇区<span lang=EN-US>1</span>，<span lang=EN-US>FAT2</span>起始于扇区<span
lang=EN-US>9</span>等。那么，我们就还需要知道如何把扇区编号转换成<span lang=EN-US>int 13h</span>中需要的起始扇区号，柱面号和磁头号。根据<span
lang=EN-US>CHS</span>寻址方式的原理，可以得出如下的计算方法：</span></p>

<table class=MsoTableGrid border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=554 valign=top style='width:415.3pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='line-height:150%'><span
  lang=EN-US style='font-size:10.5pt;font-family:"Times New Roman",serif'><img
  width=351 height=83 src="/assets/source/OS/2020-08-09-OS_lab3.files/image007.png"></span></p>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>图（<span lang=EN-US>21</span>）<span lang=EN-US>&nbsp;
  </span>扇区编号转换成起始扇区号，柱面号和磁头号的计算方法</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>由此，便可写出如下的读软盘扇区的<a name="_Hlk9539541">函数<span
lang=EN-US>read_floppy_sector</span></a>。</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#6A9955'>;
call</span><span style='font-family:宋体;color:#6A9955'>之前把要读入的扇区号放到</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>ax(0~1439)</span><span
style='font-family:宋体;color:#6A9955'>，扇区数放到</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>cl</span><span style='font-family:
宋体;color:#6A9955'>，</span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:10.5pt;
line-height:14.25pt;background:#1E1E1E'><span style='font-family:宋体;color:#6A9955'>要加载到的内存地址偏移量放到</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>es:bx</span><span
style='font-family:宋体;color:#6A9955'>中</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>read_floppy_sector:</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; </span><a name="_Hlk9539504"><span
style='font-family:宋体;color:#6A9955'>读软盘扇区</span></a></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>push</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>bp</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>bp</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>sp</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>sub</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>esp</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>2</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; </span><span style='font-family:
宋体;color:#6A9955'>开辟两个字节的堆栈区域保存要读的扇区数</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> [</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'>bp</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> - </span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>2</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>], </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>cl</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; </span><span style='font-family:
宋体;color:#6A9955'>因为</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>push</span><span style='font-family:宋体;color:#6A9955'>一次至少十六位，所以这里需要手动存进堆栈</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>dl</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, [BPB_SecPerTrk] </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>; </span><span
style='font-family:宋体;color:#6A9955'>每磁道扇区数</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>div</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>dl</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; </span><span style='font-family:
宋体;color:#6A9955'>扇区号</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'> / </span><span style='font-family:宋体;color:#6A9955'>每磁道扇区数</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#6A9955'>; (</span><span
style='font-family:宋体;color:#6A9955'>扇区号</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'> / </span><span style='font-family:
宋体;color:#6A9955'>每磁道扇区数</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>) &gt;&gt; 1 = </span><span style='font-family:宋体;color:#6A9955'>柱面号</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#6A9955'>; (</span><span
style='font-family:宋体;color:#6A9955'>扇区号</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'> / </span><span style='font-family:
宋体;color:#6A9955'>每磁道扇区数</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>) &amp; 1 = </span><span style='font-family:宋体;color:#6A9955'>磁头号</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#6A9955'>; </span><span
style='font-family:宋体;color:#6A9955'>扇区号</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'> % </span><span style='font-family:
宋体;color:#6A9955'>每磁道扇区数</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'> + 1 = </span><span style='font-family:宋体;color:#6A9955'>起始扇区编号</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>ch</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>al</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>shr</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>ch</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>1</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; ch</span><span style='font-family:
宋体;color:#6A9955'>：柱面号</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>dh</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>al</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>and</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>dh</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>1</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; dh</span><span style='font-family:
宋体;color:#6A9955'>：磁头号</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>cl</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>ah</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>inc</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>cl</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; cl</span><span style='font-family:
宋体;color:#6A9955'>：起始扇区编号，从</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>1</span><span style='font-family:宋体;color:#6A9955'>开始计数</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#6A9955'>; </span><span
style='font-family:宋体;color:#6A9955'>完成扇区定位</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>dl</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, [BS_DrvNum] </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>; </span><span
style='font-family:宋体;color:#6A9955'>驱动器号，</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>0</span><span style='font-family:
宋体;color:#6A9955'>表示</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>A</span><span style='font-family:宋体;color:#6A9955'>盘</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>&nbsp;&nbsp;&nbsp;
.read_again:</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>ah</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>2</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; ah = 02h</span><span
style='font-family:宋体;color:#6A9955'>，表示读扇区</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>al</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, [</span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>bp</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> - </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>2</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>] </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; al</span><span style='font-family:
宋体;color:#6A9955'>：欲读入的扇区数，之前保存在堆栈中了</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>int</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>13h</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; </span><span style='font-family:
宋体;color:#6A9955'>调用</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>13h</span><span style='font-family:宋体;color:#6A9955'>中断，读磁盘</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>jc</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> .read_again </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>; </span><span
style='font-family:宋体;color:#6A9955'>如果读取错误，</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>CF</span><span style='font-family:
宋体;color:#6A9955'>被置为</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>1</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>add</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>esp</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>2</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; </span><span style='font-family:
宋体;color:#6A9955'>恢复堆栈</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>pop</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>bp</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; </span><span style='font-family:
宋体;color:#6A9955'>恢复堆栈</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>ret</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=4 style='margin-left:0cm;text-indent:0cm'><a name="_Toc10938171"></a><a
name="_Toc10655581"></a><a name="_Toc10252870"></a><a name="_Toc10138924"></a><a
name="_Toc9694021"></a><a name="_Toc9550127"></a><a name="_Toc9539598"></a><a
name="_Toc9539561"></a><a name="_Toc9539527"><b><span lang=EN-US>2)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></b><b>读入<span
lang=EN-US>FAT</span>表</b></a></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>接下来，只需把<span lang=EN-US>FAT1</span>的扇区编号<span
lang=EN-US>1</span>放入<span lang=EN-US>ax</span>，<span lang=EN-US>FAT1</span>的长度<span
lang=EN-US>9</span>放入<span lang=EN-US>cl</span>，并令<span lang=EN-US>es:bx=base_fat:0</span>，之后调用函数<span
lang=EN-US>read_floppy_sector</span>，便可将<span lang=EN-US>FAT</span>表读入内存中。</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
base_fat </span><span lang=EN-US style='font-family:Consolas;color:#4EC9B0'>equ</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> base_loader - </span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>200h</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'> </span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>read_fat_sector:</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; </span><span style='font-family:
宋体;color:#6A9955'>读入</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>FAT</span><span style='font-family:宋体;color:#6A9955'>表</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>push</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>es</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; </span><span style='font-family:
宋体;color:#6A9955'>因为要读入别的位置，所以下面会修改段地址，先保存</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>push</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>bx</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>ax</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, base_fat</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>es</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>ax</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>xor</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>bx</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>bx</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; bx = 0</span><span
style='font-family:宋体;color:#6A9955'>，从段首开始放</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>FAT</span><span style='font-family:
宋体;color:#6A9955'>表</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>9000h-120h=8ee0h</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>ax</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, sector_num_FAT1 </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>; </span><span
style='font-family:宋体;color:#6A9955'>把要读的扇区号放到</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>ax</span><span style='font-family:
宋体;color:#6A9955'>，</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>FAT</span><span style='font-family:宋体;color:#6A9955'>表</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>1</span><span
style='font-family:宋体;color:#6A9955'>的扇区号为</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>sector_num_FAT1 = 1</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>cl</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>9</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; </span><span style='font-family:
宋体;color:#6A9955'>把要读的扇区数放到</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>cl</span><span style='font-family:宋体;color:#6A9955'>，</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>FAT</span><span
style='font-family:宋体;color:#6A9955'>表</span><span lang=EN-US style='font-family:
Consolas;color:#6A9955'>1</span><span style='font-family:宋体;color:#6A9955'>的扇区数为</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>9</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>call</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> read_floppy_sector </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>; </span><span
style='font-family:宋体;color:#6A9955'>读入</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>FAT</span><span style='font-family:
宋体;color:#6A9955'>表</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>pop</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>bx</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>pop</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>es</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>ret</span></p>

<p class=4 style='margin-left:0cm;text-indent:0cm'><a name="_Toc9539528"></a><a
name="_Toc10938172"></a><a name="_Toc10655582"></a><a name="_Toc10252871"></a><a
name="_Toc10138925"></a><a name="_Toc9694022"></a><a name="_Toc9550128"></a><a
name="_Toc9539599"></a><a name="_Toc9539562"><b><span lang=EN-US>3)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></b><b>取<span
lang=EN-US>FAT</span>表的下一个</b></a><b>表项</b></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>若<span lang=EN-US>loader</span>的大小大于一个簇的大小（<span
lang=EN-US>512B</span>），那么<span lang=EN-US>loader</span>将会被存在多个簇中。这时读入一个簇后，我们需要从<span
lang=EN-US>FAT</span>表中求出该簇对应的下一个簇号，从而可以继续读取<span lang=EN-US>loader</span>的剩余部分。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>回顾之前提及的有关<span lang=EN-US>FAT</span>表的知识，由<span
lang=EN-US>FAT</span>表中的每一个表项占据<span lang=EN-US>1.5</span>字节这一原理可推出以下的表项读取方法：</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>设当前簇对应的<span lang=EN-US>FAT</span>表项相对于<span
lang=EN-US>FAT</span>表表头的偏移量为</span><span
lang=EN-US style='font-size:10.5pt;font-family:"Times New Roman",serif;
position:relative;top:4.0pt'><img width=42 height=21
src="/assets/source/OS/2020-08-09-OS_lab3.files/image008.png"></span><span style='font-family:
华文中宋'>，簇号为</span><span lang=EN-US style='font-size:10.5pt;font-family:"Times New Roman",serif;
position:relative;top:4.0pt'><img width=5 height=21
src="/assets/source/OS/2020-08-09-OS_lab3.files/image009.png"></span><span style='font-family:
华文中宋'>，则</span></p>

<p class=MsoNormal style='line-height:150%'><span
lang=EN-US style='font-size:10.5pt;font-family:"Times New Roman",serif'><img
width=84 height=21 src="/assets/source/OS/2020-08-09-OS_lab3.files/image010.png"></span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>将按字节对齐的偏移量用</span><span
lang=EN-US style='font-size:10.5pt;font-family:"Times New Roman",serif;
position:relative;top:4.0pt'><img width=45 height=21
src="/assets/source/OS/2020-08-09-OS_lab3.files/image011.png"></span><span style='font-family:
华文中宋'>表示，则有</span></p>

<p class=MsoNormal style='line-height:150%'><span
lang=EN-US style='font-size:10.5pt;font-family:"Times New Roman",serif'><img
width=97 height=21 src="/assets/source/OS/2020-08-09-OS_lab3.files/image012.png"></span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>从</span><span
lang=EN-US style='font-size:10.5pt;font-family:"Times New Roman",serif;
position:relative;top:4.0pt'><img width=45 height=21
src="/assets/source/OS/2020-08-09-OS_lab3.files/image011.png"></span><span style='font-family:
华文中宋'>开始读取连续两个字节<span lang=EN-US>Byte1</span>和<span lang=EN-US>Byte2</span>组成一个字</span><span
lang=EN-US style='font-size:10.5pt;font-family:"Times New Roman",serif;
position:relative;top:4.0pt'><img width=33 height=21
src="/assets/source/OS/2020-08-09-OS_lab3.files/image013.png"></span><span style='font-family:
华文中宋'>（<span lang=EN-US>Intel</span>意义下的“字”为两个字节）。因为表项内容为下一簇号，则将表项内容用</span><span
lang=EN-US style='font-size:10.5pt;font-family:"Times New Roman",serif;
position:relative;top:4.0pt'><img width=28 height=21
src="/assets/source/OS/2020-08-09-OS_lab3.files/image014.png"></span><span style='font-family:
华文中宋'>表示，有</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
lang=EN-US style='font-size:10.5pt;font-family:"Times New Roman",serif'><img
width=245 height=62 src="/assets/source/OS/2020-08-09-OS_lab3.files/image015.png"></span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>当然，我们在实模式下并没有使用<span lang=EN-US>X87</span>的浮点运算指令集，因而可以通过整数除法运算实现上式的等价形式：</span></p>

<p class=MsoNormal style='line-height:150%'><span
lang=EN-US style='font-size:10.5pt;font-family:"Times New Roman",serif'><img
width=279 height=62 src="/assets/source/OS/2020-08-09-OS_lab3.files/image016.png"></span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>将上述取高、低<span lang=EN-US>12</span>位的自然语言写成数学语言，便为</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
lang=EN-US style='font-size:10.5pt;font-family:"Times New Roman",serif'><img
width=289 height=62 src="/assets/source/OS/2020-08-09-OS_lab3.files/image017.png"></span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>按照这个算法，便很容易地写出求<span lang=EN-US>FAT</span>表的下一个表项的函数：</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#6A9955'>;
</span><span style='font-family:宋体;color:#6A9955'>传入参数：</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>cx:</span><span style='font-family:
宋体;color:#6A9955'>当前簇号；返回值：</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>cx:</span><span style='font-family:宋体;color:#6A9955'>下一簇号。</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#6A9955'>;
</span><span style='font-family:宋体;color:#6A9955'>注意：数据区中的第一个簇号为</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>2</span><span
style='font-family:宋体;color:#6A9955'>！</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>get_next_fat_entry:</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>push</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>es</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; </span><span style='font-family:
宋体;color:#6A9955'>因为要跳到</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>FAT</span><span style='font-family:宋体;color:#6A9955'>表的内存位置，所以下面会修改段地址，先保存</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>push</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>bx</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>ax</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, base_fat</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>es</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>ax</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#6A9955'>&nbsp;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>ax</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>3</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mul</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>cx</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; ax = 1440 * 3 = 4320</span><span
style='font-family:宋体;color:#6A9955'>，</span><span lang=EN-US style='font-family:
Consolas;color:#6A9955'>ax</span><span style='font-family:宋体;color:#6A9955'>可以存得下</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>cx</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>2</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>div</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>cx</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; ax</span><span style='font-family:
宋体;color:#6A9955'>为商，</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>dx</span><span style='font-family:宋体;color:#6A9955'>为余数</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>bx</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>ax</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; </span><span style='font-family:
宋体;color:#6A9955'>把起始字节放入</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>bx</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>cx</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, [</span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>es</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>:</span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>bx</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>] </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; </span><span style='font-family:
宋体;color:#6A9955'>读入整个条目的两个字节</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>cmp</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>dx</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>0</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; </span><span style='font-family:
宋体;color:#6A9955'>判断是否被整除。如果可以被整除，则把</span><span lang=EN-US style='font-family:
Consolas;color:#6A9955'>ah</span><span style='font-family:宋体;color:#6A9955'>的高四位全部置为</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>0</span><span
style='font-family:宋体;color:#6A9955'>；否则把</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>ax</span><span style='font-family:
宋体;color:#6A9955'>右移四位。</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>jz</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> is_divided</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#6A9955'>; </span><span
style='font-family:宋体;color:#6A9955'>不能被整除</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>shr</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>cx</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>4</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; </span><span style='font-family:
宋体;color:#6A9955'>此时高</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>4</span><span style='font-family:宋体;color:#6A9955'>位已经为</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>0</span><span
style='font-family:宋体;color:#6A9955'>了，再进行下一个的与操作也无影响，但为了不用多写两个</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>pop</span><span
style='font-family:宋体;color:#6A9955'>和一个</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>ret</span><span style='font-family:
宋体;color:#6A9955'>，所以让它多执行一个与了。</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#6A9955'>; </span><span
style='font-family:宋体;color:#6A9955'>可以被整除</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>&nbsp;&nbsp;&nbsp;
is_divided:</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>and</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>cx</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>0000111111111111b</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>pop</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>bx</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>pop</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>es</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>ret</span></p>

<p class=MsoNormal style='line-height:150%'><span lang=EN-US style='font-family:
华文中宋'>&nbsp;</span></p>

<p class=4 style='margin-left:0cm;text-indent:0cm'><a name="_Toc10938173"></a><a
name="_Toc10655583"></a><a name="_Toc10252872"></a><a name="_Toc10138926"></a><a
name="_Toc9694023"></a><a name="_Toc9550129"></a><a name="_Toc9539600"></a><a
name="_Toc9539563"><b><span lang=EN-US>4)<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;
</span></span></b><b>寻找<span lang=EN-US>loader</span></b></a></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>要加载<span lang=EN-US>loader</span>，首先就要读入根目录区，然后在根目录区寻找<span
lang=EN-US>loader</span>对应的条目。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>寻找对应条目的方法大致如下：依次遍历每个条目，取出中每个条目中的前<span lang=EN-US>11</span>个表示文件名和扩展名的字节，将其与我们预设的<span
lang=EN-US>loader</span>文件名的字符串相比较。若<span lang=EN-US>11</span>个字节都相等，则说明当前条目即为<span
lang=EN-US>loader</span>对应的条目，停止遍历；否则继续匹配下一条目。若遍历所有条目后，均没有找到匹配项，说明软盘上不存在<span
lang=EN-US>loader</span>，可以选择在屏幕上输出“<span lang=EN-US>lsyOS cannot find loader</span>”以提示用户。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>按照上述自然语言描述的算法，我们可以写出这样的汇编代码：</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#6A9955'>;
</span><span style='font-family:宋体;color:#6A9955'>寻找</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>loader</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>find_loader_in_root_directory:</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>cmp</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#4EC9B0'>word</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>
[sector_num_of_root_directory_for_loop], </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>0</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>jz</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> no_find </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>; </span><span
style='font-family:宋体;color:#6A9955'>判断是否把根目录区的所有扇区都读完了还没找到</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>loader</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>dec</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#4EC9B0'>word</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>
[sector_num_of_root_directory_for_loop] </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; </span><span style='font-family:
宋体;color:#6A9955'>如果没读完，继续读下个扇区，剩余要读扇区数</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>-1</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#6A9955'>; call</span><span
style='font-family:宋体;color:#6A9955'>之前把要读入的扇区号放到</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>ax</span><span style='font-family:
宋体;color:#6A9955'>，扇区数放到</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>cl</span><span style='font-family:宋体;color:#6A9955'>，要加载到的内存地址偏移量放到</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>es:bx</span><span
style='font-family:宋体;color:#6A9955'>中</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>ax</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, base_root_entry</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>es</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>ax</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; </span><span style='font-family:
宋体;color:#6A9955'>一次性读到内存中，留给保护模式用</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>bx</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, offset_root_entry</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>ax</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, [cur_read_sector]</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>cl</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>1</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>call</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> read_floppy_sector </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>; </span><span
style='font-family:宋体;color:#6A9955'>把要读的根目录扇区加载到</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>es:bx</span><span style='font-family:
宋体;color:#6A9955'>中了</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>dx</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>17</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; </span><span style='font-family:
宋体;color:#6A9955'>一个扇区</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>512B</span><span style='font-family:宋体;color:#6A9955'>，根目录区一个条目</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>32B</span><span
style='font-family:宋体;color:#6A9955'>，则一个扇区共有</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>512/32=16</span><span
style='font-family:宋体;color:#6A9955'>个条目，则每次读一个扇区循环</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>16</span><span style='font-family:
宋体;color:#6A9955'>次。但因为下面是循环开头就让</span><span lang=EN-US style='font-family:
Consolas;color:#6A9955'>dx</span><span style='font-family:宋体;color:#6A9955'>自减，那么循环</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>16</span><span
style='font-family:宋体;color:#6A9955'>次应该让</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>dx</span><span style='font-family:
宋体;color:#6A9955'>等于</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>17</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>di</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, offset_kernel - </span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>32</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; es:di</span><span
style='font-family:宋体;color:#6A9955'>指向读入的内存区域的头部，即根目录信息的头部；因为循环体为了写的简单，一开始就给</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>di+32</span><span
style='font-family:宋体;color:#6A9955'>，所以这里先减掉</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>32</span><span style='font-family:
宋体;color:#6A9955'>（这样回到循环首的时候就不用</span><span lang=EN-US style='font-family:
Consolas;color:#6A9955'>jnz</span><span style='font-family:宋体;color:#6A9955'>后再加一个</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>jmp</span><span
style='font-family:宋体;color:#6A9955'>了）</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>&nbsp;&nbsp;&nbsp;
.read_entry:</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>and</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>di</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>1111111111100000b</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; 32 = 0020h = 0000 0000 0010 0000b</span><span
style='font-family:宋体;color:#6A9955'>，所以每个条目的低</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>5</span><span style='font-family:
宋体;color:#6A9955'>位是为</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>0</span><span style='font-family:宋体;color:#6A9955'>的，这样就能让</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>di</span><span
style='font-family:宋体;color:#6A9955'>指向该条目的开头</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>add</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>di</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>32</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; </span><span style='font-family:
宋体;color:#6A9955'>指向下一个条目</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>dec</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>dx</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; </span><span style='font-family:
宋体;color:#6A9955'>读了一个条目，计数减</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>1</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>jz</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> read_next_sector </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>; </span><span
style='font-family:宋体;color:#6A9955'>本扇区的条目读完了，读下一个扇区</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>si</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, loader_file_name </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>; ds:si</span><span
style='font-family:宋体;color:#6A9955'>指向要匹配的</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>loader</span><span style='font-family:
宋体;color:#6A9955'>的文件名指针</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#6A9955'>; </span><span
style='font-family:宋体;color:#6A9955'>下面的</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>4</span><span style='font-family:
宋体;color:#6A9955'>行文本比较代码学习自周杰英教材</span><span lang=EN-US style='font-family:
Consolas;color:#6A9955'>P100</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>cld</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; </span><span style='font-family:
宋体;color:#6A9955'>清除方向标志位，使其从左到右比较</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>cx</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>11</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; </span><span style='font-family:
宋体;color:#6A9955'>文件名</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>+</span><span style='font-family:宋体;color:#6A9955'>后缀共</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>11</span><span
style='font-family:宋体;color:#6A9955'>字节</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>repe</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>cmpsb</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; </span><span style='font-family:
宋体;color:#6A9955'>加上重复前缀</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>repeat equal</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>jnz</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> .read_entry</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>; </span><span
style='font-family:宋体;color:#6A9955'>如果其中有字符不等，继续读下一个条目</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt;
line-height:14.25pt;background:#1E1E1E'><span lang=EN-US style='font-family:
Consolas;color:#6A9955'>; </span><span style='font-family:宋体;color:#6A9955'>如果跳出循环来到了这里，说明已经匹配到相应条目了</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>jmp</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> $ </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>; </span><span
style='font-family:宋体;color:#6A9955'>暂时停在这里，下一步再补充读入条目对应的簇的代码</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>no_find:</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; </span><span style='font-family:
宋体;color:#6A9955'>所有</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>FAT</span><span style='font-family:宋体;color:#6A9955'>项都查看过了没有找到</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>loader</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'>ax</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>, </span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0B800h</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'>gs</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>, </span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'>ax</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'>ah</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>, </span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0Fh</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; 0000: </span><span
style='font-family:宋体;color:#6A9955'>黑底</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'> 1111: </span><span
style='font-family:宋体;color:#6A9955'>白字</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>cx</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, str_len</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>si</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, str_cannot_find</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>di</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, (</span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>80</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> * </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>0</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> + </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>0</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>) * </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>2</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; </span><span style='font-family:
宋体;color:#6A9955'>屏幕第</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'> 0 </span><span style='font-family:宋体;color:#6A9955'>行</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>, </span><span
style='font-family:宋体;color:#6A9955'>第</span><span lang=EN-US style='font-family:
Consolas;color:#6A9955'> 0 </span><span style='font-family:宋体;color:#6A9955'>列</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>&nbsp;&nbsp;&nbsp;
.print_str_cannot_find:</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>lodsb</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; mov ax, [si], inc si</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;[</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'>gs</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>:</span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>di</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>], </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>ax</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>add</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>di</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>2</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>loop</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> .print_str_cannot_find</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>jmp</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> $</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
cur_read_sector </span><span lang=EN-US style='font-family:Consolas;color:#4EC9B0'>dw</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> SectorNoOfRootDirectory</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
sector_num_of_root_directory_for_loop </span><span lang=EN-US style='font-family:
Consolas;color:#4EC9B0'>dw</span><span lang=EN-US style='font-family:Consolas;
color:#D4D4D4'> RootDirSectors</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
loader_file_name </span><span lang=EN-US style='font-family:Consolas;
color:#4EC9B0'>db</span><span lang=EN-US style='font-family:Consolas;
color:#D4D4D4'> &quot;LOADER&nbsp;&nbsp;&nbsp;&nbsp; &quot;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
str_cannot_find </span><span lang=EN-US style='font-family:Consolas;color:#4EC9B0'>db</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> &quot;lsyOS cannot find
loader&quot;</span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt;
line-height:14.25pt;background:#1E1E1E'><span lang=EN-US style='font-family:
Consolas;color:#D4D4D4'>str_len </span><span lang=EN-US style='font-family:
Consolas;color:#4EC9B0'>equ</span><span lang=EN-US style='font-family:Consolas;
color:#D4D4D4'> $ - str_cannot_find</span></p>

<p class=MsoNormal><a name="_Toc10938174"></a><a name="_Toc10655584"></a><a
name="_Toc10252873"></a><a name="_Toc10138927"></a><a name="_Toc9694024"></a><a
name="_Toc9550130"><span lang=EN-US>&nbsp;</span></a></p>

<p class=4 style='margin-left:0cm;text-indent:0cm'><b><span lang=EN-US>5)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></b><b>读取并跳入<span
lang=EN-US>loader</span></b></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>在根目录区寻找到<span lang=EN-US>loader</span>对应的条目后，须从中读出<span
lang=EN-US>DIR_FstClusHO</span>项，从而求出<span lang=EN-US>loader</span>在数据区的开始簇号，然后依开始簇号在<span
lang=EN-US>FAT</span>表中求出<span lang=EN-US>loader</span>的所在的所有簇，同时将相应簇的数据加载至内存中，而后跳入相应内存区段的首地址，便完成了读取并跳入<span
lang=EN-US>loader</span>的工作。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>按照上述自然语言描述的算法，我们可以将前述代码中“<span lang=EN-US>jmp $ ; </span>暂时停在这里，下一步再补充读入条目对应的簇的代码”这一部分替换成这样的代码：</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>call</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> read_fat_sector </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>; </span><span
style='font-family:宋体;color:#6A9955'>读入</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>FAT</span><span style='font-family:
宋体;color:#6A9955'>表</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>and</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>di</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>1111111111100000b</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; </span><span style='font-family:
宋体;color:#6A9955'>指向本条目的开头</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>add</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>di</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>26</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; </span><span style='font-family:
宋体;color:#6A9955'>指向本条目对应的开始簇号字段，偏移量为</span><span lang=EN-US style='font-family:
Consolas;color:#6A9955'>26</span><span style='font-family:宋体;color:#6A9955'>，长度为两字节</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>cx</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, [</span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>es</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>:</span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>di</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>] </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; </span><span style='font-family:
宋体;color:#6A9955'>读入簇号</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>ax</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, base_loader</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>es</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>ax</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>bx</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, offset_loader </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>; es:bx</span><span
style='font-family:宋体;color:#6A9955'>表示程序要被加载到的地址</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>&nbsp;&nbsp;&nbsp;
.read_loader:</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>push</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>cx</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; </span><span style='font-family:
宋体;color:#6A9955'>保存簇号</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>add</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>cx</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, sector_num_data_FAT </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>; </span><span
style='font-family:宋体;color:#6A9955'>通过簇号计算该文件的扇区号，数据区的第一个簇的簇号是</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>2</span><span
style='font-family:宋体;color:#6A9955'>，所以数据区的扇区号</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'> = </span><span style='font-family:
宋体;color:#6A9955'>簇号</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'> - 1</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>ax</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>cx</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; call</span><span style='font-family:
宋体;color:#6A9955'>之前把要读入的扇区号放到</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>ax</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>cl</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>1</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; </span><span style='font-family:
宋体;color:#6A9955'>要读的扇区数为</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>1</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>call</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> read_floppy_sector </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>; </span><span
style='font-family:宋体;color:#6A9955'>读入</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>1</span><span style='font-family:
宋体;color:#6A9955'>个簇</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>pop</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>cx</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; </span><span style='font-family:
宋体;color:#6A9955'>取出簇号</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>call</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> get_next_fat_entry </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>; </span><span
style='font-family:宋体;color:#6A9955'>取出下一个簇号到</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>cx</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>add</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>bx</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>512</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; </span><span style='font-family:
宋体;color:#6A9955'>偏移量偏至下一个扇区</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>cmp</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>cx</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>0ff8h</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; </span><span style='font-family:
宋体;color:#6A9955'>如果簇号大于等于</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>0ff8</span><span style='font-family:宋体;color:#6A9955'>，表明当前簇为该文件的最后一个簇</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>jb</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> .read_loader</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>; cx &lt; 0ff8h</span><span
style='font-family:宋体;color:#6A9955'>时继续读</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>jmp</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;base_loader:offset_loader
</span><span lang=EN-US style='font-family:Consolas;color:#6A9955'>; </span><span
style='font-family:宋体;color:#6A9955'>读完了，跳入</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>loader</span></p>

<p class=MsoNormal style='line-height:150%'><span lang=EN-US style='font-family:
华文中宋'>&nbsp;</span></p>

<p class=3 style='margin-left:0cm;text-indent:0cm'><a name="_Toc9361267"></a><a
name="_Toc9340659"></a><a name="_Toc10655585"></a><a name="_Toc10252874"></a><a
name="_Toc10138928"></a><a name="_Toc9694025"></a><a name="_Toc9550131"></a><a
name="_Toc9539601"></a><a name="_Toc9539564"></a><a name="_Toc9539529"></a><a
name="_Toc9342824"></a><a name="_Toc9342630"></a><a name="_Toc10938175"></a><a
name="_Toc10748863"><span lang=EN-US>3.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;
</span></span>保护模式下的段式内存管理</a></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>本部分对应源代码“<span lang=EN-US>boot\loader.asm</span>”。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>要进入保护模式，首先应了解保护模式。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>保护模式和实模式的主要区别之一便是寻址空间的差别。在操作系统实验中，我们常常把保护模式作为<span
lang=EN-US>32</span>位操作系统的代称，也就是说保护模式具有<span lang=EN-US>32</span>位的内存地址，可以对<span
lang=EN-US>4GB</span>的内存空间进行寻址；而虽然我们也常把实模式作为<span lang=EN-US>16</span>位操作系统的代称，但实际上，实模式对应的典型的<span
lang=EN-US>8086/8088CPU</span>共有<span lang=EN-US>20</span>条地址线，能够寻址<span
lang=EN-US>1MB</span>的空间。这是因为<span lang=EN-US>Intel</span>巧妙地利用地址分段的方法，使用两个<span
lang=EN-US>16</span>位寄存器的值形成<span lang=EN-US>20</span>位的地址，扩大了寻址空间。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>到了<span lang=EN-US>80386</span>时代，<span lang=EN-US>CPU</span>中的通用寄存器和控制寄存器都扩展为了<span
lang=EN-US>32</span>位寄存器，但段寄存器（的可见部分）仍保持着<span lang=EN-US>8086</span>中<span
lang=EN-US>16</span>位的长度。此时，每个<span lang=EN-US>32</span>位寄存器都能表示<span
lang=EN-US>32</span>位地址，均有能力对整个内存空间寻址，这难道意味着不再需要分段寻址的方法了吗？</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>答案是否定的，虽然分段机制对寻址空间的扩展作用在保护模式下不复存在，但它依然有十分重要的作用，它确实能为实现保护模式下的“保护”机制提供便利。如，可以利用分段机制限制一个段的长度，防止进程跨段访问；可以对分段机制，实现用户程序和内核之间的隔离等。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>既然保护模式下依然需要分段机制，但段寄存器只有<span lang=EN-US>16</span>位，又如何提供<span
lang=EN-US>32</span>位的段基址呢？</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>一种简单粗暴，又类似于实模式下段基址的形成方式的方法便如下文所述。可令段寄存器中仅储存段基址的高<span
lang=EN-US>16</span>位，使用段寄存器时，可将段寄存器中的值左移<span lang=EN-US>16</span>位，从而形成段地址。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>这种方法确实完成了内存空间的分段，但是对内存空间的划分是一种粗粒度的划分，各段的间隔至少为<span
lang=EN-US>1MB</span>，且没有完成保护模式中的“保护”作用，并非一种适合保护模式的方案。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>相较于这一粗糙的方案，<span lang=EN-US>Intel</span>提出了一种类似于结构体数组的方式来进行内存划分。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>首先建立一个结构体数组，称为“全局描述符表（<span lang=EN-US>GDT</span>，<span
lang=EN-US>Global Descritor Table</span>）”，其中的表项称为“全局描述符（<span lang=EN-US>Global
Descritor</span>）”，记录该段的段基址、段界限（段界限指的是段内最大偏移量，因而为段的长度减去<span lang=EN-US>1</span>）和段属性。而<span
lang=EN-US>16</span>位的段寄存器只储存对应段的描述符所在的表项的下标，称为“段选择子（<span lang=EN-US>Segment
Seletor</span>）”，从而可以利用<span lang=EN-US>16</span>位的段寄存器来索引对应段的信息。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>其实，使用<span lang=EN-US>16</span>位来进行<span lang=EN-US>2^16=65536</span>个描述符的索引太过奢侈，实际应用中几乎不会用到如此多的描述符。因此，<span
lang=EN-US>Intel</span>实际上只将“段选择子”的高<span lang=EN-US>13</span>位作为描述符的索引，用于选择<span
lang=EN-US>2^13=8192</span>个描述符；而低<span lang=EN-US>3</span>位另有用途，用于实现保护模式的“保护功能”。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>因为数组的下标仅仅是相对于数组首地址的偏移量，所以我们还需要相应的机制储存<span lang=EN-US>GDT</span>的地址。<span
lang=EN-US>80386</span>提供了“全局描述符表寄存器（<span lang=EN-US>GDTR</span>，<span
lang=EN-US>Global Descritor Table Register</span>）”来实现这一机制。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>介绍完了实现保护模式下的段式内存管理的机制，下面我们来具体研究全局描述符、<span lang=EN-US>GDT</span>、<span
lang=EN-US>GDTR</span>、段选择子和段寄存器的结构。</span></p>

<p class=4 style='margin-left:0cm;text-indent:0cm'><a name="_Toc10938176"><b><span
lang=EN-US>1)<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></b><b>全局描述符</b></a></p>

<p class=MsoListParagraph style='line-height:150%'><span lang=EN-US
style='font-family:华文中宋'>80386</span><span style='font-family:华文中宋'>的全局描述符（<span
lang=EN-US>Global Descritor</span>）共占用<span lang=EN-US>8</span>字节，由三个字段组成：</span></p>

<p class=MsoListParagraph style='margin-left:21.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span lang=EN-US
style='font-family:华文中宋'>32</span><span style='font-family:华文中宋'>位的段基址</span></p>

<p class=MsoListParagraph style='margin-left:21.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span lang=EN-US
style='font-family:华文中宋'>20</span><span style='font-family:华文中宋'>位的段界限</span></p>

<p class=MsoListParagraph style='margin-left:21.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span lang=EN-US
style='font-family:华文中宋'>12</span><span style='font-family:华文中宋'>位的段属性</span></p>

<p class=MsoListParagraph style='line-height:150%'><span style='font-family:
华文中宋'>但在<span lang=EN-US>80286</span>中，全局描述表只有<span lang=EN-US>24</span>位的段基址和<span
lang=EN-US>16</span>位的段界限，且不含与“保护”相关的段属性。<span lang=EN-US>80386</span>为了与之兼容，只能将上述三个字段拆分，形成了如下图所示的比较反人类的结构。</span></p>

<div align=center>

<table class=MsoTableGrid border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=553 valign=top style='width:414.8pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <div align=center>
  <table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0
   style='border-collapse:collapse;border:none'>
   <tr>
    <td width=44 style='width:32.95pt;border:solid windowtext 1.0pt;padding:
    0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>字节</span></p>
    </td>
    <td width=65 colspan=2 style='width:48.4pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>Byte7</span></p>
    </td>
    <td width=72 colspan=2 style='width:54.0pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>Byte6</span></p>
    </td>
    <td width=64 colspan=2 style='width:47.8pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>Byte5</span></p>
    </td>
    <td width=54 colspan=2 style='width:40.55pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>Byte4</span></p>
    </td>
    <td width=55 colspan=2 style='width:41.15pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>Byte3</span></p>
    </td>
    <td width=65 colspan=2 style='width:48.65pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>Byte2</span></p>
    </td>
    <td width=66 colspan=2 style='width:49.6pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>Byte1</span></p>
    </td>
    <td width=54 colspan=2 style='width:40.4pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>Byte0</span></p>
    </td>
   </tr>
   <tr style='height:27.1pt'>
    <td width=44 style='width:32.95pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt;height:27.1pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>表示</span></p>
    </td>
    <td width=65 colspan=2 style='width:48.4pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt;height:27.1pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>段基址</span></p>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>31</span><span style='font-family:华文中宋'>…<span
    lang=EN-US>24</span></span></p>
    </td>
    <td width=136 colspan=4 style='width:101.8pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt;height:27.1pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>段属性、</span></p>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>段界限高<span lang=EN-US>4</span>位</span></p>
    </td>
    <td width=174 colspan=6 style='width:130.35pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt;height:27.1pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>段基址</span></p>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>23</span><span style='font-family:华文中宋'>……<span
    lang=EN-US>0</span></span></p>
    </td>
    <td width=120 colspan=4 style='width:90.0pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt;height:27.1pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>段界限</span></p>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>15</span><span style='font-family:华文中宋'>……<span
    lang=EN-US>0</span></span></p>
    </td>
   </tr>
   <tr style='height:27.05pt'>
    <td width=44 style='width:32.95pt;border:none;border-bottom:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt;height:27.05pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋'>&nbsp;</span></p>
    </td>
    <td width=65 colspan=2 style='width:48.4pt;border:none;border-bottom:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt;height:27.05pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
    </td>
    <td width=136 colspan=4 style='width:101.8pt;border:none;border-bottom:
    solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt;height:27.05pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
    </td>
    <td width=294 colspan=10 style='width:220.35pt;border:none;border-bottom:
    solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt;height:27.05pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
    </td>
   </tr>
   <tr>
    <td width=44 style='width:32.95pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>位</span></p>
    </td>
    <td width=32 style='width:23.95pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>15</span></p>
    </td>
    <td width=33 style='width:24.45pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>14</span></p>
    </td>
    <td width=32 style='width:23.9pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>13</span></p>
    </td>
    <td width=40 style='width:30.1pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>12</span></p>
    </td>
    <td width=32 style='width:23.9pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>11</span></p>
    </td>
    <td width=32 style='width:23.9pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>10</span></p>
    </td>
    <td width=28 style='width:21.0pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>9</span></p>
    </td>
    <td width=26 style='width:19.55pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>8</span></p>
    </td>
    <td width=28 style='width:20.75pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>7</span></p>
    </td>
    <td width=27 style='width:20.4pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>6</span></p>
    </td>
    <td width=28 style='width:20.8pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>5</span></p>
    </td>
    <td width=37 style='width:27.85pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>4</span></p>
    </td>
    <td width=33 style='width:24.7pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>3</span></p>
    </td>
    <td width=33 style='width:24.9pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>2</span></p>
    </td>
    <td width=28 style='width:20.95pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>1</span></p>
    </td>
    <td width=26 style='width:19.45pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>0</span></p>
    </td>
   </tr>
   <tr style='height:27.1pt'>
    <td width=44 style='width:32.95pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt;height:27.1pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>表示</span></p>
    </td>
    <td width=32 style='width:23.95pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt;height:27.1pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-size:10.0pt;line-height:150%'>G</span></p>
    </td>
    <td width=33 style='width:24.45pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt;height:27.1pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-size:10.0pt;line-height:150%'>D</span></p>
    </td>
    <td width=32 style='width:23.9pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt;height:27.1pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-size:10.0pt;line-height:150%'>0</span></p>
    </td>
    <td width=40 style='width:30.1pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt;height:27.1pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-size:10.0pt;line-height:150%'>AVL</span></p>
    </td>
    <td width=118 colspan=4 style='width:88.35pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt;height:27.1pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>段界限<span lang=EN-US>19</span>…<span lang=EN-US>16</span></span></p>
    </td>
    <td width=28 style='width:20.75pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt;height:27.1pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-size:10.0pt;line-height:150%'>P</span></p>
    </td>
    <td width=55 colspan=2 style='width:41.2pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt;height:27.1pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-size:10.0pt;line-height:150%'>DPL</span></p>
    </td>
    <td width=37 style='width:27.85pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt;height:27.1pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-size:10.0pt;line-height:150%'>S</span></p>
    </td>
    <td width=94 colspan=3 style='width:70.55pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt;height:27.1pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-size:10.0pt;line-height:150%'>TYPE</span></p>
    </td>
    <td width=26 style='width:19.45pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt;height:27.1pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-size:10.0pt;line-height:150%'>A</span></p>
    </td>
   </tr>
   <tr height=0>
    <td width=44 style='border:none'></td>
    <td width=32 style='border:none'></td>
    <td width=33 style='border:none'></td>
    <td width=32 style='border:none'></td>
    <td width=40 style='border:none'></td>
    <td width=32 style='border:none'></td>
    <td width=32 style='border:none'></td>
    <td width=28 style='border:none'></td>
    <td width=26 style='border:none'></td>
    <td width=28 style='border:none'></td>
    <td width=27 style='border:none'></td>
    <td width=28 style='border:none'></td>
    <td width=37 style='border:none'></td>
    <td width=33 style='border:none'></td>
    <td width=33 style='border:none'></td>
    <td width=28 style='border:none'></td>
    <td width=26 style='border:none'></td>
   </tr>
  </table>
  </div>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>图（<span lang=EN-US>22</span>）<span lang=EN-US>&nbsp;
  80386</span>代码段与数据段的全局描述符</span></p>
  </td>
 </tr>
</table>

</div>

<p class=MsoListParagraph style='line-height:150%'><span style='font-family:
华文中宋'>段属性中各字段的具体含义如下（由图中从左至右的顺序解释）：</span></p>

<p class=MsoListParagraph style='margin-left:21.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US style='font-family:华文中宋'>G</span><span
style='font-family:华文中宋'>：<a name="_Hlk10138953">段界限粒度</a>（<span lang=EN-US>Granularity</span>）。<span
lang=EN-US>G = 0</span>表示界限粒度为字节，此时最大界限为</span><span
lang=EN-US style='font-size:10.5pt;font-family:"Times New Roman",serif;
position:relative;top:4.0pt'><img width=20 height=21
src="/assets/source/OS/2020-08-09-OS_lab3.files/image018.png"></span><span lang=EN-US
style='font-family:华文中宋'>B</span><span style='font-family:华文中宋'>；<span
lang=EN-US>G = 1</span>表示界限粒度为<span lang=EN-US>4KB</span>，此时最大界限为</span><span
lang=EN-US style='font-size:10.5pt;font-family:"Times New Roman",serif;
position:relative;top:4.0pt'><img width=20 height=21
src="/assets/source/OS/2020-08-09-OS_lab3.files/image019.png"></span><span lang=EN-US
style='font-family:华文中宋'>B</span><span style='font-family:华文中宋'>。</span></p>

<p class=MsoListParagraph style='margin-left:21.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span lang=EN-US
style='font-family:华文中宋'>D</span><span style='font-family:华文中宋'>：默认操作的长度（<span
lang=EN-US>Default operand size</span>），这个长度包含操作数的长度以及地址的长度。<span lang=EN-US>D
= 0</span>表示默认长度为<span lang=EN-US>16</span>位；<span lang=EN-US>D = 1</span>表示默认长度为<span
lang=EN-US>32</span>位。</span></p>

<p class=MsoListParagraph style='margin-left:21.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span lang=EN-US
style='font-family:华文中宋'>0</span><span style='font-family:华文中宋'>（第<span
lang=EN-US>13</span>位）：<span lang=EN-US>80386</span>中未使用。在<span lang=EN-US>x86-64</span>中作为<span
lang=EN-US>L</span>字段（<span lang=EN-US>Long-mode segment</span>），用于描述段是否为<span
lang=EN-US>64</span>位地址的段。</span></p>

<p class=MsoListParagraph style='margin-left:21.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span lang=EN-US
style='font-family:华文中宋'>AVL</span><span style='font-family:华文中宋'>：可用（<span
lang=EN-US>Available</span>）。硬件不会使用该位，可供操作系统使用。（但<span lang=EN-US>Windows</span>和<span
lang=EN-US>Liunx</span>均并未使用该位）</span></p>

<p class=MsoListParagraph style='margin-left:21.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span lang=EN-US
style='font-family:华文中宋'>P</span><span style='font-family:华文中宋'>：存在（<span
lang=EN-US>Present</span>）。<span lang=EN-US>P = 0</span>表示该段不存在，此时若将该描述符加载至段寄存器将会引起“<span
lang=EN-US>segment not present</span>”异常；<span lang=EN-US>P = 1</span>表示该段存在。</span></p>

<p class=MsoListParagraph style='line-height:150%'><span style='font-family:
华文中宋'>当段所指示的线性地址空间不被分页机制映射或当段不在内存中时，基于段式管理虚拟内存的操作系统将清除当前位（置<span lang=EN-US>P =
0</span>）。</span></p>

<p class=MsoListParagraph style='margin-left:21.0pt;text-indent:-21.0pt;
line-height:150%'><a name="_Hlk10248860"><span lang=EN-US style='font-family:
Wingdings'>l<span style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
lang=EN-US style='font-family:华文中宋'>DPL</span></a><span style='font-family:
华文中宋'>：描述符特权级（<span lang=EN-US>Descriptor privilege level</span>）。表示访此描述符描述的段对应的特权级。最高特权级为<span
lang=EN-US>0</span>，最低特权级为<span lang=EN-US>3</span>。</span></p>

<p class=MsoListParagraph style='margin-left:21.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span lang=EN-US
style='font-family:华文中宋'>S</span><span style='font-family:华文中宋'>：段类型（<span
lang=EN-US>Segment</span>）。<span lang=EN-US>S = 0</span>表示系统段；<span lang=EN-US>S
= 1</span>表示代段码或数据段。</span></p>

<p class=MsoListParagraph style='margin-left:21.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span lang=EN-US
style='font-family:华文中宋'>TYPE</span><span style='font-family:华文中宋'>：段的具体类型。下面只解释<span
lang=EN-US>S</span>位为<span lang=EN-US>1</span>时的情况，<span lang=EN-US>S = 0</span>时的情况将在有关中断处理函数的一节提及。该字段比较复杂，如下图所示，<span
lang=EN-US>bit3</span>取值不同时，<span lang=EN-US>bit2</span>和<span lang=EN-US>bit1</span>具有不同的含义。</span></p>

<table class=MsoTableGrid border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=553 valign=top style='width:414.8pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <div align=center>
  <table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0
   style='border-collapse:collapse;border:none'>
   <tr>
    <td width=89 style='width:66.7pt;border:solid windowtext 1.0pt;padding:
    0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>位</span></p>
    </td>
    <td width=41 style='width:30.75pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>4</span></p>
    </td>
    <td width=41 style='width:30.75pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>3</span></p>
    </td>
    <td width=41 style='width:30.75pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>2</span></p>
    </td>
    <td width=41 style='width:30.75pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>1</span></p>
    </td>
   </tr>
   <tr>
    <td width=89 style='width:66.7pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>表示</span></p>
    </td>
    <td width=41 style='width:30.75pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>S</span></p>
    </td>
    <td width=123 colspan=3 style='width:92.25pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>TYPE</span></p>
    </td>
   </tr>
   <tr>
    <td width=89 rowspan=2 style='width:66.7pt;border:solid windowtext 1.0pt;
    border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>具体含义</span></p>
    </td>
    <td width=41 rowspan=2 style='width:30.75pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>1</span></p>
    </td>
    <td width=41 style='width:30.75pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>0</span></p>
    </td>
    <td width=41 style='width:30.75pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>ED</span></p>
    </td>
    <td width=41 style='width:30.75pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>W</span></p>
    </td>
   </tr>
   <tr>
    <td width=41 style='width:30.75pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>1</span></p>
    </td>
    <td width=41 style='width:30.75pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>C</span></p>
    </td>
    <td width=41 style='width:30.75pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>R</span></p>
    </td>
   </tr>
  </table>
  </div>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>图（<span lang=EN-US>23</span>）<span lang=EN-US>&nbsp;
  TYPE</span>字段在<span lang=EN-US>S = 1</span>的情况下的具体含义</span></p>
  </td>
 </tr>
</table>

<p class=MsoListParagraph style='line-height:150%'><b><span style='font-family:
华文中宋'>当<span lang=EN-US>bit3 = 0</span>时，该段为数据段。</span></b></p>

<p class=MsoListParagraph style='margin-left:42.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>n<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span lang=EN-US
style='font-family:华文中宋'>bit2</span><span style='font-family:华文中宋'>表示扩展方向<span
lang=EN-US>ED</span>（<span lang=EN-US>Extended Direction</span>），为<span
lang=EN-US>0</span>表示向上扩展（通常的数据段），为<span lang=EN-US>1</span>表示向下扩展（堆栈段）。</span></p>

<p class=MsoListParagraph style='margin-left:42.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>n<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span lang=EN-US
style='font-family:华文中宋'>bit1</span><span style='font-family:华文中宋'>表示可写入（<span
lang=EN-US>Writable</span>），为<span lang=EN-US>1</span>有效。</span></p>

<p class=MsoListParagraph style='line-height:150%'><b><span style='font-family:
华文中宋'>当<span lang=EN-US>bit3 = 1</span>时，该段为代码段。</span></b></p>

<p class=MsoListParagraph style='margin-left:42.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>n<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span lang=EN-US
style='font-family:华文中宋'>bit2</span><span style='font-family:华文中宋'>表示一致代码段<span
lang=EN-US>C</span>（<span lang=EN-US>Conforming</span>），为<span lang=EN-US>1</span>表示一致代码段，为<span
lang=EN-US>0</span>表示非一致代码段。</span></p>

<p class=MsoListParagraph style='margin-left:42.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>n<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span lang=EN-US
style='font-family:华文中宋'>bit1</span><span style='font-family:华文中宋'>表示可读取（<span
lang=EN-US>Readable</span>），为<span lang=EN-US>1</span>有效。否则该代码段只可执行不可读取。</span></p>

<p class=MsoListParagraph style='margin-left:21.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span lang=EN-US
style='font-family:华文中宋'>A</span><span style='font-family:华文中宋'>：已访问（<span
lang=EN-US>Accessed</span>）。<span lang=EN-US>S = 0</span>表示该段已访问，<span
lang=EN-US>S = 1</span>表示该段未访问。当将该段对应的段选择子加载至段寄存器时，<span lang=EN-US>CPU</span>会将该位置为<span
lang=EN-US>1</span>。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>关于描述符的基本信息已介绍完毕，下面我们便按照全局描述符的格式，在<span lang=EN-US>NASM</span>中编写一个描述符吧！</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>因为描述符中段基址、段界限和段属性三个字段均被拆开存放，方便起见，我们便使用<span
lang=EN-US>NASM</span>的宏来把三个字段拆分成描述符的格式。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>首先了解一下<span lang=EN-US>NASM</span>中宏定义的方式：</span></p>

<div align=center>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=275 valign=top style='width:206.2pt;border:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=left style='text-align:left;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>%macro </span><span style='font-family:
  华文中宋'>宏名 参数个数</span></p>
  <p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt;
  line-height:150%'><span style='font-family:华文中宋'>宏体（宏体中用<span lang=EN-US>%i</span>表示参数<span
  lang=EN-US>i</span>）</span></p>
  <p class=MsoNormal align=left style='text-align:left;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>%endmacro</span></p>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>图（<span lang=EN-US>24.1</span>）<span lang=EN-US>&nbsp;
  NASM</span>中宏定义的格式</span></p>
  </td>
  <td width=275 valign=top style='width:206.2pt;border:solid windowtext 1.0pt;
  border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=left style='text-align:left;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
  <p class=MsoNormal align=left style='text-align:left;line-height:150%'><span
  style='font-family:华文中宋'>宏名 参数<span lang=EN-US>1, </span>参数<span lang=EN-US>2,
  </span>…<span lang=EN-US>, </span>参数<span lang=EN-US>n</span></span></p>
  <p class=MsoNormal align=left style='text-align:left;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
  <p class=MsoNormal align=left style='text-align:left;line-height:150%'><span
  style='font-family:华文中宋'>图（<span lang=EN-US>24.2</span>）<span lang=EN-US>&nbsp;
  NASM</span>中使用宏的方式</span></p>
  </td>
 </tr>
</table>

</div>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>是的，<span lang=EN-US>NASM</span>的宏定义就是如此简单明了。由此，我们便可写出生成描述符的宏定义，同时，我们加入一些描述段属性的常量：</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>desc_G&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#4EC9B0'>equ</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>8000h</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>; </span><span
style='font-family:宋体;color:#6A9955'>段界限粒度</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>(Granularity)</span><span
style='font-family:宋体;color:#6A9955'>为</span><span lang=EN-US style='font-family:
Consolas;color:#6A9955'>4KB</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>desc_D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#4EC9B0'>equ</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>4000h</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>; </span><span
style='font-family:宋体;color:#6A9955'>默认操作长度（</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>Default operand size</span><span
style='font-family:宋体;color:#6A9955'>）为</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>32</span><span style='font-family:
宋体;color:#6A9955'>位</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>desc_P&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#4EC9B0'>equ</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>10000000b</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>; </span><span
style='font-family:宋体;color:#6A9955'>该段存在（</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>Present</span><span
style='font-family:宋体;color:#6A9955'>）</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#6A9955'>;
</span><span style='font-family:宋体;color:#6A9955'>特权级描述</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>desc_DPL0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#4EC9B0'>equ</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0b</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>; DPL = 0</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>desc_DPL1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#4EC9B0'>equ</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0100000b</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>; DPL = 1</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>desc_DPL2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#4EC9B0'>equ</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>1000000b</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>; DPL = 2</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>desc_DPL3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#4EC9B0'>equ</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>1100000b</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>; DPL = 3</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#6A9955'>;
</span><span style='font-family:宋体;color:#6A9955'>已将</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>desc_S EQU&nbsp;10000b</span><span
style='font-family:宋体;color:#6A9955'>合并到</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>desc_DataSeg</span><span
style='font-family:宋体;color:#6A9955'>和</span><span lang=EN-US style='font-family:
Consolas;color:#6A9955'>desc_CodeSeg</span><span style='font-family:宋体;
color:#6A9955'>中，以方便使用</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#6A9955'>;
</span><span style='font-family:宋体;color:#6A9955'>数据段的</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>TYPE</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>desc_DataSeg&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#4EC9B0'>equ</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>10000b</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>; </span><span
style='font-family:宋体;color:#6A9955'>数据段</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>desc_ED&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#4EC9B0'>equ</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>100b</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>; </span><span
style='font-family:宋体;color:#6A9955'>向下扩展</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>desc_W&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#4EC9B0'>equ</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>10b</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>; </span><span
style='font-family:宋体;color:#6A9955'>可写入</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#6A9955'>;
</span><span style='font-family:宋体;color:#6A9955'>代码段的</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>TYPE</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>desc_CodeSeg&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#4EC9B0'>equ</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>11000b</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>; </span><span
style='font-family:宋体;color:#6A9955'>数据段</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>desc_C&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#4EC9B0'>equ</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>100b</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>; </span><span
style='font-family:宋体;color:#6A9955'>一致代码段</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>desc_R&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#4EC9B0'>equ</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>10b</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>; </span><span
style='font-family:宋体;color:#6A9955'>可读</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#6A9955'>;
</span><span style='font-family:宋体;color:#6A9955'>段描述符生成宏</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#6A9955'>;
</span><span style='font-family:宋体;color:#6A9955'>用法：</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>Descriptor </span><span
style='font-family:宋体;color:#6A9955'>段基址</span><span style='font-family:Consolas;
color:#6A9955'> </span><span style='font-family:宋体;color:#6A9955'>段界限</span><span
style='font-family:Consolas;color:#6A9955'> </span><span style='font-family:
宋体;color:#6A9955'>段属性</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#569CD6'>%</span><span
lang=EN-US style='font-family:Consolas;color:#C586C0'>macro</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'> Descriptor 3</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#4EC9B0'>dw</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;%</span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>2</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> &amp; </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>0FFFFh</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>; </span><span
style='font-family:宋体;color:#6A9955'>段界限</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>15……0</span><span style='font-family:
宋体;color:#6A9955'>（</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>2</span><span style='font-family:宋体;color:#6A9955'>字节）</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#4EC9B0'>dw</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;%</span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>1</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> &amp; </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>0FFFFh</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>; </span><span
style='font-family:宋体;color:#6A9955'>段基址</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>15……0</span><span style='font-family:
宋体;color:#6A9955'>（</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>2</span><span style='font-family:宋体;color:#6A9955'>字节）</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#4EC9B0'>db</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;(%</span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>1</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> &gt;&gt; </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>16</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>) &amp; </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>0FFh</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>; </span><span
style='font-family:宋体;color:#6A9955'>段基址</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>23……16</span><span style='font-family:
宋体;color:#6A9955'>（</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>1</span><span style='font-family:宋体;color:#6A9955'>字节）</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#4EC9B0'>dw</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;((%</span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>2</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> &gt;&gt; </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>8</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>) &amp; </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>0F00h</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>) | (%</span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>3</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> &amp; </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>0F0FFh</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>)</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; </span><span style='font-family:
宋体;color:#6A9955'>段属性、段界限</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>19…16</span><span style='font-family:宋体;color:#6A9955'>（</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>2</span><span
style='font-family:宋体;color:#6A9955'>字节）</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#4EC9B0'>db</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;(%</span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>1</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> &gt;&gt; </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>24</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>) &amp; </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>0FFh</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>; </span><span
style='font-family:宋体;color:#6A9955'>段基址</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>31…24</span><span style='font-family:
宋体;color:#6A9955'>（</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>1</span><span style='font-family:宋体;color:#6A9955'>字节）</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#569CD6'>%</span><span
lang=EN-US style='font-family:Consolas;color:#C586C0'>endmacro</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>因为这些常量和宏定义均关于描述符，我们索性把它们统一放到<span lang=EN-US>NASM</span>的头文件“<span
lang=EN-US>*.inc</span>”中。这样，在需要使用相关宏时，只需写上<span lang=EN-US>%include &quot;descritor.inc&quot;</span>即可。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>如此，便可用这个宏生成一个段基址为<span lang=EN-US>0</span>，段界限为<span
lang=EN-US>4GB</span>的可读代码段。</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#569CD6'>%</span><span
lang=EN-US style='font-family:Consolas;color:#C586C0'>include</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'> </span><span lang=EN-US
style='font-family:Consolas;color:#CE9178'>&quot;descritor.inc&quot;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#6A9955'>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;</span><span style='font-family:宋体;color:#6A9955'>段基址</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-family:宋体;color:#6A9955'>段界限</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;</span><span
style='font-family:宋体;color:#6A9955'>属性</span></p>

<p class=MsoNormal align=left style='margin-left:273.0pt;text-align:left;
text-indent:-273.0pt;line-height:14.25pt;background:#1E1E1E'><span lang=EN-US
style='font-family:Consolas;color:#DCDCAA'>GDT_CS:</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;
Descriptor&nbsp; </span><span lang=EN-US style='font-family:Consolas;
color:#B5CEA8'>0</span><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0FFFFFh</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>,&nbsp;&nbsp;&nbsp;
desc_G | desc_D | desc_P &nbsp;&nbsp;&nbsp;&nbsp;| desc_CodeSeg | desc_R</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>注意，因为使用了描述符属性中的<span lang=EN-US>G</span>字段，即段界限粒度为<span
lang=EN-US>4KB</span>，因此描述符中段界限的值应为<span lang=EN-US>4GB/4KB &#8211; 1B = 1MB &#8211; 1B = 0FFFFFh</span>。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>同理，可生成数据段和显存段的描述符：</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#569CD6'>%</span><span
lang=EN-US style='font-family:Consolas;color:#C586C0'>include</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'> </span><span lang=EN-US
style='font-family:Consolas;color:#CE9178'>&quot;descritor.inc&quot;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#6A9955'>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;</span><span style='font-family:宋体;color:#6A9955'>段基址</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-family:宋体;color:#6A9955'>段界限</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;</span><span
style='font-family:宋体;color:#6A9955'>属性</span></p>

<p class=MsoNormal align=left style='margin-left:273.0pt;text-align:left;
text-indent:-273.0pt;line-height:14.25pt;background:#1E1E1E'><span lang=EN-US
style='font-family:Consolas;color:#DCDCAA'>GDT_CS:</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;
Descriptor&nbsp; </span><span lang=EN-US style='font-family:Consolas;
color:#B5CEA8'>0</span><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0FFFFFh</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>,&nbsp;&nbsp;&nbsp;
desc_G | desc_D | desc_P </span></p>

<p class=MsoNormal align=left style='margin-left:273.0pt;text-align:left;
text-indent:-273.0pt;line-height:14.25pt;background:#1E1E1E'><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
| desc_CodeSeg | desc_R</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>GDT_DS:</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;
Descriptor&nbsp; </span><span lang=EN-US style='font-family:Consolas;
color:#B5CEA8'>0</span><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0FFFFFh</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>,&nbsp;&nbsp;&nbsp;
desc_G | desc_D | desc_P</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
| desc_DataSeg | desc_W </span></p>

<p class=MsoNormal align=left style='margin-left:273.0pt;text-align:left;
text-indent:-273.0pt;line-height:14.25pt;background:#1E1E1E'><span lang=EN-US
style='font-family:Consolas;color:#DCDCAA'>GDT_GS:</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;
Descriptor&nbsp; </span><span lang=EN-US style='font-family:Consolas;
color:#B5CEA8'>0B8000h</span><span lang=EN-US style='font-family:Consolas;
color:#D4D4D4'>,&nbsp;&nbsp;&nbsp; </span><span lang=EN-US style='font-family:
Consolas;color:#B5CEA8'>0FFFFh</span><span lang=EN-US style='font-family:Consolas;
color:#D4D4D4'>,&nbsp;&nbsp;&nbsp;&nbsp; desc_P | desc_DataSeg&nbsp;&nbsp;&nbsp;
| desc_W | desc_DPL3 </span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>值得注意的是，显存段的描述符中使用了<span lang=EN-US>DPL3</span>的属性，但其实本实验中无须用到这一属性。关于特权级的含义，将在后续的实验中做进一步阐述。</span></p>

<p class=MsoNormal style='line-height:150%'><span lang=EN-US style='font-family:
华文中宋'>&nbsp;</span></p>

<p class=4 style='margin-left:0cm;text-indent:0cm'><a name="_Toc10938177"><b><span
lang=EN-US>2)<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></b><b>全局描述符表</b></a></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>了解全局描述符以后，构建全局描述符表便是非常简单的事情了。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>全局描述符表（<span lang=EN-US>GDT</span>，<span lang=EN-US>Global
Descritor Table</span>）即是关于全局描述符的变长数组。由于段选择子的限制，数组长度最大为</span><span
lang=EN-US style='font-size:10.5pt;font-family:"Times New Roman",serif;
position:relative;top:4.0pt'><img width=69 height=21
src="/assets/source/OS/2020-08-09-OS_lab3.files/image020.png"></span><span style='font-family:
华文中宋'>。一个特别的地方是，<span lang=EN-US>CPU</span>并不支持使用<span lang=EN-US>GDT</span>中的第一个描述符。我们恰可利用这个特性，在<span
lang=EN-US>GDT</span>中的第一项写入命名为<span lang=EN-US>GDT_head</span>的一个空描述符，以方便之后对<span
lang=EN-US>GDT</span>表首地址的定位。如下，只需在先前的定义的三个描述符之前加上一个空描述符，便完成了全局描述符表。</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#569CD6'>%</span><span
lang=EN-US style='font-family:Consolas;color:#C586C0'>include</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'> </span><span lang=EN-US
style='font-family:Consolas;color:#CE9178'>&quot;descritor.inc&quot;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#6A9955'>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;</span><span style='font-family:宋体;color:#6A9955'>段基址</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-family:宋体;color:#6A9955'>段界限</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;</span><span
style='font-family:宋体;color:#6A9955'>属性</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>GDT_head:</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;
Descriptor&nbsp; </span><span lang=EN-US style='font-family:Consolas;
color:#B5CEA8'>0</span><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;</span><span lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#6A9955'>; </span><span
style='font-family:宋体;color:#6A9955'>空描述符</span></p>

<p class=MsoNormal align=left style='margin-left:273.0pt;text-align:left;
text-indent:-273.0pt;line-height:14.25pt;background:#1E1E1E'><span lang=EN-US
style='font-family:Consolas;color:#DCDCAA'>GDT_CS:</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;
Descriptor&nbsp; </span><span lang=EN-US style='font-family:Consolas;
color:#B5CEA8'>0</span><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0FFFFFh</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>,&nbsp;&nbsp;&nbsp;
desc_G | desc_D | desc_P </span></p>

<p class=MsoNormal align=left style='margin-left:273.0pt;text-align:left;
text-indent:-273.0pt;line-height:14.25pt;background:#1E1E1E'><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
| desc_CodeSeg | desc_R</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>GDT_DS:</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;
Descriptor&nbsp; </span><span lang=EN-US style='font-family:Consolas;
color:#B5CEA8'>0</span><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0FFFFFh</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>,&nbsp;&nbsp;&nbsp;
desc_G | desc_D | desc_P</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|
desc_DataSeg | desc_W </span></p>

<p class=MsoNormal align=left style='margin-left:273.0pt;text-align:left;
text-indent:-273.0pt;line-height:14.25pt;background:#1E1E1E'><span lang=EN-US
style='font-family:Consolas;color:#DCDCAA'>GDT_GS:</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;
Descriptor&nbsp; </span><span lang=EN-US style='font-family:Consolas;
color:#B5CEA8'>0B8000h</span><span lang=EN-US style='font-family:Consolas;
color:#D4D4D4'>,&nbsp;&nbsp;&nbsp; </span><span lang=EN-US style='font-family:
Consolas;color:#B5CEA8'>0FFFFh</span><span lang=EN-US style='font-family:Consolas;
color:#D4D4D4'>,&nbsp;&nbsp;&nbsp;&nbsp; desc_P | desc_DataSeg&nbsp;&nbsp;&nbsp;
| desc_W | desc_DPL3 </span></p>

<p class=MsoNormal style='line-height:150%'><b><span lang=EN-US
style='font-family:华文中宋'>&nbsp;</span></b></p>

<p class=4 style='margin-left:0cm;text-indent:0cm'><a name="_Toc10938178"><b><span
lang=EN-US>3)<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></b><b>全局描述符表寄存器</b></a></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>为描述全局描述符表这个“数组”，通常只需要知道数组的首地址，但为了实现“保护”机制，还需储存数组长度。因而，<span
lang=EN-US>80386</span>提供了<span lang=EN-US>48</span>位的全局描述符表寄存器<span
lang=EN-US>GDTR</span>（<span lang=EN-US>Global Descritor Table Register</span>）来存储<span
lang=EN-US>GDT</span>的<span lang=EN-US>32</span>位基址和<span lang=EN-US>16</span>位段界限。其中，<span
lang=EN-US>16</span>位的段界限用来描述<span lang=EN-US>GDT</span>的长度，防止误访问表外空间，起到“保护”作用。</span></p>

<table class=MsoTableGrid border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=553 valign=top style='width:414.8pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <div align=center>
  <table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0 width=476
   style='width:356.75pt;border-collapse:collapse;border:none'>
   <tr>
    <td width=60 valign=top style='width:45.15pt;border:none;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=right style='text-align:right;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>GDTR</span></p>
    </td>
    <td width=277 valign=top style='width:207.7pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>32</span><span style='font-family:华文中宋'>位<span
    lang=EN-US>GDT</span>基址</span></p>
    </td>
    <td width=139 valign=top style='width:103.9pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>16</span><span style='font-family:华文中宋'>位<span
    lang=EN-US>GDT</span>界限</span></p>
    </td>
   </tr>
  </table>
  </div>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>图（<span lang=EN-US>25</span>）<span lang=EN-US>&nbsp;
  GDTR</span>的具体结构</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>由此，只需在<span lang=EN-US>GDT</span>尾计算当前位置在该文件中的偏移量与<span
lang=EN-US>GDT</span>首地址在该文件中的偏移量便可得出<span lang=EN-US>GDT</span>的长度，再使用<span
lang=EN-US>GDT</span>的长度减去<span lang=EN-US>1</span>便得到<span lang=EN-US>GDT</span>的界限；而<span
lang=EN-US>GDT</span>基址可由当前文件（<span lang=EN-US>loader</span>）被加载入内存后的地址加上<span
lang=EN-US>GDT</span>首地址在该文件中的偏移量得到。依此思想，可在<span lang=EN-US>GDT</span>尾部追加如下适应<span
lang=EN-US>GDTR</span>结构的数据结构：</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#569CD6'>%</span><span
lang=EN-US style='font-family:Consolas;color:#C586C0'>include</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'> </span><span lang=EN-US
style='font-family:Consolas;color:#CE9178'>&quot;descritor.inc&quot;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#6A9955'>;
GDT ----------------------------------------------------------------</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#6A9955'>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;</span><span style='font-family:宋体;color:#6A9955'>段基址</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-family:宋体;color:#6A9955'>段界限</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;</span><span
style='font-family:宋体;color:#6A9955'>属性</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>GDT_head:</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;
Descriptor&nbsp; </span><span lang=EN-US style='font-family:Consolas;
color:#B5CEA8'>0</span><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;</span><span lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#6A9955'>; </span><span
style='font-family:宋体;color:#6A9955'>空描述符</span></p>

<p class=MsoNormal align=left style='margin-left:273.0pt;text-align:left;
text-indent:-273.0pt;line-height:14.25pt;background:#1E1E1E'><span lang=EN-US
style='font-family:Consolas;color:#DCDCAA'>GDT_CS:</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;
Descriptor&nbsp; </span><span lang=EN-US style='font-family:Consolas;
color:#B5CEA8'>0</span><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0FFFFFh</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>,&nbsp;&nbsp;&nbsp;
desc_G | desc_D | desc_P </span></p>

<p class=MsoNormal align=left style='margin-left:273.0pt;text-align:left;
text-indent:-273.0pt;line-height:14.25pt;background:#1E1E1E'><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
| desc_CodeSeg | desc_R</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>GDT_DS:</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;
Descriptor&nbsp; </span><span lang=EN-US style='font-family:Consolas;
color:#B5CEA8'>0</span><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0FFFFFh</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>,&nbsp;&nbsp;&nbsp;
desc_G | desc_D | desc_P</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
| desc_DataSeg | desc_W </span></p>

<p class=MsoNormal align=left style='margin-left:273.0pt;text-align:left;
text-indent:-273.0pt;line-height:14.25pt;background:#1E1E1E'><span lang=EN-US
style='font-family:Consolas;color:#DCDCAA'>GDT_GS:</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;
Descriptor&nbsp; </span><span lang=EN-US style='font-family:Consolas;
color:#B5CEA8'>0B8000h</span><span lang=EN-US style='font-family:Consolas;
color:#D4D4D4'>,&nbsp;&nbsp;&nbsp; </span><span lang=EN-US style='font-family:
Consolas;color:#B5CEA8'>0FFFFh</span><span lang=EN-US style='font-family:Consolas;
color:#D4D4D4'>,&nbsp;&nbsp;&nbsp;&nbsp; desc_P | desc_DataSeg&nbsp;&nbsp;&nbsp;
| desc_W | desc_DPL3 </span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#6A9955'>;
GDT ----------------------------------------------------------------</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>GDT_len
</span><span lang=EN-US style='font-family:Consolas;color:#4EC9B0'>equ</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> $ - GDT_head </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>; GDT</span><span
style='font-family:宋体;color:#6A9955'>长度</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>GDTR&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#4EC9B0'>dw</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> GDT_len - </span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>1</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; </span><span style='font-family:
宋体;color:#6A9955'>段界限</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#4EC9B0'>dd</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> base_loader_addr +
GDT_head </span><span lang=EN-US style='font-family:Consolas;color:#6A9955'>;
GDT</span><span style='font-family:宋体;color:#6A9955'>基址</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>接下来，只需执行指令“<span lang=EN-US>lgdt [GDTR]</span>”（其中，指令<span
lang=EN-US>lgdt</span>表示<span lang=EN-US>load GDT</span>），便可将这一<span
lang=EN-US>6</span>字节的数据结构加载至<span lang=EN-US>GDTR</span>中。稍后将在“进入保护模式”的部分使用这个指令。</span></p>

<p class=MsoNormal style='line-height:150%'><span lang=EN-US style='font-family:
华文中宋'>&nbsp;</span></p>

<p class=4 style='margin-left:0cm;text-indent:0cm'><a name="_Toc10938179"><b><span
lang=EN-US>4)<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></b><b>段选择子</b></a></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>段选择子（<span lang=EN-US>Segment Seletor</span>）除了作为<span
lang=EN-US>GDT</span>的索引外，还有指定描述表的类型以及特权级的功能，因而它被划分为三个字段，具体的结构如下所示：</span></p>

<table class=MsoTableGrid border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=553 valign=top style='width:414.8pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <div align=center>
  <table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0
   style='border-collapse:collapse;border:none'>
   <tr>
    <td width=44 style='width:32.95pt;border:solid windowtext 1.0pt;padding:
    0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>位</span></p>
    </td>
    <td width=32 style='width:23.95pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>15</span></p>
    </td>
    <td width=33 style='width:24.45pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>14</span></p>
    </td>
    <td width=32 style='width:23.9pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>13</span></p>
    </td>
    <td width=40 style='width:30.1pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>12</span></p>
    </td>
    <td width=32 style='width:23.9pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>11</span></p>
    </td>
    <td width=32 style='width:23.9pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>10</span></p>
    </td>
    <td width=28 style='width:21.0pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>9</span></p>
    </td>
    <td width=26 style='width:19.55pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>8</span></p>
    </td>
    <td width=28 style='width:20.75pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>7</span></p>
    </td>
    <td width=27 style='width:20.4pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>6</span></p>
    </td>
    <td width=28 style='width:20.8pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>5</span></p>
    </td>
    <td width=37 style='width:27.85pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>4</span></p>
    </td>
    <td width=33 style='width:24.7pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>3</span></p>
    </td>
    <td width=33 style='width:24.9pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>2</span></p>
    </td>
    <td width=28 style='width:20.95pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>1</span></p>
    </td>
    <td width=26 style='width:19.45pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>0</span></p>
    </td>
   </tr>
   <tr style='height:27.1pt'>
    <td width=44 style='width:32.95pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt;height:27.1pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>表示</span></p>
    </td>
    <td width=407 colspan=13 style='width:305.25pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt;height:27.1pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-size:10.0pt;line-height:150%'>INDEX</span></p>
    </td>
    <td width=33 style='width:24.9pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt;height:27.1pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-size:10.0pt;line-height:150%'>TI</span></p>
    </td>
    <td width=54 colspan=2 style='width:40.4pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt;height:27.1pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-size:10.0pt;line-height:150%'>RPL</span></p>
    </td>
   </tr>
  </table>
  </div>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>图（<span lang=EN-US>26</span>） 段选择子结构</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>其中，各字段的含义如下：</span></p>

<p class=MsoListParagraph style='margin-left:21.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span lang=EN-US
style='font-size:10.0pt;line-height:150%'>INDEX</span><span style='font-size:
10.0pt;line-height:150%;font-family:华文中宋'>：描述符索引，起始索引为</span><span lang=EN-US
style='font-size:10.0pt;line-height:150%'>0</span><span style='font-size:10.0pt;
line-height:150%;font-family:华文中宋'>，用于选择描述符表中的一个描述符。</span></p>

<p class=MsoListParagraph style='margin-left:21.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span lang=EN-US
style='font-family:华文中宋'>TI</span><span style='font-family:华文中宋'>：表指示器（<span
lang=EN-US>Table Indicator</span>），用于指明该选择子指向的是<span lang=EN-US>GDT</span>还是<span
lang=EN-US>LDT</span>。<span lang=EN-US>TI = 0</span>表示指向<span lang=EN-US>GDT</span>，<span
lang=EN-US>TI = 1</span>表示指向<span lang=EN-US>LDT</span>。（<span lang=EN-US>LDT</span>表示局部描述符表<span
lang=EN-US>Local Descriptor Table</span>，它将会在之后的内容中提及）</span></p>

<p class=MsoListParagraph style='margin-left:21.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span lang=EN-US
style='font-family:华文中宋'>RPL</span><span style='font-family:华文中宋'>：请求特权级（<span
lang=EN-US>Requested Privilege Level</span>），与段属性中的<span lang=EN-US>DPL</span>类似，表示访此此段选择子对应的特权级。最高特权级为<span
lang=EN-US>0</span>，最低特权级为<span lang=EN-US>3</span>。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>特别地，由于<span lang=EN-US>CPU</span>没有使用<span lang=EN-US>GDT</span>的第一项，因此可以使用<span
lang=EN-US>index</span>为<span lang=EN-US>0</span>的段选择子，指向之前我们编写的空描述符，从而实现空选择子。当段寄存器（<span
lang=EN-US>CS</span>或<span lang=EN-US>SS</span>除外）加载空选择子时，<span lang=EN-US>CPU</span>不会产生异常。但是，当使用加载了空选择子的段寄存器访问内存时，<span
lang=EN-US>CPU</span>将会产生异常。这个特性对于初始化未使用的段寄存器非常有用，可以在<span lang=EN-US>debug</span>时捕获对内存空间的意外引用。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>下面我们开始为之前编写的三个描述符生成对应的段选择子。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>首先将段选择子中的属性<span lang=EN-US>TI</span>与<span
lang=EN-US>RPL</span>对应的常量补充至“<span lang=EN-US>descriptor.inc</span>”中：</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#6A9955'>;
</span><span style='font-family:宋体;color:#6A9955'>选择子属性</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>seletor_RPL0&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#4EC9B0'>equ</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>seletor_RPL1&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#4EC9B0'>equ</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>1</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>seletor_RPL2&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#4EC9B0'>equ</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>2</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>seletor_RPL3&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#4EC9B0'>equ</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>3</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>seletor_TI_GDT&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#4EC9B0'>equ</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>000b</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>seletor_TI_LDT&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#4EC9B0'>equ</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>100b</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>而后可以通过如下方法计算各描述符在<span lang=EN-US>GDT</span>中的索引：用描述符的起始地址减去<span
lang=EN-US>GDT</span>的首地址，这样便得到相应描述符的偏移量。因为每个描述符的长度为<span lang=EN-US>8</span>字节，将偏移量除以<span
lang=EN-US>8</span>（即右移<span lang=EN-US>3</span>位）便得到了描述符的索引值。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>而<span lang=EN-US>INDEX</span>恰处于段选择子中的高<span
lang=EN-US>13</span>位，因而只需将索引值左移三位得到的值与选择子属性相位或，便得到了一个完整的段选择子。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>有趣的是，先行的右移与后行的左移的位数完全相同，因而在生成段选择子时，其实完全无需进行移位操作，可以直接将选择子对应的描述符的偏移量与选择子属性相位或，从而形成段选择子。这也许就是<span
lang=EN-US>Intel</span>将采用且仅用选择子的高<span lang=EN-US>13</span>位作为描述符的索引值的玄妙之处吧！</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>按照这一思路，我们便可轻易地编写出代码段、数据段和显存段描述符对应的选择子：</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#6A9955'>;
</span><span style='font-family:宋体;color:#6A9955'>段选择子</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>
------------------------------------------------------------</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>seletor_CS
</span><span lang=EN-US style='font-family:Consolas;color:#4EC9B0'>equ</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
(GDT_CS - GDT_head) | seletor_TI_GDT</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>seletor_DS
</span><span lang=EN-US style='font-family:Consolas;color:#4EC9B0'>equ</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
(GDT_DS - GDT_head) | seletor_TI_GDT</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>seletor_GS
</span><span lang=EN-US style='font-family:Consolas;color:#4EC9B0'>equ</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
(GDT_GS - GDT_head) | seletor_TI_GDT | seletor_RPL3</span></p>

<p class=4 style='margin-left:0cm;text-indent:0cm'><a name="_Toc10938180"><b><span
lang=EN-US>5)<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></b><b>段寄存器</b></a></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>为了保证与<span lang=EN-US>8086/8088</span>的兼容性，后续<span
lang=EN-US>X86</span>架构下的<span lang=EN-US>CPU</span>仍将段寄存器的长度设置为<span
lang=EN-US>16</span>位，并用这<span lang=EN-US>16</span>位储存段选择子。但实际上，这些<span
lang=EN-US>CPU</span>中的段寄存器除了拥有对软件可见的<span lang=EN-US>16</span>位外，还拥有着更大的隐藏空间，用于储存段选择子对应的描述符，以使减少寻址时对内存的二次读取。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>因此实际上，<span lang=EN-US>80386 CPU</span>中拥有<span
lang=EN-US>80</span>位的段寄存器，具体结构如下所示：</span></p>

<table class=MsoTableGrid border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=553 valign=top style='width:414.8pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <div align=center>
  <table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
   style='border-collapse:collapse;border:none'>
   <tr>
    <td width=50 valign=top style='width:37.7pt;border:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal><span lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
    </td>
    <td width=101 valign=top style='width:75.4pt;border:none;border-bottom:
    solid windowtext 1.5pt;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>16</span><span style='font-family:华文中宋'>位可见的段选择子</span></p>
    </td>
    <td width=402 valign=top style='width:301.7pt;border:none;border-bottom:
    solid windowtext 1.5pt;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>64</span><span style='font-family:华文中宋'>位</span></p>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>不可见的段描述符</span></p>
    </td>
   </tr>
   <tr>
    <td width=50 valign=top style='width:37.7pt;border:none;border-right:solid windowtext 1.5pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=right style='text-align:right'><span lang=EN-US
    style='font-family:华文中宋'>CS</span></p>
    </td>
    <td width=101 valign=top style='width:75.4pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.5pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal><span lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
    </td>
    <td width=402 valign=top style='width:301.7pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.5pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal><span lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
    </td>
   </tr>
   <tr>
    <td width=50 valign=top style='width:37.7pt;border:none;border-right:solid windowtext 1.5pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=right style='text-align:right'><span lang=EN-US
    style='font-family:华文中宋'>DS</span></p>
    </td>
    <td width=101 valign=top style='width:75.4pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.5pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal><span lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
    </td>
    <td width=402 valign=top style='width:301.7pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.5pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal><span lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
    </td>
   </tr>
   <tr>
    <td width=50 valign=top style='width:37.7pt;border:none;border-right:solid windowtext 1.5pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=right style='text-align:right'><span lang=EN-US
    style='font-family:华文中宋'>ES</span></p>
    </td>
    <td width=101 valign=top style='width:75.4pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.5pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal><span lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
    </td>
    <td width=402 valign=top style='width:301.7pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.5pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal><span lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
    </td>
   </tr>
   <tr>
    <td width=50 valign=top style='width:37.7pt;border:none;border-right:solid windowtext 1.5pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=right style='text-align:right'><span lang=EN-US
    style='font-family:华文中宋'>SS</span></p>
    </td>
    <td width=101 valign=top style='width:75.4pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.5pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal><span lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
    </td>
    <td width=402 valign=top style='width:301.7pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.5pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal><span lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
    </td>
   </tr>
   <tr>
    <td width=50 valign=top style='width:37.7pt;border:none;border-right:solid windowtext 1.5pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=right style='text-align:right'><span lang=EN-US
    style='font-family:华文中宋'>FS</span></p>
    </td>
    <td width=101 valign=top style='width:75.4pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.5pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal><span lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
    </td>
    <td width=402 valign=top style='width:301.7pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.5pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal><span lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
    </td>
   </tr>
   <tr>
    <td width=50 valign=top style='width:37.7pt;border:none;border-right:solid windowtext 1.5pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=right style='text-align:right'><span lang=EN-US
    style='font-family:华文中宋'>GS</span></p>
    </td>
    <td width=101 valign=top style='width:75.4pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.5pt;border-right:solid windowtext 1.5pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal><span lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
    </td>
    <td width=402 valign=top style='width:301.7pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.5pt;border-right:solid windowtext 1.5pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal><span lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
    </td>
   </tr>
  </table>
  </div>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>图（<span lang=EN-US>27</span>） <span lang=EN-US>80386</span>的段寄存器结构</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>加载段选择子至段寄存器的方法如下：</span></p>

<p class=MsoListParagraph style='margin-left:21.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
style='font-family:华文中宋'>对于<span lang=EN-US>CS</span>：使用远程跳转指令<span lang=EN-US>jmp</span>。具体细节将会在后文“进入保护模式”中谈及。</span></p>

<p class=MsoListParagraph style='margin-left:21.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
style='font-family:华文中宋'>对于<span lang=EN-US>DS</span>、<span lang=EN-US>ES</span>、<span
lang=EN-US>SS</span>、<span lang=EN-US>FS</span>、<span lang=EN-US>GS</span>：</span></p>

<p class=MsoListParagraph style='margin-left:21.0pt;line-height:150%'><span
lang=EN-US style='font-family:华文中宋'>mov ax, </span><span style='font-family:
华文中宋'>段选择子</span></p>

<p class=MsoListParagraph style='margin-left:21.0pt;line-height:150%'><span
lang=EN-US style='font-family:华文中宋'>mov </span><span style='font-family:华文中宋'>段寄存器（除<span
lang=EN-US>CS</span>）<span lang=EN-US>, ax</span></span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>以加载某个非代码段选择子的过程为例，若使用下述代码将数据段选择子加载至<span lang=EN-US>DS</span>中：</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
lang=EN-US style='font-family:华文中宋'>&nbsp;&nbsp;&nbsp; mov ax, seletor_DS</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
lang=EN-US style='font-family:华文中宋'>&nbsp;&nbsp;&nbsp; mov ds, ax</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
lang=EN-US style='font-family:华文中宋'>CPU</span><span style='font-family:华文中宋'>将在<span
lang=EN-US>mov ds, ax</span>之后，利用<span lang=EN-US>DS</span>中的段选择子将内存中对应该段的<span
lang=EN-US>64</span>位描述符加载至<span lang=EN-US>DS</span>的“不可见部分”。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>在这一设计下，<span lang=EN-US>CPU</span>寻址时无需经历“先从内存中读出段寄存器对应的描述符，而后再通过描述符中的相关信息计算所寻址的地址，最后取出相应内容”如此麻烦的步骤，而可以直接从寄存器中迅速取出段的相关信息，提高访存效率。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>

<p class=3 style='margin-left:0cm;text-indent:0cm'><a name="_Toc10938181"></a><a
name="_Toc10748864"><span lang=EN-US>4.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;
</span></span>二次引导程序</a></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>本部分依然对应源代码“<span lang=EN-US>boot\loader.asm</span>”。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>由于传统的<span lang=EN-US>BIOS + MBR</span>的引导方式只能加载<span
lang=EN-US>1</span>个扇区的引导程序，这给我们的引导程序编写带来了很多束缚，因而我们采用二次引导方式来完成<span lang=EN-US>lsyOS</span>的引导，以使得我们可以放开手脚大胆地编写引导程序。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>在二次引导程序中，我们需要完成保护模式的开启以及<span lang=EN-US>lsyOS</span>内核的加载与跳入。而保护模式的开启，除了要了解之前所说的“保护模式下的段式内存外”，还需要了解下面的一些内容：</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>

<p class=4 style='margin-left:21.0pt;text-indent:-21.0pt'><a name="_Toc10938182"></a><a
name="_Toc10655587"></a><a name="_Toc10252876"></a><a name="_Toc10138930"><b><span
lang=EN-US>1)<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></b><b><span
lang=EN-US>A20</span></b></a><b><span lang=EN-US> Gate</span></b></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
lang=EN-US style='font-family:华文中宋'>8086/8088</span><span style='font-family:
华文中宋'>时代，<span lang=EN-US>CPU</span>只有<span lang=EN-US>20</span>根地址线，而<span
lang=EN-US>20</span>根地址线所能表示的最大地址为<span lang=EN-US>0FFFFFh</span>，即<span
lang=EN-US>1MB</span>。而实模式下“段基址：段内偏移”这样的寻址模式最大可以表示<span lang=EN-US>FFFF:FFFF</span>的地址，即<span
lang=EN-US>10FFEFh</span>。那么，当访问从<span lang=EN-US>100000h</span>到<span
lang=EN-US>10FFEFh</span>这<span lang=EN-US>64K</span>超过<span lang=EN-US>1MB</span>的地址时，会发生什么情况呢？</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>实际上<span lang=EN-US>CPU</span>并不会产生异常，而是直接忽略掉地址中使用了第<span
lang=EN-US>20</span>根地址线的“溢出”部分，因而将回滚至<span lang=EN-US>0~FFEFh</span>的地址。然而在那个时代下，一些目光短浅的程序员利用了这一隐式“特性”来实现程序对内存空间的重用，而非自己编写显式的代码在内存底部寻找可用空间。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>到了<span lang=EN-US>80286</span>时代，<span lang=EN-US>CPU</span>地址线扩充为<span
lang=EN-US>24</span>根，最大寻址空间扩展至<span lang=EN-US>16MB</span>。此时，为了兼容利用了<span
lang=EN-US>8086/8088</span>的<span lang=EN-US>1MB</span>以上地址回滚的特性的程序，<span
lang=EN-US>Intel</span>引入了一个“开关”来控制第<span lang=EN-US>21</span>根地址线<span
lang=EN-US>A20</span>的开启与关闭。因为这一“开关”好似阻挡<span lang=EN-US>A20</span>信号的“大门”，因而它被形象的称为“<span
lang=EN-US>A20 Gate</span>”。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>

<p class=MsoListParagraph style='margin-left:31.5pt;text-indent:-31.5pt;
line-height:150%'><b><span lang=EN-US style='font-family:华文中宋'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>i.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></b><b><span style='font-family:华文中宋'>传统的<span lang=EN-US>A20 Gate</span></span></b></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>在<span lang=EN-US>80286CPU</span>设计之初，因为<span
lang=EN-US>Intel</span>的<span lang=EN-US>8042</span>键盘控制器恰有一个未使用的空引脚，于是它们决定利用该引脚控制<span
lang=EN-US>A20</span>地址线。考虑到键盘控制器和内存寻址八竿子打不着的关系，这种设计看起来很愚蠢，但是在计算机设计尚未标准化、芯片开发制造工艺并未十分完善的年代下，这样的设计似乎也节约了单独为<span
lang=EN-US>A20</span>地址线设计控制器的资源。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>如下图所示，这是关于<span lang=EN-US>80286</span>中<span
lang=EN-US>A20 Gate</span>原理的逻辑电路示意图：</span></p>

<table class=MsoTableGrid border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=553 valign=top style='width:414.8pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-size:12.0pt;line-height:150%;font-family:黑体'><img
  width=267 height=282 id="图片 8" src="/assets/source/OS/2020-08-09-OS_lab3.files/image021.png"></span></p>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>图（<span lang=EN-US>28</span>） <span lang=EN-US>80286</span>中的<span
  lang=EN-US>A20 Gate</span>示意图</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>使用这种方式开启<span lang=EN-US>A20</span>地址线需要对<span
lang=EN-US>8042</span>键盘控制器进行编程。而我们此时仍处于<span lang=EN-US>NASM</span>的纯汇编模式下，对<span
lang=EN-US>8042</span>的编程稍显麻烦，于是打算采取更简单易行的方法。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>

<p class=MsoListParagraph style='margin-left:31.5pt;text-indent:-31.5pt;
line-height:150%'><b><span lang=EN-US style='font-family:华文中宋'><span
style='font:7.0pt "Times New Roman"'>&nbsp;</span>ii.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></b><b><span lang=EN-US style='font-family:华文中宋'>Fast A20 Gate</span></b></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>当主板的南北桥结构发展起来后，在南桥（<span lang=EN-US>SB</span>，<span
lang=EN-US>South Bridge</span>）这样的高速设备和串行、并行接口、软盘驱动器、键盘鼠标等大量低速设备之间必然存在着资源不匹配问题，因而需要一块芯片将二者间的信号相互转换匹配，<span
lang=EN-US>SIO</span>（<span lang=EN-US>Super I/O</span>）芯片便实现了此功能，键盘控制器芯片也被集成入了<span
lang=EN-US>SIO</span>中。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>当然，除了为兼容性而保留传统的<span lang=EN-US>A20 Gate</span>外，南桥芯片中还新增了“替代<span
lang=EN-US>A20 Gate</span>”来实现<span lang=EN-US>A20 Gate</span>（<span
lang=EN-US>Alternate A20 Gate</span>，<span lang=EN-US>Alt_A20_GATE</span>），这技术在产生不久后改称为更通俗易懂的“<a
name="_Hlk10299522"><span lang=EN-US>Fast A20 Gate</span></a>”。它的原理十分简单，如下图所示：</span></p>

<table class=MsoTableGrid border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=553 valign=top style='width:414.8pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>&nbsp;&nbsp;</span><span lang=EN-US><img
  width=318 height=225 id="图片 17" src="/assets/source/OS/2020-08-09-OS_lab3.files/image022.png"></span></p>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>图（<span lang=EN-US>29</span>） 南桥控制的<span lang=EN-US>Fast
  A20 Gate</span>的原理示意图</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
lang=EN-US style='font-family:华文中宋'>&nbsp;</span><span style='font-family:华文中宋'>图中相关信号与元件的信息如下：</span></p>

<p class=MsoListParagraph style='margin-left:21.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span lang=EN-US
style='font-family:华文中宋'>A20GATE</span><span style='font-family:华文中宋'>：<span
lang=EN-US>SIO</span>中键盘控制器输出的<span lang=EN-US>A20 Gate</span>控制信号，高电平表示开启<span
lang=EN-US>A20</span>。</span></p>

<p class=MsoListParagraph style='margin-left:21.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span lang=EN-US
style='font-family:华文中宋'>P92</span><span style='font-family:华文中宋'>：端口<span
lang=EN-US>92</span>控制寄存器（<span lang=EN-US>Port 92 Control Register</span>），它是一个<span
lang=EN-US>8</span>位的寄存器，一般只存在于<span lang=EN-US>Intel</span>芯片组主板中的南桥中。它的结构如下：</span></p>

<table class=MsoTableGrid border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=553 valign=top style='width:414.8pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <div align=center>
  <table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
   style='border-collapse:collapse;border:none'>
   <tr>
    <td width=62 style='width:46.55pt;border:solid windowtext 1.0pt;padding:
    0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>位</span></p>
    </td>
    <td width=54 style='width:40.25pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>7</span></p>
    </td>
    <td width=54 style='width:40.3pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>6</span></p>
    </td>
    <td width=54 style='width:40.85pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>5</span></p>
    </td>
    <td width=54 style='width:40.3pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>4</span></p>
    </td>
    <td width=54 style='width:40.3pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>3</span></p>
    </td>
    <td width=54 style='width:40.85pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>2</span></p>
    </td>
    <td width=62 style='width:46.3pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>1</span></p>
    </td>
    <td width=98 style='width:73.3pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>0</span></p>
    </td>
   </tr>
   <tr>
    <td width=62 style='width:46.55pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>内容</span></p>
    </td>
    <td width=324 colspan=6 style='width:242.85pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>保留位（未用）</span></p>
    </td>
    <td width=62 style='width:46.3pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>SGA20</span></p>
    </td>
    <td width=98 style='width:73.3pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>PLKBRST#</span></p>
    </td>
   </tr>
   <tr>
    <td width=62 style='width:46.55pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>默认值</span></p>
    </td>
    <td width=54 style='width:40.25pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>0</span></p>
    </td>
    <td width=54 style='width:40.3pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>0</span></p>
    </td>
    <td width=54 style='width:40.85pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>1</span></p>
    </td>
    <td width=54 style='width:40.3pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>0</span></p>
    </td>
    <td width=54 style='width:40.3pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>0</span></p>
    </td>
    <td width=54 style='width:40.85pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>1</span></p>
    </td>
    <td width=62 style='width:46.3pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>0</span></p>
    </td>
    <td width=98 style='width:73.3pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>0</span></p>
    </td>
   </tr>
  </table>
  </div>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>图（<span lang=EN-US>30</span>） &nbsp;<span
  lang=EN-US>P92</span>控制寄存器的结构</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>其中，<span lang=EN-US>bit1</span>的<span lang=EN-US>SGA20</span>表示<span
lang=EN-US>Special GATE A20 Control</span>。</span></p>

<p class=MsoListParagraph style='margin-left:21.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span lang=EN-US
style='font-family:华文中宋'>Alt_A20_GATE</span><span style='font-family:华文中宋'>（<span
lang=EN-US>Fast A20 Gate</span>）：南桥中的一个或门，用于将<span lang=EN-US>P92</span>的<span
lang=EN-US>bit1</span>与<span lang=EN-US>A20Gate</span>相“或”形成<span lang=EN-US>A20M#</span>信号送往<span
lang=EN-US>CPU</span>中，从而实现在<span lang=EN-US>Fast A20 Gate</span>下对传统键盘控制器控制的<span
lang=EN-US>A20 Gate</span>的兼容性。</span></p>

<p class=MsoListParagraph style='margin-left:21.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span lang=EN-US
style='font-family:华文中宋'>A20M#</span><span style='font-family:华文中宋'>：从南桥输出到<span
lang=EN-US>CPU</span>引脚的信号，低电平有效。该信号有效时，<span lang=EN-US>CPU</span>的<span
lang=EN-US>A20</span>地址线始终为低电平，模拟<span lang=EN-US>8086/8088</span>的<span
lang=EN-US>1MB+</span>地址回滚特性。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>由逻辑“或”的定义，可得出关于<span lang=EN-US>A20M#</span>的真值表如下：</span></p>

<div align=center>

<table class=MsoTableGrid border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=478 valign=top style='width:358.35pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <div align=center>
  <table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
   style='border-collapse:collapse;border:none'>
   <tr>
    <td width=131 valign=top style='width:98.5pt;border:solid windowtext 1.5pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>输入<span lang=EN-US>1</span></span></p>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>P92 Bit 1</span></p>
    </td>
    <td width=131 valign=top style='width:98.5pt;border:solid windowtext 1.5pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>输入<span lang=EN-US>2</span></span></p>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>A20GATE</span></p>
    </td>
    <td width=131 valign=top style='width:98.5pt;border:solid windowtext 1.5pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>输出</span></p>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>A20M#</span></p>
    </td>
   </tr>
   <tr>
    <td width=131 valign=top style='width:98.5pt;border-top:none;border-left:
    solid windowtext 1.5pt;border-bottom:solid windowtext 1.0pt;border-right:
    solid windowtext 1.5pt;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>0</span></p>
    </td>
    <td width=131 valign=top style='width:98.5pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.5pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>0</span></p>
    </td>
    <td width=131 valign=top style='width:98.5pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.5pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>0</span></p>
    </td>
   </tr>
   <tr>
    <td width=131 valign=top style='width:98.5pt;border-top:none;border-left:
    solid windowtext 1.5pt;border-bottom:solid windowtext 1.0pt;border-right:
    solid windowtext 1.5pt;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>0</span></p>
    </td>
    <td width=131 valign=top style='width:98.5pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.5pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>1</span><span style='font-family:华文中宋'>（开启<span
    lang=EN-US>A20</span>）</span></p>
    </td>
    <td width=131 valign=top style='width:98.5pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.5pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>1</span><span style='font-family:华文中宋'>（开启<span
    lang=EN-US>A20</span>）</span></p>
    </td>
   </tr>
   <tr>
    <td width=131 valign=top style='width:98.5pt;border-top:none;border-left:
    solid windowtext 1.5pt;border-bottom:solid windowtext 1.0pt;border-right:
    solid windowtext 1.5pt;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>1</span></p>
    </td>
    <td width=131 valign=top style='width:98.5pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.5pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>0</span></p>
    </td>
    <td width=131 valign=top style='width:98.5pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.5pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>1</span><span style='font-family:华文中宋'>（开启<span
    lang=EN-US>A20</span>）</span></p>
    </td>
   </tr>
   <tr>
    <td width=131 valign=top style='width:98.5pt;border:solid windowtext 1.5pt;
    border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>1</span></p>
    </td>
    <td width=131 valign=top style='width:98.5pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.5pt;border-right:solid windowtext 1.5pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>1</span><span style='font-family:华文中宋'>（开启<span
    lang=EN-US>A20</span>）</span></p>
    </td>
    <td width=131 valign=top style='width:98.5pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.5pt;border-right:solid windowtext 1.5pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>1</span><span style='font-family:华文中宋'>（开启<span
    lang=EN-US>A20</span>）</span></p>
    </td>
   </tr>
  </table>
  </div>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>图（<span lang=EN-US>31</span>） &nbsp;输出信号<span
  lang=EN-US>A20M#</span>的真值表</span></p>
  </td>
 </tr>
</table>

</div>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>由此可知，若要开启<span lang=EN-US>A20</span>地址线，只需使用传统的<span
lang=EN-US>A20 Gate</span>或<span lang=EN-US>Fast A20 Gate</span>之一即可；然而，若需关闭<span
lang=EN-US>A20</span>地址线，则需同时关闭以上两种方法打开的地址线，稍显麻烦。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>在此，我们直接使用<span lang=EN-US>Fast A20 Gate</span>中修改<span
lang=EN-US>P92</span>寄存器的方法开启<span lang=EN-US>A20</span>地址线，具体操作十分简单。只需先从端口<span
lang=EN-US>92</span>中读出<span lang=EN-US>P92</span>寄存器的值，而后将其与<span lang=EN-US>00000010B</span>相或，从而使其<span
lang=EN-US>bit1</span>变为<span lang=EN-US>1</span>，再把这个新值输出至端口<span lang=EN-US>92</span>即可。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>按照这个思路，我们可以写出这样的代码：</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#6A9955'>;
</span><span style='font-family:宋体;color:#6A9955'>打开</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>A20</span><span style='font-family:
宋体;color:#6A9955'>地址线</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>in</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>al</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>92h</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>or</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>al</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>00000010b</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>out</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>92h</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>al</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>届时，只需在进入保护模式前一刻执行上述代码，便可开启<span lang=EN-US>A20</span>地址线，自由徜徉在保护模式的大内存空间中。</span></p>

<p class=MsoNormal><span lang=EN-US style='font-family:华文中宋'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

<p class=4 style='margin-left:0cm;text-indent:0cm'><a name="_Toc10938183"></a><a
name="_Toc10655588"></a><a name="_Toc10252878"></a><a name="_Toc10138932"></a><a
name="_Toc9694028"></a><a name="_Toc9550134"></a><a name="_Toc9539604"></a><a
name="_Toc9539567"></a><a name="_Toc9539532"><b><span lang=EN-US>2)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></b><b><span
lang=EN-US>ELF</span>文件</b></a><b>的结构与加载执行</b></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>我们不可能一直使用纯汇编语言编写操作系统，引入高级语言可以大大提高我们的开发效率。而高级语言的代码经过编译、链接等一系列步骤后，将会转换为可执行文件。常见的可执行文件主要分为两类：一是纯二进制文件，如“<span
lang=EN-US>*.com</span>”和“<span lang=EN-US>*.bin</span>”；二是<span lang=EN-US>COFF</span>（通用对象文件格式，<span
lang=EN-US>Common Object File Format</span>）文件，如<span lang=EN-US>Windows</span>下的<span
lang=EN-US>exe</span>、<span lang=EN-US>dll</span>和<span lang=EN-US>Unix</span>下的<span
lang=EN-US>ELF</span>。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>使用一段到底的纯二进制文件明显不符合现代操作系统的要求，而<span lang=EN-US>Windows
PE</span>文件的结构又稍显复杂，于是我们决定将<span lang=EN-US>lsyOS</span>内核编译成<span lang=EN-US>ELF</span>文件。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>既然做了这个决定，那么就需要了解<span lang=EN-US>ELF</span>文件的结构后才有办法执行其中的机器码。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>

<div align=center>

<table class=MsoTableGrid border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=478 valign=top style='width:358.35pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <div align=center>
  <table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
   style='border-collapse:collapse;border:none'>
   <tr>
    <td width=182 style='width:136.75pt;border:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>ELF header</span></p>
    </td>
    <td width=197 colspan=2 style='width:148.0pt;border:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
    </td>
   </tr>
   <tr>
    <td width=182 style='width:136.75pt;border:solid windowtext 1.0pt;
    border-top:none;background:#F2F2F2;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>Program header 0</span></p>
    </td>
    <td width=30 rowspan=3 style='width:22.8pt;border:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=left style='text-align:left;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'><img width=13 height=77 id="左大括号 26"
    src="/assets/source/OS/2020-08-09-OS_lab3.files/image023.png"></span></p>
    </td>
    <td width=167 rowspan=3 style='width:125.2pt;border:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=left style='text-align:left;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>Program header table</span></p>
    </td>
   </tr>
   <tr>
    <td width=182 style='width:136.75pt;border:solid windowtext 1.0pt;
    border-top:none;background:#F2F2F2;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>Program header 1</span></p>
    </td>
   </tr>
   <tr>
    <td width=182 style='width:136.75pt;border:solid windowtext 1.0pt;
    border-top:none;background:#F2F2F2;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>……</span></p>
    </td>
   </tr>
   <tr>
    <td width=182 style='width:136.75pt;border:solid windowtext 1.0pt;
    border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>Section 0</span></p>
    </td>
    <td width=30 rowspan=3 style='width:22.8pt;border:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=left style='text-align:left;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'><img width=13 height=77 id="左大括号 28"
    src="/assets/source/OS/2020-08-09-OS_lab3.files/image023.png"></span></p>
    </td>
    <td width=167 rowspan=3 style='width:125.2pt;border:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=left style='text-align:left;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>Sections</span></p>
    </td>
   </tr>
   <tr>
    <td width=182 style='width:136.75pt;border:solid windowtext 1.0pt;
    border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>Section 1</span></p>
    </td>
   </tr>
   <tr>
    <td width=182 style='width:136.75pt;border:solid windowtext 1.0pt;
    border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>……</span></p>
    </td>
   </tr>
   <tr>
    <td width=182 style='width:136.75pt;border:solid windowtext 1.0pt;
    border-top:none;background:#F2F2F2;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>Section header 0</span></p>
    </td>
    <td width=30 rowspan=3 style='width:22.8pt;border:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=left style='text-align:left;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'><img width=13 height=77 id="左大括号 27"
    src="/assets/source/OS/2020-08-09-OS_lab3.files/image023.png"></span></p>
    </td>
    <td width=167 rowspan=3 style='width:125.2pt;border:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=left style='text-align:left;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>Section header table</span></p>
    </td>
   </tr>
   <tr>
    <td width=182 style='width:136.75pt;border:solid windowtext 1.0pt;
    border-top:none;background:#F2F2F2;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>Section header 1</span></p>
    </td>
   </tr>
   <tr>
    <td width=182 style='width:136.75pt;border:solid windowtext 1.0pt;
    border-top:none;background:#F2F2F2;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>……</span></p>
    </td>
   </tr>
  </table>
  </div>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>图（<span lang=EN-US>32</span>） &nbsp;<span
  lang=EN-US>ELF</span>文件的结构</span></p>
  </td>
 </tr>
</table>

</div>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>由上图可以看出，<span lang=EN-US>ELF</span>文件由<span
lang=EN-US>ELF header</span>（<span lang=EN-US>ELF</span>头）、<span lang=EN-US>Program
header table </span>、<span lang=EN-US>Sections</span>、<span lang=EN-US>Section
header table</span>等<span lang=EN-US>4</span>部分组成。但实际的<span lang=EN-US>ELF</span>文件中，除<span
lang=EN-US>ELF</span>头必须存在且位置固定外，其余三部分未必存在，且位置没有规定。因而，<span lang=EN-US>ELF</span>头中需要储存其他其余部分的相关信息，从而使得操作系统在加载<span
lang=EN-US>ELF</span>文件时可以通过<span lang=EN-US>ELF</span>头索引到所需部分的信息。</span></p>

<p class=MsoListParagraph style='margin-left:31.5pt;text-indent:-31.5pt;
line-height:150%'><b><span lang=EN-US style='font-family:华文中宋'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>i.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></b><b><span lang=EN-US style='font-family:华文中宋'>ELF</span></b><b><span
style='font-family:华文中宋'>头</span></b></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>因为<span lang=EN-US>ELF</span>格式是<span lang=EN-US>Unix/Liunx</span>上最通用的文件格式，内核中当然也会存在着<span
lang=EN-US>ELF</span>文件在<span lang=EN-US>C</span>语言中的相关头文件。如在<span lang=EN-US>Ubuntu
18.04</span>中，该文件位置为“<span lang=EN-US>/usr/include/elf.h</span>”。查看该文件，可从中看到<span
lang=EN-US>ELF</span>文件头的<span lang=EN-US>C</span>语言结构体定义。</span></p>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0 width=576
 style='width:432.35pt;margin-left:-7.35pt;border-collapse:collapse;border:
 none'>
 <tr>
  <td width=576 valign=top style='width:432.35pt;border:solid windowtext 1.0pt;
  padding:0cm 2.85pt 0cm 2.85pt'>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>/* The ELF
  file header.&nbsp; This appears at the start of every ELF file.&nbsp; */</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>#define
  EI_NIDENT (16)</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>&nbsp;</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>typedef
  struct</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>{</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>&nbsp;
  unsigned char e_ident[EI_NIDENT];&nbsp;&nbsp; /* Magic number and other info
  */</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>&nbsp;
  Elf32_Half&nbsp;&nbsp;&nbsp;
  e_type;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  /* Object file type */</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>&nbsp;
  Elf32_Half&nbsp;&nbsp;&nbsp;
  e_machine;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  /* Architecture */</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>&nbsp;
  Elf32_Word&nbsp;&nbsp;&nbsp;
  e_version;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  /* Object file version */</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>&nbsp;
  Elf32_Addr&nbsp;&nbsp;&nbsp;
  e_entry;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  /* Entry point virtual address */</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>&nbsp;
  Elf32_Off&nbsp;&nbsp;&nbsp; &nbsp;e_phoff;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  /* Program header table file offset */</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>&nbsp;
  Elf32_Off&nbsp;&nbsp;&nbsp;&nbsp;
  e_shoff;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /* Section
  header table file offset */</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>&nbsp;
  Elf32_Word&nbsp;&nbsp;&nbsp;
  e_flags;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  /* Processor-specific flags */</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>&nbsp;
  Elf32_Half&nbsp;&nbsp;&nbsp;
  e_ehsize;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  /* ELF header size in bytes */</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>&nbsp;
  Elf32_Half&nbsp;&nbsp;&nbsp; e_phentsize;&nbsp;&nbsp;&nbsp;&nbsp; /* Program
  header table entry size */</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>&nbsp;
  Elf32_Half&nbsp;&nbsp;&nbsp;
  e_phnum;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /* Program header
  table entry count */</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>&nbsp;
  Elf32_Half&nbsp;&nbsp;&nbsp; e_shentsize;&nbsp;&nbsp; &nbsp;&nbsp;/* Section
  header table entry size */</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>&nbsp;
  Elf32_Half&nbsp;&nbsp;&nbsp; e_shnum;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;/*
  Section header table entry count */</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>&nbsp;
  Elf32_Half&nbsp;&nbsp;&nbsp; e_shstrndx;&nbsp;&nbsp;&nbsp; &nbsp;/* Section
  header string table index */</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>} Elf32_Ehdr;</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>&nbsp;</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>typedef
  struct</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>{</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>&nbsp;
  unsigned char e_ident[EI_NIDENT];&nbsp;&nbsp;&nbsp;&nbsp; /* Magic number and
  other info */</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>&nbsp;
  Elf64_Half&nbsp;&nbsp;&nbsp;
  e_type;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  /* Object file type */</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>&nbsp;
  Elf64_Half&nbsp;&nbsp;&nbsp;
  e_machine;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  /* Architecture */</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>&nbsp;
  Elf64_Word&nbsp;&nbsp;&nbsp;
  e_version;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  /* Object file version */</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>&nbsp;
  Elf64_Addr&nbsp;&nbsp;&nbsp;
  e_entry;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  /* Entry point virtual address */</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>&nbsp;
  Elf64_Off&nbsp;&nbsp;&nbsp;&nbsp;
  e_phoff;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /*
  Program header table file offset */</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>&nbsp;
  Elf64_Off&nbsp;&nbsp;&nbsp;&nbsp;
  e_shoff;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /* Section header table
  file offset */</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>&nbsp;
  Elf64_Word&nbsp;&nbsp;&nbsp;
  e_flags;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  /* Processor-specific flags */</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>&nbsp;
  Elf64_Half&nbsp;&nbsp;&nbsp;
  e_ehsize;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  /* ELF header size in bytes */</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>&nbsp;
  Elf64_Half&nbsp;&nbsp;&nbsp;
  e_phentsize;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /* Program header
  table entry size */</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>&nbsp;
  Elf64_Half&nbsp;&nbsp;&nbsp;
  e_phnum;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /*
  Program header table entry count */</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>&nbsp;
  Elf64_Half&nbsp;&nbsp;&nbsp; e_shentsize;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;/*
  Section header table entry size */</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>&nbsp;
  Elf64_Half&nbsp;&nbsp;&nbsp;
  e_shnum;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;/*
  Section header table entry count */</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>&nbsp;
  Elf64_Half&nbsp;&nbsp;&nbsp; e_shstrndx;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  /* Section header string table index */</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>}
  Elf64_Ehdr;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>从中可以看出，在<span lang=EN-US>32</span>位操作系统和<span
lang=EN-US>64</span>位操作系统下，<span lang=EN-US>ELF</span>文件头中除<span lang=EN-US>e_ident</span>以外的成员变量的数据类型是不同的，在<span
lang=EN-US>32</span>位下它们的数据类型为“</span><span lang=EN-US style='font-family:Consolas'>Elf32_</span><span
style='font-family:华文中宋'>”开头，而<span lang=EN-US>64</span>位下以“</span><span
lang=EN-US style='font-family:Consolas'>Elf64_</span><span style='font-family:
华文中宋'>”开头。结合该结构体之前的宏定义（节选）：</span></p>

<div align=center>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0 width=482
 style='width:361.25pt;border-collapse:collapse;border:none'>
 <tr>
  <td width=482 valign=top style='width:361.25pt;border:solid windowtext 1.0pt;
  padding:0cm 2.85pt 0cm 2.85pt'>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>/* Type for
  a 16-bit quantity.&nbsp; */</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>typedef
  uint16_t Elf32_Half;</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>typedef
  uint16_t Elf64_Half;</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>&nbsp;</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>/* Types for
  signed and unsigned 32-bit quantities.&nbsp; */</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>typedef
  uint32_t Elf32_Word;</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>typedef
  int32_t&nbsp; Elf32_Sword;</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>typedef
  uint32_t Elf64_Word;</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>typedef
  int32_t&nbsp; Elf64_Sword;</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>&nbsp;</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>/* Types for
  signed and unsigned 64-bit quantities.&nbsp; */</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>typedef uint64_t
  Elf32_Xword;</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>typedef
  int64_t&nbsp; Elf32_Sxword;</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>typedef
  uint64_t Elf64_Xword;</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>typedef
  int64_t&nbsp; Elf64_Sxword;</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>&nbsp;</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>/* Type of
  addresses.&nbsp; */</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>typedef
  uint32_t Elf32_Addr;</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>typedef
  uint64_t Elf64_Addr;</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>&nbsp;</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>/* Type of
  file offsets.&nbsp; */</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>typedef
  uint32_t Elf32_Off;</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>typedef
  uint64_t Elf64_Off;</span></p>
  </td>
 </tr>
</table>

</div>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>可以了解到，这样编写结构体是为了实现一个通用的、跨平台的<span lang=EN-US>ELF</span>文件，从而让文件格式与编译文件所用的操作系统无关。由上述宏定义的<span
lang=EN-US>typedef</span>和注释可以看出<span lang=EN-US>ELF</span>中定义的各种数据类型的长度与含义：</span></p>

<table class=MsoTableGrid border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=553 valign=top style='width:414.8pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <div align=center>
  <table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
   style='border-collapse:collapse;border:none'>
   <tr>
    <td width=100 style='width:74.7pt;border:solid windowtext 1.0pt;padding:
    0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>数据类型</span></p>
    </td>
    <td width=108 style='width:81.25pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>长度（字节）</span></p>
    </td>
    <td width=179 style='width:134.4pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>含义</span></p>
    </td>
   </tr>
   <tr>
    <td width=100 style='width:74.7pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>Half</span></p>
    </td>
    <td width=108 style='width:81.25pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>2</span></p>
    </td>
    <td width=179 style='width:134.4pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>Half Word</span><span style='font-family:
    华文中宋'>，无符号半字</span></p>
    </td>
   </tr>
   <tr>
    <td width=100 style='width:74.7pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>Word</span></p>
    </td>
    <td width=108 style='width:81.25pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>4</span></p>
    </td>
    <td width=179 style='width:134.4pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>无符号字</span></p>
    </td>
   </tr>
   <tr>
    <td width=100 style='width:74.7pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>Sword</span></p>
    </td>
    <td width=108 style='width:81.25pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>4</span></p>
    </td>
    <td width=179 style='width:134.4pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>有符号字</span></p>
    </td>
   </tr>
   <tr>
    <td width=100 style='width:74.7pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>Xword</span></p>
    </td>
    <td width=108 style='width:81.25pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>8</span></p>
    </td>
    <td width=179 style='width:134.4pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>无符号双字</span></p>
    </td>
   </tr>
   <tr>
    <td width=100 style='width:74.7pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>Sxword</span></p>
    </td>
    <td width=108 style='width:81.25pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>8</span></p>
    </td>
    <td width=179 style='width:134.4pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>有符号双字</span></p>
    </td>
   </tr>
   <tr>
    <td width=100 style='width:74.7pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>Elf32_Addr</span></p>
    </td>
    <td width=108 style='width:81.25pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>4</span></p>
    </td>
    <td width=179 rowspan=2 style='width:134.4pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋'>Address</span><span style='font-family:华文中宋'>，长度与目标平台字长相同。</span></p>
    </td>
   </tr>
   <tr>
    <td width=100 style='width:74.7pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>Elf64_Addr</span></p>
    </td>
    <td width=108 style='width:81.25pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>8</span></p>
    </td>
   </tr>
   <tr>
    <td width=100 style='width:74.7pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>Elf32_Off</span></p>
    </td>
    <td width=108 style='width:81.25pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>4</span></p>
    </td>
    <td width=179 rowspan=2 style='width:134.4pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋'>Offset</span><span style='font-family:华文中宋'>，长度与目标平台字长相同。</span></p>
    </td>
   </tr>
   <tr>
    <td width=100 style='width:74.7pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>Elf64_Off</span></p>
    </td>
    <td width=108 style='width:81.25pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>8</span></p>
    </td>
   </tr>
  </table>
  </div>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>图（<span lang=EN-US>33</span>） &nbsp;<span
  lang=EN-US>ELF</span>文件定义的数据类型</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>由此结合注释，便可解读<span lang=EN-US>ELF</span>头结构体中各成员对象的含义了，以<span
lang=EN-US>32</span>位平台为例：</span></p>

<table class=MsoTableGrid border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=553 valign=top style='width:414.8pt;padding:0cm 0cm 0cm 0cm'>
  <div align=center>
  <table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
   style='border-collapse:collapse;border:none'>
   <tr>
    <td width=112 style='width:83.8pt;border:solid windowtext 1.0pt;padding:
    0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>数据类型</span></p>
    </td>
    <td width=94 style='width:70.45pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>成员</span></p>
    </td>
    <td width=59 style='width:43.95pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>偏移量</span></p>
    </td>
    <td width=288 style='width:216.1pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>含义</span></p>
    </td>
   </tr>
   <tr>
    <td width=112 style='width:83.8pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋'>unsigned char</span></p>
    </td>
    <td width=94 style='width:70.45pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋'>e_ident[16]</span></p>
    </td>
    <td width=59 style='width:43.95pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>0</span></p>
    </td>
    <td width=288 style='width:216.1pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span style='font-family:华文中宋'>开头以幻数（<span
    lang=EN-US>Magic number</span>）<span lang=EN-US>0x7f</span>、<span
    lang=EN-US>'E'</span>、<span lang=EN-US>'L'</span>、<span lang=EN-US>'F'</span>四字节组成，用以标识“<span
    lang=EN-US>ELF</span>”文件。其余部分包含有关<span lang=EN-US>ELF</span>格式和体系结构的信息。</span></p>
    </td>
   </tr>
   <tr>
    <td width=112 style='width:83.8pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋'>Elf32_Half</span></p>
    </td>
    <td width=94 style='width:70.45pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋'>e_type</span></p>
    </td>
    <td width=59 style='width:43.95pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>16</span></p>
    </td>
    <td width=288 style='width:216.1pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span style='font-family:华文中宋'>目标文件的类型。可执行文件的值为<span
    lang=EN-US>2</span>。</span></p>
    </td>
   </tr>
   <tr>
    <td width=112 style='width:83.8pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋'>Elf32_Half</span></p>
    </td>
    <td width=94 style='width:70.45pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋'>e_machine</span></p>
    </td>
    <td width=59 style='width:43.95pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>18</span></p>
    </td>
    <td width=288 style='width:216.1pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span style='font-family:华文中宋'>目标文件的指令集架构。<span
    lang=EN-US>X86</span>为<span lang=EN-US>0x03</span>，<span lang=EN-US>X86-64</span>为<span
    lang=EN-US>0x3E</span>。</span></p>
    </td>
   </tr>
   <tr>
    <td width=112 style='width:83.8pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋'>Elf32_Word</span></p>
    </td>
    <td width=94 style='width:70.45pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋'>e_version</span></p>
    </td>
    <td width=59 style='width:43.95pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>20</span></p>
    </td>
    <td width=288 style='width:216.1pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span style='font-family:华文中宋'>文件版本。初版将被置为<span
    lang=EN-US>1</span>。</span></p>
    </td>
   </tr>
   <tr>
    <td width=112 style='width:83.8pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋'>Elf32_Addr</span></p>
    </td>
    <td width=94 style='width:70.45pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋'>e_entry</span></p>
    </td>
    <td width=59 style='width:43.95pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>24</span></p>
    </td>
    <td width=288 style='width:216.1pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span style='font-family:华文中宋'>程序入口地址</span></p>
    </td>
   </tr>
   <tr>
    <td width=112 style='width:83.8pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋;color:red'>Elf32_Off</span></p>
    </td>
    <td width=94 style='width:70.45pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋;color:red'>e_phoff</span></p>
    </td>
    <td width=59 style='width:43.95pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋;color:red'>28</span></p>
    </td>
    <td width=288 style='width:216.1pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋;color:red'>program header</span><span
    style='font-family:华文中宋;color:red'>在<span lang=EN-US>ELF</span>文件中的偏移量</span></p>
    </td>
   </tr>
   <tr>
    <td width=112 style='width:83.8pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋'>Elf32_Off</span></p>
    </td>
    <td width=94 style='width:70.45pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋'>e_shoff</span></p>
    </td>
    <td width=59 style='width:43.95pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>32</span></p>
    </td>
    <td width=288 style='width:216.1pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋'>section header</span><span style='font-family:
    华文中宋'>在<span lang=EN-US>ELF</span>文件中的偏移量</span></p>
    </td>
   </tr>
   <tr>
    <td width=112 style='width:83.8pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋'>Elf32_Word</span></p>
    </td>
    <td width=94 style='width:70.45pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋'>e_flags</span></p>
    </td>
    <td width=59 style='width:43.95pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>34</span></p>
    </td>
    <td width=288 style='width:216.1pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span style='font-family:华文中宋'>取决于目标架构</span></p>
    </td>
   </tr>
   <tr>
    <td width=112 style='width:83.8pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋'>Elf32_Half</span></p>
    </td>
    <td width=94 style='width:70.45pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋'>e_ehsize</span></p>
    </td>
    <td width=59 style='width:43.95pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>40</span></p>
    </td>
    <td width=288 style='width:216.1pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋'>ELF</span><span style='font-family:华文中宋'>头的长度</span></p>
    </td>
   </tr>
   <tr>
    <td width=112 style='width:83.8pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋;color:red'>Elf32_Half</span></p>
    </td>
    <td width=94 style='width:70.45pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋;color:red'>e_phentsize</span></p>
    </td>
    <td width=59 style='width:43.95pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋;color:red'>42</span></p>
    </td>
    <td width=288 style='width:216.1pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋;color:red'>program header table</span><span
    style='font-family:华文中宋;color:red'>中一个条目的长度</span></p>
    </td>
   </tr>
   <tr>
    <td width=112 style='width:83.8pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋;color:red'>Elf32_Half</span></p>
    </td>
    <td width=94 style='width:70.45pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋;color:red'>e_phnum</span></p>
    </td>
    <td width=59 style='width:43.95pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋;color:red'>44</span></p>
    </td>
    <td width=288 style='width:216.1pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋;color:red'>program header table</span><span
    style='font-family:华文中宋;color:red'>中条目的数量</span></p>
    </td>
   </tr>
   <tr>
    <td width=112 style='width:83.8pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋'>Elf32_Half</span></p>
    </td>
    <td width=94 style='width:70.45pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋'>e_shentsize</span></p>
    </td>
    <td width=59 style='width:43.95pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>46</span></p>
    </td>
    <td width=288 style='width:216.1pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋'>section header table</span><span style='font-family:
    华文中宋'>中一个条目的长度</span></p>
    </td>
   </tr>
   <tr>
    <td width=112 style='width:83.8pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋'>Elf32_Half</span></p>
    </td>
    <td width=94 style='width:70.45pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋'>e_shnum</span></p>
    </td>
    <td width=59 style='width:43.95pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>48</span></p>
    </td>
    <td width=288 style='width:216.1pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋'>section header table</span><span style='font-family:
    华文中宋'>中条目的数量</span></p>
    </td>
   </tr>
   <tr>
    <td width=112 style='width:83.8pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋'>Elf32_Half</span></p>
    </td>
    <td width=94 style='width:70.45pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋'>e_shstrndx</span></p>
    </td>
    <td width=59 style='width:43.95pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>50</span></p>
    </td>
    <td width=288 style='width:216.1pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span style='font-family:华文中宋'>含<span
    lang=EN-US>section</span>名称的<span lang=EN-US>section header table</span>条目的索引（第一个条目的索引为<span
    lang=EN-US>0</span>）</span></p>
    </td>
   </tr>
  </table>
  </div>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>图（<span lang=EN-US>34</span>）<span lang=EN-US>&nbsp;
  ELF</span>头结构体的内容</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>上述表格中如此众多的成员可能让人失去继续阅读的耐心，但其实我们最后只需要用到红色标出的三项，跳过其他的项目也是没有问题的。既然后面我们需要用到这三项，可以将其先行放入“<span
lang=EN-US>ELF.inc</span>”中：</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
e_phoff&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span lang=EN-US style='font-family:
Consolas;color:#4EC9B0'>equ</span><span lang=EN-US style='font-family:Consolas;
color:#D4D4D4'> </span><span lang=EN-US style='font-family:Consolas;color:#B5CEA8'>28</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> &nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>; ELF</span><span
style='font-family:宋体;color:#6A9955'>头中部分成员的宏定义</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;e_phentsize&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#4EC9B0'>equ</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>42</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
e_phnum&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span lang=EN-US style='font-family:
Consolas;color:#4EC9B0'>equ</span><span lang=EN-US style='font-family:Consolas;
color:#D4D4D4'> </span><span lang=EN-US style='font-family:Consolas;color:#B5CEA8'>44</span></p>

<p class=MsoListParagraph style='margin-left:31.5pt;text-indent:-31.5pt;
line-height:150%'><a name="_Hlk10299523"><b><span lang=EN-US style='font-family:
华文中宋'><span style='font:7.0pt "Times New Roman"'>&nbsp;</span>ii.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></b><b><span
lang=EN-US style='font-family:华文中宋'>program header</span></b></a></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>再来看看<span lang=EN-US>program header</span>，同样地，从“<span
lang=EN-US>elf.h</span>”中寻找到相关结构体，此次我们仅展现<span lang=EN-US>32</span>位下的结构体：</span></p>

<div align=center>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0 width=576
 style='width:432.35pt;border-collapse:collapse;border:none'>
 <tr>
  <td width=576 valign=top style='width:432.35pt;border:solid windowtext 1.0pt;
  padding:0cm 2.85pt 0cm 2.85pt'>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>/* Program
  segment header.&nbsp; */</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>typedef
  struct</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>{</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>&nbsp;
  Elf32_Word&nbsp;&nbsp;&nbsp;
  p_type;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  /* Segment type */</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>&nbsp;
  Elf32_Off&nbsp;&nbsp;&nbsp;&nbsp;
  p_offset;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  /* Segment file offset */</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>&nbsp;
  Elf32_Addr&nbsp;&nbsp;&nbsp;
  p_vaddr;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  /* Segment virtual address */</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>&nbsp;
  Elf32_Addr&nbsp;&nbsp;&nbsp;
  p_paddr;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  /* Segment physical address */</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>&nbsp;
  Elf32_Word&nbsp;&nbsp;&nbsp;
  p_filesz;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  /* Segment size in file */</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>&nbsp;
  Elf32_Word&nbsp;&nbsp;&nbsp;
  p_memsz;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  /* Segment size in memory */</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>&nbsp;
  Elf32_Word&nbsp;&nbsp;&nbsp;
  p_flags;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  /* Segment flags */</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>&nbsp;
  Elf32_Word&nbsp;&nbsp;&nbsp;
  p_align;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  /* Segment alignment */</span></p>
  <p class=MsoNormal><span lang=EN-US style='font-family:Consolas'>}
  Elf32_Phdr;</span></p>
  </td>
 </tr>
</table>

</div>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>结合注释，可解读其中各成员对象的含义：</span></p>

<table class=MsoTableGrid border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=553 valign=top style='width:414.8pt;padding:0cm 0cm 0cm 0cm'>
  <div align=center>
  <table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
   style='border-collapse:collapse;border:none'>
   <tr>
    <td width=104 style='width:77.7pt;border:solid windowtext 1.0pt;padding:
    0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>数据类型</span></p>
    </td>
    <td width=78 style='width:58.3pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>成员</span></p>
    </td>
    <td width=64 style='width:48.05pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>偏移量</span></p>
    </td>
    <td width=307 style='width:230.25pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>含义</span></p>
    </td>
   </tr>
   <tr>
    <td width=104 style='width:77.7pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋;color:red'>Elf32_Word</span></p>
    </td>
    <td width=78 style='width:58.3pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋;color:red'>p_type</span></p>
    </td>
    <td width=64 style='width:48.05pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋;color:red'>0</span></p>
    </td>
    <td width=307 style='width:230.25pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span style='font-family:华文中宋;
    color:red'>当前<span lang=EN-US>program header</span>条目所描述段的类型。其中，<span
    lang=EN-US>PT_NULL = 0</span>，表示该条目未被使用；<span lang=EN-US>PT_LOAD = 1</span>，表示该段可被加载。</span></p>
    </td>
   </tr>
   <tr>
    <td width=104 style='width:77.7pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋;color:red'>Elf32_</span><span lang=EN-US
    style='font-family:Consolas;color:red'>Off</span></p>
    </td>
    <td width=78 style='width:58.3pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋;color:red'>p_offset</span></p>
    </td>
    <td width=64 style='width:48.05pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋;color:red'>4</span></p>
    </td>
    <td width=307 style='width:230.25pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋;color:red'>program segment</span><span
    style='font-family:华文中宋;color:red'>在<span lang=EN-US>ELF</span>文件中的偏移量</span></p>
    </td>
   </tr>
   <tr>
    <td width=104 style='width:77.7pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋;color:red'>Elf32_Addr</span></p>
    </td>
    <td width=78 style='width:58.3pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋;color:red'>p_vaddr</span></p>
    </td>
    <td width=64 style='width:48.05pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋;color:red'>8</span></p>
    </td>
    <td width=307 style='width:230.25pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋;color:red'>program segment</span><span
    style='font-family:华文中宋;color:red'>在内存中的虚拟地址</span></p>
    </td>
   </tr>
   <tr>
    <td width=104 style='width:77.7pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋'>Elf32_Addr</span></p>
    </td>
    <td width=78 style='width:58.3pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋'>p_paddr</span></p>
    </td>
    <td width=64 style='width:48.05pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>12</span></p>
    </td>
    <td width=307 style='width:230.25pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋'>program segment</span><span style='font-family:
    华文中宋'>在内存中的物理地址</span></p>
    </td>
   </tr>
   <tr>
    <td width=104 style='width:77.7pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋;color:red'>Elf32_Word</span></p>
    </td>
    <td width=78 style='width:58.3pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋;color:red'>p_filesz</span></p>
    </td>
    <td width=64 style='width:48.05pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋;color:red'>16</span></p>
    </td>
    <td width=307 style='width:230.25pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋;color:red'>program segment</span><span
    style='font-family:华文中宋;color:red'>在文件中的长度</span></p>
    </td>
   </tr>
   <tr>
    <td width=104 style='width:77.7pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋'>Elf32_Word</span></p>
    </td>
    <td width=78 style='width:58.3pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋'>p_memsz</span></p>
    </td>
    <td width=64 style='width:48.05pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>20</span></p>
    </td>
    <td width=307 style='width:230.25pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋'>program segment</span><span style='font-family:
    华文中宋'>在内存中的长度</span></p>
    </td>
   </tr>
   <tr>
    <td width=104 style='width:77.7pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋'>Elf32_Word</span></p>
    </td>
    <td width=78 style='width:58.3pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋'>p_flags</span></p>
    </td>
    <td width=64 style='width:48.05pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>24</span></p>
    </td>
    <td width=307 style='width:230.25pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span style='font-family:华文中宋'>与<span
    lang=EN-US>program segment</span>相关的标志</span></p>
    </td>
   </tr>
   <tr>
    <td width=104 style='width:77.7pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋'>Elf32_Word</span></p>
    </td>
    <td width=78 style='width:58.3pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋'>p_align</span></p>
    </td>
    <td width=64 style='width:48.05pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>28</span></p>
    </td>
    <td width=307 style='width:230.25pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal style='line-height:150%'><span style='font-family:华文中宋'>确定该段在文件和内存中的对齐方式</span></p>
    </td>
   </tr>
  </table>
  </div>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>图（<span lang=EN-US>35</span>）<span lang=EN-US>&nbsp;
  program header</span>结构体的内容</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>可以看出，<span lang=EN-US>program header</span>描述了一个段在文件以及被加载至内存后的位置和大小。同样地，我们只需要用到红色部分的成员，可以先将相关宏写入“<span
lang=EN-US>ELF.inc</span>”中：</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;p_type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#4EC9B0'>equ</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0 </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>; program header</span><span
style='font-family:宋体;color:#6A9955'>部分成员宏定义，所有成员均为</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>4</span><span style='font-family:
宋体;color:#6A9955'>字节。</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;PT_NULL
&nbsp;&nbsp;&nbsp;&nbsp;</span><span lang=EN-US style='font-family:Consolas;
color:#4EC9B0'>equ</span><span lang=EN-US style='font-family:Consolas;
color:#D4D4D4'> </span><span lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;p_offset&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#4EC9B0'>equ</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>4</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;p_vaddr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#4EC9B0'>equ</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>8</span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:24.0pt;
line-height:14.25pt;background:#1E1E1E'><span lang=EN-US style='font-family:
Consolas;color:#D4D4D4'>p_filesz&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#4EC9B0'>equ</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>16</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span></p>

<p class=MsoNormal style='line-height:150%'><b><span lang=EN-US
style='font-family:华文中宋'>&nbsp;</span></b></p>

<p class=MsoListParagraph style='margin-left:31.5pt;text-indent:-31.5pt;
line-height:150%'><b><span lang=EN-US style='font-family:华文中宋'>iii.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></b><b><span
style='font-family:华文中宋'>从<span lang=EN-US>ELF</span>中剥离出内核<span lang=EN-US>program
segment</span></span></b></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>由于我们在读入<span lang=EN-US>ELF</span>格式的文件前，并不知道<span
lang=EN-US>program segment</span>被装载至内存中的地址，且我们目前并没有使用虚拟内存技术，因而只能先从磁盘中读出整个<span
lang=EN-US>ELF</span>文件，而后再将<span lang=EN-US>ELF</span>的多个<span lang=EN-US>program
segment</span>拷贝至各段对应的内存地址。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>具体的步骤如下所示：</span></p>

<p class=MsoListParagraph style='margin-left:21.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
style='font-family:华文中宋'>将内核<span lang=EN-US>ELF</span>读入内存</span></p>

<p class=MsoListParagraph style='margin-left:21.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
style='font-family:华文中宋'>从<span lang=EN-US>ELF</span>头中寻找<span lang=EN-US>program
header</span>的物理地址、<span lang=EN-US>program header table</span>中一个条目的长度和<span
lang=EN-US>program header</span>个数，读入第一个<span lang=EN-US>program header</span>条目。</span></p>

<p class=MsoListParagraph style='margin-left:21.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
style='font-family:华文中宋'>按<span lang=EN-US>program header</span>个数进行下面的循环：</span></p>

<p class=MsoListParagraph style='margin-left:42.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>n<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
style='font-family:华文中宋'>利用<span lang=EN-US>p_type</span>判断当前段是否被使用。若未被使用，跳入下一轮循环。</span></p>

<p class=MsoListParagraph style='margin-left:42.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>n<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
style='font-family:华文中宋'>寻找<span lang=EN-US>p_vaddr</span>、<span lang=EN-US>p_offset</span>和<span
lang=EN-US>p_filesz</span>的值，将以<span lang=EN-US>ELF</span>基址<span lang=EN-US> +
p_offset</span>为源地址，长度为<span lang=EN-US>p_filesz</span>的内存复制至以<span lang=EN-US>p_vaddr</span>为目的地址的内存中。</span></p>

<p class=MsoListParagraph style='margin-left:42.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>n<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
style='font-family:华文中宋'>判断是否已对所有条目进行处理。若已处理所有条目，则结束该过程；否则，读入下一个条目，继续这一循环过程。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>既然要发生<span lang=EN-US>program segment</span>的拷贝，那么经典的<span
lang=EN-US>memcpy</span>函数必不可少：</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#6A9955'>;
</span><span style='font-family:宋体;color:#6A9955'>调用前把</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>dest</span><span style='font-family:
宋体;color:#6A9955'>放入</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>edi</span><span style='font-family:宋体;color:#6A9955'>，</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>src</span><span
style='font-family:宋体;color:#6A9955'>放入</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>esi</span><span style='font-family:
宋体;color:#6A9955'>，</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>n</span><span style='font-family:宋体;color:#6A9955'>放入</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>edx</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#6A9955'>;
void *memcpy(void *dest, const void *src, size_t n)</span><span
style='font-family:宋体;color:#6A9955'>，学习自</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>liunx</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>memcpy:</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>cld</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>ecx</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>edx</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; ecx = n</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>shr</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>ecx</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>2</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; n / 4</span><span
style='font-family:宋体;color:#6A9955'>，因为一次</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>movsl</span><span style='font-family:
宋体;color:#6A9955'>四个字节</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>rep</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>movsd</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; es:di = ds:si</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>test</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>dl</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>1</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; </span><span style='font-family:
宋体;color:#6A9955'>看看</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>dl</span><span style='font-family:宋体;color:#6A9955'>最低位是不是</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>1</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>je</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> .do_nod_copy_byte </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>; </span><span
style='font-family:宋体;color:#6A9955'>如果不是</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>1</span><span style='font-family:
宋体;color:#6A9955'>，就不复制</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>1</span><span style='font-family:宋体;color:#6A9955'>个字节</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>movsb</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; </span><span style='font-family:
宋体;color:#6A9955'>否则复制一个字节</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>&nbsp;&nbsp;&nbsp;
.do_nod_copy_byte:</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>test</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>dl</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>2</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; </span><span style='font-family:
宋体;color:#6A9955'>看看</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>dl</span><span style='font-family:宋体;color:#6A9955'>次低位是不是</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>1</span><span
style='font-family:宋体;color:#6A9955'>，从而可以解决</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>4</span><span style='font-family:
宋体;color:#6A9955'>字节复制时的余数问题</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>je</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> .memcpy_return </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>; </span><span
style='font-family:宋体;color:#6A9955'>如果不是</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>1</span><span style='font-family:
宋体;color:#6A9955'>，直接返回</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>movsw</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; </span><span style='font-family:
宋体;color:#6A9955'>否则复制一个字</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>&nbsp;&nbsp;&nbsp;
.memcpy_return:</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>ret</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>这个写法以<span lang=EN-US>4</span>个字节为单位进行内存拷贝，当最后剩余未拷贝字节不足<span
lang=EN-US>4</span>个时，再依次考虑<span lang=EN-US>2</span>个字节和<span lang=EN-US>1</span>个字节的余数，具有极高的效率。当然，这个经典的函数还将会在之后的“<span
lang=EN-US>string.h</span>”中以<span lang=EN-US>GCC</span>内联汇编的形式出现。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>按照这个思路，我们可以用和加载<span lang=EN-US>loader</span>的过程完全相同的过程将内核从软盘加载至内存中，因而此处对这一过程便不再赘述。假设已经将内核加载至<span
lang=EN-US>kernel_ELF_header</span>处后，利用<span lang=EN-US>memcpy</span>函数，便可从<span
lang=EN-US>ELF</span>中剥离出内核<span lang=EN-US>program segment</span>：</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#569CD6'>%</span><span
lang=EN-US style='font-family:Consolas;color:#C586C0'>include</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'> </span><span lang=EN-US
style='font-family:Consolas;color:#CE9178'>&quot;ELF.inc&quot;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#6A9955'>;
</span><span style='font-family:宋体;color:#6A9955'>把已经加载到内存中的</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>ELF</span><span
style='font-family:宋体;color:#6A9955'>文件中的相应的程序段加载到指定位置</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><a name="_Hlk10299524"><span lang=EN-US style='font-family:
Consolas;color:#D4D4D4'>kernel_ELF_header</span></a><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#4EC9B0'>equ</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> base_kernel * </span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>10h</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; </span><span style='font-family:
宋体;color:#6A9955'>内核</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>ELF</span><span style='font-family:宋体;color:#6A9955'>头的物理地址</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>cpy_kernel:</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>ebx</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, [kernel_ELF_header + e_phoff] </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>; ebx = program header</span><span
style='font-family:宋体;color:#6A9955'>偏移量</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>add</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>ebx</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, kernel_ELF_header </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>; </span><span
style='font-family:宋体;color:#6A9955'>加上基址，</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>ebx = program header</span><span
style='font-family:宋体;color:#6A9955'>的物理地址</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>xor</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>eax</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>eax</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; eax = 0</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>ax</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, [kernel_ELF_header + e_phentsize] </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>; eax = program header
table</span><span style='font-family:宋体;color:#6A9955'>中一个条目的长度</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>push</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>eax</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; </span><span style='font-family:
宋体;color:#6A9955'>栈顶</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'> = program header table</span><span style='font-family:宋体;
color:#6A9955'>中一个条目的长度</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>ax</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, [kernel_ELF_header + e_phnum] </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>; ax = program header</span><span
style='font-family:宋体;color:#6A9955'>个数，用来指定下面的循环次数</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>&nbsp;&nbsp;&nbsp;
.cpy_program:</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>edx</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#4EC9B0'>dword</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> [</span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>ebx</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> + p_type] </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; p_type</span><span
style='font-family:宋体;color:#6A9955'>的值，表示该段的类型</span><span style='font-family:
Consolas;color:#6A9955'> </span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>cmp</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>edx</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, PT_NULL </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; edx == PT_NULL</span><span
style='font-family:宋体;color:#6A9955'>，表明该段没有被使用</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>jz</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> .cpy_next_program</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>edi</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#4EC9B0'>dword</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> [</span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>ebx</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> + p_vaddr] </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>;p_vaddr</span><span
style='font-family:宋体;color:#6A9955'>，段首字节在内存中的虚拟地址</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>esi</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#4EC9B0'>dword</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> [</span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>ebx</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> + p_offset] </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>;p_offset</span><span
style='font-family:宋体;color:#6A9955'>，段的首字节在文件中的偏移</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>add</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>esi</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, kernel_ELF_header </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>; </span><span
style='font-family:宋体;color:#6A9955'>加上基址，得到段的第一个字节的物理地址</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>edx</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#4EC9B0'>dword</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> [</span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>ebx</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> + p_filesz] </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>; p_filesz</span><span
style='font-family:宋体;color:#6A9955'>，即文件长度</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>call</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> memcpy</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
.cpy_next_program:</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>add</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>ebx</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, [</span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>esp</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>] </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; </span><span style='font-family:
宋体;color:#6A9955'>一个</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>program header</span><span style='font-family:宋体;color:#6A9955'>条目大小存在栈顶，指向下一个条目</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>dec</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>eax</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>jnz</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> .cpy_program</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>add</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>esp</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>4</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; </span><span style='font-family:
宋体;color:#6A9955'>把</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>program header</span><span style='font-family:宋体;color:#6A9955'>条目大小从栈顶弹出</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>ret</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>

<p class=4 style='margin-left:0cm;text-indent:0cm'><a name="_Toc10938184"></a><a
name="_Toc10655589"></a><a name="_Toc10252877"></a><a name="_Toc10138931"></a><a
name="_Toc9694027"></a><a name="_Toc9550133"></a><a name="_Toc9539603"></a><a
name="_Toc9539566"></a><a name="_Toc9539531"><b><span lang=EN-US>3)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></b><b>进入保护模式</b></a></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>我们已经做了如此充分的准备工作，就快要到那跳入保护模式的历史性时刻了！但别急，还有两个小问题需要了解。</span></p>

<p class=MsoListParagraph style='margin-left:31.5pt;text-indent:-31.5pt;
line-height:150%'><b><span lang=EN-US style='font-family:华文中宋'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>i.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></b><b><span style='font-family:华文中宋'>控制寄存器<span lang=EN-US>CR0</span></span></b></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
lang=EN-US style='font-family:华文中宋'>80386</span><span style='font-family:华文中宋'>在<span
lang=EN-US>8086/8088</span>的基础上增加了<span lang=EN-US>4</span>个<span lang=EN-US>32</span>位的控制寄存器<span
lang=EN-US>CR0</span>、<span lang=EN-US>CR1</span>、<span lang=EN-US>CR2</span>和<span
lang=EN-US>CR3</span>，用于控制<span lang=EN-US>CPU</span>的工作状态。而其中，<span
lang=EN-US>CR0</span>与保护模式的开启与关闭息息相关，它的结构如下所示：</span></p>

<table class=MsoTableGrid border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=553 valign=top style='width:414.8pt;padding:0cm 0cm 0cm 0cm'>
  <div align=center>
  <table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
   style='border-collapse:collapse;border:none'>
   <tr>
    <td width=47 valign=top style='width:35.2pt;border:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>位</span></p>
    </td>
    <td width=38 valign=top style='width:1.0cm;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>31</span></p>
    </td>
    <td width=296 valign=top style='width:222.15pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>30&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    ~&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    5</span></p>
    </td>
    <td width=33 valign=top style='width:24.9pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>4</span></p>
    </td>
    <td width=32 valign=top style='width:24.25pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>3</span></p>
    </td>
    <td width=37 valign=top style='width:28.05pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>2</span></p>
    </td>
    <td width=36 valign=top style='width:27.0pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>1</span></p>
    </td>
    <td width=33 valign=top style='width:24.9pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>0</span></p>
    </td>
   </tr>
   <tr>
    <td width=47 valign=top style='width:35.2pt;border:solid windowtext 1.0pt;
    border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>含义</span></p>
    </td>
    <td width=38 valign=top style='width:1.0cm;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>PG</span></p>
    </td>
    <td width=296 valign=top style='width:222.15pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>保留位，必须置<span lang=EN-US>0</span></span></p>
    </td>
    <td width=33 valign=top style='width:24.9pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>ET</span></p>
    </td>
    <td width=32 valign=top style='width:24.25pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>TS</span></p>
    </td>
    <td width=37 valign=top style='width:28.05pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>EM</span></p>
    </td>
    <td width=36 valign=top style='width:27.0pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>MP</span></p>
    </td>
    <td width=33 valign=top style='width:24.9pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>PE</span></p>
    </td>
   </tr>
  </table>
  </div>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>图（<span lang=EN-US>36</span>）<span lang=EN-US>&nbsp;
  </span>控制寄存器<span lang=EN-US>CR0</span>的结果</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>其中，<span lang=EN-US>bit1~bit4</span>的<span lang=EN-US>4</span>位合称为协处理器控制位，主要与<span
lang=EN-US>X87</span>的浮点运算相关，目前我们尚未使用。而<span lang=EN-US>bit0</span>的<span
lang=EN-US>PE</span>位和<span lang=EN-US>bit31</span>的<span lang=EN-US>PG</span>位合称保护控制位，这便是我们所需要了解的控制位。</span></p>

<p class=MsoListParagraph style='margin-left:21.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span lang=EN-US
style='font-family:华文中宋'>PE</span><span style='font-family:华文中宋'>：保护允许位（<span
lang=EN-US>Protect Enable</span>）。<span lang=EN-US>PE = 0</span>，处理器进入实模式；<span
lang=EN-US>PE = 1</span>，处理器进入保护模式；</span></p>

<p class=MsoListParagraph style='margin-left:21.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span lang=EN-US
style='font-family:华文中宋'>PG</span><span style='font-family:华文中宋'>：分页允许位（<span
lang=EN-US>Paging Grant</span>）。<span lang=EN-US>PG = 0</span>，禁用分页管理机制，此时分段管理机制产生的线性地址直接作为物理地址使用；<span
lang=EN-US>PG = 1</span>，启用分页管理机制（仅在保护模式下这一操作有效），此时线性地址经分页管理机制转换为物理地址。</span></p>

<table class=MsoTableGrid border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=553 valign=top style='width:414.8pt;padding:0cm 0cm 0cm 0cm'>
  <div align=center>
  <table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
   style='border-collapse:collapse;border:none'>
   <tr>
    <td width=94 valign=top style='width:70.65pt;border:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>PG</span><span style='font-family:华文中宋'>（分页）</span></p>
    </td>
    <td width=94 valign=top style='width:70.85pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>PE</span><span style='font-family:华文中宋'>（保护）</span></p>
    </td>
    <td width=364 valign=top style='width:273.3pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>处理器工作方式</span></p>
    </td>
   </tr>
   <tr>
    <td width=94 valign=top style='width:70.65pt;border:solid windowtext 1.0pt;
    border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>0</span></p>
    </td>
    <td width=94 valign=top style='width:70.85pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>0</span></p>
    </td>
    <td width=364 valign=top style='width:273.3pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>实模式，兼容<span lang=EN-US>8086</span></span></p>
    </td>
   </tr>
   <tr>
    <td width=94 valign=top style='width:70.65pt;border:solid windowtext 1.0pt;
    border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>0</span></p>
    </td>
    <td width=94 valign=top style='width:70.85pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>1</span></p>
    </td>
    <td width=364 valign=top style='width:273.3pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>保护模式，禁用分页机制</span></p>
    </td>
   </tr>
   <tr>
    <td width=94 valign=top style='width:70.65pt;border:solid windowtext 1.0pt;
    border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>1</span></p>
    </td>
    <td width=94 valign=top style='width:70.85pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>0</span></p>
    </td>
    <td width=364 valign=top style='width:273.3pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>非法组合，<span lang=EN-US>CPU</span>将产生<span
    lang=EN-US>General Protection Fault</span>异常</span></p>
    </td>
   </tr>
   <tr>
    <td width=94 valign=top style='width:70.65pt;border:solid windowtext 1.0pt;
    border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>1</span></p>
    </td>
    <td width=94 valign=top style='width:70.85pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>1</span></p>
    </td>
    <td width=364 valign=top style='width:273.3pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>保护模式，启用分页机制</span></p>
    </td>
   </tr>
  </table>
  </div>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>图（<span lang=EN-US>37</span>）<span lang=EN-US>&nbsp;
  PE</span>位和<span lang=EN-US>PG</span>位组合下处理器的工作方式</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>因为目前我们尚未使用分页机制，要开启保护模式，只需读出<span lang=EN-US>CR0</span>的值并将<span
lang=EN-US>PE</span>位置<span lang=EN-US>1</span>后写回即可。</span></p>

<p class=MsoNormal style='line-height:150%'><span lang=EN-US style='font-family:
华文中宋'>&nbsp;</span></p>

<p class=MsoListParagraph style='margin-left:31.5pt;text-indent:-31.5pt;
line-height:150%'><b><span lang=EN-US style='font-family:华文中宋'><span
style='font:7.0pt "Times New Roman"'>&nbsp;</span>ii.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></b><b><span lang=EN-US style='font-family:华文中宋'>16</span></b><b><span
style='font-family:华文中宋'>位代码段中进行<span lang=EN-US>32</span>位跳转</span></b></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>开启保护模式后，我们依然处于<span lang=EN-US>16</span>位的代码段，编译器默认还会将我们的<span
lang=EN-US>jmp</span>指令编译成<span lang=EN-US>16</span>位的跳转指令。此时，若使用<span
lang=EN-US>jmp seletor_CS:(base_loader_addr + protect_mode_start)</span>这样形式的代码，当偏移量大于<span
lang=EN-US>16</span>位时，将会只截取低<span lang=EN-US>16</span>位地址编译成跳转指令，产生跳转错误。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>要解决这个问题，最直接的想法便是使用<span lang=EN-US>db</span>关键字内联机器码，手写<span
lang=EN-US>32</span>位<span lang=EN-US>jmp</span>指令机器码。而<span lang=EN-US>Liunx</span>内核也确实是这样解决的。但因为我们用的是较为先进的<span
lang=EN-US>NASM</span>，开发者已经考虑到了用该产品进行操作系统开发的用途，便在<span lang=EN-US>Intel</span>宏汇编的基础上扩展了<span
lang=EN-US>jmp</span>指令的用法，可在“段选择子：偏移量”整个地址的前面加入<span lang=EN-US>dword</span>关键字（<span
lang=EN-US>Intel</span>语法中只允许在偏移量前加<span lang=EN-US>dword</span>）。此时，编译器将会把这一<span
lang=EN-US>jmp</span>指令编译成<span lang=EN-US>32</span>位跳转的机器码。因此，我们只需要使用<span
lang=EN-US>jmp <span style='color:red'>dword</span> seletor_CS:(base_loader_addr
+ protect_mode_start)</span>便可跳入<span lang=EN-US>32</span>位代码段。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>

<p class=MsoListParagraph style='margin-left:31.5pt;text-indent:-31.5pt;
line-height:150%'><b><span lang=EN-US style='font-family:华文中宋'>iii.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></b><b><span
style='font-family:华文中宋'>关中断</span></b></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>进入保护模式后，因为<span lang=EN-US>CPU</span>使用新的机制来管理中断，导致原有的实模式下的所有<span
lang=EN-US>BIOS</span>中断和异常处理程序将不再可用。此时，若有任何一个不可屏蔽中断产生，处理器将无法正常进入中断服务子程序，从而造成不可恢复的错误。因此，在开启<span
lang=EN-US>CR0</span>的<span lang=EN-US>PE</span>位进入保护模式前，应当使用<span lang=EN-US>cli</span>指令关中断，直到我们在内核中完成新的中断服务程序的编写和加载后，再重新开启中断。</span></p>

<p class=MsoNormal style='line-height:150%'><b><span lang=EN-US
style='font-family:华文中宋'>&nbsp;</span></b></p>

<p class=MsoListParagraph style='margin-left:31.5pt;text-indent:-31.5pt;
line-height:150%'><b><span lang=EN-US style='font-family:华文中宋'>iv.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></b><b><span
style='font-family:华文中宋'>完整地进入保护模式的过程</span></b></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>下面将之前所做的工作梳理一下，总结进入保护模式的基本步骤：</span></p>

<p class=MsoListParagraph style='margin-left:21.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
style='font-family:华文中宋'>编写<span lang=EN-US>GDT</span>、<span lang=EN-US>GDTR</span>的数据结构与段选择子；</span></p>

<p class=MsoListParagraph style='margin-left:21.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
style='font-family:华文中宋'>将<span lang=EN-US>GDTR</span>的数据结构加载入<span lang=EN-US>GDTR</span>；</span></p>

<p class=MsoListParagraph style='margin-left:21.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
style='font-family:华文中宋'>打开<span lang=EN-US>A20</span>地址线；</span></p>

<p class=MsoListParagraph style='margin-left:21.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
style='font-family:华文中宋'>关中断；</span></p>

<p class=MsoListParagraph style='margin-left:21.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
style='font-family:华文中宋'>将<span lang=EN-US>CR0</span>的<span lang=EN-US>PE</span>位置<span
lang=EN-US>1</span>；</span></p>

<p class=MsoListParagraph style='margin-left:21.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
style='font-family:华文中宋'>跳入<span lang=EN-US>32</span>位代码段。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>依此思路，可编写如下的代码<span lang=EN-US>&nbsp;&nbsp; </span>进入保护模式：</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#6A9955'>;
------------</span><span style='font-family:宋体;color:#6A9955'>下面准备跳入保护模式</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'> -------------</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#6A9955'>&nbsp;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#6A9955'>;
</span><span style='font-family:宋体;color:#6A9955'>加载</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'> GDTR</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>lgdt</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> [GDTR]</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#6A9955'>;
</span><span style='font-family:宋体;color:#6A9955'>打开</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>A20</span><span style='font-family:
宋体;color:#6A9955'>地址线</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>in</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>al</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>92h</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>or</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>al</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>00000010b</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>out</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>92h</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>al</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#6A9955'>;
</span><span style='font-family:宋体;color:#6A9955'>关中断</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>cli</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#6A9955'>;
</span><span style='font-family:宋体;color:#6A9955'>准备切换到保护模式</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>eax</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>cr0</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>or</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>eax</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>1</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>cr0</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>eax</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#6A9955'>;
</span><span style='font-family:宋体;color:#6A9955'>真正进入保护模式</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>jmp</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#4EC9B0'>dword</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> seletor_CS:(base_loader_addr +
protected_mode_start)</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><a
name="_Toc10655590"></a><a name="_Toc10252879"></a><a name="_Toc10138933"></a><a
name="_Toc9694029"></a><a name="_Toc9550135"></a><a name="_Toc9539605"></a><a
name="_Toc9539568"></a><a name="_Toc9539533"><span lang=EN-US style='font-family:
华文中宋'>&nbsp;</span></a></p>

<p class=4 style='margin-left:0cm;text-indent:0cm'><a name="_Toc10938185"><b><span
lang=EN-US>4)<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></b><b>跳入内核</b></a></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>执行了上述<span lang=EN-US>jmp</span>指令后，我们便跳入了保护模式下的<span
lang=EN-US>32</span>位代码段。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>此时，我们需要在代码中新建一个<span lang=EN-US>32</span>位的<span
lang=EN-US>section</span>，以向<span lang=EN-US>NASM</span>编译器表明以下代码位于<span
lang=EN-US>32</span>位的代码段，从而编译出<span lang=EN-US>32</span>位下的机器码。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>因为<span lang=EN-US>NASM</span>的指令类型分为用户级指令和原始指令两种。原始指令被包含在一个方括号中；而用户指令没有括号，且以宏的形式被编译，从而调用对应的原始指令。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>如“<span lang=EN-US>[SECTION <a name="_Hlk10385230">protected_mode</a>]</span>”便是以原始指令的形式定义了一个名为“<span
lang=EN-US>protected_mode</span>”的代码段。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>接下来可以使用<span lang=EN-US>ALIGN</span>指令对该段进行内存对齐，<span
lang=EN-US>ALIGN 32</span>指导编译器对该段进行<span lang=EN-US>32</span>位内存边界的对齐。当然，这一个用户级指令写不写无所谓，因为<span
lang=EN-US>NASM</span>中各<span lang=EN-US>section</span>在默认情况下均会进行<span
lang=EN-US>32</span>位的内存对齐。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>而<span lang=EN-US>BITS</span>指令可以指定<span lang=EN-US>NASM</span>编译器目标代码是被设计运行在<span
lang=EN-US>16</span>位模式的处理器上还是运行在<span lang=EN-US>32</span>位模式的处理器上，分别对应<span
lang=EN-US>BITS 16</span>和<span lang=EN-US>BITS 32</span>，它们的等效原始指令为［<span
lang=EN-US>BITS 16</span>］和［<span lang=EN-US>BITS 32</span>］。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>因而，使用如下的代码便可建立一个<span lang=EN-US>32</span>位的代码段：</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#6A9955'>;
-----------</span><span style='font-family:宋体;color:#6A9955'>下面是</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>32</span><span
style='font-family:宋体;color:#6A9955'>位代码段</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>-----------</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>[SECTION
protected_mode]</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>ALIGN
</span><span lang=EN-US style='font-family:Consolas;color:#B5CEA8'>32</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>[BITS
</span><span lang=EN-US style='font-family:Consolas;color:#B5CEA8'>32</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>]</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>接下来，只需将段选择子加载至对应的段寄存器中，而后调用先前编写的<span lang=EN-US>cpy_kernel</span>函数将内核从<span
lang=EN-US>ELF</span>的<span lang=EN-US>program segment</span>中剥离出来，最后使用一个<span
lang=EN-US>jmp</span>指令跳入内核，<span lang=EN-US>loader</span>的光荣使命便已完成：</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>protected_mode_start:</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>ax</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, seletor_DS</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>ds</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>ax</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>es</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>ax</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>fs</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>ax</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>ss</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>ax</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>ax</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, seletor_GS</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>gs</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>ax</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>ebp</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, base_kernel_addr</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>mov</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>esp</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>ebp</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>; </span><span style='font-family:
宋体;color:#6A9955'>让堆栈段紧挨着内核之前</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>call</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> cpy_kernel</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>jmp</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>
seletor_CS:base_kernel_addr </span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>; </span><span style='font-family:宋体;color:#6A9955'>正式进入内核，同时将段选择子加载入</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>CS</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>注意到，我们先前并未单独为堆栈段编写描述符，此处直接将代码段的描述符加载入了<span
lang=EN-US>SS</span>寄存器中。这样的做法，也许一开始难以理解，但仔细想想也不难琢磨出一丝头绪。因为现代操作系统更多地使用页式管理机制来管理内存，而段式机制通常只是作为段页式管理下的一个基石。因此，在这些系统中通常把堆栈段的基址设置为<span
lang=EN-US>0</span>，而段界限设置为整个地址空间。基于这样的考虑，我们的操作系统也会在将来引入页式管理机制，因而此处提前为其铺平道路，以减少未来新增页式管理机制后修改代码的工作量。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>

<p class=3 style='margin-left:0cm;text-indent:0cm'><a name="_Toc9361268"></a><a
name="_Toc9340660"></a><a name="_Toc9694030"></a><a name="_Toc9550136"></a><a
name="_Toc9539606"></a><a name="_Toc9539569"></a><a name="_Toc9539534"></a><a
name="_Toc9342825"></a><a name="_Toc9342631"></a><a name="_Toc10938186"></a><a
name="_Toc10748865"></a><a name="_Toc10655591"></a><a name="_Toc10252880"></a><a
name="_Toc10138934"><span lang=EN-US>5.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;
</span></span>辅助跳入内核函数</a></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>本部分对应源代码“<span lang=EN-US>include\</span></span><span
lang=EN-US> </span><span lang=EN-US style='font-family:华文中宋'>_start.asm</span><span
style='font-family:华文中宋'>”。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>本来打算内核使用完完全全的<span lang=EN-US>GCC</span>编写，可最后也不得不妥协，但最终发现还是使用一些些汇编比较方便。这文件虽然十分简单，可它却具有十分重大的意义。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>一是可以满足实验目的中“掌握<span lang=EN-US>NASM</span>汇编语言与<span
lang=EN-US>GCC</span>联合编程的方法”；</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>二是因为当<span lang=EN-US>GCC</span>编译的代码进行编译优化后，各函数之间的顺序将会被打乱，此时我们无法保证跳入内核后首先执行的函数是我们所需要的函数。当然，我们可能会想到使用<span
lang=EN-US>GCC</span>的编译参数手动指定入口函数，但这种做法在将<span lang=EN-US>c</span>代码编译为“<span
lang=EN-US>*.o</span>”的目标代码时是不可行的。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>因而，我在此编写了单独的一个汇编程序，在使用<span lang=EN-US>ld</span>链接各目标文件时，将该汇编程序的目标代码置于首位，以确保在链接成<span
lang=EN-US>ELF</span>后该程序的代码段位于<span lang=EN-US>ELF</span>文件<span lang=EN-US>program
segment</span>的头部，而后便可使用该程序跳入内核的<span lang=EN-US>main()</span>函数中，从而完成真正意义上的进入内核。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>该文件的结构如下所示，十分简洁明了：</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>extern
main</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>global
_start</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>[SECTION
.s32]</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>ALIGN
</span><span lang=EN-US style='font-family:Consolas;color:#B5CEA8'>32</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>[BITS
</span><span lang=EN-US style='font-family:Consolas;color:#B5CEA8'>32</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>]</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>_start:</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>jmp</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> main</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>其中，首行的<span lang=EN-US>extern main</span>用于指导<span
lang=EN-US>NASM</span>编译器，通知其<span lang=EN-US>main</span>这个标识存在于外部，从而避免编译错误，同时可以指导<span
lang=EN-US>ld</span>将内核中的“<span lang=EN-US>main</span>”函数正确地链接到此处；而第二行的<span
lang=EN-US>global _start</span>则是将本程序中的“<span lang=EN-US>_start:</span>”段作为一个全局的标签，使其在编译为目标文件时仍保留，从而帮助<span
lang=EN-US>ld</span>选择默认的入口函数“<span lang=EN-US>_start</span>”。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>

<p class=3 style='margin-left:0cm;text-indent:0cm'><a name="_Toc10938187"></a><a
name="_Toc10748866"></a><a name="_Toc10655592"></a><a name="_Toc10252881"></a><a
name="_Toc10138935"><span lang=EN-US>6.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;
</span></span>内核</a></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>本部分对应源代码“<span lang=EN-US>include\kernel.c</span>”。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>终于真正地进入内核当中了，但也许你看到内核的<span lang=EN-US>main()</span>函数时会大吃一惊，不禁想问，内核的代码为何如此简洁：</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#C586C0'>#include</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'> </span><span lang=EN-US
style='font-family:Consolas;color:#CE9178'>&quot;io.h&quot;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#C586C0'>#include</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'> </span><span lang=EN-US
style='font-family:Consolas;color:#CE9178'>&quot;8259a.h&quot;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#C586C0'>#include</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'> </span><span lang=EN-US
style='font-family:Consolas;color:#CE9178'>&quot;idt.h&quot;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#C586C0'>#include</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'> </span><span lang=EN-US
style='font-family:Consolas;color:#CE9178'>&quot;keyboard.h&quot;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#C586C0'>#include</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'> </span><span lang=EN-US
style='font-family:Consolas;color:#CE9178'>&quot;terminal.h&quot;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#C586C0'>#include</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'> </span><span lang=EN-US
style='font-family:Consolas;color:#CE9178'>&quot;floppy.h&quot;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#569CD6'>void</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#DCDCAA'>main</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>()</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>{</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>init_8259A</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>();</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>init_idt</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>();</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>init_key_buf</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>();</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>init_terminal</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>();</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>enable_irq</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(</span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>0</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>);&nbsp; </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>// </span><span style='font-family:
宋体;color:#6A9955'>打开时钟中断</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>enable_irq</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(</span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>1</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>); </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>// </span><span style='font-family:
宋体;color:#6A9955'>打开键盘中断</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>enable_irq</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(</span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>6</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>); </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>// </span><span style='font-family:
宋体;color:#6A9955'>打开软盘中断</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>init_floppy</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(); </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>// </span><span
style='font-family:宋体;color:#6A9955'>初始化软驱</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#C586C0'>while</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(</span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>1</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>);</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>}</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>其实上述代码做的事情十分简单：利用头文件中已经实现的函数初始化<span lang=EN-US>8259A</span>、初始化<span
lang=EN-US>IDT</span>、初始化键盘缓冲区、初始化终端、打开时钟中断、打开键盘中断、打开软盘中断和初始化软驱，最后使用<span
lang=EN-US>while(1)</span>停在那儿。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>看到这一段代码和这一系列阐述，也许你的疑问更多了？而且应该可以分为以下两类：</span></p>

<p class=MsoListParagraph style='margin-left:21.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
style='font-family:华文中宋'>上面一段话所说的<span lang=EN-US>8259A</span>、<span
lang=EN-US>IDT</span>、键盘缓冲区等是啥东西<span lang=EN-US>~</span>！！？</span></p>

<p class=MsoListParagraph style='margin-left:21.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
style='font-family:华文中宋'>最后使用<span lang=EN-US>while(1)</span>死循环后，不就无法与用户交互了吗，那这样的内核有什么用？</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>其实，上面那一段话中出现的新名词无一例外地都与保护模式下的“中断”概念相关，而<span
lang=EN-US>while(1)</span>死循环后，我们便是通过键盘中断和时钟中断，维持操作系统的正常运行，并与用户进行交互的。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>因而，在后文中，我们将介绍实现保护模式下的中断处理，从而利用这些中断实现一些驱动程序、终端与<span
lang=EN-US>shell</span>等。但在介绍这些东西之前，我们需要先了解为这一切奠定基础的<span lang=EN-US>C</span>语言标准函数库。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>

<p class=3 style='margin-left:0cm;text-indent:0cm'><a name="_Toc10938188"></a><a
name="_Toc10748867"></a><a name="_Toc10655593"></a><a name="_Toc10252882"></a><a
name="_Toc10138936"></a><a name="_Toc9694031"></a><a name="_Toc9550137"></a><a
name="_Toc9539607"></a><a name="_Toc9539570"></a><a name="_Toc9539535"></a><a
name="_Toc9342826"></a><a name="_Toc9342632"><span lang=EN-US>7.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span>C语言标准函数库</a></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>本部分对应“<span lang=EN-US>include\</span>”路径下的相应文件。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>既然是称之为<span lang=EN-US>C</span>语言标准函数库，那么下面的代码大都是按照<span
lang=EN-US>C</span>语言标准的规定而编写的。当然，毕竟这是自己的操作系统，不必似<span lang=EN-US>C</span>语言标准一般因为历史原因要对兼容性进行考量，因而必然存在着一些自己新增的或着修改过的函数。在遇到这些函数时，我将会附上特别说明，以阐述它与<span
lang=EN-US>C</span>标准定义的差别。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>因为本部分函数数量众多，它们虽然是操作系统的灵魂部分，但却不是操作系统课程的重点部分，因而，我们选择不阐述每个函数的算法细节，而只会简单概述每个头文件中所含数据类型、宏定义和函数的定义、用法。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>

<p class=4 style='margin-left:21.0pt;text-indent:-21.0pt'><a name="_Toc10252883"></a><a
name="_Toc10138937"></a><a name="_Toc10938189"></a><a name="_Toc10655594"></a><a
name="_Toc10252888"></a><a name="_Toc10138942"><b><span lang=EN-US>1)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></b><b><span
lang=EN-US>bool.h</span></b></a></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>需要说明的是，这并不是一个<span lang=EN-US>C</span>标准里规定的头文件。虽然<span
lang=EN-US>C99</span>中新增的“<span lang=EN-US>stdbool.h</span>”头文件中规定了<span
lang=EN-US>_Bool</span>的布尔型变量以及相关的值，但这一写法似乎稍显麻烦。因而本人使用类似<span lang=EN-US>C++</span>的风格定义<span
lang=EN-US>bool</span>变量，且使用“<span lang=EN-US>bool.h</span>”作为头文件的名称，以表示该头文件与<span
lang=EN-US>C</span>标准中规定的区别。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>文件中的代码十分简单，不做解释：</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#C586C0'>#ifndef</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'> </span><span lang=EN-US
style='font-family:Consolas;color:#DCDCAA'>_BOOL_H_</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#C586C0'>#define</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'> </span><span lang=EN-US
style='font-family:Consolas;color:#DCDCAA'>_BOOL_H_</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#569CD6'>typedef</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>unsigned</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>char</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>bool</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#C586C0'>#define</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'> </span><span lang=EN-US
style='font-family:Consolas;color:#DCDCAA'>true</span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'> </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>1</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#C586C0'>#define</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'> </span><span lang=EN-US
style='font-family:Consolas;color:#DCDCAA'>false</span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'> </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>0</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#C586C0'>#endif</span></p>

<p class=MsoNormal style='line-height:150%'><span lang=EN-US>&nbsp;</span></p>

<p class=4 style='margin-left:21.0pt;text-indent:-21.0pt'><a name="_Toc10938190"></a><a
name="_Toc10655595"></a><a name="_Toc10252886"></a><a name="_Toc10138940"><b><span
lang=EN-US>2)<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></b><b><span
lang=EN-US>ctype.h</span></b></a></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>该文件提供了与字符操作相关的函数，目前只定义了一个<span lang=EN-US>tolower()</span>函数。</span></p>

<div align=center>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=47 valign=top style='width:35.2pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>序号</span></p>
  </td>
  <td width=506 valign=top style='width:379.6pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid windowtext 1.0pt;border-right:none;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>函数声明及描述</span></p>
  </td>
 </tr>
 <tr>
  <td width=47 style='width:35.2pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.5pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>1</span></p>
  </td>
  <td width=506 valign=top style='width:379.6pt;border:none;border-bottom:solid windowtext 1.5pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>char tolower(char chr)</span></p>
  <p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
  style='font-family:华文中宋'>用于将一个大写字母转换为小写字符，提供给随后在“<span lang=EN-US>string.h</span>”中定义的<span
  lang=EN-US>strcasecmp()</span>函数使用。</span></p>
  </td>
 </tr>
</table>

</div>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><a
name="_Toc10655596"><span lang=EN-US style='font-family:华文中宋'>&nbsp;</span></a></p>

<p class=4 style='margin-left:21.0pt;text-indent:-21.0pt'><a name="_Toc10938191"><b><span
lang=EN-US>3)<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></b><b><span
lang=EN-US>stddef.h</span></b></a></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>该文件定义了<span lang=EN-US>C</span>语言库中常用的库变量<span
lang=EN-US>size_t</span>和库宏<span lang=EN-US>NULL</span>。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>因为本文件的代码十分简单，熟悉<span lang=EN-US>C</span>语言的朋友也了解这些定义的作用，因而直接展示代码，不再对其进行深入解释。</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#C586C0'>#ifndef</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'> </span><span lang=EN-US
style='font-family:Consolas;color:#DCDCAA'>_STDDEF_H_</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#C586C0'>#define</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'> </span><span lang=EN-US
style='font-family:Consolas;color:#DCDCAA'>_STDDEF_H_</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#C586C0'>#define</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'> </span><span lang=EN-US
style='font-family:Consolas;color:#DCDCAA'>NULL</span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'> ((void </span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>*</span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>)</span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>0</span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>)</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#569CD6'>typedef</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>unsigned</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>int</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>size_t</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#C586C0'>#endif</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>但要说明的一点是，因为我们做的是保护模式下的<span lang=EN-US>32</span>位操作系统，因而将<span
lang=EN-US>size_t</span>定义为<span lang=EN-US>32</span>位无符号整数。</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=4 style='margin-left:21.0pt;text-indent:-21.0pt'><a name="_Toc10938192"></a><a
name="_Toc10655597"></a><a name="_Toc10252884"></a><a name="_Toc10138938"><b><span
lang=EN-US>4)<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></b><b><span
lang=EN-US>stdio.h</span></b></a></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>该文件提供与标准输入、输出相关的函数，并不独立于操作系统，十分依赖于后文谈到的<span
lang=EN-US>I/O</span>驱动的实现。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>在目前的实现下，<span lang=EN-US>stdio.h</span>内部自己维护一个记录当前<span
lang=EN-US>printf</span>位置的变量，因而，与其说这是一个与标准输入、输出相关的头文件，不如说是一个与在终端上输出相关的函数。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>同时，因为本库目前也没有似标准库中的<span lang=EN-US>printf()</span>一般，实现可变参数的函数。而只是将所需的各种<span
lang=EN-US>printf</span>功能单独列出，形成一个个不同的函数。因而，下列的展现出的函数较多，且与<span lang=EN-US>C</span>标准中的规定完全不同。</span></p>

<div align=center>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=47 valign=top style='width:35.2pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>序号</span></p>
  </td>
  <td width=506 valign=top style='width:379.6pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid windowtext 1.0pt;border-right:none;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>函数声明及描述</span></p>
  </td>
 </tr>
 <tr>
  <td width=47 style='width:35.2pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>1</span></p>
  </td>
  <td width=506 valign=top style='width:379.6pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='line-height:150%'><span lang=EN-US
  style='font-family:华文中宋'>void init_printf_pos()</span></p>
  <p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
  style='font-family:华文中宋'>将在屏幕上打印字符的位置初始化为<span lang=EN-US>0</span>。</span></p>
  <p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
  style='font-family:华文中宋'>需要在首次使用任何一个与<span lang=EN-US>printf()</span>相关的语句前调用。</span></p>
  </td>
 </tr>
 <tr>
  <td width=47 style='width:35.2pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>2</span></p>
  </td>
  <td width=506 valign=top style='width:379.6pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='line-height:150%'><span lang=EN-US
  style='font-family:华文中宋'>static void if_scroll_up(); </span></p>
  <p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
  style='font-family:华文中宋'>判断打印位置是否已达到屏幕底部，若是，则将屏幕向上滚动一行。</span></p>
  <p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
  style='font-family:华文中宋'>这是<span lang=EN-US>stdio.h</span>的内部函数，仅供下述各种<span
  lang=EN-US>printf()</span>函数调用。</span></p>
  </td>
 </tr>
 <tr>
  <td width=47 style='width:35.2pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>3</span></p>
  </td>
  <td width=506 valign=top style='width:379.6pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='line-height:150%'><span lang=EN-US
  style='font-family:华文中宋'>void printf_char(const unsigned char chr)</span></p>
  <p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
  style='font-family:华文中宋'>在屏幕上打印一个字符<span lang=EN-US>chr</span>。</span></p>
  </td>
 </tr>
 <tr>
  <td width=47 style='width:35.2pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>4</span></p>
  </td>
  <td width=506 valign=top style='width:379.6pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='line-height:150%'><span lang=EN-US
  style='font-family:华文中宋'>void printf_char_with_colour</span></p>
  <p class=MsoNormal style='line-height:150%'><span lang=EN-US
  style='font-family:华文中宋'>(const unsigned char chr, unsigned char colour)</span></p>
  <p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
  style='font-family:华文中宋'>在屏幕上以颜色<span lang=EN-US>colour</span>打印一个字符<span
  lang=EN-US>chr</span>。</span></p>
  <p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
  style='font-family:华文中宋'>该颜色遵循显存中对字符属性的规定：</span></p>
  <table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
   style='border-collapse:collapse;border:none'>
   <tr>
    <td width=55 style='width:40.9pt;border-top:solid windowtext 1.5pt;
    border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>颜色</span></p>
    </td>
    <td width=218 colspan=4 style='width:163.6pt;border-top:solid windowtext 1.5pt;
    border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>前景色</span></p>
    </td>
    <td width=218 colspan=4 style='width:163.8pt;border-top:solid windowtext 1.5pt;
    border-left:none;border-bottom:solid windowtext 1.0pt;border-right:none;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>背景色</span></p>
    </td>
   </tr>
   <tr>
    <td width=55 style='width:40.9pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>位</span></p>
    </td>
    <td width=55 style='width:40.9pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>7</span></p>
    </td>
    <td width=55 style='width:40.9pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>6</span></p>
    </td>
    <td width=55 style='width:40.9pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>5</span></p>
    </td>
    <td width=55 style='width:40.9pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>4</span></p>
    </td>
    <td width=55 style='width:40.95pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>3</span></p>
    </td>
    <td width=55 style='width:40.95pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>2</span></p>
    </td>
    <td width=55 style='width:40.95pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>1</span></p>
    </td>
    <td width=55 style='width:40.95pt;border:none;border-bottom:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>0</span></p>
    </td>
   </tr>
   <tr>
    <td width=55 style='width:40.9pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.5pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>含义</span></p>
    </td>
    <td width=55 style='width:40.9pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.5pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>K</span></p>
    </td>
    <td width=55 style='width:40.9pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.5pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>R</span></p>
    </td>
    <td width=55 style='width:40.9pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.5pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>G</span></p>
    </td>
    <td width=55 style='width:40.9pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.5pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>B</span></p>
    </td>
    <td width=55 style='width:40.95pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.5pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>I</span></p>
    </td>
    <td width=55 style='width:40.95pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.5pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>R</span></p>
    </td>
    <td width=55 style='width:40.95pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.5pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>G</span></p>
    </td>
    <td width=55 style='width:40.95pt;border:none;border-bottom:solid windowtext 1.5pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>B</span></p>
    </td>
   </tr>
  </table>
  <p class=MsoNormal style='line-height:150%'><span lang=EN-US
  style='font-family:华文中宋'>&nbsp;</span></p>
  <table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
   style='border-collapse:collapse;border:none'>
   <tr>
    <td width=25 rowspan=2 style='width:18.4pt;border-top:solid windowtext 1.5pt;
    border-left:none;border-bottom:solid windowtext 1.5pt;border-right:none;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>R</span></p>
    </td>
    <td width=26 rowspan=2 style='width:19.2pt;border-top:solid windowtext 1.5pt;
    border-left:none;border-bottom:solid windowtext 1.5pt;border-right:none;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>G</span></p>
    </td>
    <td width=25 rowspan=2 style='width:18.6pt;border-top:solid windowtext 1.5pt;
    border-left:none;border-bottom:solid windowtext 1.5pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>B</span></p>
    </td>
    <td width=210 style='width:157.45pt;border-top:solid windowtext 1.5pt;
    border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>背景色</span></p>
    </td>
    <td width=205 colspan=2 style='width:153.65pt;border-top:solid windowtext 1.5pt;
    border-left:none;border-bottom:solid windowtext 1.0pt;border-right:none;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>前景色</span></p>
    </td>
   </tr>
   <tr>
    <td width=210 style='width:157.45pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.5pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>K = 0</span><span style='font-family:
    华文中宋'>时不闪烁，<span lang=EN-US>K = 1</span>时闪烁</span></p>
    </td>
    <td width=104 style='width:77.75pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.5pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>I = 0</span></p>
    </td>
    <td width=101 style='width:75.9pt;border:none;border-bottom:solid windowtext 1.5pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>I = 1</span></p>
    </td>
   </tr>
   <tr>
    <td width=25 style='width:18.4pt;border:none;border-bottom:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>0</span></p>
    </td>
    <td width=26 style='width:19.2pt;border:none;border-bottom:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>0</span></p>
    </td>
    <td width=25 style='width:18.6pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>0</span></p>
    </td>
    <td width=210 style='width:157.45pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>黑</span></p>
    </td>
    <td width=104 style='width:77.75pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>黑</span></p>
    </td>
    <td width=101 style='width:75.9pt;border:none;border-bottom:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>灰</span></p>
    </td>
   </tr>
   <tr>
    <td width=25 style='width:18.4pt;border:none;border-bottom:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>0</span></p>
    </td>
    <td width=26 style='width:19.2pt;border:none;border-bottom:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>0</span></p>
    </td>
    <td width=25 style='width:18.6pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>1</span></p>
    </td>
    <td width=210 style='width:157.45pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>蓝</span></p>
    </td>
    <td width=104 style='width:77.75pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>蓝</span></p>
    </td>
    <td width=101 style='width:75.9pt;border:none;border-bottom:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>浅蓝</span></p>
    </td>
   </tr>
   <tr>
    <td width=25 style='width:18.4pt;border:none;border-bottom:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>0</span></p>
    </td>
    <td width=26 style='width:19.2pt;border:none;border-bottom:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>1</span></p>
    </td>
    <td width=25 style='width:18.6pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>0</span></p>
    </td>
    <td width=210 style='width:157.45pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>绿</span></p>
    </td>
    <td width=104 style='width:77.75pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>绿</span></p>
    </td>
    <td width=101 style='width:75.9pt;border:none;border-bottom:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>浅绿</span></p>
    </td>
   </tr>
   <tr>
    <td width=25 style='width:18.4pt;border:none;border-bottom:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>0</span></p>
    </td>
    <td width=26 style='width:19.2pt;border:none;border-bottom:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>1</span></p>
    </td>
    <td width=25 style='width:18.6pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>1</span></p>
    </td>
    <td width=210 style='width:157.45pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>青</span></p>
    </td>
    <td width=104 style='width:77.75pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>青</span></p>
    </td>
    <td width=101 style='width:75.9pt;border:none;border-bottom:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>浅青</span></p>
    </td>
   </tr>
   <tr>
    <td width=25 style='width:18.4pt;border:none;border-bottom:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>1</span></p>
    </td>
    <td width=26 style='width:19.2pt;border:none;border-bottom:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>0</span></p>
    </td>
    <td width=25 style='width:18.6pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>0</span></p>
    </td>
    <td width=210 style='width:157.45pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>红</span></p>
    </td>
    <td width=104 style='width:77.75pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>红</span></p>
    </td>
    <td width=101 style='width:75.9pt;border:none;border-bottom:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>浅红</span></p>
    </td>
   </tr>
   <tr>
    <td width=25 style='width:18.4pt;border:none;border-bottom:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>1</span></p>
    </td>
    <td width=26 style='width:19.2pt;border:none;border-bottom:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>0</span></p>
    </td>
    <td width=25 style='width:18.6pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>1</span></p>
    </td>
    <td width=210 style='width:157.45pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>品（洋）红</span></p>
    </td>
    <td width=104 style='width:77.75pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>品（洋）红</span></p>
    </td>
    <td width=101 style='width:75.9pt;border:none;border-bottom:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>浅品（洋）红</span></p>
    </td>
   </tr>
   <tr>
    <td width=25 style='width:18.4pt;border:none;border-bottom:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>1</span></p>
    </td>
    <td width=26 style='width:19.2pt;border:none;border-bottom:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>1</span></p>
    </td>
    <td width=25 style='width:18.6pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>0</span></p>
    </td>
    <td width=210 style='width:157.45pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>棕</span></p>
    </td>
    <td width=104 style='width:77.75pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>棕</span></p>
    </td>
    <td width=101 style='width:75.9pt;border:none;border-bottom:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>黄</span></p>
    </td>
   </tr>
   <tr>
    <td width=25 style='width:18.4pt;border:none;border-bottom:solid windowtext 1.5pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>1</span></p>
    </td>
    <td width=26 style='width:19.2pt;border:none;border-bottom:solid windowtext 1.5pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>1</span></p>
    </td>
    <td width=25 style='width:18.6pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.5pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>1</span></p>
    </td>
    <td width=210 style='width:157.45pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.5pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>白</span></p>
    </td>
    <td width=104 style='width:77.75pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.5pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>白</span></p>
    </td>
    <td width=101 style='width:75.9pt;border:none;border-bottom:solid windowtext 1.5pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>亮白</span></p>
    </td>
   </tr>
  </table>
  <p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
  style='font-family:华文中宋'>以字符‘<span lang=EN-US>A</span>’为例，在黑色背景下，令背景色的所占的低<span
  lang=EN-US>4</span>位以此从<span lang=EN-US>0</span>递增至<span lang=EN-US>15</span>，字符颜色的变化为：<span
  lang=EN-US><img width=148 height=17 id="图片 29"
  src="/assets/source/OS/2020-08-09-OS_lab3.files/image024.png"></span></span></p>
  </td>
 </tr>
 <tr>
  <td width=47 style='width:35.2pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>5</span></p>
  </td>
  <td width=506 valign=top style='width:379.6pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='line-height:150%'><span lang=EN-US
  style='font-family:华文中宋'>void printf_str(const unsigned char *str)</span></p>
  <p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
  style='font-family:华文中宋'>在屏幕上打印一个空终止字节字符串<span lang=EN-US>str</span>。</span></p>
  </td>
 </tr>
 <tr>
  <td width=47 style='width:35.2pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>6</span></p>
  </td>
  <td width=506 valign=top style='width:379.6pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='line-height:150%'><span lang=EN-US
  style='font-family:华文中宋'>void printf_str_with_colour</span></p>
  <p class=MsoNormal style='line-height:150%'><span lang=EN-US
  style='font-family:华文中宋'>(const unsigned char *str, unsigned char colour)</span></p>
  <p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
  style='font-family:华文中宋'>在屏幕上以颜色<span lang=EN-US>colour</span>打印一个空终止字节字符串<span
  lang=EN-US>str</span>。</span></p>
  <p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
  style='font-family:华文中宋'>该颜色遵循显存中对字符属性的规定。</span></p>
  </td>
 </tr>
 <tr>
  <td width=47 style='width:35.2pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>7</span></p>
  </td>
  <td width=506 valign=top style='width:379.6pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='line-height:150%'><span lang=EN-US
  style='font-family:华文中宋'>void printf_str_with_width(const unsigned char *str,
  int width, char fill) </span></p>
  <p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
  style='font-family:华文中宋'>在屏幕上打印一个宽度为<span lang=EN-US>width</span>的空终止字节字符串<span
  lang=EN-US>str</span>。</span></p>
  <p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
  style='font-family:华文中宋'>若字符串长度不足<span lang=EN-US>width</span>，则用<span
  lang=EN-US>fill</span>填充；</span></p>
  <p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
  style='font-family:华文中宋'>若字符串长度大于<span lang=EN-US>width</span>，则将会被截断。</span></p>
  </td>
 </tr>
 <tr>
  <td width=47 style='width:35.2pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>8</span></p>
  </td>
  <td width=506 valign=top style='width:379.6pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='line-height:150%'><span lang=EN-US
  style='font-family:华文中宋'>void printf_int(const int num)</span></p>
  <p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
  style='font-family:华文中宋'>在屏幕上打印一个带符号整数<span lang=EN-US>num</span>。</span></p>
  </td>
 </tr>
 <tr>
  <td width=47 style='width:35.2pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>9</span></p>
  </td>
  <td width=506 valign=top style='width:379.6pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='line-height:150%'><span lang=EN-US
  style='font-family:华文中宋'>void printf_int_with_width_right_alignment</span></p>
  <p class=MsoNormal style='line-height:150%'><span lang=EN-US
  style='font-family:华文中宋'>(const int num, int width, char fill)</span></p>
  <p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
  style='font-family:华文中宋'>在屏幕上以右对齐的方式打印一个宽度为<span lang=EN-US>width</span>的带符号整数<span
  lang=EN-US>num</span>。</span></p>
  <p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
  style='font-family:华文中宋'>若整数长度不足<span lang=EN-US>width</span>，则用<span
  lang=EN-US>fill</span>填充；</span></p>
  <p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
  style='font-family:华文中宋'>若整数长度大于<span lang=EN-US>width</span>，则将会被截断。</span></p>
  </td>
 </tr>
 <tr>
  <td width=47 style='width:35.2pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.5pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>10</span></p>
  </td>
  <td width=506 valign=top style='width:379.6pt;border:none;border-bottom:solid windowtext 1.5pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='line-height:150%'><span lang=EN-US
  style='font-family:华文中宋'>void printf_hex(const unsigned char chr)</span></p>
  <p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
  style='font-family:华文中宋'>在屏幕上以两位十六进制数的形式打印一个字节<span lang=EN-US>chr</span>。</span></p>
  </td>
 </tr>
</table>

</div>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>

<p class=4 style='margin-left:21.0pt;text-indent:-21.0pt'><a name="_Toc10938193"></a><a
name="_Toc10655598"></a><a name="_Toc10252885"></a><a name="_Toc10138939"><b><span
lang=EN-US>5)<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></b><b><span
lang=EN-US>stdlib.h</span></b></a></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>该文件提供一些通用功能，包括动态内存分配、随机数生成、与操作系统的通信、整数算术、搜索、排序和数据类型转换。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>但目前我们只实现了所需的整数与字符串相互转换的函数。</span></p>

<div align=center>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=47 valign=top style='width:35.2pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>序号</span></p>
  </td>
  <td width=506 valign=top style='width:379.6pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid windowtext 1.0pt;border-right:none;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>函数声明及描述</span></p>
  </td>
 </tr>
 <tr>
  <td width=47 style='width:35.2pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>1</span></p>
  </td>
  <td width=506 valign=top style='width:379.6pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='line-height:150%'><span lang=EN-US
  style='font-family:华文中宋'>char *itoa(int val, char *str, int base)</span></p>
  <p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
  style='font-family:华文中宋'>使用指定的基<span lang=EN-US>base</span>将整数值<span
  lang=EN-US>val</span>转换为空终止字节字符串，并将结果存储在<span lang=EN-US>str</span>参数给定的缓冲区中。</span></p>
  <p class=MsoListParagraph style='margin-left:39.0pt;text-indent:-18.0pt;
  line-height:150%'><span lang=EN-US style='font-family:华文中宋'>★<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><span
  style='font-family:华文中宋'>注：<span lang=EN-US>base</span>的范围应为<span lang=EN-US>[1,
  36]</span>，即仅支持<span lang=EN-US>1~36</span>进制的整数转换。</span></p>
  </td>
 </tr>
 <tr>
  <td width=47 style='width:35.2pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.5pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>2</span></p>
  </td>
  <td width=506 valign=top style='width:379.6pt;border:none;border-bottom:solid windowtext 1.5pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='line-height:150%'><span lang=EN-US
  style='font-family:华文中宋'>int atoi(const char *str)</span></p>
  <p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
  style='font-family:华文中宋'>解析空终止字节字符串<span lang=EN-US>str</span>，将其内容转换为<span
  lang=EN-US>int</span>类型的值并返回。</span></p>
  <p class=MsoListParagraph style='margin-left:39.0pt;text-indent:-18.0pt;
  line-height:150%'><span lang=EN-US style='font-family:华文中宋'>★<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><span
  style='font-family:华文中宋'>注：和<span lang=EN-US>C</span>标准中规定的实现不同，并没有舍弃空白字符和判断非法字符。</span></p>
  </td>
 </tr>
</table>

</div>

<p class=MsoNormal style='text-indent:21.1pt;line-height:150%'><b><span
lang=EN-US>&nbsp;</span></b></p>

<p class=4 style='margin-left:21.0pt;text-indent:-21.0pt'><a name="_Toc10938194"></a><a
name="_Toc10655599"></a><a name="_Toc10252887"></a><a name="_Toc10138941"><b><span
lang=EN-US>6)<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></b><b><span
lang=EN-US>string.h</span></b></a></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>该文件提供与字符串操作和内存操作有关的函数。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>因为后续的终端与<span lang=EN-US>shell</span>将频繁涉及字符串处理函数，因而此处这些函数源码的编写方式采用<span
lang=EN-US>C</span>语言和内联汇编混合，以提高这些常用函数的执行效率。</span></p>

<div align=center>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=47 valign=top style='width:35.2pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>序号</span></p>
  </td>
  <td width=506 valign=top style='width:379.6pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid windowtext 1.0pt;border-right:none;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>函数声明及描述</span></p>
  </td>
 </tr>
 <tr>
  <td width=47 style='width:35.2pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>1</span></p>
  </td>
  <td width=506 valign=top style='width:379.6pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='line-height:150%'><span lang=EN-US
  style='font-family:华文中宋'>void * memcpy(void *dst, const void *src, size_t n)</span></p>
  <p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
  style='font-family:华文中宋'>从<span lang=EN-US> src </span>所指向的对象复制<span
  lang=EN-US> count </span>个字符到<span lang=EN-US> dest </span>所指向的对象。</span></p>
  <p class=MsoListParagraph style='margin-left:39.0pt;text-indent:-18.0pt;
  line-height:150%'><span lang=EN-US style='font-family:华文中宋'>★<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><span
  style='font-family:华文中宋'>注：这个函数采用内联汇编的方式编写，函数的实现与“<span lang=EN-US>3.</span>二次引导程序
  <span lang=EN-US>3)ELF</span>文件的结构与加载执行”中<span lang=EN-US>memcpy</span>的实现完全相同。</span></p>
  </td>
 </tr>
 <tr>
  <td width=47 style='width:35.2pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>2</span></p>
  </td>
  <td width=506 valign=top style='width:379.6pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='line-height:150%'><span lang=EN-US
  style='font-family:华文中宋'>int strcasecmp(const char *src, const char *dst)</span></p>
  <p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
  style='font-family:华文中宋'>以忽略大小写的字典序比较二个空终止字节字符串。</span></p>
  <p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
  style='font-family:华文中宋'>结果的符号是被比较的字符串中首对不同字符（都转译成<span lang=EN-US> unsigned
  char</span>）的值间的差值符号。</span></p>
  <p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
  style='font-family:华文中宋'>若 <span lang=EN-US>src</span>或 <span lang=EN-US>dst</span>不是指向空终止字节字符串的指针，则行为未定义。</span></p>
  <p class=MsoListParagraph style='margin-left:39.0pt;text-indent:-18.0pt;
  line-height:150%'><span lang=EN-US style='font-family:华文中宋'>★<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><span
  style='font-family:华文中宋'>注：该函数非<span lang=EN-US>C</span>语言标准中所规定的函数，仅<span
  lang=EN-US>Liunx</span>中有此定义。<span lang=EN-US>Windows</span>下有一功能类似的函数<span
  lang=EN-US>stricmp()</span>。</span></p>
  </td>
 </tr>
 <tr>
  <td width=47 style='width:35.2pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>3</span></p>
  </td>
  <td width=506 valign=top style='width:379.6pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='line-height:150%'><span lang=EN-US
  style='font-family:华文中宋'>char *strchr(const char *str, int ch)</span></p>
  <p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
  style='font-family:华文中宋'>在<span lang=EN-US> str </span>所指向的字节字符串中寻找字符<span
  lang=EN-US> ch</span>的首次出现。</span></p>
  <p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
  style='font-family:华文中宋'>认为终止空字符是字符串的一部分，而且若搜索<span lang=EN-US> '\0' </span>则能找到它。</span></p>
  </td>
 </tr>
 <tr>
  <td width=47 style='width:35.2pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>4</span></p>
  </td>
  <td width=506 valign=top style='width:379.6pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='line-height:150%'><span lang=EN-US
  style='font-family:华文中宋'>int strcmp(const char *src, const char *dst)</span></p>
  <p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
  style='font-family:华文中宋'>以字典序比较二个空终止字节字符串。</span></p>
  <p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
  style='font-family:华文中宋'>结果的符号是被比较的字符串中首对不同字符（都转译成<span lang=EN-US> unsigned
  char</span>）的值间的差值符号。</span></p>
  <p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
  style='font-family:华文中宋'>若 <span lang=EN-US>src</span>或 <span lang=EN-US>dst</span>不是指向空终止字节字符串的指针，则行为未定义。</span></p>
  <p class=MsoListParagraph style='margin-left:39.0pt;text-indent:-18.0pt;
  line-height:150%'><span lang=EN-US style='font-family:华文中宋'>★<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><span
  style='font-family:华文中宋'>注：曾尝试按照<span lang=EN-US>liunx1.0</span>内核的思路，使用内联汇编完成该函数，但经编译优化后，编译结果改变了代码的原意，将值传递至该函数的指针优化成了类似于<span
  lang=EN-US>C++</span>的“引用传递”，导致一些错误的发生。</span></p>
  </td>
 </tr>
 <tr>
  <td width=47 style='width:35.2pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>5</span></p>
  </td>
  <td width=506 valign=top style='width:379.6pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='line-height:150%'><span lang=EN-US
  style='font-family:华文中宋'>size_t strlen(const char *str)</span></p>
  <p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
  style='font-family:华文中宋'>返回给定字节字符串的长度，即首元素为<span lang=EN-US> str </span>所指向的字符数组直到而不包含首个空字符的字符数。若<span
  lang=EN-US> str </span>所指向的字符数组中无空字符，则行为未定义。</span></p>
  </td>
 </tr>
 <tr>
  <td width=47 style='width:35.2pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>6</span></p>
  </td>
  <td width=506 valign=top style='width:379.6pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='line-height:150%'><span lang=EN-US
  style='font-family:华文中宋'>char *strpbrk(const char *s, const char *accept)</span></p>
  <p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
  style='font-family:华文中宋'>在 <span lang=EN-US>s </span>所指向的空终止字节串中，扫描来自 <span
  lang=EN-US>accept</span>所指向的空终止字节串的任何字符，并返回指向该字符的指针。</span></p>
  </td>
 </tr>
 <tr>
  <td width=47 style='width:35.2pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>7</span></p>
  </td>
  <td width=506 valign=top style='width:379.6pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='line-height:150%'><span lang=EN-US
  style='font-family:华文中宋'>char *strrchr(const char *str, int ch)</span></p>
  <p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
  style='font-family:华文中宋'>寻找<span lang=EN-US> ch </span>（转换到<span lang=EN-US>
  char </span>后）在<span lang=EN-US> str </span>所指向的空终止字节串中的最后出现。若搜索<span
  lang=EN-US> '\0' </span>，则认为终止空字符为字符串的一部分，而且能找到。</span></p>
  </td>
 </tr>
 <tr>
  <td width=47 style='width:35.2pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>8</span></p>
  </td>
  <td width=506 valign=top style='width:379.6pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='line-height:150%'><span lang=EN-US
  style='font-family:华文中宋'>size_t strspn(const char *s, const char *accept)</span></p>
  <p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
  style='font-family:华文中宋'>返回 <span lang=EN-US>s </span>所指向的空终止字节串的最大起始段（<span
  lang=EN-US>span</span>）长度，段仅由 <span lang=EN-US>accept</span>所指向的空终止字节字符串中找到的字符组成。</span></p>
  </td>
 </tr>
 <tr>
  <td width=47 style='width:35.2pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.5pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>9</span></p>
  </td>
  <td width=506 valign=top style='width:379.6pt;border:none;border-bottom:solid windowtext 1.5pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='line-height:150%'><span lang=EN-US
  style='font-family:华文中宋'>char *strtok_r(char *s, const char *delim, char
  **save_ptr)</span></p>
  <p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
  style='font-family:华文中宋'>寻找<span lang=EN-US> str </span>所指向的空终止字节字符串中的下个记号。由<span
  lang=EN-US> delim </span>所指向的空终止字节字符串鉴别分隔字符。</span></p>
  <p class=MsoListParagraph style='margin-left:39.0pt;text-indent:-18.0pt;
  line-height:150%'><span lang=EN-US style='font-family:华文中宋'>★<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><span
  style='font-family:华文中宋'>注：该函数非<span lang=EN-US>C</span>语言标准中所规定的函数，为标准中规定的<span
  lang=EN-US>strtok()</span>函数的线程安全版本，仅<span lang=EN-US>Liunx</span>中有此定义。考虑到未来我们的操作系统需要多进程模型的实现，便不打算实现其标准库版本。</span></p>
  </td>
 </tr>
</table>

</div>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
lang=EN-US>&nbsp;</span></p>

<p class=3 style='margin-left:0cm;text-indent:0cm'><a name="_Toc10938195"></a><a
name="_Toc10748868"></a><a name="_Toc10655600"></a><a name="_Toc10252889"></a><a
name="_Toc10138948"></a><a name="_Toc9694033"></a><a name="_Toc9550139"></a><a
name="_Toc9539609"></a><a name="_Toc9539572"></a><a name="_Toc9539537"></a><a
name="_Toc9342828"></a><a name="_Toc9342634"><span lang=EN-US>8.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span>保护模式下的中断</a>机制</p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>保护模式下，中断机制发生了很大变化，实模式的中断向量表已被<span lang=EN-US>IDT</span>所代替，导致<span
lang=EN-US>BIOS</span>中断在保护模式下无法继续使用。也许你听说过保护模式下的虚拟<span lang=EN-US>8086</span>模式（<span
lang=EN-US>V8086</span>或<span lang=EN-US>V86</span>模式），但这毕竟是虚拟的，并不完全等同于实模式。在<span
lang=EN-US>V86</span>模式下，如果<span lang=EN-US>CPU</span>响应中断，便会退出当前<span
lang=EN-US>V86</span>任务的<span lang=EN-US>V86</span>模式，且仍然根据保护模式下的<span
lang=EN-US>IDT</span>来进行中断向量的查找。我们当然也不可能在需要使用特定中断时便跳出保护模式，回退实模式，这需要进行太多太多的现场保护，不仅十分繁琐，而且效率低下。因而，我们不得不自己编写<span
lang=EN-US>IDT</span>，以实现保护模式下的中断。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>反复谈及那么多次<span lang=EN-US>IDT</span>，然而你很可能没听说过<span
lang=EN-US>IDT</span>，但看到<span lang=EN-US>DT</span>二字，你一定很熟悉，这就是<span
lang=EN-US>DT in the house</span>的陶&#21894;。哦不，开个玩笑，这似乎是一个描述符表（<span lang=EN-US>Descriptor
Table</span>），和<span lang=EN-US>GDT</span>有类似之处。确实如此，它叫做中断描述符表（<span
lang=EN-US>Interrupt Descriptor Table</span>），用于对中断处理程序的索引。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>也许是因为当年的<span lang=EN-US>80386</span>的架构师喜欢多啦<span
lang=EN-US>A</span>梦（纯属自己臆想），而中断又似“任意门”一般，无论原先操作系统在干什么，<span lang=EN-US>EIP</span>指向哪里，只要未被屏蔽的中断或不可屏蔽的中断产生，中断描述表中的表项都能指引<span
lang=EN-US>CPU</span>的<span lang=EN-US>EIP</span>寄存器，转移至一个确定的地方。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>因而中断描述符表中的条目并不似<span lang=EN-US>GDT</span>的条目直接被命名为“中断描述符”，<span
lang=EN-US>Intel</span>使用专门术语“门（<span lang=EN-US>gate</span>）或门描述符（<span
lang=EN-US>Gate Descriptors</span>）”来称呼它。它分为以下三类：</span></p>

<p class=MsoListParagraph style='margin-left:42.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
style='font-family:华文中宋'>任务门（<span lang=EN-US>Task gates</span>） （注意不是“任意门”）</span></p>

<p class=MsoListParagraph style='margin-left:42.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
style='font-family:华文中宋'>中断门（<span lang=EN-US>Interrupt gates</span>）</span></p>

<p class=MsoListParagraph style='margin-left:42.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
style='font-family:华文中宋'>陷阱门（<span lang=EN-US>Trap gates</span>）</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>因为我们不需要用到“任务门”，所以后文将只对“中断门”和“陷阱门”进行讲解。</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=4 style='margin-left:21.0pt;text-indent:-21.0pt'><a name="_Toc10938196"></a><a
name="_Toc10655601"><b><span lang=EN-US>1)<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;
</span></span></b><b>门</b></a><b>描述符、中段描述符表与中段描述符表寄存器</b></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>本部分对应源代码“<span lang=EN-US>include\idt.h</span>”。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>中断门、陷阱门与“师出同门”的全局描述符很相似，也是一个<span lang=EN-US>8</span>字节的数据结构，也同样有向下兼容的考虑，也由三个字段组成。但此时，全局描述符中的段基址字段换成了段选择子。因为段选择子的存在，不再需要把段基址也进行拆开存放，此时这个“门”的结构就显得友好了许多。</span></p>

<table class=MsoTableGrid border=0 cellspacing=0 cellpadding=0
 style='margin-left:-7.1pt;border-collapse:collapse;border:none'>
 <tr>
  <td width=563 valign=top style='width:422.4pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <div align=center>
  <table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0 width=560
   style='width:419.8pt;border-collapse:collapse;border:none'>
   <tr>
    <td width=45 style='width:33.9pt;border:solid windowtext 1.0pt;padding:
    0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>字节</span></p>
    </td>
    <td width=64 colspan=2 style='width:48.2pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>Byte7</span></p>
    </td>
    <td width=64 colspan=2 style='width:48.25pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>Byte6</span></p>
    </td>
    <td width=64 colspan=3 style='width:48.25pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>Byte5</span></p>
    </td>
    <td width=64 colspan=2 style='width:48.25pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>Byte4</span></p>
    </td>
    <td width=64 colspan=2 style='width:48.2pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>Byte3</span></p>
    </td>
    <td width=64 colspan=2 style='width:48.25pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>Byte2</span></p>
    </td>
    <td width=64 colspan=2 style='width:48.25pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>Byte1</span></p>
    </td>
    <td width=64 colspan=2 style='width:48.25pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>Byte0</span></p>
    </td>
   </tr>
   <tr style='height:27.1pt'>
    <td width=45 style='width:33.9pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt;height:27.1pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>表示</span></p>
    </td>
    <td width=129 colspan=4 style='width:96.45pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt;height:27.1pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>偏移量<span lang=EN-US>31</span>…<span lang=EN-US>16</span></span></p>
    </td>
    <td width=129 colspan=5 style='width:96.5pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt;height:27.1pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>门属性</span></p>
    </td>
    <td width=129 colspan=4 style='width:96.45pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt;height:27.1pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>段选择子</span></p>
    </td>
    <td width=129 colspan=4 style='width:96.5pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt;height:27.1pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>偏移量<span lang=EN-US>15</span>…<span lang=EN-US>0</span></span></p>
    </td>
   </tr>
   <tr style='height:27.05pt'>
    <td width=45 style='width:33.9pt;border:none;border-bottom:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt;height:27.05pt'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋'>&nbsp;</span></p>
    </td>
    <td width=129 colspan=4 style='width:96.45pt;border:none;border-bottom:
    solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt;height:27.05pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
    </td>
    <td width=36 colspan=2 valign=top style='width:26.9pt;border:none;
    border-bottom:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt;
    height:27.05pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
    </td>
    <td width=93 colspan=3 style='width:69.6pt;border:none;border-bottom:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt;height:27.05pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
    </td>
    <td width=257 colspan=8 style='width:192.95pt;border:none;border-bottom:
    solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt;height:27.05pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
    </td>
   </tr>
   <tr>
    <td width=45 style='width:33.9pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>位</span></p>
    </td>
    <td width=32 style='width:24.1pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>15</span></p>
    </td>
    <td width=32 style='width:24.1pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>14</span></p>
    </td>
    <td width=32 style='width:24.15pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>13</span></p>
    </td>
    <td width=32 style='width:24.1pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>12</span></p>
    </td>
    <td width=32 style='width:24.1pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>11</span></p>
    </td>
    <td width=32 colspan=2 style='width:24.15pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>10</span></p>
    </td>
    <td width=32 style='width:24.1pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>9</span></p>
    </td>
    <td width=32 style='width:24.15pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>8</span></p>
    </td>
    <td width=32 style='width:24.1pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>7</span></p>
    </td>
    <td width=32 style='width:24.1pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>6</span></p>
    </td>
    <td width=32 style='width:24.15pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>5</span></p>
    </td>
    <td width=32 style='width:24.1pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>4</span></p>
    </td>
    <td width=32 style='width:24.1pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>3</span></p>
    </td>
    <td width=32 style='width:24.15pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>2</span></p>
    </td>
    <td width=32 style='width:24.1pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>1</span></p>
    </td>
    <td width=32 style='width:24.15pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>0</span></p>
    </td>
   </tr>
   <tr style='height:27.1pt'>
    <td width=45 style='width:33.9pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt;height:27.1pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>表示</span></p>
    </td>
    <td width=32 style='width:24.1pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt;height:27.1pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-size:10.0pt;line-height:150%'>P</span></p>
    </td>
    <td width=64 colspan=2 style='width:48.25pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt;height:27.1pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-size:10.0pt;line-height:150%'>DPL</span></p>
    </td>
    <td width=32 style='width:24.1pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt;height:27.1pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-size:10.0pt;line-height:150%'>S</span></p>
    </td>
    <td width=129 colspan=5 style='width:96.5pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt;height:27.1pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-size:10.0pt;line-height:150%'>TYPE</span></p>
    </td>
    <td width=32 style='width:24.1pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt;height:27.1pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-size:10.0pt;line-height:150%'>0</span></p>
    </td>
    <td width=32 style='width:24.1pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt;height:27.1pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-size:10.0pt;line-height:150%'>0</span></p>
    </td>
    <td width=32 style='width:24.15pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt;height:27.1pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-size:10.0pt;line-height:150%'>0</span></p>
    </td>
    <td width=161 colspan=5 style='width:120.6pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt;height:27.1pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-size:10.0pt;line-height:150%;font-family:华文中宋'>保留位</span></p>
    </td>
   </tr>
   <tr height=0>
    <td width=45 style='border:none'></td>
    <td width=32 style='border:none'></td>
    <td width=32 style='border:none'></td>
    <td width=32 style='border:none'></td>
    <td width=32 style='border:none'></td>
    <td width=32 style='border:none'></td>
    <td width=4 style='border:none'></td>
    <td width=28 style='border:none'></td>
    <td width=32 style='border:none'></td>
    <td width=32 style='border:none'></td>
    <td width=32 style='border:none'></td>
    <td width=32 style='border:none'></td>
    <td width=32 style='border:none'></td>
    <td width=32 style='border:none'></td>
    <td width=32 style='border:none'></td>
    <td width=32 style='border:none'></td>
    <td width=32 style='border:none'></td>
    <td width=32 style='border:none'></td>
   </tr>
  </table>
  </div>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>图（<span lang=EN-US>38</span>）<span lang=EN-US>&nbsp;
  80386</span>的中断门、陷阱门</span></p>
  </td>
 </tr>
</table>

<p class=MsoListParagraph style='line-height:150%'><span style='font-family:
华文中宋'>门属性中各字段的具体含义如下（由图中从左至右的顺序解释）：</span></p>

<p class=MsoListParagraph style='margin-left:21.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span lang=EN-US
style='font-family:华文中宋'>P</span><span style='font-family:华文中宋'>：存在（<span
lang=EN-US>Present</span>）。<span lang=EN-US>P = 0</span>表示未使用该中断。</span></p>

<p class=MsoListParagraph style='margin-left:21.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span lang=EN-US
style='font-family:华文中宋'>DPL</span><span style='font-family:华文中宋'>：描述符特权级（<span
lang=EN-US>Descriptor privilege level</span>）。指定调用该描述符的最低特权级。用于保护硬件和<span
lang=EN-US>CPU</span>中断不被用户空间所调用。</span></p>

<p class=MsoListParagraph style='margin-left:21.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span lang=EN-US
style='font-family:华文中宋'>S</span><span style='font-family:华文中宋'>：储存段（<span
lang=EN-US>Storage Segment</span>）。对门描述符，该位置为<span lang=EN-US>0</span>。</span></p>

<p class=MsoListParagraph style='margin-left:21.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span lang=EN-US
style='font-family:华文中宋'>TYPE</span><span style='font-family:华文中宋'>：门的具体类型。</span></p>

<table class=MsoTableGrid border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=553 valign=top style='width:414.8pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <div align=center>
  <table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0
   style='border-collapse:collapse;border:none'>
   <tr style='height:23.4pt'>
    <td width=89 style='width:66.7pt;border:solid windowtext 1.0pt;padding:
    0cm 5.4pt 0cm 5.4pt;height:23.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>位</span></p>
    </td>
    <td width=41 style='width:30.75pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt;height:23.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>11</span></p>
    </td>
    <td width=41 style='width:30.75pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt;height:23.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>10</span></p>
    </td>
    <td width=41 style='width:30.75pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt;height:23.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>9</span></p>
    </td>
    <td width=41 style='width:30.75pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt;height:23.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>8</span></p>
    </td>
    <td width=137 style='width:102.85pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt;height:23.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>含义</span></p>
    </td>
   </tr>
   <tr style='height:23.4pt'>
    <td width=89 style='width:66.7pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt;height:23.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>值</span></p>
    </td>
    <td width=41 style='width:30.75pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt;height:23.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>1</span></p>
    </td>
    <td width=41 style='width:30.75pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt;height:23.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>1</span></p>
    </td>
    <td width=41 style='width:30.75pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt;height:23.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>1</span></p>
    </td>
    <td width=41 style='width:30.75pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt;height:23.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>0</span></p>
    </td>
    <td width=137 style='width:102.85pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt;height:23.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>80386</span><span style='font-family:
    华文中宋'>中断门</span></p>
    </td>
   </tr>
   <tr style='height:23.4pt'>
    <td width=89 style='width:66.7pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt;height:23.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>值</span></p>
    </td>
    <td width=41 style='width:30.75pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt;height:23.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>1</span></p>
    </td>
    <td width=41 style='width:30.75pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt;height:23.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>1</span></p>
    </td>
    <td width=41 style='width:30.75pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt;height:23.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>1</span></p>
    </td>
    <td width=41 style='width:30.75pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt;height:23.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>1</span></p>
    </td>
    <td width=137 style='width:102.85pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt;height:23.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>80386</span><span style='font-family:
    华文中宋'>陷阱门</span></p>
    </td>
   </tr>
  </table>
  </div>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>图（<span lang=EN-US>39</span>）<span lang=EN-US>&nbsp;
  TYPE</span>字段在不同含义下的取值</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>由此便可写出<span lang=EN-US>C</span>语言中的“门”结构体：</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#569CD6'>struct</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#4EC9B0'>gate_desc</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>// </span><span style='font-family:
宋体;color:#6A9955'>门描述符</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>{</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>unsigned</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>short</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> offset_low; </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>// </span><span
style='font-family:宋体;color:#6A9955'>偏移量低</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>16</span><span style='font-family:
宋体;color:#6A9955'>位</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>unsigned</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>short</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> selector; </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>// </span><span style='font-family:
宋体;color:#6A9955'>段选择子</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>unsigned</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>char</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> dcount; </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>// </span><span style='font-family:
宋体;color:#6A9955'>调用门使用。这里我们把它常置为</span><span lang=EN-US style='font-family:
Consolas;color:#6A9955'>0</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>unsigned</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>char</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> attribute; </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>// </span><span style='font-family:
宋体;color:#6A9955'>属性</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>unsigned</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>short</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> offset_high; </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>// </span><span
style='font-family:宋体;color:#6A9955'>偏移量高</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>16</span><span style='font-family:
宋体;color:#6A9955'>位</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>};</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>还记得实模式下的中断向量表有<span lang=EN-US>256</span>个条目吗，<span
lang=EN-US>IDT</span>的长度当然也是<span lang=EN-US>256</span>。而且，<span lang=EN-US>IDT</span>也和中断向量表一样，第<span
lang=EN-US>0</span>个条目是可用的（而不似<span lang=EN-US>GDT</span>的第<span lang=EN-US>0</span>个条目无法使用）。因而，只需利用这个结构体，定义一个含<span
lang=EN-US>256</span>个元素的数组，便构成了<span lang=EN-US>IDT</span>：</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#C586C0'>#define</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'> </span><span lang=EN-US
style='font-family:Consolas;color:#DCDCAA'>idt_size</span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'> </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>256</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>struct</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#4EC9B0'>gate_desc</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#9CDCFE'>idt</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>[idt_size]; </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>// idt</span><span style='font-family:
宋体;color:#6A9955'>表</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>接着，利用<span lang=EN-US>init_gate_desc()</span>函数，只需传入中断向量号<span
lang=EN-US>vector</span>，门描述符的类型<span lang=EN-US>desc_type</span>，中断服务程序的函数指针<span
lang=EN-US>handler</span>，描述符特权级<span lang=EN-US>DPL</span>，便可完成一个门描述符的创建：</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#C586C0'>#define</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'> </span><span lang=EN-US
style='font-family:Consolas;color:#DCDCAA'>seletor_CS</span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'> </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>8</span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>// loader.asm</span><span
style='font-family:宋体;color:#6A9955'>中确定了的</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>CS</span><span style='font-family:
宋体;color:#6A9955'>的段选择子</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#569CD6'>void</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#DCDCAA'>init_gate_desc</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(</span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>unsigned</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>char</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#9CDCFE'>vector</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>unsigned</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>char</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#9CDCFE'>desc_type</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>,</span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:115.5pt;
line-height:14.25pt;background:#1E1E1E'><span lang=EN-US style='font-family:
Consolas;color:#569CD6'>void</span><span lang=EN-US style='font-family:Consolas;
color:#D4D4D4'> *</span><span lang=EN-US style='font-family:Consolas;
color:#9CDCFE'>handler</span><span lang=EN-US style='font-family:Consolas;
color:#D4D4D4'>, </span><span lang=EN-US style='font-family:Consolas;
color:#569CD6'>unsigned</span><span lang=EN-US style='font-family:Consolas;
color:#D4D4D4'> </span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>char</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#9CDCFE'>DPL</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>)</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>{</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
gate_desc *ptr_gate = &amp;</span><span lang=EN-US style='font-family:Consolas;
color:#9CDCFE'>idt</span><span lang=EN-US style='font-family:Consolas;
color:#D4D4D4'>[vector];</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#9CDCFE'>ptr_gate</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>-&gt;</span><span
lang=EN-US style='font-family:Consolas;color:#9CDCFE'>offset_low</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> = (</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'>unsigned</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>int</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>)handler &amp; </span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0xFFFF</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#9CDCFE'>ptr_gate</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>-&gt;</span><span
lang=EN-US style='font-family:Consolas;color:#9CDCFE'>selector</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> = seletor_CS;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#9CDCFE'>ptr_gate</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>-&gt;</span><span
lang=EN-US style='font-family:Consolas;color:#9CDCFE'>dcount</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> = </span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#9CDCFE'>ptr_gate</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>-&gt;</span><span
lang=EN-US style='font-family:Consolas;color:#9CDCFE'>attribute</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> = desc_type | (DPL
&lt;&lt; </span><span lang=EN-US style='font-family:Consolas;color:#B5CEA8'>5</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>);</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#9CDCFE'>ptr_gate</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>-&gt;</span><span
lang=EN-US style='font-family:Consolas;color:#9CDCFE'>offset_high</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> = ((</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'>unsigned</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>int</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>)handler &gt;&gt; </span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>16</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>) &amp; </span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0xFFFF</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>}</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>假设我们已经编写好了一个空的中断服务程序<span lang=EN-US>vector_empty()</span>，便可利用一个循环初始化<span
lang=EN-US>IDT</span>中的所有门，指向该程序：</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#C586C0'>#define</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'>&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#DCDCAA'>desc_type_386int</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'> </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>0xE</span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>// 80386</span><span
style='font-family:宋体;color:#6A9955'>中断门类型值</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#C586C0'>&nbsp;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#C586C0'>#define</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'>&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#DCDCAA'>DPL_kernel</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'>&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0</span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>// </span><span style='font-family:
宋体;color:#6A9955'>内核态，特权级为</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>0</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#C586C0'>#define</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'>&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#DCDCAA'>DPL_user</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'>&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>3</span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>// </span><span style='font-family:
宋体;color:#6A9955'>用户态，特权级为</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>3</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#C586C0'>for</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(</span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>int</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> i = </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>0</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>; i &lt; idt_size; i++)</span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:24.0pt;
line-height:14.25pt;background:#1E1E1E'><span lang=EN-US style='font-family:
Consolas;color:#DCDCAA'>init_gate_desc</span><span lang=EN-US style='font-family:
Consolas;color:#D4D4D4'>(i, desc_type_386int, </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>NULL</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, DPL_kernel); </span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:24.0pt;
line-height:14.25pt;background:#1E1E1E'><span lang=EN-US style='font-family:
Consolas;color:#6A9955'>// </span><span style='font-family:宋体;color:#6A9955'>初始化空描述符，不置</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>“</span><span
style='font-family:宋体;color:#6A9955'>存在位</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>”</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>这样，一个空的<span lang=EN-US>IDT</span>算是构建好了。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>接下来，如同<span lang=EN-US>GDT</span>要加载至<span lang=EN-US>GDTR</span>一样，我们要将<span
lang=EN-US>IDT</span>加载至<span lang=EN-US>IDTR</span>中，而<span lang=EN-US>IDTR</span>的结构与<span
lang=EN-US>GDTR</span>完全相同：</span></p>

<table class=MsoTableGrid border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=553 valign=top style='width:414.8pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <div align=center>
  <table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0 width=476
   style='width:356.75pt;border-collapse:collapse;border:none'>
   <tr>
    <td width=60 valign=top style='width:45.15pt;border:none;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=right style='text-align:right;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>IDTR</span></p>
    </td>
    <td width=277 valign=top style='width:207.7pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>32</span><span style='font-family:华文中宋'>位<span
    lang=EN-US>IDT</span>基址</span></p>
    </td>
    <td width=139 valign=top style='width:103.9pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>16</span><span style='font-family:华文中宋'>位<span
    lang=EN-US>IDT</span>界限</span></p>
    </td>
   </tr>
  </table>
  </div>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>图（<span lang=EN-US>40</span>）<span lang=EN-US>&nbsp;
  IDTR</span>的具体结构</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>加载方式也与<span lang=EN-US>GDTR</span>的加载方式相似，使用<span
lang=EN-US>lidt(load idt)</span>指令。由此，可使用内联汇编编写<span lang=EN-US>init_IDTR()</span>函数进行<span
lang=EN-US>IDTR</span>的加载：</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#569CD6'>unsigned</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>char</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#9CDCFE'>IDTR</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>[</span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>6</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>]; </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>// </span><span style='font-family:
宋体;color:#6A9955'>低</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>2</span><span style='font-family:宋体;color:#6A9955'>字节：</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>IDT</span><span
style='font-family:宋体;color:#6A9955'>界限；高</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>4</span><span style='font-family:
宋体;color:#6A9955'>字节：</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>IDT</span><span style='font-family:宋体;color:#6A9955'>基址。</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#569CD6'>&nbsp;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#569CD6'>static</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>void</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#DCDCAA'>init_IDTR</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>()</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>{</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'>unsigned</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>short</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> *idt_limit = (</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'>unsigned</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>short</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> *)(&amp;</span><span lang=EN-US
style='font-family:Consolas;color:#9CDCFE'>IDTR</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>[</span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>0</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>]);</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>unsigned</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>int</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> *idt_base = (</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'>unsigned</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>int</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> *)(&amp;</span><span lang=EN-US
style='font-family:Consolas;color:#9CDCFE'>IDTR</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>[</span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>2</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>]);</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
*idt_limit = idt_size * </span><span lang=EN-US style='font-family:Consolas;
color:#569CD6'>sizeof</span><span lang=EN-US style='font-family:Consolas;
color:#D4D4D4'>(gate_desc) - </span><span lang=EN-US style='font-family:Consolas;
color:#B5CEA8'>1</span><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
*idt_base = (</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>unsigned</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>int</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>)&amp;idt;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
__asm__( </span><span lang=EN-US style='font-family:Consolas;color:#CE9178'>&quot;lidt
(%0)\n\t&quot;</span><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>
</span><span lang=EN-US style='font-family:Consolas;color:#6A9955'>// </span><span
style='font-family:宋体;color:#6A9955'>加载中断向量描述符表</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#CE9178'>&quot;sti&quot;</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>// </span><span style='font-family:
宋体;color:#6A9955'>开中断</span><span style='font-family:Consolas;color:#6A9955'> </span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
:</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
:</span><span lang=EN-US style='font-family:Consolas;color:#CE9178'>&quot;r&quot;</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(IDTR)</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
:</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
);</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>}</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>至此，我们完成了在保护模式下构建中断描述符的工作，编写一个能正常工作的中断服务程序似乎是轻而易举的事情了。但可别忘了，我们现在想使用纯<span
lang=EN-US>GCC</span>完成<span lang=EN-US>lsyOS</span>的内核，而用纯<span lang=EN-US>GCC</span>编写中断服务程序可不是一件易事呢。</span></p>

<p class=MsoNormal style='line-height:150%'><span lang=EN-US style='font-family:
华文中宋'>&nbsp;</span></p>

<p class=4 style='margin-left:21.0pt;text-indent:-21.0pt'><a name="_Toc10938197"></a><a
name="_Toc10655603"><b><span lang=EN-US>2)<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;
</span></span></b><b>中断处理函数</b></a></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>本部分对应源代码“<span lang=EN-US>include\interrupt.h</span>”。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>和函数调用一样，中断处理函数当然也需要使用堆栈储存返回原过程所需的信息，即原始的先压入<span
lang=EN-US>EIP</span>，后压入<span lang=EN-US>CS</span>（因为在<span lang=EN-US>call</span>指令中，短跳转不需要修改<span
lang=EN-US>CS</span>，所以<span lang=EN-US>CS</span>一定是后压的）。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>但由于中断产生的时间是不确定的，可能会打断原有的任何种类的过程，因此必须保存原有寄存器的值，在中断返回时还原。因为跳入中断这一过程本身便会重置标志寄存器<span
lang=EN-US>EFLAGS</span>中的<span lang=EN-US>TF</span>标志位，以防止单步调试对中断响应产生影响，因而处理器还会自动将<span
lang=EN-US>EFLAGS</span>压入堆栈以保护这个必然会被修改的寄存器。而对于通用寄存器等其他寄存器的保护，需要编写中断处理函数的我们自己，根据函数中对寄存器的修改状况做相应保护。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>为了更直接的了解中断产生时堆栈的变化，我们用以下的图示来描述这一过程：</span></p>

<table class=MsoTableGrid border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=553 valign=top style='width:414.8pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <div align=center>
  <table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
   style='border-collapse:collapse;border:none'>
   <tr>
    <td width=82 valign=top style='width:61.2pt;border:none;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=right style='text-align:right;line-height:150%'><span
    style='font-family:华文中宋'>高地址</span></p>
    </td>
    <td width=176 colspan=2 valign=top style='width:132.1pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>……</span></p>
    </td>
    <td width=88 valign=top style='width:66.1pt;border:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>旧<span lang=EN-US>SS:ESP</span></span></p>
    </td>
   </tr>
   <tr>
    <td width=82 valign=top style='width:61.2pt;border:none;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=right style='text-align:right;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
    </td>
    <td width=176 colspan=2 valign=top style='width:132.1pt;border-top:none;
    border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>……</span></p>
    </td>
    <td width=88 rowspan=2 valign=top style='width:66.1pt;border:none;
    padding:0cm 0cm 0cm 0cm'>
    <p class=MsoNormal style='line-height:150%'><span lang=EN-US
    style='font-family:华文中宋'><img width=47 height=37 id="连接符: 肘形 11"
    src="/assets/source/OS/2020-08-09-OS_lab3.files/image025.png"></span></p>
    </td>
   </tr>
   <tr>
    <td width=82 valign=top style='width:61.2pt;border:none;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=right style='text-align:right;line-height:150%;
    word-break:break-all'><span style='font-family:华文中宋'>↓ </span></p>
    </td>
    <td width=176 colspan=2 valign=top style='width:132.1pt;border-top:none;
    border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>旧<span lang=EN-US>EFLAGS</span></span></p>
    </td>
   </tr>
   <tr>
    <td width=82 valign=top style='width:61.2pt;border:none;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=right style='text-align:right;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
    </td>
    <td width=88 valign=top style='width:66.05pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>……</span></p>
    </td>
    <td width=88 valign=top style='width:66.05pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>旧<span lang=EN-US>CS</span></span></p>
    </td>
    <td width=88 valign=top style='width:66.1pt;border:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>新<span lang=EN-US>SS:ESP</span></span></p>
    </td>
   </tr>
   <tr>
    <td width=82 valign=top style='width:61.2pt;border:none;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=right style='text-align:right;line-height:150%'><span
    style='font-family:华文中宋'>低地址</span></p>
    </td>
    <td width=176 colspan=2 valign=top style='width:132.1pt;border-top:none;
    border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>旧<span lang=EN-US>EIP</span></span></p>
    </td>
    <td width=88 rowspan=2 valign=top style='width:66.1pt;border:none;
    padding:0cm 0cm 0cm 0cm'>
    <p class=MsoNormal align=left style='text-align:left;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'><img width=47 height=37 id="连接符: 肘形 12"
    src="/assets/source/OS/2020-08-09-OS_lab3.files/image025.png"></span></p>
    </td>
   </tr>
   <tr>
    <td width=82 valign=top style='width:61.2pt;border:none;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=right style='text-align:right;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
    </td>
    <td width=176 colspan=2 valign=top style='width:132.1pt;border:none;
    border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
    </td>
   </tr>
   <tr>
    <td width=82 valign=top style='width:61.2pt;border:none;border-right:dashed windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=right style='text-align:right;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
    </td>
    <td width=176 colspan=2 valign=top style='width:132.1pt;border:none;
    border-right:dashed windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
    </td>
    <td width=88 valign=top style='width:66.1pt;border:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
    </td>
   </tr>
   <tr height=0>
    <td width=82 style='border:none'></td>
    <td width=88 style='border:none'></td>
    <td width=88 style='border:none'></td>
    <td width=88 style='border:none'></td>
   </tr>
  </table>
  </div>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>图（<span lang=EN-US>41</span>）<span lang=EN-US>&nbsp;
  </span>无特权级变化时中断产生后的堆栈布局</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>既然进入中断函数后的堆栈布局与普通的函数调用后的堆栈布局不同，那么针对普通函数的<span
lang=EN-US>call</span>调用的<span lang=EN-US>ret</span>返回当然也不适用于中断函数，因为<span
lang=EN-US>ret</span>不会把<span lang=EN-US>EFLAGS</span>从堆栈中弹出并送回<span
lang=EN-US>EFLAGS</span>寄存器。而<span lang=EN-US>iret</span>指令（<span lang=EN-US>interrupt
ret</span>）的出现，便是解决这一问题的。它除了<span lang=EN-US>ret</span>弹出并还原<span lang=EN-US>EIP</span>、<span
lang=EN-US>CS</span>的功能外，还会弹出并还原<span lang=EN-US>EFLAGS</span>。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>正因这细微的不同，便给我们使用纯<span lang=EN-US>GCC</span>编写中断服务程序带来不小的困难。因为编译器将一个<span
lang=EN-US>C</span>函数汇编时，会将最后的返回指令编译为<span lang=EN-US>ret</span>，而非我们所需的<span
lang=EN-US>iret</span>，我们如何把这最后一个<span lang=EN-US>ret</span>修改为<span
lang=EN-US>iret</span>呢？</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>最直接的想法当然是直接在<span lang=EN-US>C</span>函数的尾部使用内联汇编写入一条“<span
lang=EN-US>iret</span>”语句，以期在“<span lang=EN-US>ret</span>”调用前，提前用“<span
lang=EN-US>iret</span>”正确跳出中断服务程序。然而，仔细想想便可确定这个思路是不可行的。实际上，编译器在将<span
lang=EN-US>C</span>函数的尾部最后一条代码转换为汇编代码后，会紧随其后插入还原寄存器、还原堆栈的指令，而后才进行“<span
lang=EN-US>ret</span>”。如果我们贸然提前进行“<span lang=EN-US>iret</span>”，会导致堆栈和寄存器的错误，造成系统异常的产生。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>那么，我们还有什么办法呢？也许是国内写操作系统的人本身就少，使用纯<span lang=EN-US>GCC</span>编写中断处理函数的人更是少上加少，因而这方面的资料几乎难觅踪影。但会不会<span
lang=EN-US>GCC</span>曾考虑过用户编写中断的需求，有相应的编译指导语句或函数属性设定语句可以帮我们完成这个工作呢？可惜的是，在<span
lang=EN-US>GCC7.40</span>的文档上（<span lang=EN-US>https://gcc.gnu.org/onlinedocs/gcc-7.4.0/gcc.pdf</span>），我看到了关于<span
lang=EN-US>ARM</span>、<span lang=EN-US>IA-64</span>、<span lang=EN-US>MIPS</span>、<span
lang=EN-US>RISC-V</span>等架构下中断服务程序的编写指导，却唯独没有<span lang=EN-US>X86</span>、<span
lang=EN-US>X86-64</span>架构的说明。然而造化弄人，似乎<span lang=EN-US>GNU</span>跟我们开了一个玩笑，虽然在它的<span
lang=EN-US>PDF</span>版本的文档上并未看到相关说明，但在网页版本的文档上却有着我们所需的东西。（<span lang=EN-US>https://gcc.gnu.org/onlinedocs/gcc/x86-Function-Attributes.html#x86-Function-Attributes</span>）</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>可以使用函数属性“<span lang=EN-US>__attribute__ ((interrupt))</span>”来指定某个特殊的函数为中断处理函数。当存在此属性时，<span
lang=EN-US>GCC</span>将生成适用于中断处理程序的函数入口和出口指令序列，并使用<span lang=EN-US>IRET</span>指令而不是<span
lang=EN-US>RET</span>指令从中断处理程序返回。除了由<span lang=EN-US>IRET</span>指令恢复的<span
lang=EN-US>EFLAGS</span>寄存器外，其他所有寄存器都由编译器保护。由于<span lang=EN-US>GCC</span>在编译中断处理程序时不保留与<span
lang=EN-US>SSE</span>、<span lang=EN-US>MMX</span>和<span lang=EN-US>x87</span>相关的寄存器状态，因此应使用<span
lang=EN-US>GCC</span>编译选项<span lang=EN-US>-mgeneral-regs-only</span>来编译中断处理程序。<span
lang=EN-US>-mgeneral-regs-only</span>选项可以指导编译器生成仅使用通用寄存器的代码，这可以防止编译器使用浮点寄存器（<span
lang=EN-US>X87</span>）、向量寄存器（<span lang=EN-US>SSE</span>、<span lang=EN-US>MMX</span>等）、中断屏蔽寄存器（<span
lang=EN-US>Interrupt Mask Register</span>）和供保护使用的界限寄存器（<span lang=EN-US>Bound Registers</span>）。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>因为需要这样特殊的编译命令，我们把中断处理函数单独放在了一个文件“<span lang=EN-US>interrupt.c</span>”中，编译时单独将其编译为目标文件，最后再与内核其他部分链接起来。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
lang=EN-US style='font-family:华文中宋'>GCC</span><span style='font-family:华文中宋'>规定，中断处理函数的参数必须使用指向中断帧的指针的形式定义：</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>__attribute__</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> ((interrupt)) </span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'>void</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#DCDCAA'>f</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>(</span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>struct</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> interrupt_frame *</span><span
lang=EN-US style='font-family:Consolas;color:#9CDCFE'>frame</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>)</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>{</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>}</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>依照图（<span lang=EN-US>41</span>），对于一个无特权级变换的中断处理函数，可以给出如下的中断帧定义：</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.0pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#569CD6'>struct</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> interrupt_frame</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.0pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>{</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.0pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>unsigned</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>int</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> eip;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.0pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'>unsigned</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>int</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> cs;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.0pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'>unsigned</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>int</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> eflags; </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>// PSW</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.0pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>};</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>如此，一个中断处理函数模板便已完成。</span></p>

<p class=MsoNormal style='line-height:150%'><span lang=EN-US style='font-family:
华文中宋'>&nbsp;</span></p>

<p class=4 style='margin-left:21.0pt;text-indent:-21.0pt'><a name="_Toc10938198"><b><span
lang=EN-US>3)<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></b><b><span
lang=EN-US>8259A</span>可编程中断控制器</b></a></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>本部分对应源代码“<span lang=EN-US>include\8259a.h</span>”。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
lang=EN-US style='font-family:华文中宋'>8259</span><span style='font-family:华文中宋'>可编程中断控制器（<span
lang=EN-US>PIC</span>，<i><span lang=EN-US>Programmable Interrupt Controller</span></i>）是组成<span
lang=EN-US>x86</span>体系结构的最重要的芯片之一。没有了它，<span lang=EN-US>x86</span>就无法成为一个由中断驱动的体系结构。<span
lang=EN-US>8259A</span>的功能是管理硬件中断并将它们发送给操作系统。这使得系统能够在不浪费时间的情况下响应设备的需求（例如，无须轮询设备）。</span></p>

<div align=center>

<table class=MsoTableGrid border=0 cellspacing=0 cellpadding=0 width=576
 style='width:432.3pt;border-collapse:collapse;border:none'>
 <tr>
  <td width=69 colspan=3 rowspan=2 valign=bottom style='width:51.95pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-family:华文中宋'>不可屏</span></p>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-family:华文中宋'>蔽中断</span></p>
  </td>
  <td width=45 style='width:33.9pt;padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
  </td>
  <td width=45 style='width:33.8pt;padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
  </td>
  <td width=45 style='width:33.4pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
  </td>
  <td width=44 style='width:33.05pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
  </td>
  <td width=16 style='width:11.8pt;padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
  </td>
  <td width=91 style='width:67.9pt;border:none;border-right:solid windowtext 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
  </td>
  <td width=83 colspan=2 rowspan=8 style='width:62.15pt;border:solid windowtext 1.0pt;
  border-left:none;padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>从<span lang=EN-US>8259A</span></span></p>
  </td>
  <td width=15 style='width:11.0pt;border:none;padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>←</span></p>
  </td>
  <td width=124 style='width:93.35pt;padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=left style='text-align:left;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>IRQ8 </span><span style='font-family:
  华文中宋'>实时时钟</span></p>
  </td>
 </tr>
 <tr>
  <td width=45 style='width:33.9pt;padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
  </td>
  <td width=45 style='width:33.8pt;border:none;border-right:solid windowtext 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
  </td>
  <td width=89 colspan=2 rowspan=8 style='width:66.45pt;border-top:none;
  border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>主<span lang=EN-US>8259A</span></span></p>
  </td>
  <td width=16 style='width:11.8pt;border:none;padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>←</span></p>
  </td>
  <td width=91 style='width:67.9pt;border:none;border-right:solid windowtext 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=left style='text-align:left;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>IRQ0 </span><span style='font-family:
  华文中宋'>时钟</span></p>
  </td>
  <td width=15 style='width:11.0pt;border:none;padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>←</span></p>
  </td>
  <td width=124 style='width:93.35pt;padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=left style='text-align:left;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>IRQ9</span><span style='font-family:华文中宋'>重定向<span
  lang=EN-US>IRQ2</span></span></p>
  </td>
 </tr>
 <tr>
  <td width=37 colspan=2 rowspan=2 style='width:28.1pt;border:none;border-bottom:
  solid windowtext 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=right style='text-align:right'><span lang=EN-US
  style='font-family:华文中宋'><img width=11 height=60 id="直接箭头连接符 19"
  src="/assets/source/OS/2020-08-09-OS_lab3.files/image026.png"></span></p>
  </td>
  <td width=32 rowspan=2 valign=bottom style='width:23.85pt;border:none;
  border-bottom:solid windowtext 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-size:9.0pt'>NMI</span></p>
  </td>
  <td width=45 style='width:33.9pt;padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
  </td>
  <td width=45 style='width:33.8pt;border:none;border-right:solid windowtext 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
  </td>
  <td width=16 style='width:11.8pt;border:none;padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>←</span></p>
  </td>
  <td width=91 style='width:67.9pt;border:none;border-right:solid windowtext 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=left style='text-align:left;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>IRQ1 </span><span style='font-family:
  华文中宋'>键盘</span></p>
  </td>
  <td width=15 style='width:11.0pt;border:none;padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>←</span></p>
  </td>
  <td width=124 style='width:93.35pt;padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=left style='text-align:left;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>IRQ10 </span><span style='font-family:
  华文中宋'>保留</span></p>
  </td>
 </tr>
 <tr>
  <td width=45 style='width:33.9pt;padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
  </td>
  <td width=45 style='width:33.8pt;border:none;border-right:solid windowtext 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
  </td>
  <td width=106 colspan=2 style='width:79.7pt;border:none;border-right:solid windowtext 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=left style='text-align:left;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'><img width=100 height=13 id="直接箭头连接符 16"
  src="/assets/source/OS/2020-08-09-OS_lab3.files/image027.png"></span></p>
  </td>
  <td width=15 style='width:11.0pt;border:none;padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>←</span></p>
  </td>
  <td width=124 style='width:93.35pt;padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=left style='text-align:left;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>IRQ11 </span><span style='font-family:
  华文中宋'>保留</span></p>
  </td>
 </tr>
 <tr>
  <td width=69 colspan=3 rowspan=2 style='width:51.95pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>CPU</span></p>
  </td>
  <td width=90 colspan=2 rowspan=2 style='width:67.7pt;border:none;border-right:
  solid windowtext 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=right style='text-align:right;word-break:break-all'><span
  lang=EN-US style='font-size:9.0pt'>INT </span></p>
  <p class=MsoNormal align=left style='text-align:left'><span lang=EN-US
  style='font-family:华文中宋'><img width=85 height=13 id="直接箭头连接符 18"
  src="/assets/source/OS/2020-08-09-OS_lab3.files/image028.png"></span></p>
  <p class=MsoNormal align=left style='text-align:left;text-indent:9.0pt'><span
  lang=EN-US style='font-size:9.0pt'>INTR</span></p>
  </td>
  <td width=16 style='width:11.8pt;border:none;padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>←</span></p>
  </td>
  <td width=91 style='width:67.9pt;border:none;border-right:solid windowtext 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=left style='text-align:left;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>IRQ3</span><span style='font-family:华文中宋'>串口<span
  lang=EN-US>2</span></span></p>
  </td>
  <td width=15 style='width:11.0pt;border:none;padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>←</span></p>
  </td>
  <td width=124 style='width:93.35pt;padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=left style='text-align:left;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>IRQ12 PS/2</span><span style='font-family:
  华文中宋'>鼠标</span></p>
  </td>
 </tr>
 <tr>
  <td width=16 style='width:11.8pt;border:none;padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>←</span></p>
  </td>
  <td width=91 style='width:67.9pt;border:none;border-right:solid windowtext 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=left style='text-align:left;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>IRQ4</span><span style='font-family:华文中宋'>串口<span
  lang=EN-US>1</span></span></p>
  </td>
  <td width=15 style='width:11.0pt;border:none;padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>←</span></p>
  </td>
  <td width=124 style='width:93.35pt;padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=left style='text-align:left;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>IRQ13 FPU</span><span style='font-family:
  华文中宋'>异常</span></p>
  </td>
 </tr>
 <tr>
  <td width=16 style='width:12.35pt;border:none;padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
  </td>
  <td width=53 colspan=2 style='width:39.6pt;border:none;padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
  </td>
  <td width=45 style='width:33.9pt;padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
  </td>
  <td width=45 style='width:33.8pt;border:none;border-right:solid windowtext 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
  </td>
  <td width=16 style='width:11.8pt;border:none;padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>←</span></p>
  </td>
  <td width=91 style='width:67.9pt;border:none;border-right:solid windowtext 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=left style='text-align:left;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>IRQ5 LPT2</span></p>
  </td>
  <td width=15 style='width:11.0pt;border:none;padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>←</span></p>
  </td>
  <td width=124 style='width:93.35pt;padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=left style='text-align:left;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>IRQ14 AT</span><span style='font-family:
  华文中宋'>温盘</span></p>
  </td>
 </tr>
 <tr>
  <td width=16 style='width:12.35pt;padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
  </td>
  <td width=53 colspan=2 style='width:39.6pt;padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
  </td>
  <td width=45 style='width:33.9pt;padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
  </td>
  <td width=45 style='width:33.8pt;border:none;border-right:solid windowtext 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
  </td>
  <td width=16 style='width:11.8pt;border:none;padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>←</span></p>
  </td>
  <td width=91 style='width:67.9pt;border:none;border-right:solid windowtext 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=left style='text-align:left;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>IRQ6 </span><span style='font-family:
  华文中宋'>软盘</span></p>
  </td>
  <td width=15 style='width:11.0pt;border:none;padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>←</span></p>
  </td>
  <td width=124 style='width:93.35pt;padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=left style='text-align:left;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>IRQ15 </span><span style='font-family:
  华文中宋'>保留</span></p>
  </td>
 </tr>
 <tr>
  <td width=16 style='width:12.35pt;padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
  </td>
  <td width=53 colspan=2 style='width:39.6pt;padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
  </td>
  <td width=45 style='width:33.9pt;padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
  </td>
  <td width=45 style='width:33.8pt;border:none;border-right:solid windowtext 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
  </td>
  <td width=16 style='width:11.8pt;border:none;padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>←</span></p>
  </td>
  <td width=91 style='width:67.9pt;padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=left style='text-align:left;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>IRQ7 LPT1</span></p>
  </td>
  <td width=39 style='width:29.0pt;border:none;padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
  </td>
  <td width=44 style='width:33.15pt;border:none;border-top:solid windowtext 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
  </td>
  <td width=15 style='width:11.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
  </td>
  <td width=124 style='width:93.35pt;padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>
  </td>
 </tr>
 <tr height=0>
  <td width=16 style='border:none'></td>
  <td width=21 style='border:none'></td>
  <td width=32 style='border:none'></td>
  <td width=45 style='border:none'></td>
  <td width=45 style='border:none'></td>
  <td width=45 style='border:none'></td>
  <td width=44 style='border:none'></td>
  <td width=16 style='border:none'></td>
  <td width=91 style='border:none'></td>
  <td width=39 style='border:none'></td>
  <td width=44 style='border:none'></td>
  <td width=15 style='border:none'></td>
  <td width=124 style='border:none'></td>
 </tr>
</table>

</div>

<p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
style='font-family:华文中宋'>图（<span lang=EN-US>42</span>）<span lang=EN-US>&nbsp; 8259A</span>中断管理示意图</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>由图知，两片级联的<span lang=EN-US>8259A</span>通过<span
lang=EN-US>INTR</span>引脚与<span lang=EN-US>CPU</span>相连，每个<span lang=EN-US>8259A</span>有<span
lang=EN-US>8</span>根中断信号线，于是两片级联总共可以挂接<span lang=EN-US>15</span>个不同的外部设备。这些设备发出的中断请求与中断向量的对应关系可通过对<span
lang=EN-US>8259A</span>的编程而设置。<span lang=EN-US>BIOS</span>中断需要用到<span
lang=EN-US>8259A</span>，因而会将<span lang=EN-US>IRQ0</span>～<span lang=EN-US>IRQ7</span>设置为对应向量号<span
lang=EN-US>08h</span>～<span lang=EN-US>0Fh</span>，但在保护模式下这些向量号已被占用，因而我们需要重新初始化<span
lang=EN-US>8259A</span>。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>初始化<span lang=EN-US>8259A</span>是通过向相应的端口写入特定的<span
lang=EN-US>ICW</span>（<span lang=EN-US>Initialization Command Word</span>）来实现的，而<span
lang=EN-US>ICW</span>一共有<span lang=EN-US>4</span>个，长度均为<span lang=EN-US>1</span>字节，分别具有不同的格式。主<span
lang=EN-US>8259A</span>对应的端口地址是<span lang=EN-US>20h</span>和<span lang=EN-US>21h</span>，从<span
lang=EN-US>8259A</span>对应的端口地址是<span lang=EN-US>A0h</span>和<span lang=EN-US>A1h</span>。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>初始化的过程如下，其中每一步的顺序均不可颠倒：</span></p>

<p class=MsoListParagraph style='margin-left:42.0pt;text-indent:-42.0pt;
line-height:150%'><span lang=EN-US style='font-family:华文中宋'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>i.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='font-family:华文中宋'>往端口<span lang=EN-US>20h</span>（主片）或<span
lang=EN-US>A0h</span>（从片）写入<span lang=EN-US>ICW1</span>。</span></p>

<p class=MsoListParagraph style='margin-left:42.0pt;text-indent:-42.0pt;
line-height:150%'><span lang=EN-US style='font-family:华文中宋'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span>ii.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='font-family:华文中宋'>往端口<span lang=EN-US>21h</span>（主片）或<span
lang=EN-US>A1h</span>（从片）写入<span lang=EN-US>ICW2</span>。</span></p>

<p class=MsoListParagraph style='margin-left:42.0pt;text-indent:-42.0pt;
line-height:150%'><span lang=EN-US style='font-family:华文中宋'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span>iii.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='font-family:华文中宋'>往端口<span lang=EN-US>21h</span>（主片）或<span
lang=EN-US>A1h</span>（从片）写入<span lang=EN-US>ICW3</span>。</span></p>

<p class=MsoListParagraph style='margin-left:42.0pt;text-indent:-42.0pt;
line-height:150%'><span lang=EN-US style='font-family:华文中宋'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span>iv.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='font-family:华文中宋'>往端口<span lang=EN-US>21h</span>（主片）或<span
lang=EN-US>A1h</span>（从片）写入<span lang=EN-US>ICW4</span>。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>这<span lang=EN-US>4</span>个<span lang=EN-US>ICW</span>的格式如下：</span></p>

<table class=MsoTableGrid border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=386 valign=top style='width:289.15pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <div align=center>
  <table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0 width=370
   style='width:277.85pt;border-collapse:collapse;border:none'>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;padding:
    0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>位</span></p>
    </td>
    <td width=342 style='width:256.55pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>值</span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>7</span></p>
    </td>
    <td width=342 rowspan=3 style='width:256.55pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>对<span lang=EN-US>PC</span>系统必须为<span lang=EN-US>0</span></span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>6</span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>5</span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>4</span></p>
    </td>
    <td width=342 style='width:256.55pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>置<span lang=EN-US>1</span></span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>3</span></p>
    </td>
    <td width=342 style='width:256.55pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>1 = level triggerred</span><span style='font-family:
    华文中宋'>模式，<span lang=EN-US>0 = edge triggered</span>模式</span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>2</span></p>
    </td>
    <td width=342 style='width:256.55pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>1 = 4</span><span style='font-family:华文中宋'>字节中断向量，<span
    lang=EN-US>0 = 8</span>字节中断向量</span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>1</span></p>
    </td>
    <td width=342 style='width:256.55pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>1 = </span><span style='font-family:华文中宋'>单个<span
    lang=EN-US>8259</span>，<span lang=EN-US>0 = </span>级联<span lang=EN-US>8259</span></span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>0</span></p>
    </td>
    <td width=342 style='width:256.55pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>1 = </span><span style='font-family:华文中宋'>需要<span
    lang=EN-US>ICW4</span>，<span lang=EN-US>0 = </span>不需要<span lang=EN-US>ICW4</span></span></p>
    </td>
   </tr>
  </table>
  </div>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>图（<span lang=EN-US>43.1</span>）<span lang=EN-US>&nbsp;
  ICW1</span>格式</span></p>
  </td>
  <td width=168 valign=top style='width:126.15pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <div align=center>
  <table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
   style='border-collapse:collapse;border:none'>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;padding:
    0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>位</span></p>
    </td>
    <td width=94 style='width:70.85pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>值</span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>7</span></p>
    </td>
    <td width=94 rowspan=5 style='width:70.85pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>该片的第一个中断信号线对应的<span lang=EN-US>80x86</span>中断向量号</span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>6</span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>5</span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>4</span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>3</span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>2</span></p>
    </td>
    <td width=94 rowspan=3 style='width:70.85pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>置<span lang=EN-US>0</span>，表示<span lang=EN-US>80x86</span>系统</span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>1</span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>0</span></p>
    </td>
   </tr>
  </table>
  </div>
  <p class=MsoNormal style='line-height:150%'><span style='font-family:华文中宋'>图（<span
  lang=EN-US>43.2</span>） <span lang=EN-US>ICW2</span>格式</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>

<div align=center>

<table class=MsoTableGrid border=0 cellspacing=0 cellpadding=0 width=671
 style='width:503.25pt;border-collapse:collapse;border:none'>
 <tr>
  <td width=178 valign=top style='width:133.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <div align=center>
  <table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0 width=134
   style='border-collapse:collapse;border:none'>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;padding:
    0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>位</span></p>
    </td>
    <td width=105 style='width:78.9pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>值</span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>7</span></p>
    </td>
    <td width=105 rowspan=8 style='width:78.9pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>对应的<span lang=EN-US>IR</span>引脚级联从片。</span></p>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>高电平选中。</span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>6</span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>5</span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>4</span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>3</span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>2</span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>1</span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>0</span></p>
    </td>
   </tr>
  </table>
  </div>
  <p class=MsoNormal style='line-height:150%'><span style='font-family:华文中宋'>图（<span
  lang=EN-US>43.3</span>）主片<span lang=EN-US>ICW3</span>格式</span></p>
  </td>
  <td width=181 valign=top style='width:136.1pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <div align=center>
  <table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
   style='border-collapse:collapse;border:none'>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;padding:
    0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>位</span></p>
    </td>
    <td width=104 style='width:77.7pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>值</span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>7</span></p>
    </td>
    <td width=104 rowspan=5 style='width:77.7pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>置<span lang=EN-US>0</span></span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>6</span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>5</span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>4</span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>3</span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>2</span></p>
    </td>
    <td width=104 rowspan=3 style='width:77.7pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>从片级联主片的中断向量号</span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>1</span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>0</span></p>
    </td>
   </tr>
  </table>
  </div>
  <p class=MsoNormal style='line-height:150%'><span style='font-family:华文中宋'>图（<span
  lang=EN-US>43.4</span>）从片<span lang=EN-US>ICW3</span>格式</span></p>
  </td>
  <td width=312 valign=top style='width:233.9pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <div align=center>
  <table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0 width=293
   style='border-collapse:collapse;border:none'>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;padding:
    0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>位</span></p>
    </td>
    <td width=264 style='width:198.2pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>值</span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>7</span></p>
    </td>
    <td width=264 rowspan=3 style='width:198.2pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>未使用（置<span lang=EN-US>0</span>）</span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>6</span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>5</span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>4</span></p>
    </td>
    <td width=264 style='width:198.2pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>1 = SFMN</span><span style='font-family:华文中宋'>模式，<span
    lang=EN-US>0 = sequential</span>模式</span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>3</span></p>
    </td>
    <td width=264 rowspan=2 style='width:198.2pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>主<span lang=EN-US>/</span>从缓冲模式</span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>2</span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>1</span></p>
    </td>
    <td width=264 style='width:198.2pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>1 = </span><span style='font-family:华文中宋'>自动<span
    lang=EN-US>EOI</span>，<span lang=EN-US>0 = </span>正常<span lang=EN-US>EOI</span></span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>0</span></p>
    </td>
    <td width=264 style='width:198.2pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>1 = 80x86</span><span style='font-family:华文中宋'>模式，<span
    lang=EN-US>0 = MCS 80/85</span></span></p>
    </td>
   </tr>
  </table>
  </div>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>图（<span lang=EN-US>43.5</span>） <span lang=EN-US>ICW4</span>格式</span></p>
  </td>
 </tr>
</table>

</div>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>由此，可以使用以下代码完成<span lang=EN-US>8259A</span>的初始化。其中，<span
lang=EN-US>out_byte</span>函数是后文中<span lang=EN-US>I/O</span>驱动中用<span
lang=EN-US>C</span>语言风格封装的汇编函数<span lang=EN-US>out</span>。对<span lang=EN-US>ICW2</span>设置时，将主片对应的起始向量号定为<span
lang=EN-US>0x20</span>，从片对应的起始向量号定为<span lang=EN-US>0x28</span>。</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#C586C0'>#define</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'> </span><span lang=EN-US
style='font-family:Consolas;color:#DCDCAA'>port_8259a_master_io</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'>&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0x20</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>// </span><span style='font-family:
宋体;color:#6A9955'>主片</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>I/O</span><span style='font-family:宋体;color:#6A9955'>端口</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#C586C0'>#define</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'> </span><span lang=EN-US
style='font-family:Consolas;color:#DCDCAA'>port_8259a_master_mask</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'>&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0x21</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>// </span><span style='font-family:
宋体;color:#6A9955'>主片掩码设置端口</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#C586C0'>#define</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'> </span><span lang=EN-US
style='font-family:Consolas;color:#DCDCAA'>port_8259a_slave_io</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0xA0</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>// </span><span style='font-family:
宋体;color:#6A9955'>从片</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>I/O</span><span style='font-family:宋体;color:#6A9955'>端口</span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt;
line-height:14.25pt;background:#1E1E1E'><span lang=EN-US style='font-family:
Consolas;color:#C586C0'>#define</span><span lang=EN-US style='font-family:Consolas;
color:#569CD6'> </span><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>port_8259a_slave_mask</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'>&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0xA1</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'> </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>// </span><span style='font-family:
宋体;color:#6A9955'>从片掩码设置端口</span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt;
line-height:14.25pt;background:#1E1E1E'><span lang=EN-US style='font-family:
Consolas;color:#C586C0'>#define</span><span lang=EN-US style='font-family:Consolas;
color:#569CD6'> </span><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>int_vector_irq0</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'>&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0x20</span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt;
line-height:14.25pt;background:#1E1E1E'><span lang=EN-US style='font-family:
Consolas;color:#C586C0'>#define</span><span lang=EN-US style='font-family:Consolas;
color:#569CD6'> </span><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>int_vector_irq8</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'>&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0x28</span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt;
line-height:14.25pt;background:#1E1E1E'><span lang=EN-US style='font-family:
Consolas;color:#D4D4D4'>&nbsp;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>out_byte</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(port_8259a_master_io, </span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0x11</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>); </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>// </span><span
style='font-family:宋体;color:#6A9955'>主片</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>ICW1</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>out_byte</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(port_8259a_slave_io, </span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0x11</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>); </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>// </span><span
style='font-family:宋体;color:#6A9955'>从片</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>ICW1</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>out_byte</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(port_8259a_master_mask,
int_vector_irq0); </span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>// </span><span style='font-family:宋体;color:#6A9955'>主片</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>ICW2</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>out_byte</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(port_8259a_slave_mask,
int_vector_irq8); </span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>// </span><span style='font-family:宋体;color:#6A9955'>从片</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>ICW2</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>out_byte</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(port_8259a_master_mask, </span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0x4</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>); </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>// </span><span
style='font-family:宋体;color:#6A9955'>主片</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>ICW3</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>out_byte</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(port_8259a_slave_mask, </span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0x2</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>); </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>// </span><span
style='font-family:宋体;color:#6A9955'>从片</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>ICW3</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>out_byte</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(port_8259a_master_mask, </span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0x1</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>); </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>// </span><span
style='font-family:宋体;color:#6A9955'>主片</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>ICW4</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>out_byte</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(port_8259a_slave_mask, </span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0x1</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>); </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>// </span><span
style='font-family:宋体;color:#6A9955'>从片</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>ICW4</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>接下来，需要使用<span lang=EN-US>OCW</span>（<span lang=EN-US>Operation
Control Word</span>）屏蔽<span lang=EN-US>/</span>开启一个中断，以及通知<span lang=EN-US>8259A</span>以告知其一个中断处理过程已结束。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>需要用到的<span lang=EN-US>OCW</span>的格式如下：</span></p>

<div align=center>

<table class=MsoTableGrid border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=277 valign=top style='width:207.4pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <div align=center>
  <table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0 width=140
   style='width:105.35pt;border-collapse:collapse;border:none'>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;padding:
    0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>位</span></p>
    </td>
    <td width=112 style='width:84.05pt;border:solid windowtext 1.0pt;
    border-left:none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>值</span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>7</span></p>
    </td>
    <td width=112 rowspan=8 style='width:84.05pt;border-top:none;border-left:
    none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>屏蔽对应的<span lang=EN-US>IR</span>引脚的中断。</span></p>
    <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
    style='font-family:华文中宋'>高电平选中。</span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>6</span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>5</span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>4</span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>3</span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>2</span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>1</span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>0</span></p>
    </td>
   </tr>
  </table>
  </div>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>图（<span lang=EN-US>44.1</span>）<span lang=EN-US>&nbsp;
  OCW1</span>格式</span></p>
  </td>
  <td width=277 valign=top style='width:207.4pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <div align=center>
  <table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0 width=81
   style='width:60.6pt;border-collapse:collapse;border:none'>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;padding:
    0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>位</span></p>
    </td>
    <td width=52 style='width:39.3pt;border:solid windowtext 1.0pt;border-left:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span
    style='font-family:华文中宋'>值</span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>7</span></p>
    </td>
    <td width=52 style='width:39.3pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>R</span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>6</span></p>
    </td>
    <td width=52 style='width:39.3pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>SL</span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>5</span></p>
    </td>
    <td width=52 style='width:39.3pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>EOI</span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>4</span></p>
    </td>
    <td width=52 style='width:39.3pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>0</span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>3</span></p>
    </td>
    <td width=52 style='width:39.3pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>0</span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>2</span></p>
    </td>
    <td width=52 style='width:39.3pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>L2</span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>1</span></p>
    </td>
    <td width=52 style='width:39.3pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>L1</span></p>
    </td>
   </tr>
   <tr>
    <td width=28 style='width:21.3pt;border:solid windowtext 1.0pt;border-top:
    none;padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>0</span></p>
    </td>
    <td width=52 style='width:39.3pt;border-top:none;border-left:none;
    border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
    padding:0cm 5.4pt 0cm 5.4pt'>
    <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
    style='font-family:华文中宋'>L0</span></p>
    </td>
   </tr>
  </table>
  </div>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>图（<span lang=EN-US>44.2</span>）<span lang=EN-US>&nbsp;
  OCW2</span>格式</span></p>
  </td>
 </tr>
</table>

</div>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>实际上，<span lang=EN-US>OCW1</span>会被写入中断屏蔽寄存器（<span
lang=EN-US>IMR</span>）。一个中断到达时，<span lang=EN-US>IMR</span>会判断此中断是否应被丢弃。因此，若想屏蔽某一个中断，将对应<span
lang=EN-US>OCW1</span>中的对应位置为<span lang=EN-US>1</span>即可。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>由此，我们可以完善上述代码，加上初始化时通过设置<span lang=EN-US>OCW1</span>屏蔽所有中断的语句：</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#569CD6'>void</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#DCDCAA'>init_8259A</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>()</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>{</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>out_byte</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(port_8259a_master_io, </span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0x11</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>); </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>// </span><span
style='font-family:宋体;color:#6A9955'>主片</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>ICW1</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>out_byte</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(port_8259a_slave_io, </span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0x11</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>); </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>// </span><span
style='font-family:宋体;color:#6A9955'>从片</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>ICW1</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>out_byte</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(port_8259a_master_mask,
int_vector_irq0); </span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>// </span><span style='font-family:宋体;color:#6A9955'>主片</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>ICW2</span><span
style='font-family:宋体;color:#6A9955'>，设置主片第一个中断向量为</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>0x20</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>out_byte</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(port_8259a_slave_mask,
int_vector_irq8); </span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>// </span><span style='font-family:宋体;color:#6A9955'>从片</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>ICW2</span><span
style='font-family:宋体;color:#6A9955'>，设置从片第一个中断向量为</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>0x28</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>out_byte</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(port_8259a_master_mask, </span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0x4</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>); </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>// </span><span
style='font-family:宋体;color:#6A9955'>主片</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>ICW3</span><span style='font-family:
宋体;color:#6A9955'>，设置</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>IR2</span><span style='font-family:宋体;color:#6A9955'>引脚级联从片</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>out_byte</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(port_8259a_slave_mask, </span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0x2</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>); </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>// </span><span
style='font-family:宋体;color:#6A9955'>从片</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>ICW3</span><span style='font-family:
宋体;color:#6A9955'>，设置对应主片的</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>IR2</span><span style='font-family:宋体;color:#6A9955'>引脚</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>out_byte</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(port_8259a_master_mask, </span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0x1</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>); </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>// </span><span
style='font-family:宋体;color:#6A9955'>主片</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>ICW4</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>out_byte</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(port_8259a_slave_mask, </span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0x1</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>); </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>// </span><span
style='font-family:宋体;color:#6A9955'>从片</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>ICW4</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>out_byte</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(port_8259a_master_mask, </span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0xFF</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>); </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>// </span><span
style='font-family:宋体;color:#6A9955'>主片</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>OCW1</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>out_byte</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(port_8259a_slave_mask, </span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0xFF</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>); </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>// </span><span
style='font-family:宋体;color:#6A9955'>从片</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>OCW1</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>}</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>同时，按照这个原理，可以写出用启用或屏蔽某个<span lang=EN-US>irq</span>的两个函数：</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#569CD6'>void</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#DCDCAA'>enable_irq</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>(</span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>unsigned</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>char</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#9CDCFE'>irq</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>)</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>{</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>unsigned</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>char</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp; mask, </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>// </span><span
style='font-family:宋体;color:#6A9955'>原先的掩码</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
my_mask = ~(</span><span lang=EN-US style='font-family:Consolas;color:#B5CEA8'>1</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> &lt;&lt; irq); </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>// </span><span
style='font-family:宋体;color:#6A9955'>需要开的某一位</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>unsigned</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>short</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> port = (irq &lt; </span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>8</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>) ? port_8259a_master_mask :
port_8259a_slave_mask; </span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>// </span><span style='font-family:宋体;color:#6A9955'>选择主</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>/</span><span
style='font-family:宋体;color:#6A9955'>从片</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
mask = </span><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>in_byte</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(port);</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#C586C0'>if</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>((mask &amp; my_mask) != </span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>) </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>// </span><span style='font-family:
宋体;color:#6A9955'>原先没有开启</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>out_byte</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(port, mask &amp;
my_mask); </span><span lang=EN-US style='font-family:Consolas;color:#6A9955'>//
</span><span style='font-family:宋体;color:#6A9955'>把需要开启中断的这一位置为</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>0</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>}</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#569CD6'>void</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#DCDCAA'>disable_irq</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>(</span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>unsigned</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>char</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#9CDCFE'>irq</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>)</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>{</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>unsigned</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>char</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp; mask, </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>// </span><span
style='font-family:宋体;color:#6A9955'>原先的掩码</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
my_mask = </span><span lang=EN-US style='font-family:Consolas;color:#B5CEA8'>1</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> &lt;&lt; irq; </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>// </span><span
style='font-family:宋体;color:#6A9955'>需要开的某一位</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>unsigned</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>short</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> port = (irq &lt; </span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>8</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>) ? port_8259a_master_mask :
port_8259a_slave_mask; </span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>// </span><span style='font-family:宋体;color:#6A9955'>选择主</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>/</span><span
style='font-family:宋体;color:#6A9955'>从片</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
mask = </span><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>in_byte</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(port);</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#C586C0'>if</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>((mask &amp; my_mask) == </span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>) </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>// </span><span style='font-family:
宋体;color:#6A9955'>原先开启了</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>out_byte</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(port, mask | my_mask); </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>// </span><span
style='font-family:宋体;color:#6A9955'>把需要关闭中断的这一位置为</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>1</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>}</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>而对于<span lang=EN-US>OCW2</span>，因为每一次中断产生后，<span
lang=EN-US>8259A</span>会自动屏蔽所有中断，并且关中断（<span lang=EN-US>cli</span>），此时需要置<span
lang=EN-US>OCW2</span>中的<span lang=EN-US>EOI</span>（<span lang=EN-US>end of
interrupt</span>）位为<span lang=EN-US>1</span>，并送往相应端口，以通知<span lang=EN-US>8259A</span>可继续接收中断，然后使用<span
lang=EN-US>sti</span>开中断。因此可以编写这样的代码实现这些功能：</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#569CD6'>inline</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>void</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#DCDCAA'>send_EOI_and_sti</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>() </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>// </span><span
style='font-family:宋体;color:#6A9955'>发送</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>EOI</span><span style='font-family:
宋体;color:#6A9955'>给</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>8259A</span><span style='font-family:宋体;color:#6A9955'>并开中断</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>{</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
__asm__(&quot;movb $0x20, %al\n\t&quot;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#CE9178'>&quot;outb
%al, $0x20</span><span lang=EN-US style='font-family:Consolas;color:#D7BA7D'>\n\t</span><span
lang=EN-US style='font-family:Consolas;color:#CE9178'>&quot;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#CE9178'>&quot;sti&quot;</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>);</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>}</span></p>

<p class=MsoNormal style='line-height:150%'><span lang=EN-US style='font-family:
华文中宋'>&nbsp;</span></p>

<p class=4 style='margin-left:21.0pt;text-indent:-21.0pt'><a name="_Toc10938199"><b><span
lang=EN-US>4)<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></b><b>时钟中断</b></a></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>本部分涉及“<span lang=EN-US>include</span>”文件夹中的“<span
lang=EN-US>interrupt.c</span>”、“<span lang=EN-US>idt.h</span>”和“<span
lang=EN-US>kernel.c</span>”文件。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>了解基本的<span lang=EN-US>8259A</span>编程方法后，下面就来实践一下吧。还记得我们在实验<span
lang=EN-US>2</span>的时候做了一个显示当前时间的程序吗？现在我们将这个汇编程序转换为<span lang=EN-US>C</span>语言程序，并放入时钟中断中，便可以显示实时时间。</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>__attribute__</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> ((interrupt))</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#569CD6'>void</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#DCDCAA'>irq_timer</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>(</span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>struct</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> interrupt_frame *</span><span
lang=EN-US style='font-family:Consolas;color:#9CDCFE'>frame</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>) </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>// </span><span
style='font-family:宋体;color:#6A9955'>时钟中断</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>{</span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt;
line-height:14.25pt;background:#1E1E1E'><span lang=EN-US style='font-family:
Consolas;color:#DCDCAA'>send_EOI_and_sti</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>();</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>static</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>int</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> irq_times = </span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>8</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#C586C0'>if</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(++irq_times == </span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>9</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>)</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
{</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
irq_times = </span><span lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>static</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>char</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> time_str</span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>[]</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> = </span><span lang=EN-US
style='font-family:Consolas;color:#CE9178'>&quot;yy/mm/dd hh:mm:ss&quot;</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>static</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>const</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>unsigned</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>char</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#9CDCFE'>time_select</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>[</span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>6</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>] = {</span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>9</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>8</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>7</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>4</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>2</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>0</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>}; </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>// </span><span style='font-family:
宋体;color:#6A9955'>秒：</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>0&nbsp; </span><span style='font-family:宋体;color:#6A9955'>分：</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>2&nbsp;&nbsp; </span><span
style='font-family:宋体;color:#6A9955'>时：</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>4&nbsp;&nbsp; </span><span
style='font-family:宋体;color:#6A9955'>日：</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>7&nbsp;&nbsp; </span><span
style='font-family:宋体;color:#6A9955'>月：</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>8&nbsp;&nbsp; </span><span
style='font-family:宋体;color:#6A9955'>年：</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>9</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>unsigned</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>char</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> time_BCD, time_high, time_low;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#C586C0'>for</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(</span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>int</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> i = </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>0</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>; i &lt; </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>6</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>; i++)</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
{</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>out_byte</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(</span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>0x70</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#9CDCFE'>time_select</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>[i]); </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>// </span><span style='font-family:
宋体;color:#6A9955'>把要读的参数的标号送到</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>70h</span><span style='font-family:宋体;color:#6A9955'>端口</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
time_BCD = </span><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>in_byte</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(</span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>0x71</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>); </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>// </span><span style='font-family:
宋体;color:#6A9955'>高四位表示十位数的</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>BCD</span><span style='font-family:宋体;color:#6A9955'>码，低四位表示个位数的</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>BCD</span><span
style='font-family:宋体;color:#6A9955'>码</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
time_high = (time_BCD &gt;&gt; </span><span lang=EN-US style='font-family:Consolas;
color:#B5CEA8'>4</span><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>)
+ </span><span lang=EN-US style='font-family:Consolas;color:#CE9178'>'0'</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>; </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>// </span><span
style='font-family:宋体;color:#6A9955'>取高四位</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>BCD</span><span style='font-family:
宋体;color:#6A9955'>码，并转换为</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>ASCII</span><span style='font-family:宋体;color:#6A9955'>码。注意位运算的优先级在</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>+</span><span
style='font-family:宋体;color:#6A9955'>后一级</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
time_low = (time_BCD &amp; </span><span lang=EN-US style='font-family:Consolas;
color:#B5CEA8'>0x0F</span><span lang=EN-US style='font-family:Consolas;
color:#D4D4D4'>) + </span><span lang=EN-US style='font-family:Consolas;
color:#CE9178'>'0'</span><span lang=EN-US style='font-family:Consolas;
color:#D4D4D4'>; </span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>// </span><span style='font-family:宋体;color:#6A9955'>取低四位</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>BCD</span><span
style='font-family:宋体;color:#6A9955'>码，并转换为</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>ASCII</span><span style='font-family:
宋体;color:#6A9955'>码。</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#9CDCFE'>time_str</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>[i * </span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>3</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>] = time_high;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#9CDCFE'>time_str</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>[i * </span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>3</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> + </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>1</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>] = time_low;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
}</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>print_string</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(time_str, </span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>80</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> * </span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>24</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> + </span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>63</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>);</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
}</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>}</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>时钟中断由<span lang=EN-US>8253/8254</span>可编程时钟发生器触发，默认状态下，它的触发频率接近<span
lang=EN-US>18.2Hz</span>。因此，在上述代码中我们使用了一个静态变量<span lang=EN-US>irq_times</span>对时钟中断的触发次数进行计数，当触发次数达到<span
lang=EN-US>9</span>次时，才进行现行时钟的更新，以避免无谓的运算发生。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>而后，向“<span lang=EN-US>include/idt.h</span>”文件的<span
lang=EN-US>init_idt()</span>函数添加以下语句，从而将时钟中断处理函数<span lang=EN-US>irq_timer()</span>添加至<span
lang=EN-US>IDT</span>中，以便时钟中断发生时<span lang=EN-US>CPU</span>可以转向对应的中断处理函数： </span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>init_gate_desc</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(int_vector_irq0 + </span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, desc_type_P | desc_type_386int,</span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:73.5pt;
line-height:14.25pt;background:#1E1E1E'><span lang=EN-US style='font-family:
Consolas;color:#D4D4D4'>&nbsp;(</span><span lang=EN-US style='font-family:Consolas;
color:#569CD6'>void</span><span lang=EN-US style='font-family:Consolas;
color:#D4D4D4'> *)irq_timer, DPL_kernel); </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>// </span><span style='font-family:
宋体;color:#6A9955'>初始化时钟中断</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>最后，向“<span lang=EN-US>include/kernel.c</span>”文件的<span
lang=EN-US>main()</span>函数添加打开时钟中断的代码：</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>enable_irq</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(</span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>0</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>);&nbsp; </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>// </span><span style='font-family:
宋体;color:#6A9955'>打开时钟中断</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>如此，便完成了一个显示实时时钟的时钟中断的编写。当然，这个时钟中断可不仅仅是为了显示时间，它更是键盘驱动编写的基石。进入“驱动程序”这一小节的内容后，你必然更能体会时钟中断的伟大之处！</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=3 style='margin-left:0cm;text-indent:0cm'><a name="_Toc10938200"></a><a
name="_Toc10748869"></a><a name="_Toc10655604"></a><a name="_Toc10252890"></a><a
name="_Toc10138943"></a><a name="_Toc9694032"></a><a name="_Toc9550138"></a><a
name="_Toc9539608"></a><a name="_Toc9539571"></a><a name="_Toc9539536"></a><a
name="_Toc9342827"></a><a name="_Toc9342633"><span lang=EN-US>9.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span>驱动程序</a></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>作为操作系统与硬件间的接口，驱动程序具有举足轻重的地位。没有了以下这些驱动的支持，我们之前在内核中所做的工作都成了摆设。下面就来了解一下目前<span
lang=EN-US>lsyOS</span>中所需的驱动吧。</span></p>

<p class=4 style='margin-left:21.0pt;text-indent:-21.0pt'><a name="_Toc10938201"></a><a
name="_Toc10655605"></a><a name="_Toc10252891"></a><a name="_Toc10138944"><b><span
lang=EN-US>1)<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></b><b><span
lang=EN-US>I/O</span>驱动</b></a></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>本部分对应源代码“<span lang=EN-US>include\</span></span><span
lang=EN-US>io.h</span><span style='font-family:华文中宋'>”。其中，各函数的实现以<span
lang=EN-US>GCC</span>内联汇编的方式为主，用于提供对<span lang=EN-US>I/O</span>端口和显存读写的支持。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>以<span lang=EN-US>out_byte()</span>函数为例，说明本驱动对<span
lang=EN-US>I/O</span>端口操作的支持：</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#569CD6'>extern</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>inline</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>void</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#DCDCAA'>out_byte</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>(</span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>unsigned</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>short</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#9CDCFE'>port</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>unsigned</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>char</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#9CDCFE'>val</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>)</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>{</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
__asm__(</span><span lang=EN-US style='font-family:Consolas;color:#CE9178'>&quot;outb
%1, %0&quot;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
: </span><span lang=EN-US style='font-family:Consolas;color:#6A9955'>// </span><span
style='font-family:宋体;color:#6A9955'>无输出</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
: </span><span lang=EN-US style='font-family:Consolas;color:#CE9178'>&quot;d&quot;</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(port), </span><span
lang=EN-US style='font-family:Consolas;color:#CE9178'>&quot;a&quot;</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(val) </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>// </span><span
style='font-family:宋体;color:#6A9955'>端口寄存器必须要用</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>dx/dl</span><span style='font-family:
宋体;color:#6A9955'>，数据必须用</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>ax/al</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
: </span><span lang=EN-US style='font-family:Consolas;color:#6A9955'>// </span><span
style='font-family:宋体;color:#6A9955'>没有额外修改寄存器</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
);</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>}</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>这是一个端口输出函数，它将汇编语句<span lang=EN-US>outb</span>封装为<span
lang=EN-US>C</span>语言格式的内联函数，以方便内核中的中断处理函数和其他驱动进行<span lang=EN-US>I/O</span>操作。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>又以<span lang=EN-US>print_char()</span>函数为例，说明本驱动对显存读写的支持：</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#569CD6'>extern</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>inline</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>void</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#DCDCAA'>print_char</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>(</span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>unsigned</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>char</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#9CDCFE'>chr</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>int</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#9CDCFE'>pos</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>)</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>{</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
__asm__(</span><span lang=EN-US style='font-family:Consolas;color:#CE9178'>&quot;movb
$0x07, %%ah\n\t&quot;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#CE9178'>&quot;movb
%0, %%al</span><span lang=EN-US style='font-family:Consolas;color:#D7BA7D'>\n\t</span><span
lang=EN-US style='font-family:Consolas;color:#CE9178'>&quot;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#CE9178'>&quot;movw
%%ax, %%gs:(%1)&quot;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
: </span><span lang=EN-US style='font-family:Consolas;color:#6A9955'>// </span><span
style='font-family:宋体;color:#6A9955'>无输出</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
: </span><span lang=EN-US style='font-family:Consolas;color:#CE9178'>&quot;r&quot;</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(chr), </span><span
lang=EN-US style='font-family:Consolas;color:#CE9178'>&quot;r&quot;</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(pos * </span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>2</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>)</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
: </span><span lang=EN-US style='font-family:Consolas;color:#CE9178'>&quot;ax&quot;</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>, </span><span
lang=EN-US style='font-family:Consolas;color:#CE9178'>&quot;memory&quot;</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>);</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>}</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>这是一个打印字符函数，它将写入显存的汇编语句封装为<span lang=EN-US>C</span>语言格式的内联函数，可使得字符<span
lang=EN-US>chr</span>显示在屏幕中位置<span lang=EN-US>pos</span>。其中，<span lang=EN-US>pos</span>指的是在当前<span
lang=EN-US>80</span>×<span lang=EN-US>25</span>的分辨率下的屏幕位置（从<span lang=EN-US>0</span>起计数），如从第<span
lang=EN-US>0</span>行第<span lang=EN-US>0</span>列起，由左至右的每个像素的位置分别为<span
lang=EN-US>0</span>、<span lang=EN-US>1</span>、<span lang=EN-US>2</span>、…。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>该文件中的所涵盖的两类函数的原理大致如此，因而此处将不逐一展示代码细节，仅对各函数的功能及用法进行相关说明：</span></p>

<div align=center>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=47 valign=top style='width:35.2pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>序号</span></p>
  </td>
  <td width=506 valign=top style='width:379.6pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid windowtext 1.0pt;border-right:none;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>函数声明及描述</span></p>
  </td>
 </tr>
 <tr>
  <td width=47 style='width:35.2pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>1</span></p>
  </td>
  <td width=506 valign=top style='width:379.6pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='line-height:150%'><span lang=EN-US
  style='font-family:华文中宋'>extern inline void out_byte(unsigned short port,
  unsigned char val)</span></p>
  <p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
  style='font-family:华文中宋'>端口输出函数。将字节<span lang=EN-US>val</span>输出至端口<span
  lang=EN-US>port</span>。</span></p>
  </td>
 </tr>
 <tr>
  <td width=47 style='width:35.2pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>2</span></p>
  </td>
  <td width=506 valign=top style='width:379.6pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='line-height:150%'><span lang=EN-US
  style='font-family:华文中宋'>extern inline void out_byte_delay(unsigned short
  port, unsigned char val)</span></p>
  <p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
  style='font-family:华文中宋'>含延迟的端口输出函数。将字节<span lang=EN-US>val</span>输出至端口<span
  lang=EN-US>port</span>后，等待两个时钟周期（用两个<span lang=EN-US>nop</span>实现）。</span></p>
  </td>
 </tr>
 <tr>
  <td width=47 style='width:35.2pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>3</span></p>
  </td>
  <td width=506 valign=top style='width:379.6pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='line-height:150%'><span lang=EN-US
  style='font-family:华文中宋'>extern inline unsigned char in_byte(unsigned short
  port)</span></p>
  <p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
  style='font-family:华文中宋'>端口输入函数。读入从端口<span lang=EN-US>port</span>输入的字节并将其返回。</span></p>
  </td>
 </tr>
 <tr>
  <td width=47 style='width:35.2pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>4</span></p>
  </td>
  <td width=506 valign=top style='width:379.6pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='line-height:150%'><span lang=EN-US
  style='font-family:华文中宋'>extern inline unsigned char in_byte_delay(unsigned
  short port)</span></p>
  <p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
  style='font-family:华文中宋'>含延迟的端口输入函数。读入从端口<span lang=EN-US>port</span>输入的字节后，等待两个时钟周期，将该字节返回。</span></p>
  </td>
 </tr>
 <tr>
  <td width=47 style='width:35.2pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>5</span></p>
  </td>
  <td width=506 valign=top style='width:379.6pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='line-height:150%'><span lang=EN-US
  style='font-family:华文中宋'>extern inline void print_char(unsigned char chr, int
  pos)</span></p>
  <p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
  style='font-family:华文中宋'>打印字符。令字符<span lang=EN-US>chr</span>显示在屏幕上的<span
  lang=EN-US>pos</span>位置。</span></p>
  </td>
 </tr>
 <tr>
  <td width=47 style='width:35.2pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>6</span></p>
  </td>
  <td width=506 valign=top style='width:379.6pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='line-height:150%'><span lang=EN-US
  style='font-family:华文中宋'>extern inline void print_char_with_colour</span></p>
  <p class=MsoNormal style='line-height:150%'><span lang=EN-US
  style='font-family:华文中宋'>(unsigned char chr, int pos, unsigned char colour)</span></p>
  <p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
  style='font-family:华文中宋'>带颜色打印字符。令字符<span lang=EN-US>chr</span>以颜色<span
  lang=EN-US>colour</span>显示在屏幕上的<span lang=EN-US>pos</span>位置。</span></p>
  <p class=MsoListParagraph style='margin-left:39.0pt;text-indent:-18.0pt;
  line-height:150%'><span lang=EN-US style='font-family:华文中宋'>★<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><span
  style='font-family:华文中宋'>注：<span lang=EN-US>colour</span>的格式与先前在讲述<span
  lang=EN-US>C</span>语言标准函数库中的<span lang=EN-US>stdio.h</span>文件里的<span
  lang=EN-US>printf_char_with_colour()</span>函数参数中对<span lang=EN-US>colour</span>格式的规定完全相同，此处不再赘述。</span></p>
  </td>
 </tr>
 <tr>
  <td width=47 style='width:35.2pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>7</span></p>
  </td>
  <td width=506 valign=top style='width:379.6pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='line-height:150%'><span lang=EN-US
  style='font-family:华文中宋'>extern inline void print_clear()</span></p>
  <p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
  style='font-family:华文中宋'>清屏。将当前屏幕中所有位置的内容置为默认值。</span></p>
  <p class=MsoListParagraph style='margin-left:39.0pt;text-indent:-18.0pt;
  line-height:150%'><span lang=EN-US style='font-family:华文中宋'>★<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><span
  style='font-family:华文中宋'>注：因为在当前时钟中断的编写状态下，屏幕的最后一行用于显示当前时间，因而该函数将不会清除屏幕最后一行的内容。</span></p>
  </td>
 </tr>
 <tr>
  <td width=47 style='width:35.2pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>8</span></p>
  </td>
  <td width=506 valign=top style='width:379.6pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='line-height:150%'><span lang=EN-US
  style='font-family:华文中宋'>extern inline void print_new_line()</span></p>
  <p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
  style='font-family:华文中宋'>换行。将屏幕中所有内容上移一行。</span></p>
  <p class=MsoListParagraph style='margin-left:39.0pt;text-indent:-18.0pt;
  line-height:150%'><span lang=EN-US style='font-family:华文中宋'>★<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><span
  style='font-family:华文中宋'>注：同上，屏幕中的最后一行的内容不会被移动。</span></p>
  </td>
 </tr>
 <tr>
  <td width=47 style='width:35.2pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>9</span></p>
  </td>
  <td width=506 valign=top style='width:379.6pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='line-height:150%'><span lang=EN-US
  style='font-family:华文中宋'>void print_string(unsigned char *str, int pos)</span></p>
  <p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
  style='font-family:华文中宋'>打印字符串。从屏幕上的<span lang=EN-US>pos</span>位置起，依次显示空终止字符串<span
  lang=EN-US>str</span>的内容。</span></p>
  <p class=MsoListParagraph style='margin-left:39.0pt;text-indent:-18.0pt;
  line-height:150%'><span lang=EN-US style='font-family:华文中宋'>★<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><span
  style='font-family:华文中宋'>注：该函数非内联汇编函数，而是通过反复调用<span lang=EN-US>print_char()</span>函数实现。</span></p>
  </td>
 </tr>
 <tr>
  <td width=47 style='width:35.2pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>10</span></p>
  </td>
  <td width=506 valign=top style='width:379.6pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='line-height:150%'><span lang=EN-US
  style='font-family:华文中宋'>void print_string_with_colour</span></p>
  <p class=MsoNormal style='line-height:150%'><span lang=EN-US
  style='font-family:华文中宋'>(unsigned char *str, int pos, unsigned char colour)</span></p>
  <p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
  style='font-family:华文中宋'>带颜色打印字符串。从屏幕上的<span lang=EN-US>pos</span>位置起，依次以颜色<span
  lang=EN-US>colour</span>显示空终止字符串<span lang=EN-US>str</span>的内容。</span></p>
  <p class=MsoListParagraph style='margin-left:39.0pt;text-indent:-18.0pt;
  line-height:150%'><span lang=EN-US style='font-family:华文中宋'>★<span
  style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><span
  style='font-family:华文中宋'>注：该函数非内联汇编函数，而是通过反复调用<span lang=EN-US>print_char_with_colour()</span>函数实现。</span></p>
  </td>
 </tr>
 <tr>
  <td width=47 style='width:35.2pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>11</span></p>
  </td>
  <td width=506 valign=top style='width:379.6pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='line-height:150%'><span lang=EN-US
  style='font-family:华文中宋'>void print_int(unsigned int num, int pos)</span></p>
  <p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
  style='font-family:华文中宋'>打印二进制整数。从屏幕上的<span lang=EN-US>pos</span>位置起依次显示整数<span
  lang=EN-US>num</span>的二进制形式。</span></p>
  </td>
 </tr>
 <tr>
  <td width=47 style='width:35.2pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.5pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>12</span></p>
  </td>
  <td width=506 valign=top style='width:379.6pt;border:none;border-bottom:solid windowtext 1.5pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='line-height:150%'><span lang=EN-US
  style='font-family:华文中宋'>extern inline void set_cursor_pos(int pos)</span></p>
  <p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
  style='font-family:华文中宋'>设置光标位置函数。将当前光标设置在屏幕上的<span lang=EN-US>pos</span>位置。</span></p>
  </td>
 </tr>
</table>

</div>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
lang=EN-US>&nbsp;</span></p>

<p class=4 style='margin-left:21.0pt;text-indent:-21.0pt'><a name="_Toc10938202"></a><a
name="_Toc10655606"></a><a name="_Toc10252892"></a><a name="_Toc10138945"><b><span
lang=EN-US>2)<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></b><b>键盘驱动</b></a></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>本部分对应源代码“<span lang=EN-US>include\</span></span><span
lang=EN-US>kerborad.h</span><span style='font-family:华文中宋'>”。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>如果说之前的<span lang=EN-US>I/O</span>驱动实现了操作系统面向用户的信息传递，那么键盘便实现了用户面向操作系统的信息传递。二者相辅相成，共同构成了一个最基本的用户交互模型。因而，接下来就开始编写键盘驱动，以完善系统雏形。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>通常键盘中使用<span lang=EN-US>8048</span>键盘编码器（<span
lang=EN-US>Keyboard Encoder</span>）监视键盘输入并将接收到的数据传送给主机。而主板上使用键盘控制器（<span
lang=EN-US>Keyboard Controller</span>）接收和解码来自键盘的数据，并与<span lang=EN-US>8259A</span>进行通信。</span></p>

<p class=MsoNormal style='line-height:150%'><span style='font-family:华文中宋'>当<span
lang=EN-US>8048</span>检测到一个键的动作后，将产生扫描码（<span lang=EN-US>Scan Code</span>）。扫描码分为通码（<span
lang=EN-US>Make Code</span>）和断码（<span lang=EN-US>Break Code</span>）两类。当一个键被按下或者保持住按下时，产生通码；当键弹起时，产生断码。除了<span
lang=EN-US>Pause</span>键之外，每一个按键都对应一个通码和一个断码。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>而后，<span lang=EN-US>8048</span>会把相应的扫描码发送给<span
lang=EN-US>8042</span>，<span lang=EN-US>8042</span>会把它转换成相应的<span lang=EN-US>Scan
code set 1</span>扫描码，并将其放置在大小为<span lang=EN-US>1</span>字节的输入缓冲区中，然后通知<span
lang=EN-US>8259A</span>产生<span lang=EN-US>IRQ1</span>中断。若此时键盘又有新的键被按下，<span
lang=EN-US>8042</span>将直接丢弃送来的扫描码，直到输入缓冲区清空才继续接受扫描码。从输入缓冲区中读入一个扫描码的方法很简单，只需从<span
lang=EN-US>0x60</span>端口读入一个字节即可。接着考虑如何将其与某个按键对应起来。先来看看扫描码表：</span></p>

<div align=center>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=94 style='width:70.8pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid windowtext 1.5pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-family:华文中宋'>按键</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid windowtext 1.5pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-family:华文中宋'>通码</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid windowtext 1.5pt;border-right:double windowtext 2.25pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-family:华文中宋'>断码</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid windowtext 1.5pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-family:华文中宋'>按键</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid windowtext 1.5pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-family:华文中宋'>通码</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid windowtext 1.5pt;border-right:none;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-family:华文中宋'>断码</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>A</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>1E</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>9E</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>L</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>26</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>A6</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>B</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>30</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>B0</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>M</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>32</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>B2</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>C</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>2E</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>AE</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>N</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>31</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>B1</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>D</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>20</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>A0</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>O</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>18</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>98</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>12</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>92</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>P</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>19</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>99</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>F</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>21</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>A1</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>Q</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>10</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>19</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>G</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>22</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>A2</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>R</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>13</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>93</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>H</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>23</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>A3</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>S</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>1F</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>9F</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>I</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>17</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>97</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>T</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>14</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>94</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>J</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>24</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>A4</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>U</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>16</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>96</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>K</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>25</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>A5</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>V</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>2F</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>AF</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>W</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>11</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>91</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>=</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>0D</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>8D</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>X</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>2D</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>AD</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>\</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>2B</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>AB</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>Y</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>15</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>95</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>Space</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>39</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>B9</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>Z</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>2C</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>AC</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>KP /</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,35</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,B5</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>Tab</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>0F</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>8F</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>KP -</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>4A</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>CA</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>Caps Lock</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>3A</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>BA</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>KP +</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>4E</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>CE</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>Left Shift</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>2A</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>AA</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>KP *</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>37</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>B7</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>Left Ctrl</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>1D</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>9D</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>KP .</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>53</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>D3</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>Left GUI</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,5B</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>D0,DB</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>KP 0</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>52</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>D2</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>Left Alt</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>38</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>B8</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>KP 1</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>4F</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>CF</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>Right Shift</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>36</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>B6</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>KP 2</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>50</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>D0</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>Right Ctrl</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,1D</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>D0,9D</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>KP 3</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>51</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>D1</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>Right GUI</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,5C</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,DC</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>KP 4</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>4B</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>CB</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>Right Alt</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,38</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,B8</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>KP 5</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>4C</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>CC</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>APPS</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,5D</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,DD</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>KP 6</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>4D</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>CD</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>Enter</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>1C</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>9C</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>KP 7</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>47</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>C7</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>Esc</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>1</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>81</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>KP 8</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>48</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>C8</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>F1</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>3B</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>BB</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>KP 9</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>49</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>C9</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>F2</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>3C</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>BC</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>[</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>1A</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>9A</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>F3</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>3D</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>BD</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>]</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>1B</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>9B</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>F4</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>3E</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>BE</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>;</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>27</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>A7</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>F5</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>EF</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>BF</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>‘</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>28</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>A8</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>F6</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>40</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>C0</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>,</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>33</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>B3</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>F7</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>41</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>C1</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>.</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>34</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>B4</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>F8</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>42</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>C2</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>/</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>35</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>B5</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>F9</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>43</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>C3</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>Power</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,5E</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,DE</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>F10</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>44</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>C4</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>Sleep</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,5F</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,DF</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>F11</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>57</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>D7</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>Wake</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,63</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,E3</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>F12</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>58</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>D8</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>Scroll</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>46</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>C6</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>Print Screen</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,2A</span></p>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,B7</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,B7</span></p>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,AA</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>Pause</span></p>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>Break</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E1,1D,45,</span></p>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E1,9D,C5</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-family:华文中宋'>无</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>0</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>0B</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>8B</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>Insert</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,52</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,D2</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>1</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>2</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>82</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>Home</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,47</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,C7</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>2</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>3</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>83</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>Page Up</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,49</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,C9</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>3</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>4</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>84</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>Delete</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,53</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,D3</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>4</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>5</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>85</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>End</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,4F</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,CF</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>5</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>6</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>86</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>Page Down</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,51</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,D1</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>6</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>7</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>87</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-family:华文中宋'>↑</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,48</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,C8</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>7</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>8</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>88</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-family:华文中宋'>←</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,4B</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,CB</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>8</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>9</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>89</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-family:华文中宋'>↓</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,50</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,D0</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>9</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>0A</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>8A</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-family:华文中宋'>→</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,4D</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,CD</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>‘</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>29</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>89</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>Num</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>45</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>C5</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>-</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>0C</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>8C</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>Backspace</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>0E</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>8E</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>KP Enter</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,1C</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,9C</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>Calculator*</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,21</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,A1</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-size:10.0pt;font-family:华文中宋'>Next Track*</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,19</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,99</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-size:8.0pt;font-family:华文中宋'>My computer*</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,6B</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,EB</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>Pre Track*</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,10</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,90</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-size:8.0pt;font-family:华文中宋'>WWW Search*</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,65</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,E5</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>Stop*</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,24</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,A4</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-size:9.0pt;font-family:华文中宋'>WWW Home*</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,32</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,B2</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-size:10.0pt;font-family:华文中宋'>Play/Pause*</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,22</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,A2</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-size:9.0pt;font-family:华文中宋'>WWW Back*</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,6A</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,EA</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>Mute*</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,20</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,A0</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-size:7.5pt;font-family:华文中宋'>WWW Forward*</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,69</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,E9</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>Vol Up*</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,30</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,B0</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-size:9.0pt;font-family:华文中宋'>WWW Stop*</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,68</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,E8</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>Vol Down*</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,2E</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,AE</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-size:7.5pt;font-family:华文中宋'>WWW Refresh*</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,67</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,E7</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-size:9.0pt;font-family:华文中宋'>Media Select*</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,6D</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,ED</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-size:6.5pt;font-family:华文中宋'>WWW Favorites*</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,66</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,E6</span></p>
  </td>
 </tr>
 <tr>
  <td width=94 style='width:70.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.5pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E-mail*</span></p>
  </td>
  <td width=92 style='width:68.7pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.5pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,6C</span></p>
  </td>
  <td width=92 style='width:68.8pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.5pt;border-right:double windowtext 2.25pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>E0,EC</span></p>
  </td>
  <td width=92 style='width:69.15pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.5pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>&nbsp;</span></p>
  </td>
  <td width=92 style='width:69.05pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.5pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>&nbsp;</span></p>
  </td>
  <td width=92 style='width:68.8pt;border:none;border-bottom:solid windowtext 1.5pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
  style='font-family:华文中宋'>&nbsp;</span></p>
  </td>
 </tr>
</table>

</div>

<p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
style='font-family:华文中宋'>图（<span lang=EN-US>45</span>） <span lang=EN-US>Scan
code set 1</span>扫描码表（带<span lang=EN-US>*</span>号的表示<span lang=EN-US>Windows</span>多媒体键盘专有按钮）</span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt;
line-height:150%'><span style='font-family:华文中宋'>因此，我们可以建立形如</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#569CD6'>const</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>unsigned</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>int</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#9CDCFE'>keymap</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>[NR_SCAN_CODES * MAP_COLS] = {</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#6A9955'>/*
scan-code&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!Shift&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Shift&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;E0
XX&nbsp;&nbsp;&nbsp;*/</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#6A9955'>/*
==================================================================== */</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#6A9955'>/*
0x00 - none&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;</span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>0</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>,</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#6A9955'>/*
0x01 - ESC&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;ESC,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ESC,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>,</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#6A9955'>/*
0x02 - '1'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;</span><span lang=EN-US
style='font-family:Consolas;color:#CE9178'>'1'</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#CE9178'>'!'</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>,</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:150%'><span
style='font-family:华文中宋'>的数组来解析扫描码。</span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt;
line-height:150%'><span style='font-family:华文中宋'>并使用一个循环队列作为键盘缓冲区：</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#C586C0'>#define</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'> </span><span lang=EN-US
style='font-family:Consolas;color:#DCDCAA'>key_buf_size</span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'> </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>32</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#6A9955'>//
</span><span style='font-family:宋体;color:#6A9955'>用队列来充当键盘缓冲区，使用前记得调用</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>key_buf_init()</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#569CD6'>struct</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> queue</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>{</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>unsigned</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>char</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> *front;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>unsigned</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>char</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> *back;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>unsigned</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>int</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> count;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>unsigned</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>char</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#9CDCFE'>key</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>[key_buf_size];</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>}
key_buf;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#569CD6'>void</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#DCDCAA'>init_key_buf</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>()</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>{</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#9CDCFE'>key_buf</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>.</span><span lang=EN-US
style='font-family:Consolas;color:#9CDCFE'>front</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> = </span><span lang=EN-US
style='font-family:Consolas;color:#9CDCFE'>key_buf</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>.</span><span lang=EN-US
style='font-family:Consolas;color:#9CDCFE'>back</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> = </span><span lang=EN-US
style='font-family:Consolas;color:#9CDCFE'>key_buf</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>.</span><span lang=EN-US
style='font-family:Consolas;color:#9CDCFE'>key</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#9CDCFE'>key_buf</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>.</span><span lang=EN-US
style='font-family:Consolas;color:#9CDCFE'>count</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> = </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>0</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>}</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#569CD6'>void</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#DCDCAA'>key_buf_write</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(</span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>unsigned</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>char</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#9CDCFE'>scan_code</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>) </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>// </span><span style='font-family:
宋体;color:#6A9955'>向键盘缓冲区写入一个扫描码</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>{</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#C586C0'>if</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(</span><span lang=EN-US
style='font-family:Consolas;color:#9CDCFE'>key_buf</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>.</span><span lang=EN-US
style='font-family:Consolas;color:#9CDCFE'>count</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> &lt;= key_buf_size)</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
{</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
*</span><span lang=EN-US style='font-family:Consolas;color:#9CDCFE'>key_buf</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>.</span><span lang=EN-US
style='font-family:Consolas;color:#9CDCFE'>back</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>++ = scan_code;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#9CDCFE'>key_buf</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>.</span><span lang=EN-US
style='font-family:Consolas;color:#9CDCFE'>count</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>++;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#C586C0'>if</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(</span><span lang=EN-US
style='font-family:Consolas;color:#9CDCFE'>key_buf</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>.</span><span lang=EN-US
style='font-family:Consolas;color:#9CDCFE'>back</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> == </span><span lang=EN-US
style='font-family:Consolas;color:#9CDCFE'>key_buf</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>.</span><span lang=EN-US
style='font-family:Consolas;color:#9CDCFE'>key</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> + key_buf_size)</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#9CDCFE'>key_buf</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>.</span><span lang=EN-US
style='font-family:Consolas;color:#9CDCFE'>back</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> = </span><span lang=EN-US
style='font-family:Consolas;color:#9CDCFE'>key_buf</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>.</span><span lang=EN-US
style='font-family:Consolas;color:#9CDCFE'>key</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
}&nbsp;&nbsp;&nbsp; </span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>}</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#569CD6'>static</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>unsigned</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>char</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#DCDCAA'>key_buf_read</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>() </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>// </span><span style='font-family:
宋体;color:#6A9955'>从键盘缓冲区取出一个扫描码</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>{</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#C586C0'>if</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(</span><span lang=EN-US
style='font-family:Consolas;color:#9CDCFE'>key_buf</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>.</span><span lang=EN-US
style='font-family:Consolas;color:#9CDCFE'>count</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> &gt; </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>0</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>)</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
{</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>unsigned</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>char</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> scan_code = *</span><span
lang=EN-US style='font-family:Consolas;color:#9CDCFE'>key_buf</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>.</span><span lang=EN-US
style='font-family:Consolas;color:#9CDCFE'>front</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>++;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#9CDCFE'>key_buf</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>.</span><span lang=EN-US
style='font-family:Consolas;color:#9CDCFE'>count</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>--;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#C586C0'>if</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(</span><span lang=EN-US
style='font-family:Consolas;color:#9CDCFE'>key_buf</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>.</span><span lang=EN-US
style='font-family:Consolas;color:#9CDCFE'>front</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> == </span><span lang=EN-US
style='font-family:Consolas;color:#9CDCFE'>key_buf</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>.</span><span lang=EN-US
style='font-family:Consolas;color:#9CDCFE'>key</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> + key_buf_size)</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#9CDCFE'>key_buf</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>.</span><span lang=EN-US
style='font-family:Consolas;color:#9CDCFE'>front</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> = </span><span lang=EN-US
style='font-family:Consolas;color:#9CDCFE'>key_buf</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>.</span><span lang=EN-US
style='font-family:Consolas;color:#9CDCFE'>key</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#C586C0'>return</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> scan_code;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
}</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#C586C0'>else</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#C586C0'>return</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>0</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>}</span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt;
line-height:150%'><span style='font-family:华文中宋'>此时，键盘中断只需从输入缓冲区读入一个字符并放入键盘缓冲区即可。对字符的处理工作交给时钟中断完成。</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=4 style='margin-left:21.0pt;text-indent:-21.0pt'><a name="_Toc10938203"></a><a
name="_Toc10655607"></a><a name="_Toc10252893"></a><a name="_Toc10138946"><b><span
lang=EN-US>3)<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></b><b>软盘驱动</b></a></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>本部分对应源代码“<span lang=EN-US>include\</span></span><span
lang=EN-US>floppy.h</span><span style='font-family:华文中宋'>”。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>这是目前为止最复杂的一个驱动，复杂的原因之一是软盘设计年代太早，操作方式稍显稚嫩，导致这个驱动看起来比较丑陋。读写软盘的过程主要是通过读写软盘控制器与<span
lang=EN-US>DMA</span>控制器完成。</span></p>

<p class=MsoListParagraph style='margin-left:42.0pt;text-indent:-42.0pt;
line-height:150%'><span lang=EN-US style='font-family:华文中宋'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>i.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='font-family:华文中宋'>软盘控制器</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>对软盘控制器的编程比较烦琐。在编程时需要访问<span lang=EN-US>4</span>个端口，分别对应一个或多个寄存器。对于<span
lang=EN-US>1.2M</span>的软盘控制器有以下一些端口：</span></p>

<div align=center>

<table class=TableNormal border=1 cellspacing=0 cellpadding=0 style='border-collapse:
 collapse;border:none'>
 <tr style='height:15.65pt'>
  <td width=77 style='width:57.95pt;border:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.65pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>I/O 端口</span></p>
  </td>
  <td width=62 style='width:46.8pt;border-top:solid black 1.5pt;border-left:
  none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.65pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>读写性</span></p>
  </td>
  <td width=293 style='width:220.1pt;border:solid black 1.5pt;border-left:none;
  padding:0cm 0cm 0cm 0cm;height:15.65pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>寄存器名称</span></p>
  </td>
 </tr>
 <tr style='height:15.55pt'>
  <td width=77 style='width:57.95pt;border-top:none;border-left:solid black 1.5pt;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.55pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:13.35pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>0x3f2</span></p>
  </td>
  <td width=62 style='width:46.8pt;border-top:none;border-left:none;border-bottom:
  solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.55pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:13.35pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>只写</span></p>
  </td>
  <td width=293 style='width:220.1pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;padding:0cm 0cm 0cm 0cm;
  height:15.55pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:13.35pt'><span style='font-size:10.5pt;font-family:华文中宋'>数字输出寄存器（<span
  lang=EN-US>DOR</span>）<span lang=EN-US>(</span>数字控制寄存器<span lang=EN-US>)</span></span></p>
  </td>
 </tr>
 <tr style='height:15.55pt'>
  <td width=77 style='width:57.95pt;border-top:none;border-left:solid black 1.5pt;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>0x3f4</span></p>
  </td>
  <td width=62 style='width:46.8pt;border-top:none;border-left:none;border-bottom:
  solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>只读</span></p>
  </td>
  <td width=293 style='width:220.1pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;padding:0cm 0cm 0cm 0cm;
  height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>FDC 主状态寄存器(STATUS)</span></p>
  </td>
 </tr>
 <tr style='height:15.65pt'>
  <td width=77 style='width:57.95pt;border-top:none;border-left:solid black 1.5pt;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.65pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>0x3f5</span></p>
  </td>
  <td width=62 style='width:46.8pt;border-top:none;border-left:none;border-bottom:
  solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.65pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>读/写</span></p>
  </td>
  <td width=293 style='width:220.1pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;padding:0cm 0cm 0cm 0cm;
  height:15.65pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>FDC 数据寄存器(DATA)</span></p>
  </td>
 </tr>
 <tr style='height:15.15pt'>
  <td width=77 rowspan=2 style='width:57.95pt;border-top:none;border-left:solid black 1.5pt;
  border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.15pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>0x3f7</span></p>
  </td>
  <td width=62 style='width:46.8pt;border-top:none;border-left:none;border-bottom:
  solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.15pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center;
  line-height:13.05pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>只读</span></p>
  </td>
  <td width=293 style='width:220.1pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;padding:0cm 0cm 0cm 0cm;
  height:15.15pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center;
  line-height:13.05pt'><span style='font-size:10.5pt;font-family:华文中宋'>数字输入寄存器（<span
  lang=EN-US>DIR</span>）</span></p>
  </td>
 </tr>
 <tr style='height:15.25pt'>
  <td width=62 style='width:46.8pt;border-top:none;border-left:none;border-bottom:
  solid black 1.5pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.25pt'>
  <p class=TableParagraph align=center style='margin-top:.75pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>只写</span></p>
  </td>
  <td width=293 style='width:220.1pt;border-top:none;border-left:none;
  border-bottom:solid black 1.5pt;border-right:solid black 1.5pt;padding:0cm 0cm 0cm 0cm;
  height:15.25pt'>
  <p class=TableParagraph align=center style='margin-top:.75pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  style='font-size:10.5pt;font-family:华文中宋'>磁盘控制寄存器<span lang=EN-US>(DCR)(</span>传输率控制<span
  lang=EN-US>)</span></span></p>
  </td>
 </tr>
</table>

</div>

<p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
style='font-family:华文中宋'>图（<span lang=EN-US>46</span>） 软盘控制器端口</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>数字输出端口<span lang=EN-US>DOR</span>（数字控制端口）是一个<span
lang=EN-US>8</span>位寄存器，它控制驱动器马达开启、驱动器选择、启动<span lang=EN-US>/</span>复位<span
lang=EN-US>FDC</span>以及允许<span lang=EN-US>/</span>禁止<span lang=EN-US>DMA</span>及中断请求。</span></p>

<div align=center>

<table class=TableNormal border=1 cellspacing=0 cellpadding=0 style='border-collapse:
 collapse;border:none'>
 <tr style='height:16.35pt'>
  <td width=46 valign=top style='width:34.7pt;border-top:windowtext 1.5pt;
  border-left:windowtext 1.5pt;border-bottom:black 1.0pt;border-right:black 1.0pt;
  border-style:solid;padding:0cm 0cm 0cm 0cm;height:16.35pt'>
  <p class=MsoNormal align=center style='text-align:center;text-autospace:none'><span
  lang=EN-US style='font-family:华文中宋'>位</span></p>
  </td>
  <td width=95 valign=top style='width:70.9pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:16.35pt'>
  <p class=MsoNormal align=center style='text-align:center;text-autospace:none'><span
  lang=EN-US style='font-family:华文中宋'>名称</span></p>
  </td>
  <td width=312 valign=top style='width:233.85pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:16.35pt'>
  <p class=MsoNormal align=center style='text-align:center;text-autospace:none'><span
  lang=EN-US style='font-family:华文中宋'>说明</span></p>
  </td>
 </tr>
 <tr style='height:16.35pt'>
  <td width=46 valign=top style='width:34.7pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:16.35pt'>
  <p class=TableParagraph align=center style='margin-top:1.55pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>7</span></p>
  </td>
  <td width=95 valign=top style='width:70.9pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:16.35pt'>
  <p class=TableParagraph align=center style='margin-top:1.55pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>MOT_EN3</span></p>
  </td>
  <td width=312 valign=top style='width:233.85pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:16.35pt'>
  <p class=TableParagraph align=center style='margin-top:1.55pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  style='font-size:10.5pt;font-family:华文中宋'>启动软驱<span lang=EN-US>D</span>马达：<span
  lang=EN-US>1-</span>启动；<span lang=EN-US>0-</span>关闭。</span></p>
  </td>
 </tr>
 <tr style='height:15.55pt'>
  <td width=46 valign=top style='width:34.7pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>6</span></p>
  </td>
  <td width=95 valign=top style='width:70.9pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>MOT_EN2</span></p>
  </td>
  <td width=312 valign=top style='width:233.85pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  style='font-size:10.5pt;font-family:华文中宋'>启动软驱<span lang=EN-US>C</span>马达：<span
  lang=EN-US>1-</span>启动；<span lang=EN-US>0-</span>关闭。</span></p>
  </td>
 </tr>
 <tr style='height:15.55pt'>
  <td width=46 valign=top style='width:34.7pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>5</span></p>
  </td>
  <td width=95 valign=top style='width:70.9pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>MOT_EN1</span></p>
  </td>
  <td width=312 valign=top style='width:233.85pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  style='font-size:10.5pt;font-family:华文中宋'>启动软驱<span lang=EN-US>B</span>马达：<span
  lang=EN-US>1-</span>启动；<span lang=EN-US>0-</span>关闭。</span></p>
  </td>
 </tr>
 <tr style='height:15.55pt'>
  <td width=46 valign=top style='width:34.7pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>4</span></p>
  </td>
  <td width=95 valign=top style='width:70.9pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>MOT_EN0</span></p>
  </td>
  <td width=312 valign=top style='width:233.85pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  style='font-size:10.5pt;font-family:华文中宋'>启动软驱<span lang=EN-US>A</span>马达：<span
  lang=EN-US>1-</span>启动；<span lang=EN-US>0-</span>关闭。</span></p>
  </td>
 </tr>
 <tr style='height:15.55pt'>
  <td width=46 valign=top style='width:34.7pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>3</span></p>
  </td>
  <td width=95 valign=top style='width:70.9pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>DMA_INT</span></p>
  </td>
  <td width=312 valign=top style='width:233.85pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  style='font-size:10.5pt;font-family:华文中宋'>允许<span lang=EN-US>DMA</span>和中断请求；<span
  lang=EN-US>0-</span>禁止<span lang=EN-US>DMA</span>和中断请求。</span></p>
  </td>
 </tr>
 <tr style='height:15.7pt'>
  <td width=46 valign=top style='width:34.7pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.7pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>2</span></p>
  </td>
  <td width=95 valign=top style='width:70.9pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.7pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>RESET</span></p>
  </td>
  <td width=312 valign=top style='width:233.85pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.7pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  style='font-size:10.5pt;font-family:华文中宋'>允许软盘控制器<span lang=EN-US>FDC</span>工作。</span><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>0-复位FDC。</span></p>
  </td>
 </tr>
 <tr style='height:15.55pt'>
  <td width=46 valign=top style='width:34.7pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>1</span></p>
  </td>
  <td width=95 valign=top style='width:70.9pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>DRV_SEL1</span></p>
  </td>
  <td width=312 rowspan=2 valign=top style='width:233.85pt;border-top:none;
  border-left:none;border-bottom:solid windowtext 1.5pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-top:8.9pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>00-11</span><span
  style='font-size:10.5pt;font-family:华文中宋'>用于选择软盘驱动器<span lang=EN-US>A-D</span>。</span></p>
  </td>
 </tr>
 <tr style='height:15.55pt'>
  <td width=46 valign=top style='width:34.7pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:solid windowtext 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>0</span></p>
  </td>
  <td width=95 valign=top style='width:70.9pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>DRV_SEL0</span></p>
  </td>
 </tr>
</table>

</div>

<p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
style='font-family:华文中宋'>图（<span lang=EN-US>47</span>） 数字输出寄存器定义</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
lang=EN-US style='font-family:华文中宋'>FDC</span><span style='font-family:华文中宋'>的主状态寄存器也是一个<span
lang=EN-US>8</span>位寄存器，用于反映软盘控制器<span lang=EN-US>FDC</span>和软盘驱动器<span
lang=EN-US>FDD</span>的基本状态。通常，在<span lang=EN-US>CPU</span>向<span lang=EN-US>FDC</span>发送命令之前或从<span
lang=EN-US>FDC</span>获取操作结果之前，都要读取主状态寄存器的状态位，以判别当前<span lang=EN-US>FDC</span>数据寄存器是否就绪，以及确定数据传送的方向。</span></p>

<div align=center>

<table class=TableNormal border=1 cellspacing=0 cellpadding=0 style='border-collapse:
 collapse;border:none'>
 <tr style='height:15.55pt'>
  <td width=30 valign=top style='width:22.7pt;border-top:windowtext 1.5pt;
  border-left:windowtext 1.5pt;border-bottom:black 1.5pt;border-right:black 1.0pt;
  border-style:solid;padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>位</span></p>
  </td>
  <td width=70 valign=top style='width:52.45pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>名称</span></p>
  </td>
  <td width=334 valign=top style='width:250.45pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>说明</span></p>
  </td>
 </tr>
 <tr style='height:16.35pt'>
  <td width=30 valign=top style='width:22.7pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:16.35pt'>
  <p class=TableParagraph align=center style='margin-top:1.55pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>7</span></p>
  </td>
  <td width=70 valign=top style='width:52.45pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:16.35pt'>
  <p class=TableParagraph align=center style='margin-top:1.55pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>RQM</span></p>
  </td>
  <td width=334 valign=top style='width:250.45pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:16.35pt'>
  <p class=TableParagraph align=center style='margin-top:1.55pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  style='font-size:10.5pt;font-family:华文中宋'>数据口就绪：控制器<span lang=EN-US>FDC</span>数据寄存器已准备就绪。</span></p>
  </td>
 </tr>
 <tr style='height:15.55pt'>
  <td width=30 valign=top style='width:22.7pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>6</span></p>
  </td>
  <td width=70 valign=top style='width:52.45pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>DIO</span></p>
  </td>
  <td width=334 valign=top style='width:250.45pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>传输<span
  style='letter-spacing:-.15pt'>方</span>向：1- FDC&nbsp;&nbsp; CPU；0- CPU&nbsp;&nbsp;&nbsp;&nbsp; FDC</span></p>
  </td>
 </tr>
 <tr style='height:15.55pt'>
  <td width=30 valign=top style='width:22.7pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>5</span></p>
  </td>
  <td width=70 valign=top style='width:52.45pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>NDM</span></p>
  </td>
  <td width=334 valign=top style='width:250.45pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>非DMA方式：1- 非DMA方式；0- DMA方式</span></p>
  </td>
 </tr>
 <tr style='height:15.55pt'>
  <td width=30 valign=top style='width:22.7pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>4</span></p>
  </td>
  <td width=70 valign=top style='width:52.45pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>CB</span></p>
  </td>
  <td width=334 valign=top style='width:250.45pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  style='font-size:10.5pt;font-family:华文中宋'>控制器忙：<span lang=EN-US>FDC</span>正处于命令执行忙碌状态</span></p>
  </td>
 </tr>
 <tr style='height:15.65pt'>
  <td width=30 valign=top style='width:22.7pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.65pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>3</span></p>
  </td>
  <td width=70 valign=top style='width:52.45pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.65pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>DDB</span></p>
  </td>
  <td width=334 valign=top style='width:250.45pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.65pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>软驱D忙</span></p>
  </td>
 </tr>
 <tr style='height:15.55pt'>
  <td width=30 valign=top style='width:22.7pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>2</span></p>
  </td>
  <td width=70 valign=top style='width:52.45pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>DCB</span></p>
  </td>
  <td width=334 valign=top style='width:250.45pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>软驱C忙</span></p>
  </td>
 </tr>
 <tr style='height:15.55pt'>
  <td width=30 valign=top style='width:22.7pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>1</span></p>
  </td>
  <td width=70 valign=top style='width:52.45pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>DBB</span></p>
  </td>
  <td width=334 valign=top style='width:250.45pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>软驱B忙</span></p>
  </td>
 </tr>
 <tr style='height:15.55pt'>
  <td width=30 valign=top style='width:22.7pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:solid windowtext 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>0</span></p>
  </td>
  <td width=70 valign=top style='width:52.45pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>DAB</span></p>
  </td>
  <td width=334 valign=top style='width:250.45pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.5pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>软驱A忙</span></p>
  </td>
 </tr>
</table>

</div>

<p class=MsoNormal align=center style='text-align:center;text-indent:21.0pt;
line-height:150%'><span style='font-family:华文中宋'>图（<span lang=EN-US>48</span>） <span
lang=EN-US>FDC</span>主状态控制器<span lang=EN-US>MSR</span>定义</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
lang=EN-US style='font-family:华文中宋'>FDC</span><span style='font-family:华文中宋'>的主状态寄存器也是一个<span
lang=EN-US>8</span>位寄存器，用于反映软盘控制器<span lang=EN-US>FDC</span>和软盘驱动器<span
lang=EN-US>FDD</span>的基本状态。通常，在<span lang=EN-US>CPU</span>向<span lang=EN-US>FDC</span>发送命令之前或从<span
lang=EN-US>FDC</span>获取操作结果之前，都要读取主状态寄存器的状态位，以判别当前<span lang=EN-US>FDC</span>数据寄存器是否就绪，以及确定数据传送的方向。</span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt;
line-height:150%'><span lang=EN-US style='font-family:华文中宋'>FDC</span><span
style='font-family:华文中宋'>的数据端口对应多个寄存器（只写型命令寄存器和参数寄存器、只读型结果寄存器），但任一时刻只能有一个寄存器出现在数据端口<span
lang=EN-US>0x3F5</span>。在访问只写型寄存器时，主状态控制的<span lang=EN-US>DIO</span>方向位必须为<span
lang=EN-US>0</span>（<span lang=EN-US>CPU</span>→<span lang=EN-US>FDC</span>），访问只读型寄存器时则反之。在读取结果时只有在<span
lang=EN-US>FDC</span>不忙之后才算读完结果，通常结果数据最多有<span lang=EN-US>7</span>个字节。</span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt;
line-height:150%'><span style='font-family:华文中宋'>数据输入寄存器（<span lang=EN-US>DIR</span>）只有位<span
lang=EN-US>7</span>（<span lang=EN-US>D7</span>）对软盘有效，用来表示盘片更换状态。其余七位用于硬盘控制器接口。</span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt;
line-height:150%'><span style='font-family:华文中宋'>磁盘控制寄存器<span lang=EN-US>(DCR)</span>用于选择盘片在不同类型驱动器上使用的数据传输率。仅使用低<span
lang=EN-US>2 </span>位（<span lang=EN-US>D1D0</span>），<span lang=EN-US>00</span>表示<span
lang=EN-US>500kbps</span>，<span lang=EN-US>01</span>表示<span lang=EN-US>300kbps</span>，<span
lang=EN-US>10</span>表示<span lang=EN-US>250kbps</span>。</span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt;
line-height:150%'><span style='font-family:华文中宋'>我们的软盘驱动程序与软驱中磁盘之间的数据传输是通过<span
lang=EN-US>DMA</span>控制器实现的。在进行读写操作之前，需要首先初始化<span lang=EN-US>DMA</span>控制器，并对软驱控制器进行编程。对于<span
lang=EN-US>386</span>兼容<span lang=EN-US>PC</span>，软驱控制器使用硬件中断<span lang=EN-US>IR6</span>（对应中断描述符<span
lang=EN-US>0x26</span>），并采用<span lang=EN-US>DMA</span>控制器的通道<span lang=EN-US>2</span>。有关<span
lang=EN-US>DMA</span>控制处理的内容见后面小节。</span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt;
line-height:150%'><span lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>

<p class=MsoListParagraph style='margin-left:42.0pt;text-indent:-42.0pt;
line-height:150%'><span lang=EN-US style='font-family:华文中宋'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span>ii.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='font-family:华文中宋'>软盘控制器命令</span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt;
line-height:150%'><span style='font-family:华文中宋'>软盘控制器共可以接受<span lang=EN-US>15</span>条命令。每个命令均经历三个阶段：命令阶段、执行阶段和结果阶段。</span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt;
line-height:150%'><span style='font-family:华文中宋'>命令阶段是<span lang=EN-US>CPU</span>向<span
lang=EN-US>FDC</span>发送命令字节和参数字节。每条命令的第一个字节总是命令字节（命令码）。其后跟着<span lang=EN-US>0--8</span>字节的参数。</span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt;
line-height:150%'><span style='font-family:华文中宋'>执行阶段是<span lang=EN-US>FDC</span>执行命令规定的操作。在执行阶段<span
lang=EN-US>CPU</span>是不加干预的，一般是通过<span lang=EN-US>FDC</span>发出中断请求获知命令执行的结束。如果<span
lang=EN-US>CPU</span>发出的<span lang=EN-US>FDC</span>命令是传送数据，则<span lang=EN-US>FDC</span>可以以中断方式或<span
lang=EN-US>DMA</span>方式进行。中断方式每次传送<span lang=EN-US>1</span>字节。<span lang=EN-US>DMA</span>方式是在<span
lang=EN-US>DMA</span>控制器管理下，<span lang=EN-US>FDC</span>与内存进行数据的传输直至全部数据传送完。此时<span
lang=EN-US>DMA</span>控制器会将传输字节计数终止信号通知<span lang=EN-US>FDC</span>，最后由<span
lang=EN-US>FDC</span>发出中断请求信号告知<span lang=EN-US>CPU</span>执行阶段结束。</span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt;
line-height:150%'><span style='font-family:华文中宋'>结果阶段是由<span lang=EN-US>CPU</span>读取<span
lang=EN-US>FDC</span>数据寄存器返回值，从而获得<span lang=EN-US>FDC</span>命令执行的结果。返回结果数据的长度为<span
lang=EN-US>0--7</span>字节。对于没有返回结果数据的命令，则应向<span lang=EN-US>FDC</span>发送检测中断状态命令获得操作的状态。</span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt;
line-height:150%'><span style='font-family:华文中宋'>而我们只使用其中<span lang=EN-US>6</span>条命令，因此这里仅对这些用到的命令进行描述。</span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'><span
lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>

<p class=MsoListParagraph style='margin-left:41.95pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
style='font-family:华文中宋'>重新校正命令（<span lang=EN-US>FD_RECALIBRATE</span>）</span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt;
line-height:150%'><span style='font-family:华文中宋'>该命令用来让磁头退回到<span lang=EN-US>0</span>磁道。通常用于在软盘操作出错时对磁头重新校正定位。其命令码是<span
lang=EN-US>0x07</span>，参数是指定的驱动器号（<span lang=EN-US>0</span>&#8212;<span lang=EN-US>3</span>）。</span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt;
line-height:150%'><span style='font-family:华文中宋'>该命令无结果阶段，程序需要通过执行“检测中断状态”来获取该命令的执行结果。</span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt;
line-height:150%'><span lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>

<div align=center>

<table class=TableNormal border=1 cellspacing=0 cellpadding=0 width=568
 style='width:426.2pt;border-collapse:collapse;border:none'>
 <tr style='height:15.55pt'>
  <td width=49 valign=top style='width:36.6pt;border-top:windowtext 1.5pt;
  border-left:windowtext 1.5pt;border-bottom:black 1.5pt;border-right:black 1.0pt;
  border-style:solid;padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  等线'>阶段</span></p>
  </td>
  <td width=28 valign=top style='width:21.35pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  等线'>序</span></p>
  </td>
  <td width=34 valign=top style='width:25.2pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt'>D7</span></p>
  </td>
  <td width=33 valign=top style='width:24.5pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt'>D6</span></p>
  </td>
  <td width=33 valign=top style='width:24.5pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt'>D5</span></p>
  </td>
  <td width=33 valign=top style='width:24.5pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt'>D4</span></p>
  </td>
  <td width=33 valign=top style='width:24.4pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt'>D3</span></p>
  </td>
  <td width=33 valign=top style='width:24.5pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt'>D2</span></p>
  </td>
  <td width=38 valign=top style='width:28.8pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt'>D1</span></p>
  </td>
  <td width=39 valign=top style='width:29.15pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt'>D0</span></p>
  </td>
  <td width=217 valign=top style='width:162.7pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  等线'>说明</span></p>
  </td>
 </tr>
 <tr style='height:15.15pt'>
  <td width=49 rowspan=2 valign=top style='width:36.6pt;border-top:none;
  border-left:solid windowtext 1.5pt;border-bottom:double black 1.0pt;
  border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;height:15.15pt'>
  <p class=TableParagraph align=center style='margin-top:8.4pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:等线'>命令</span></p>
  </td>
  <td width=28 valign=top style='width:21.35pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  background:#CCCCCC;padding:0cm 0cm 0cm 0cm;height:15.15pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt'>0</span></p>
  </td>
  <td width=34 valign=top style='width:25.2pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.15pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt'>0</span></p>
  </td>
  <td width=33 valign=top style='width:24.5pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.15pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt'>0</span></p>
  </td>
  <td width=33 valign=top style='width:24.5pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.15pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt'>0</span></p>
  </td>
  <td width=33 valign=top style='width:24.5pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.15pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt'>0</span></p>
  </td>
  <td width=33 valign=top style='width:24.4pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.15pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt'>0</span></p>
  </td>
  <td width=33 valign=top style='width:24.5pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.15pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt'>1</span></p>
  </td>
  <td width=38 valign=top style='width:28.8pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.15pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt'>1</span></p>
  </td>
  <td width=39 valign=top style='width:29.15pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.15pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt'>1</span></p>
  </td>
  <td width=217 valign=top style='width:162.7pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.15pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  等线'>重新校正命令码：</span><span lang=EN-US style='font-size:10.5pt'>0x07</span></p>
  </td>
 </tr>
 <tr style='height:15.05pt'>
  <td width=28 valign=top style='width:21.35pt;border-top:none;border-left:
  none;border-bottom:double black 1.0pt;border-right:solid black 1.0pt;
  background:#CCCCCC;padding:0cm 0cm 0cm 0cm;height:15.05pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt'>1</span></p>
  </td>
  <td width=34 valign=top style='width:25.2pt;border-top:none;border-left:none;
  border-bottom:double black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.05pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt'>0</span></p>
  </td>
  <td width=33 valign=top style='width:24.5pt;border-top:none;border-left:none;
  border-bottom:double black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.05pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt'>0</span></p>
  </td>
  <td width=33 valign=top style='width:24.5pt;border-top:none;border-left:none;
  border-bottom:double black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.05pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt'>0</span></p>
  </td>
  <td width=33 valign=top style='width:24.5pt;border-top:none;border-left:none;
  border-bottom:double black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.05pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt'>0</span></p>
  </td>
  <td width=33 valign=top style='width:24.4pt;border-top:none;border-left:none;
  border-bottom:double black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.05pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt'>0</span></p>
  </td>
  <td width=33 valign=top style='width:24.5pt;border-top:none;border-left:none;
  border-bottom:double black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.05pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt'>0</span></p>
  </td>
  <td width=38 valign=top style='width:28.8pt;border-top:none;border-left:none;
  border-bottom:double black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.05pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt'>US1</span></p>
  </td>
  <td width=39 valign=top style='width:29.15pt;border-top:none;border-left:
  none;border-bottom:double black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.05pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt'>US2</span></p>
  </td>
  <td width=217 valign=top style='width:162.7pt;border-top:none;border-left:
  none;border-bottom:double black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.05pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  等线'>驱动器号</span></p>
  </td>
 </tr>
 <tr style='height:15.5pt'>
  <td width=49 valign=top style='width:36.6pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:double black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.5pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:13.3pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  等线'>执行</span></p>
  </td>
  <td width=28 valign=top style='width:21.35pt;border-top:none;border-left:
  none;border-bottom:double black 1.0pt;border-right:solid black 1.0pt;
  background:#CCCCCC;padding:0cm 0cm 0cm 0cm;height:15.5pt'>
  <p class=TableParagraph align=center style='margin:0cm;margin-bottom:.0001pt;
  text-align:center'><span lang=EN-US style='font-size:10.0pt;font-family:"Times New Roman",serif'>&nbsp;</span></p>
  </td>
  <td width=274 colspan=8 valign=top style='width:205.55pt;border-top:none;
  border-left:none;border-bottom:double black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.5pt'>
  <p class=TableParagraph align=center style='margin:0cm;margin-bottom:.0001pt;
  text-align:center'><span lang=EN-US style='font-size:10.0pt;font-family:"Times New Roman",serif'>&nbsp;</span></p>
  </td>
  <td width=217 valign=top style='width:162.7pt;border-top:none;border-left:
  none;border-bottom:double black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.5pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:13.3pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  等线'>磁头移动到</span><span lang=EN-US style='font-size:10.5pt'>0</span><span
  lang=EN-US style='font-size:10.5pt;font-family:等线'>磁道</span></p>
  </td>
 </tr>
 <tr style='height:15.65pt'>
  <td width=49 valign=top style='width:36.6pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:solid windowtext 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.65pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:等线'>结果</span></p>
  </td>
  <td width=28 valign=top style='width:21.35pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.5pt;border-right:solid black 1.0pt;
  background:#CCCCCC;padding:0cm 0cm 0cm 0cm;height:15.65pt'>
  <p class=TableParagraph align=center style='margin:0cm;margin-bottom:.0001pt;
  text-align:center'><span lang=EN-US style='font-size:10.0pt;font-family:"Times New Roman",serif'>&nbsp;</span></p>
  </td>
  <td width=274 colspan=8 valign=top style='width:205.55pt;border-top:none;
  border-left:none;border-bottom:solid windowtext 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.65pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:等线'>无。</span></p>
  </td>
  <td width=217 valign=top style='width:162.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.5pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.65pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  style='font-size:10.5pt;font-family:等线'>需使用命令获取执行结果。</span></p>
  </td>
 </tr>
</table>

</div>

<p class=MsoListParagraph align=center style='text-align:center;text-indent:
0cm;line-height:150%'><span style='font-family:华文中宋'>图（<span lang=EN-US>49</span>）
重新校正命令（<span lang=EN-US>FD_RECALIBRATE</span>）</span></p>

<p class=MsoListParagraph style='text-indent:0cm;line-height:150%'><span
lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>

<p class=MsoListParagraph align=left style='margin-left:41.95pt;text-align:
left;text-indent:-21.0pt;line-height:150%'><span lang=EN-US style='font-family:
Wingdings'>l<span style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
style='font-family:华文中宋'>磁头寻道命令（<span lang=EN-US>FD_SEEK</span>）</span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt;
line-height:150%'><span style='font-family:华文中宋'>该命令让选中驱动器的磁头移动到指定磁道上。第<span
lang=EN-US>1</span>个参数指定驱动器号和磁头号，位<span lang=EN-US>0-1</span>是驱动器号，位<span
lang=EN-US>2</span>是磁头号，其它比特位无用。第<span lang=EN-US>2</span>个参数指定磁道号。</span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt;
line-height:150%'><span style='font-family:华文中宋'>该命令也无结果阶段，程序需通过执行“检测中断状态”来获取该命令的执行结果。</span></p>

<div align=center>

<table class=TableNormal border=1 cellspacing=0 cellpadding=0 width=568
 style='width:425.8pt;border-collapse:collapse;border:none'>
 <tr style='height:15.55pt'>
  <td width=49 style='width:36.85pt;border-top:windowtext 1.5pt;border-left:
  windowtext 1.5pt;border-bottom:black 1.5pt;border-right:black 1.0pt;
  border-style:solid;padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>阶段</span></p>
  </td>
  <td width=28 style='width:21.35pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>序</span></p>
  </td>
  <td width=34 style='width:25.3pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>D7</span></p>
  </td>
  <td width=33 style='width:24.45pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>D6</span></p>
  </td>
  <td width=33 style='width:24.45pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>D5</span></p>
  </td>
  <td width=33 style='width:24.45pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>D4</span></p>
  </td>
  <td width=33 style='width:24.55pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>D3</span></p>
  </td>
  <td width=33 style='width:24.45pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>D2</span></p>
  </td>
  <td width=38 style='width:28.75pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>D1</span></p>
  </td>
  <td width=39 style='width:29.35pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>D0</span></p>
  </td>
  <td width=216 style='width:161.85pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>说明</span></p>
  </td>
 </tr>
 <tr style='height:15.15pt'>
  <td width=49 rowspan=3 style='width:36.85pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:double black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.15pt'>
  <p class=TableParagraph align=center style='margin:0cm;margin-bottom:.0001pt;
  text-align:center'><span lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>命令</span></p>
  </td>
  <td width=28 style='width:21.35pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;background:
  #CCCCCC;padding:0cm 0cm 0cm 0cm;height:15.15pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>0</span></p>
  </td>
  <td width=34 style='width:25.3pt;border-top:none;border-left:none;border-bottom:
  solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.15pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>0</span></p>
  </td>
  <td width=33 style='width:24.45pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.15pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>0</span></p>
  </td>
  <td width=33 style='width:24.45pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.15pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>0</span></p>
  </td>
  <td width=33 style='width:24.45pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.15pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>0</span></p>
  </td>
  <td width=33 style='width:24.55pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.15pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>1</span></p>
  </td>
  <td width=33 style='width:24.45pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.15pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>1</span></p>
  </td>
  <td width=38 style='width:28.75pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.15pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>1</span></p>
  </td>
  <td width=39 style='width:29.35pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.15pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>1</span></p>
  </td>
  <td width=216 style='width:161.85pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.15pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span style='font-size:10.5pt;font-family:华文中宋'>磁头寻道命令码：<span
  lang=EN-US>0x0F</span></span></p>
  </td>
 </tr>
 <tr style='height:14.55pt'>
  <td width=28 style='width:21.35pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;background:
  #CCCCCC;padding:0cm 0cm 0cm 0cm;height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>1</span></p>
  </td>
  <td width=34 style='width:25.3pt;border-top:none;border-left:none;border-bottom:
  solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>0</span></p>
  </td>
  <td width=33 style='width:24.45pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>0</span></p>
  </td>
  <td width=33 style='width:24.45pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>0</span></p>
  </td>
  <td width=33 style='width:24.45pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>0</span></p>
  </td>
  <td width=33 style='width:24.55pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>0</span></p>
  </td>
  <td width=33 style='width:24.45pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>HD</span></p>
  </td>
  <td width=38 style='width:28.75pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>US1</span></p>
  </td>
  <td width=39 style='width:29.35pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>US2</span></p>
  </td>
  <td width=216 style='width:161.85pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>磁头号、驱动器号。</span></p>
  </td>
 </tr>
 <tr style='height:15.05pt'>
  <td width=28 style='width:21.35pt;border-top:none;border-left:none;
  border-bottom:double black 1.0pt;border-right:solid black 1.0pt;background:
  #CCCCCC;padding:0cm 0cm 0cm 0cm;height:15.05pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>2</span></p>
  </td>
  <td width=274 colspan=8 style='width:205.75pt;border-top:none;border-left:
  none;border-bottom:double black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.05pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>C</span></p>
  </td>
  <td width=216 style='width:161.85pt;border-top:none;border-left:none;
  border-bottom:double black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.05pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>磁道号。</span></p>
  </td>
 </tr>
 <tr style='height:15.5pt'>
  <td width=49 style='width:36.85pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:double black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.5pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:13.3pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>执行</span></p>
  </td>
  <td width=28 style='width:21.35pt;border-top:none;border-left:none;
  border-bottom:double black 1.0pt;border-right:solid black 1.0pt;background:
  #CCCCCC;padding:0cm 0cm 0cm 0cm;height:15.5pt'>
  <p class=TableParagraph align=center style='margin:0cm;margin-bottom:.0001pt;
  text-align:center'><span lang=EN-US style='font-size:10.0pt;font-family:华文中宋'>&nbsp;</span></p>
  </td>
  <td width=274 colspan=8 style='width:205.75pt;border-top:none;border-left:
  none;border-bottom:double black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.5pt'>
  <p class=TableParagraph align=center style='margin:0cm;margin-bottom:.0001pt;
  text-align:center'><span lang=EN-US style='font-size:10.0pt;font-family:华文中宋'>&nbsp;</span></p>
  </td>
  <td width=216 style='width:161.85pt;border-top:none;border-left:none;
  border-bottom:double black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.5pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:13.3pt'><span style='font-size:10.5pt;font-family:华文中宋'>磁头移动到指定磁道上。</span></p>
  </td>
 </tr>
 <tr style='height:15.65pt'>
  <td width=49 style='width:36.85pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:solid windowtext 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.65pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>结果</span></p>
  </td>
  <td width=28 style='width:21.35pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.5pt;border-right:solid black 1.0pt;
  background:#CCCCCC;padding:0cm 0cm 0cm 0cm;height:15.65pt'>
  <p class=TableParagraph align=center style='margin:0cm;margin-bottom:.0001pt;
  text-align:center'><span lang=EN-US style='font-size:10.0pt;font-family:华文中宋'>&nbsp;</span></p>
  </td>
  <td width=274 colspan=8 style='width:205.75pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.65pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>无。</span></p>
  </td>
  <td width=216 style='width:161.85pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.5pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.65pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  style='font-size:10.5pt;font-family:华文中宋'>需使用命令获取执行结果。</span></p>
  </td>
 </tr>
</table>

</div>

<p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
style='font-family:华文中宋'>图（<span lang=EN-US>50</span>） 磁头寻道命令（<span lang=EN-US>FD_SEEK</span>）</span></p>

<p class=MsoListParagraph align=left style='margin-left:41.95pt;text-align:
left;text-indent:0cm;line-height:150%'><span lang=EN-US style='font-family:
华文中宋'>&nbsp;</span></p>

<p class=MsoListParagraph style='margin-left:42.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
style='font-family:华文中宋'>读扇区数据命令（<span lang=EN-US>FD_READ</span>）</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>该命令用于从磁盘上读取指定位置开始的扇区，经<span lang=EN-US>DMA</span>控制传输到系统内存中。每当一个扇区读完，参数<span
lang=EN-US>4</span>（<span lang=EN-US>R</span>）就自动加<span lang=EN-US>1</span>，以继续读取下一个扇区，直到<span
lang=EN-US>DMA</span>控制器把传输计数终止信号发送给软盘控制器。该命令通常是在磁头寻道命令执行后磁头已经位于指定磁道后开始。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>返回结果中，磁道号<span lang=EN-US>C</span>和扇区号<span
lang=EN-US>R</span>是当前磁头所处位置。因为在读完一个扇区后起始扇区号<span lang=EN-US>R</span>自动增<span
lang=EN-US>1</span>，因此结果中的<span lang=EN-US>R</span>值是下一个未读扇区号。若正好读完一个磁道上最后一个扇区（即<span
lang=EN-US>EOT</span>），则磁道号也会增<span lang=EN-US>1</span>，并且<span lang=EN-US>R</span>值复位成<span
lang=EN-US>1</span>。</span></p>

<div align=center>

<table class=TableNormal border=1 cellspacing=0 cellpadding=0 width=563
 style='width:422.3pt;border-collapse:collapse;border:none'>
 <tr style='height:15.55pt'>
  <td width=44 style='width:33.1pt;border-top:windowtext 1.5pt;border-left:
  windowtext 1.5pt;border-bottom:black 1.5pt;border-right:black 1.0pt;
  border-style:solid;padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>阶段</span></p>
  </td>
  <td width=28 style='width:21.35pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>序</span></p>
  </td>
  <td width=35 style='width:25.9pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>D7</span></p>
  </td>
  <td width=34 style='width:25.3pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>D6</span></p>
  </td>
  <td width=32 style='width:24.35pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>D5</span></p>
  </td>
  <td width=32 style='width:24.35pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>D4</span></p>
  </td>
  <td width=32 style='width:24.35pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>D3</span></p>
  </td>
  <td width=32 style='width:24.35pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>D2</span></p>
  </td>
  <td width=38 style='width:28.55pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>D1</span></p>
  </td>
  <td width=39 style='width:29.05pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>D0</span></p>
  </td>
  <td width=216 style='width:161.65pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>说明</span></p>
  </td>
 </tr>
 <tr style='height:15.15pt'>
  <td width=44 rowspan=9 style='width:33.1pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:double black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.15pt'>
  <p class=TableParagraph align=center style='margin:0cm;margin-bottom:.0001pt;
  text-align:center'><span lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>命令</span></p>
  </td>
  <td width=28 style='width:21.35pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;background:
  #CCCCCC;padding:0cm 0cm 0cm 0cm;height:15.15pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>0</span></p>
  </td>
  <td width=35 style='width:25.9pt;border-top:none;border-left:none;border-bottom:
  solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.15pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>MT</span></p>
  </td>
  <td width=34 style='width:25.3pt;border-top:none;border-left:none;border-bottom:
  solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.15pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>MF</span></p>
  </td>
  <td width=32 style='width:24.35pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.15pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>SK</span></p>
  </td>
  <td width=32 style='width:24.35pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.15pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>0</span></p>
  </td>
  <td width=32 style='width:24.35pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.15pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>0</span></p>
  </td>
  <td width=32 style='width:24.35pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.15pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>1</span></p>
  </td>
  <td width=38 style='width:28.55pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.15pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>1</span></p>
  </td>
  <td width=39 style='width:29.05pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.15pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>0</span></p>
  </td>
  <td width=216 style='width:161.65pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.15pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>读命令码：0xE6（MT=MF=SK=1）</span></p>
  </td>
 </tr>
 <tr style='height:14.55pt'>
  <td width=28 style='width:21.35pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;background:
  #CCCCCC;padding:0cm 0cm 0cm 0cm;height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>1</span></p>
  </td>
  <td width=35 style='width:25.9pt;border-top:none;border-left:none;border-bottom:
  solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>0</span></p>
  </td>
  <td width=34 style='width:25.3pt;border-top:none;border-left:none;border-bottom:
  solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>0</span></p>
  </td>
  <td width=32 style='width:24.35pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>0</span></p>
  </td>
  <td width=32 style='width:24.35pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>0</span></p>
  </td>
  <td width=32 style='width:24.35pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>0</span></p>
  </td>
  <td width=32 style='width:24.35pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>0</span></p>
  </td>
  <td width=38 style='width:28.55pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>US1</span></p>
  </td>
  <td width=39 style='width:29.05pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>US2</span></p>
  </td>
  <td width=216 style='width:161.65pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>驱动器号。</span></p>
  </td>
 </tr>
 <tr style='height:14.55pt'>
  <td width=28 style='width:21.35pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;background:
  #CCCCCC;padding:0cm 0cm 0cm 0cm;height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>2</span></p>
  </td>
  <td width=275 colspan=8 style='width:206.2pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>C</span></p>
  </td>
  <td width=216 style='width:161.65pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>磁道号</span></p>
  </td>
 </tr>
 <tr style='height:14.55pt'>
  <td width=28 style='width:21.35pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;background:
  #CCCCCC;padding:0cm 0cm 0cm 0cm;height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>3</span></p>
  </td>
  <td width=275 colspan=8 style='width:206.2pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>H</span></p>
  </td>
  <td width=216 style='width:161.65pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>磁头号</span></p>
  </td>
 </tr>
 <tr style='height:14.55pt'>
  <td width=28 style='width:21.35pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;background:
  #CCCCCC;padding:0cm 0cm 0cm 0cm;height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>4</span></p>
  </td>
  <td width=275 colspan=8 style='width:206.2pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>R</span></p>
  </td>
  <td width=216 style='width:161.65pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>起始扇区号</span></p>
  </td>
 </tr>
 <tr style='height:14.55pt'>
  <td width=28 style='width:21.35pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;background:
  #CCCCCC;padding:0cm 0cm 0cm 0cm;height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>5</span></p>
  </td>
  <td width=275 colspan=8 style='width:206.2pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>N</span></p>
  </td>
  <td width=216 style='width:161.65pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>扇区字节数</span></p>
  </td>
 </tr>
 <tr style='height:14.7pt'>
  <td width=28 style='width:21.35pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;background:
  #CCCCCC;padding:0cm 0cm 0cm 0cm;height:14.7pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:13.05pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>6</span></p>
  </td>
  <td width=275 colspan=8 style='width:206.2pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:14.7pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:13.05pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>EOT</span></p>
  </td>
  <td width=216 style='width:161.65pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:14.7pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:13.05pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>磁道上最大扇区号</span></p>
  </td>
 </tr>
 <tr style='height:14.55pt'>
  <td width=28 style='width:21.35pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;background:
  #CCCCCC;padding:0cm 0cm 0cm 0cm;height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>7</span></p>
  </td>
  <td width=275 colspan=8 style='width:206.2pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>GPL</span></p>
  </td>
  <td width=216 style='width:161.65pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:12.95pt'><span style='font-size:10.5pt;font-family:华文中宋'>扇区之间间隔长度（<span
  lang=EN-US>3</span>）</span></p>
  </td>
 </tr>
 <tr style='height:15.05pt'>
  <td width=28 style='width:21.35pt;border-top:none;border-left:none;
  border-bottom:double black 1.0pt;border-right:solid black 1.0pt;background:
  #CCCCCC;padding:0cm 0cm 0cm 0cm;height:15.05pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>8</span></p>
  </td>
  <td width=275 colspan=8 style='width:206.2pt;border-top:none;border-left:
  none;border-bottom:double black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.05pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>DTL</span></p>
  </td>
  <td width=216 style='width:161.65pt;border-top:none;border-left:none;
  border-bottom:double black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.05pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>N=0</span><span style='font-size:10.5pt;font-family:华文中宋'>时，指定扇区字节数</span></p>
  </td>
 </tr>
 <tr style='height:15.5pt'>
  <td width=44 style='width:33.1pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:double black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.5pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:13.3pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>执行</span></p>
  </td>
  <td width=28 style='width:21.35pt;border-top:none;border-left:none;
  border-bottom:double black 1.0pt;border-right:solid black 1.0pt;background:
  #CCCCCC;padding:0cm 0cm 0cm 0cm;height:15.5pt'>
  <p class=TableParagraph align=center style='margin:0cm;margin-bottom:.0001pt;
  text-align:center'><span lang=EN-US style='font-size:10.0pt;font-family:华文中宋'>&nbsp;</span></p>
  </td>
  <td width=275 colspan=8 style='width:206.2pt;border-top:none;border-left:
  none;border-bottom:double black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.5pt'>
  <p class=TableParagraph align=center style='margin:0cm;margin-bottom:.0001pt;
  text-align:center'><span lang=EN-US style='font-size:10.0pt;font-family:华文中宋'>&nbsp;</span></p>
  </td>
  <td width=216 style='width:161.65pt;border-top:none;border-left:none;
  border-bottom:double black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.5pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center;
  line-height:13.3pt'><span style='font-size:10.5pt;font-family:华文中宋'>数据从磁盘传送到系统</span></p>
  </td>
 </tr>
 <tr style='height:15.65pt'>
  <td width=44 rowspan=7 style='width:33.1pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:solid windowtext 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.65pt'>
  <p class=TableParagraph align=center style='margin:0cm;margin-bottom:.0001pt;
  text-align:center'><span lang=EN-US style='font-size:10.0pt;font-family:华文中宋'>&nbsp;</span></p>
  <p class=TableParagraph align=center style='margin:0cm;margin-bottom:.0001pt;
  text-align:center'><span lang=EN-US style='font-size:10.0pt;font-family:华文中宋'>&nbsp;</span></p>
  <p class=TableParagraph align=center style='margin:0cm;margin-bottom:.0001pt;
  text-align:center'><span lang=EN-US style='font-size:10.0pt;font-family:华文中宋'>&nbsp;</span></p>
  <p class=TableParagraph align=center style='margin-top:.05pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:8.0pt;font-family:华文中宋'>&nbsp;</span></p>
  <p class=TableParagraph align=center style='margin:0cm;margin-bottom:.0001pt;
  text-align:center'><span lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>结果</span></p>
  </td>
  <td width=28 style='width:21.35pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;background:
  #CCCCCC;padding:0cm 0cm 0cm 0cm;height:15.65pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>1</span></p>
  </td>
  <td width=275 colspan=8 style='width:206.2pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.65pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>ST0</span></p>
  </td>
  <td width=216 style='width:161.65pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.65pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>状态字节0</span></p>
  </td>
 </tr>
 <tr style='height:15.55pt'>
  <td width=28 style='width:21.35pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;background:
  #CCCCCC;padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>2</span></p>
  </td>
  <td width=275 colspan=8 style='width:206.2pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>ST1</span></p>
  </td>
  <td width=216 style='width:161.65pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>状态字节1</span></p>
  </td>
 </tr>
 <tr style='height:15.55pt'>
  <td width=28 style='width:21.35pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;background:
  #CCCCCC;padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>3</span></p>
  </td>
  <td width=275 colspan=8 style='width:206.2pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>ST2</span></p>
  </td>
  <td width=216 style='width:161.65pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>状态字节2</span></p>
  </td>
 </tr>
 <tr style='height:15.55pt'>
  <td width=28 style='width:21.35pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;background:
  #CCCCCC;padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>4</span></p>
  </td>
  <td width=275 colspan=8 style='width:206.2pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>C</span></p>
  </td>
  <td width=216 style='width:161.65pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>磁道号</span></p>
  </td>
 </tr>
 <tr style='height:15.7pt'>
  <td width=28 style='width:21.35pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;background:
  #CCCCCC;padding:0cm 0cm 0cm 0cm;height:15.7pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>5</span></p>
  </td>
  <td width=275 colspan=8 style='width:206.2pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.7pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>H</span></p>
  </td>
  <td width=216 style='width:161.65pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.7pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>磁头号</span></p>
  </td>
 </tr>
 <tr style='height:15.55pt'>
  <td width=28 style='width:21.35pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;background:
  #CCCCCC;padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>6</span></p>
  </td>
  <td width=275 colspan=8 style='width:206.2pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>R</span></p>
  </td>
  <td width=216 style='width:161.65pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>扇区号</span></p>
  </td>
 </tr>
 <tr style='height:15.55pt'>
  <td width=28 style='width:21.35pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.5pt;border-right:solid black 1.0pt;
  background:#CCCCCC;padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>7</span></p>
  </td>
  <td width=275 colspan=8 style='width:206.2pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>N</span></p>
  </td>
  <td width=216 style='width:161.65pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.5pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>扇区字节数</span></p>
  </td>
 </tr>
</table>

</div>

<p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
style='font-family:华文中宋'>图（<span lang=EN-US>51</span>） 读扇区数据命令（<span
lang=EN-US>FD_READ</span>）</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>其中<span lang=EN-US>MT</span>、<span lang=EN-US>MF</span>和<span
lang=EN-US>SK</span>的含义分别为：</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
lang=EN-US style='font-family:华文中宋'>MT</span><span style='font-family:华文中宋'>表示多磁道操作。<span
lang=EN-US>MT=1</span>表示允许在同一磁道上两个磁头连续操作。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
lang=EN-US style='font-family:华文中宋'>MF</span><span style='font-family:华文中宋'>表示记录方式。<span
lang=EN-US>MF=1</span>表示选用<span lang=EN-US>MFM</span>记录方式，否则是<span lang=EN-US>FM</span>记录方式。<span
lang=EN-US>SK</span>表示是否跳过有删除标志的扇区。<span lang=EN-US>SK=1</span>表示跳过。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>返回的<span lang=EN-US>3</span>个状态字节<span lang=EN-US>ST0</span>、<span
lang=EN-US>ST1</span>和<span lang=EN-US>ST2</span>的含义见下面所示。</span></p>

<div align=center>

<table class=TableNormal border=1 cellspacing=0 cellpadding=0 style='border-collapse:
 collapse;border:none'>
 <tr style='height:15.55pt'>
  <td width=33 style='width:24.95pt;border-top:windowtext 1.5pt;border-left:
  windowtext 1.5pt;border-bottom:black 1.5pt;border-right:black 1.0pt;
  border-style:solid;padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>位</span></p>
  </td>
  <td width=84 style='width:62.85pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>名称</span></p>
  </td>
  <td width=385 style='width:288.7pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>说明</span></p>
  </td>
 </tr>
 <tr style='height:15.65pt'>
  <td width=33 style='width:24.95pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.65pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>7</span></p>
  </td>
  <td width=84 rowspan=2 style='width:62.85pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.65pt'>
  <p class=TableParagraph align=center style='margin-top:8.4pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>ST0_INTR</span></p>
  </td>
  <td width=385 rowspan=2 style='width:288.7pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.65pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  style='font-size:10.5pt;font-family:华文中宋'>中断原因。<span lang=EN-US>00 &#8211; </span>命令正常结束；<span
  lang=EN-US>01 &#8211; </span>命令异常结束；</span></p>
  <p class=TableParagraph align=center style='margin-top:2.15pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>10 &#8211; </span><span
  style='font-size:10.5pt;font-family:华文中宋'>命令无效；<span lang=EN-US>11 &#8211; </span>软盘驱动器状态改变。</span></p>
  </td>
 </tr>
 <tr style='height:15.55pt'>
  <td width=33 style='width:24.95pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>6</span></p>
  </td>
 </tr>
 <tr style='height:15.55pt'>
  <td width=33 style='width:24.95pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>5</span></p>
  </td>
  <td width=84 style='width:62.85pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>ST0_SE</span></p>
  </td>
  <td width=385 style='width:288.7pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  style='font-size:10.5pt;font-family:华文中宋'>寻道操作或重新校正操作结束。</span><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>（Seek End）</span></p>
  </td>
 </tr>
 <tr style='height:15.55pt'>
  <td width=33 style='width:24.95pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>4</span></p>
  </td>
  <td width=84 style='width:62.85pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>ST0_ECE</span></p>
  </td>
  <td width=385 style='width:288.7pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  style='font-size:10.5pt;font-family:华文中宋;letter-spacing:-.1pt'>设备检查出错</span><span
  style='font-size:10.5pt;font-family:华文中宋;letter-spacing:-.15pt'>（零磁道校正出错</span><span
  style='font-size:10.5pt;font-family:华文中宋'>）（<span lang=EN-US>Equip. </span></span><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>Check Error）</span></p>
  </td>
 </tr>
 <tr style='height:15.55pt'>
  <td width=33 style='width:24.95pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>3</span></p>
  </td>
  <td width=84 style='width:62.85pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>ST0_NR</span></p>
  </td>
  <td width=385 style='width:288.7pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>软驱未就绪。（Not Ready）</span></p>
  </td>
 </tr>
 <tr style='height:15.7pt'>
  <td width=33 style='width:24.95pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.7pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>2</span></p>
  </td>
  <td width=84 style='width:62.85pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.7pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>ST0_HA</span></p>
  </td>
  <td width=385 style='width:288.7pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.7pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  style='font-size:10.5pt;font-family:华文中宋'>磁头地址。中断时磁头号。</span><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>（Head Address）</span></p>
  </td>
 </tr>
 <tr style='height:15.55pt'>
  <td width=33 style='width:24.95pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>1</span></p>
  </td>
  <td width=84 rowspan=2 style='width:62.85pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-top:8.9pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>ST0_DS</span></p>
  </td>
  <td width=385 rowspan=2 style='width:288.7pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.5pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  style='font-size:10.5pt;font-family:华文中宋;letter-spacing:-.1pt'>驱动器选择号</span><span
  style='font-size:10.5pt;font-family:华文中宋;letter-spacing:-.15pt'>（发生中断时驱动器号</span><span
  style='font-size:10.5pt;font-family:华文中宋'>）（<span lang=EN-US>Drive Select</span>）</span></p>
  <p class=TableParagraph align=center style='margin-top:2.15pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>00 &#8211; 11</span><span
  style='font-size:10.5pt;font-family:华文中宋'>分别对应驱动器<span lang=EN-US>0&#8212;3</span>。</span></p>
  </td>
 </tr>
 <tr style='height:15.55pt'>
  <td width=33 style='width:24.95pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:solid windowtext 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>0</span></p>
  </td>
 </tr>
</table>

</div>

<p class=MsoNormal align=center style='text-align:center;text-indent:21.0pt;
line-height:150%'><span style='font-family:华文中宋'>图（<span lang=EN-US>52</span>） 状态字节<span
lang=EN-US>0 </span>（<span lang=EN-US>ST0</span>）</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:150%'><span
lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>

<div align=center>

<table class=TableNormal border=1 cellspacing=0 cellpadding=0 style='border-collapse:
 collapse;border:none'>
 <tr style='height:15.55pt'>
  <td width=33 style='width:24.95pt;border-top:windowtext 1.5pt;border-left:
  windowtext 1.5pt;border-bottom:black 1.5pt;border-right:black 1.0pt;
  border-style:solid;padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>位</span></p>
  </td>
  <td width=84 style='width:62.85pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>名称</span></p>
  </td>
  <td width=385 style='width:288.7pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center;
  line-height:13.45pt'><span lang=EN-US style='font-size:10.5pt;font-family:
  华文中宋'>说明</span></p>
  </td>
 </tr>
 <tr style='height:15.65pt'>
  <td width=33 style='width:24.95pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.65pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>7</span></p>
  </td>
  <td width=84 style='width:62.85pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.65pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>ST1_EOC</span></p>
  </td>
  <td width=385 style='width:288.7pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.65pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  style='font-size:10.5pt;font-family:华文中宋;letter-spacing:-.15pt'>访问超过磁道上最大扇区号</span><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>EOT</span><span
  style='font-size:10.5pt;font-family:华文中宋;letter-spacing:-5.4pt'>。</span><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>（End of Cylinder）</span></p>
  </td>
 </tr>
 <tr style='height:15.55pt'>
  <td width=33 style='width:24.95pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>6</span></p>
  </td>
  <td width=84 style='width:62.85pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.55pt'>
  <p class=TableParagraph align=center style='margin:0cm;margin-bottom:.0001pt;
  text-align:center'><span lang=EN-US style='font-size:10.0pt;font-family:华文中宋'>&nbsp;</span></p>
  </td>
  <td width=385 style='width:288.7pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋;letter-spacing:-.05pt'>未使用</span><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>（0<span
  style='letter-spacing:-5.4pt'>）</span></span></p>
  </td>
 </tr>
 <tr style='height:15.55pt'>
  <td width=33 style='width:24.95pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>5</span></p>
  </td>
  <td width=84 style='width:62.85pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>ST1_CRC</span></p>
  </td>
  <td width=385 style='width:288.7pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>CRC校验出错。</span></p>
  </td>
 </tr>
 <tr style='height:15.55pt'>
  <td width=33 style='width:24.95pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>4</span></p>
  </td>
  <td width=84 style='width:62.85pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>ST1_OR</span></p>
  </td>
  <td width=385 style='width:288.7pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  style='font-size:10.5pt;font-family:华文中宋'>数据传输超时，<span lang=EN-US>DMA</span>控制器故障。</span><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>（Over Run）</span></p>
  </td>
 </tr>
 <tr style='height:15.55pt'>
  <td width=33 style='width:24.95pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>3</span></p>
  </td>
  <td width=84 style='width:62.85pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.55pt'>
  <p class=TableParagraph align=center style='margin:0cm;margin-bottom:.0001pt;
  text-align:center'><span lang=EN-US style='font-size:10.0pt;font-family:华文中宋'>&nbsp;</span></p>
  </td>
  <td width=385 style='width:288.7pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋;letter-spacing:-.05pt'>未使用</span><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>（0<span
  style='letter-spacing:-5.4pt'>）</span></span></p>
  </td>
 </tr>
 <tr style='height:15.55pt'>
  <td width=33 style='width:24.95pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>2</span></p>
  </td>
  <td width=84 style='width:62.85pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>ST1_ND</span></p>
  </td>
  <td width=385 style='width:288.7pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>未找到指定的扇区。（No Data -
  unreadable）</span></p>
  </td>
 </tr>
 <tr style='height:15.7pt'>
  <td width=33 style='width:24.95pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.7pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>1</span></p>
  </td>
  <td width=84 style='width:62.85pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.7pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>ST1_WP</span></p>
  </td>
  <td width=385 style='width:288.7pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.7pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>写保护。（Write Protect）</span></p>
  </td>
 </tr>
 <tr style='height:15.55pt'>
  <td width=33 style='width:24.95pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:solid windowtext 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>0</span></p>
  </td>
  <td width=84 style='width:62.85pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>ST1_MAM</span></p>
  </td>
  <td width=385 style='width:288.7pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.5pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋;letter-spacing:-.15pt'>未找到扇区地址标志</span><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>ID <span
  style='letter-spacing:-.15pt'>AM</span><span style='letter-spacing:-5.3pt'>。</span>（Missing
  Address Mask）</span></p>
  </td>
 </tr>
</table>

</div>

<p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
style='font-family:华文中宋'>图（<span lang=EN-US>53</span>） 状态字节<span lang=EN-US>1 </span>（<span
lang=EN-US>ST1</span>）</span></p>

<div align=center>

<table class=TableNormal border=1 cellspacing=0 cellpadding=0 style='border-collapse:
 collapse;border:none'>
 <tr style='height:15.55pt'>
  <td width=33 style='width:24.95pt;border-top:windowtext 1.5pt;border-left:
  windowtext 1.5pt;border-bottom:black 1.5pt;border-right:black 1.0pt;
  border-style:solid;padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>位</span></p>
  </td>
  <td width=84 style='width:62.85pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>名称</span></p>
  </td>
  <td width=385 style='width:288.7pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>说明</span></p>
  </td>
 </tr>
 <tr style='height:15.65pt'>
  <td width=33 style='width:24.95pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.65pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>7</span></p>
  </td>
  <td width=84 style='width:62.85pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.65pt'>
  <p class=TableParagraph align=center style='margin:0cm;margin-bottom:.0001pt;
  text-align:center'><span lang=EN-US style='font-size:10.0pt;font-family:华文中宋'>&nbsp;</span></p>
  </td>
  <td width=385 style='width:288.7pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.65pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋;letter-spacing:-.05pt'>未使用</span><span
  style='font-size:10.5pt;font-family:华文中宋'>（</span><span lang=EN-US
  style='font-size:10.5pt;font-family:华文中宋'>0</span><span style='font-size:
  10.5pt;font-family:华文中宋'>）</span></p>
  </td>
 </tr>
 <tr style='height:15.55pt'>
  <td width=33 style='width:24.95pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>6</span></p>
  </td>
  <td width=84 style='width:62.85pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>ST2_CM</span></p>
  </td>
  <td width=385 style='width:288.7pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>SK=0</span><span
  style='font-size:10.5pt;font-family:华文中宋;letter-spacing:-.6pt'>时，读数据遇到删除标志。</span><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>（Control Mark = deleted）</span></p>
  </td>
 </tr>
 <tr style='height:15.55pt'>
  <td width=33 style='width:24.95pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>5</span></p>
  </td>
  <td width=84 style='width:62.85pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>ST2_CRC</span></p>
  </td>
  <td width=385 style='width:288.7pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  style='font-size:10.5pt;font-family:华文中宋'>扇区数据场<span lang=EN-US>CRC</span>校验出错。</span></p>
  </td>
 </tr>
 <tr style='height:15.55pt'>
  <td width=33 style='width:24.95pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>4</span></p>
  </td>
  <td width=84 style='width:62.85pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>ST2_WC</span></p>
  </td>
  <td width=385 style='width:288.7pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  style='font-size:10.5pt;font-family:华文中宋'>扇区<span lang=EN-US>ID</span>信息的磁道号<span
  lang=EN-US>C</span>不符。</span><span lang=EN-US style='font-size:10.5pt;
  font-family:华文中宋'>（Wrong Cylinder）</span></p>
  </td>
 </tr>
 <tr style='height:15.55pt'>
  <td width=33 style='width:24.95pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>3</span></p>
  </td>
  <td width=84 style='width:62.85pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>ST2_SEH</span></p>
  </td>
  <td width=385 style='width:288.7pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  style='font-size:10.5pt;font-family:华文中宋'>检索（扫描）条件满足要求。</span><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>（Scan Equal Hit）</span></p>
  </td>
 </tr>
 <tr style='height:15.55pt'>
  <td width=33 style='width:24.95pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>2</span></p>
  </td>
  <td width=84 style='width:62.85pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>ST2_SNS</span></p>
  </td>
  <td width=385 style='width:288.7pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>检索条件不满足要求。（Scan Not
  Satisfied）</span></p>
  </td>
 </tr>
 <tr style='height:15.65pt'>
  <td width=33 style='width:24.95pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.65pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>1</span></p>
  </td>
  <td width=84 style='width:62.85pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.65pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>ST2_BC</span></p>
  </td>
  <td width=385 style='width:288.7pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.65pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  style='font-size:10.5pt;font-family:华文中宋'>扇区<span lang=EN-US>ID</span>信息的磁道号<span
  lang=EN-US>C=0xFF</span>，磁道坏。</span><span lang=EN-US style='font-size:10.5pt;
  font-family:华文中宋'>（Bad Cylinder）</span></p>
  </td>
 </tr>
 <tr style='height:15.55pt'>
  <td width=33 style='width:24.95pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:solid windowtext 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>0</span></p>
  </td>
  <td width=84 style='width:62.85pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>ST2_MAM</span></p>
  </td>
  <td width=385 style='width:288.7pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.5pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  style='font-size:10.5pt;font-family:华文中宋;letter-spacing:-.15pt'>未找到扇区数据标志</span><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>DATA AM</span><span
  style='font-size:10.5pt;font-family:华文中宋;letter-spacing:-5.3pt'>。</span><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>（Missing Address Mask）</span></p>
  </td>
 </tr>
</table>

</div>

<p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
style='font-family:华文中宋'>图（<span lang=EN-US>54</span>） 状态字节<span lang=EN-US>2 </span>（<span
lang=EN-US>ST2</span>）</span></p>

<p class=MsoNormal style='line-height:150%'><span lang=EN-US style='font-family:
华文中宋'>&nbsp;</span></p>

<p class=MsoListParagraph style='margin-left:42.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
style='font-family:华文中宋'>写扇区数据命令（<span lang=EN-US>FD_WRITE</span>）</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>该命令用于将内存中的数据写到磁盘上。在<span lang=EN-US>DMA</span>传输方式下，软驱控制器把内存中的数据串行地写到磁盘指定扇区中。每写完一个扇区，起始扇区号自动增<span
lang=EN-US>1</span>，并继续写下一个扇区，直到软驱控制器收到<span lang=EN-US>DMA</span>控制器的计数终止信号。见下表所示，其中缩写名称的含义与读命令中的相同。</span></p>

<div align=center>

<table class=TableNormal border=1 cellspacing=0 cellpadding=0 width=563
 style='width:422.3pt;border-collapse:collapse;border:none'>
 <tr style='height:15.55pt'>
  <td width=44 style='width:33.1pt;border-top:windowtext 1.5pt;border-left:
  windowtext 1.5pt;border-bottom:black 1.5pt;border-right:black 1.0pt;
  border-style:solid;padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>阶段</span></p>
  </td>
  <td width=28 style='width:21.35pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>序</span></p>
  </td>
  <td width=35 style='width:25.9pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>D7</span></p>
  </td>
  <td width=34 style='width:25.3pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>D6</span></p>
  </td>
  <td width=32 style='width:24.35pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>D5</span></p>
  </td>
  <td width=32 style='width:24.35pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>D4</span></p>
  </td>
  <td width=32 style='width:24.35pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>D3</span></p>
  </td>
  <td width=32 style='width:24.35pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>D2</span></p>
  </td>
  <td width=38 style='width:28.55pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>D1</span></p>
  </td>
  <td width=39 style='width:29.05pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>D0</span></p>
  </td>
  <td width=216 style='width:161.65pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>说明</span></p>
  </td>
 </tr>
 <tr style='height:15.15pt'>
  <td width=44 rowspan=9 style='width:33.1pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:double black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.15pt'>
  <p class=TableParagraph align=center style='margin:0cm;margin-bottom:.0001pt;
  text-align:center'><span lang=EN-US style='font-size:10.0pt;font-family:华文中宋'>&nbsp;</span></p>
  <p class=TableParagraph align=center style='margin:0cm;margin-bottom:.0001pt;
  text-align:center'><span lang=EN-US style='font-size:10.0pt;font-family:华文中宋'>&nbsp;</span></p>
  <p class=TableParagraph align=center style='margin:0cm;margin-bottom:.0001pt;
  text-align:center'><span lang=EN-US style='font-size:10.0pt;font-family:华文中宋'>&nbsp;</span></p>
  <p class=TableParagraph align=center style='margin:0cm;margin-bottom:.0001pt;
  text-align:center'><span lang=EN-US style='font-size:10.0pt;font-family:华文中宋'>&nbsp;</span></p>
  <p class=TableParagraph align=center style='margin-top:.1pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>&nbsp;</span></p>
  <p class=TableParagraph align=center style='margin:0cm;margin-bottom:.0001pt;
  text-align:center'><span lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>命令</span></p>
  </td>
  <td width=28 style='width:21.35pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;background:
  #CCCCCC;padding:0cm 0cm 0cm 0cm;height:15.15pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>0</span></p>
  </td>
  <td width=35 style='width:25.9pt;border-top:none;border-left:none;border-bottom:
  solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.15pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>MT</span></p>
  </td>
  <td width=34 style='width:25.3pt;border-top:none;border-left:none;border-bottom:
  solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.15pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>MF</span></p>
  </td>
  <td width=32 style='width:24.35pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.15pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>0</span></p>
  </td>
  <td width=32 style='width:24.35pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.15pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>0</span></p>
  </td>
  <td width=32 style='width:24.35pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.15pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>0</span></p>
  </td>
  <td width=32 style='width:24.35pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.15pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>1</span></p>
  </td>
  <td width=38 style='width:28.55pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.15pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>0</span></p>
  </td>
  <td width=39 style='width:29.05pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.15pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>1</span></p>
  </td>
  <td width=216 style='width:161.65pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.15pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  style='font-size:10.5pt;font-family:华文中宋'>写数据命令码：<span lang=EN-US>0xC5</span>（<span
  lang=EN-US>MT=MF=1</span>）</span></p>
  </td>
 </tr>
 <tr style='height:14.55pt'>
  <td width=28 style='width:21.35pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;background:
  #CCCCCC;padding:0cm 0cm 0cm 0cm;height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>1</span></p>
  </td>
  <td width=35 style='width:25.9pt;border-top:none;border-left:none;border-bottom:
  solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>0</span></p>
  </td>
  <td width=34 style='width:25.3pt;border-top:none;border-left:none;border-bottom:
  solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>0</span></p>
  </td>
  <td width=32 style='width:24.35pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>0</span></p>
  </td>
  <td width=32 style='width:24.35pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>0</span></p>
  </td>
  <td width=32 style='width:24.35pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>0</span></p>
  </td>
  <td width=32 style='width:24.35pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>0</span></p>
  </td>
  <td width=38 style='width:28.55pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>US1</span></p>
  </td>
  <td width=39 style='width:29.05pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>US2</span></p>
  </td>
  <td width=216 style='width:161.65pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>驱动器号。</span></p>
  </td>
 </tr>
 <tr style='height:14.55pt'>
  <td width=28 style='width:21.35pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;background:
  #CCCCCC;padding:0cm 0cm 0cm 0cm;height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>2</span></p>
  </td>
  <td width=275 colspan=8 style='width:206.2pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>C</span></p>
  </td>
  <td width=216 style='width:161.65pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>磁道号</span></p>
  </td>
 </tr>
 <tr style='height:14.55pt'>
  <td width=28 style='width:21.35pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;background:
  #CCCCCC;padding:0cm 0cm 0cm 0cm;height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>3</span></p>
  </td>
  <td width=275 colspan=8 style='width:206.2pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>H</span></p>
  </td>
  <td width=216 style='width:161.65pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>磁头号</span></p>
  </td>
 </tr>
 <tr style='height:14.55pt'>
  <td width=28 style='width:21.35pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;background:
  #CCCCCC;padding:0cm 0cm 0cm 0cm;height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>4</span></p>
  </td>
  <td width=275 colspan=8 style='width:206.2pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>R</span></p>
  </td>
  <td width=216 style='width:161.65pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>起始扇区号</span></p>
  </td>
 </tr>
 <tr style='height:14.55pt'>
  <td width=28 style='width:21.35pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;background:
  #CCCCCC;padding:0cm 0cm 0cm 0cm;height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>5</span></p>
  </td>
  <td width=275 colspan=8 style='width:206.2pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>N</span></p>
  </td>
  <td width=216 style='width:161.65pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>扇区字节数</span></p>
  </td>
 </tr>
 <tr style='height:14.65pt'>
  <td width=28 style='width:21.35pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;background:
  #CCCCCC;padding:0cm 0cm 0cm 0cm;height:14.65pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>6</span></p>
  </td>
  <td width=275 colspan=8 style='width:206.2pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:14.65pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>EOT</span></p>
  </td>
  <td width=216 style='width:161.65pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:14.65pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>磁道上最大扇区号</span></p>
  </td>
 </tr>
 <tr style='height:14.55pt'>
  <td width=28 style='width:21.35pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;background:
  #CCCCCC;padding:0cm 0cm 0cm 0cm;height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>7</span></p>
  </td>
  <td width=275 colspan=8 style='width:206.2pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>GPL</span></p>
  </td>
  <td width=216 style='width:161.65pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:14.55pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  style='font-size:10.5pt;font-family:华文中宋'>扇区之间间隔长度（<span lang=EN-US>3</span>）</span></p>
  </td>
 </tr>
 <tr style='height:15.05pt'>
  <td width=28 style='width:21.35pt;border-top:none;border-left:none;
  border-bottom:double black 1.0pt;border-right:solid black 1.0pt;background:
  #CCCCCC;padding:0cm 0cm 0cm 0cm;height:15.05pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>8</span></p>
  </td>
  <td width=275 colspan=8 style='width:206.2pt;border-top:none;border-left:
  none;border-bottom:double black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.05pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>DTL</span></p>
  </td>
  <td width=216 style='width:161.65pt;border-top:none;border-left:none;
  border-bottom:double black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.05pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>N=0</span><span
  style='font-size:10.5pt;font-family:华文中宋'>时，指定扇区字节数</span></p>
  </td>
 </tr>
 <tr style='height:15.5pt'>
  <td width=44 style='width:33.1pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:double black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.5pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>执行</span></p>
  </td>
  <td width=28 style='width:21.35pt;border-top:none;border-left:none;
  border-bottom:double black 1.0pt;border-right:solid black 1.0pt;background:
  #CCCCCC;padding:0cm 0cm 0cm 0cm;height:15.5pt'>
  <p class=TableParagraph align=center style='margin:0cm;margin-bottom:.0001pt;
  text-align:center'><span lang=EN-US style='font-size:10.0pt;font-family:华文中宋'>&nbsp;</span></p>
  </td>
  <td width=275 colspan=8 style='width:206.2pt;border-top:none;border-left:
  none;border-bottom:double black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.5pt'>
  <p class=TableParagraph align=center style='margin:0cm;margin-bottom:.0001pt;
  text-align:center'><span lang=EN-US style='font-size:10.0pt;font-family:华文中宋'>&nbsp;</span></p>
  </td>
  <td width=216 style='width:161.65pt;border-top:none;border-left:none;
  border-bottom:double black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.5pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  style='font-size:10.5pt;font-family:华文中宋'>数据从系统传送到磁盘</span></p>
  </td>
 </tr>
 <tr style='height:15.65pt'>
  <td width=44 rowspan=7 style='width:33.1pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:solid windowtext 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.65pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>结果</span></p>
  </td>
  <td width=28 style='width:21.35pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;background:
  #CCCCCC;padding:0cm 0cm 0cm 0cm;height:15.65pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>1</span></p>
  </td>
  <td width=275 colspan=8 style='width:206.2pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.65pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>ST0</span></p>
  </td>
  <td width=216 style='width:161.65pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.65pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>状态字节0</span></p>
  </td>
 </tr>
 <tr style='height:15.55pt'>
  <td width=28 style='width:21.35pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;background:
  #CCCCCC;padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>2</span></p>
  </td>
  <td width=275 colspan=8 style='width:206.2pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>ST1</span></p>
  </td>
  <td width=216 style='width:161.65pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>状态字节1</span></p>
  </td>
 </tr>
 <tr style='height:15.55pt'>
  <td width=28 style='width:21.35pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;background:
  #CCCCCC;padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>3</span></p>
  </td>
  <td width=275 colspan=8 style='width:206.2pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>ST2</span></p>
  </td>
  <td width=216 style='width:161.65pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>状态字节2</span></p>
  </td>
 </tr>
 <tr style='height:15.55pt'>
  <td width=28 style='width:21.35pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;background:
  #CCCCCC;padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>4</span></p>
  </td>
  <td width=275 colspan=8 style='width:206.2pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>C</span></p>
  </td>
  <td width=216 style='width:161.65pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>磁道号</span></p>
  </td>
 </tr>
 <tr style='height:15.55pt'>
  <td width=28 style='width:21.35pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;background:
  #CCCCCC;padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>5</span></p>
  </td>
  <td width=275 colspan=8 style='width:206.2pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>H</span></p>
  </td>
  <td width=216 style='width:161.65pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>磁头号</span></p>
  </td>
 </tr>
 <tr style='height:15.55pt'>
  <td width=28 style='width:21.35pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;background:
  #CCCCCC;padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>6</span></p>
  </td>
  <td width=275 colspan=8 style='width:206.2pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>R</span></p>
  </td>
  <td width=216 style='width:161.65pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>扇区号</span></p>
  </td>
 </tr>
 <tr style='height:15.55pt'>
  <td width=28 style='width:21.35pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.5pt;border-right:solid black 1.0pt;
  background:#CCCCCC;padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>7</span></p>
  </td>
  <td width=275 colspan=8 style='width:206.2pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>N</span></p>
  </td>
  <td width=216 style='width:161.65pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.5pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>扇区字节数</span></p>
  </td>
 </tr>
</table>

</div>

<p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
style='font-family:华文中宋'>图（<span lang=EN-US>55</span>） 写扇区数据命令（<span
lang=EN-US>FD_WRITE</span>）</span></p>

<p class=MsoNormal style='line-height:150%'><span lang=EN-US style='font-family:
华文中宋'>&nbsp;</span></p>

<p class=MsoListParagraph style='margin-left:42.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
style='font-family:华文中宋'>检测中断状态命令（<span lang=EN-US>FD_SENSEI</span>）</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>发送该命令后软驱控制器会立刻返回常规结果<span lang=EN-US>1</span>和<span
lang=EN-US>2</span>（即状态<span lang=EN-US>ST0</span>和磁头所处磁道号<span lang=EN-US>PCN</span>）。它们是控制器执行上一条命令后的状态。通常在一个命令执行结束后会向<span
lang=EN-US>CPU</span>发出中断信号。对于读写扇区、读写磁道、读写删除标志、读标识场、格式化和扫描等命令以及非<span
lang=EN-US>DMA</span>传输方式下的命令引起的中断，可以直接根据主状态寄存器的标志知道中断原因。而对于驱动器就绪信号发生变化、寻道和重新校正（磁头回零道）而引起的中断，由于没有返回结果，就需要利用本命令来读取控制器执行命令后的状态信息。</span></p>

<div align=center>

<table class=TableNormal border=1 cellspacing=0 cellpadding=0 width=563
 style='width:422.3pt;border-collapse:collapse;border:none'>
 <tr style='height:15.55pt'>
  <td width=44 style='width:33.25pt;border-top:windowtext 1.5pt;border-left:
  windowtext 1.5pt;border-bottom:black 1.5pt;border-right:black 1.0pt;
  border-style:solid;padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>阶段</span></p>
  </td>
  <td width=28 style='width:21.35pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>序</span></p>
  </td>
  <td width=34 style='width:25.8pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>D7</span></p>
  </td>
  <td width=34 style='width:25.3pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>D6</span></p>
  </td>
  <td width=32 style='width:24.35pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>D5</span></p>
  </td>
  <td width=32 style='width:24.35pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>D4</span></p>
  </td>
  <td width=32 style='width:24.35pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-top:1.1pt;margin-right:
  6.75pt;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:
  center'><span lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>D3</span></p>
  </td>
  <td width=32 style='width:24.35pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-top:1.1pt;margin-right:
  6.75pt;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:
  center'><span lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>D2</span></p>
  </td>
  <td width=38 style='width:28.65pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>D1</span></p>
  </td>
  <td width=39 style='width:29.15pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>D0</span></p>
  </td>
  <td width=215 style='width:161.4pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>说明</span></p>
  </td>
 </tr>
 <tr style='height:15.5pt'>
  <td width=44 style='width:33.25pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:double black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.5pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>命令</span></p>
  </td>
  <td width=28 style='width:21.35pt;border-top:none;border-left:none;
  border-bottom:double black 1.0pt;border-right:solid black 1.0pt;background:
  #CCCCCC;padding:0cm 0cm 0cm 0cm;height:15.5pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>0</span></p>
  </td>
  <td width=34 style='width:25.8pt;border-top:none;border-left:none;border-bottom:
  double black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.5pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>0</span></p>
  </td>
  <td width=34 style='width:25.3pt;border-top:none;border-left:none;border-bottom:
  double black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.5pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>0</span></p>
  </td>
  <td width=32 style='width:24.35pt;border-top:none;border-left:none;
  border-bottom:double black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.5pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>0</span></p>
  </td>
  <td width=32 style='width:24.35pt;border-top:none;border-left:none;
  border-bottom:double black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.5pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>0</span></p>
  </td>
  <td width=32 style='width:24.35pt;border-top:none;border-left:none;
  border-bottom:double black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.5pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  7.6pt;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:
  center'><span lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>1</span></p>
  </td>
  <td width=32 style='width:24.35pt;border-top:none;border-left:none;
  border-bottom:double black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.5pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  7.55pt;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:
  center'><span lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>0</span></p>
  </td>
  <td width=38 style='width:28.65pt;border-top:none;border-left:none;
  border-bottom:double black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.5pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>0</span></p>
  </td>
  <td width=39 style='width:29.15pt;border-top:none;border-left:none;
  border-bottom:double black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.5pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>0</span></p>
  </td>
  <td width=215 style='width:161.4pt;border-top:none;border-left:none;
  border-bottom:double black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.5pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  style='font-size:10.5pt;font-family:华文中宋'>检测中断状态命令码：<span lang=EN-US>0x08</span></span></p>
  </td>
 </tr>
 <tr style='height:15.65pt'>
  <td width=44 style='width:33.25pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:double black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.65pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>执行</span></p>
  </td>
  <td width=28 style='width:21.35pt;border-top:none;border-left:none;
  border-bottom:double black 1.0pt;border-right:solid black 1.0pt;background:
  #CCCCCC;padding:0cm 0cm 0cm 0cm;height:15.65pt'>
  <p class=TableParagraph align=center style='margin:0cm;margin-bottom:.0001pt;
  text-align:center'><span lang=EN-US style='font-size:10.0pt;font-family:华文中宋'>&nbsp;</span></p>
  </td>
  <td width=275 colspan=8 style='width:206.3pt;border-top:none;border-left:
  none;border-bottom:double black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.65pt'>
  <p class=TableParagraph align=center style='margin:0cm;margin-bottom:.0001pt;
  text-align:center'><span lang=EN-US style='font-size:10.0pt;font-family:华文中宋'>&nbsp;</span></p>
  </td>
  <td width=215 style='width:161.4pt;border-top:none;border-left:none;
  border-bottom:double black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.65pt'>
  <p class=TableParagraph align=center style='margin:0cm;margin-bottom:.0001pt;
  text-align:center'><span lang=EN-US style='font-size:10.0pt;font-family:华文中宋'>&nbsp;</span></p>
  </td>
 </tr>
 <tr style='height:15.55pt'>
  <td width=44 rowspan=2 style='width:33.25pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:solid windowtext 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-top:8.4pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>结果</span></p>
  </td>
  <td width=28 style='width:21.35pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;background:
  #CCCCCC;padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>1</span></p>
  </td>
  <td width=275 colspan=8 style='width:206.3pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>ST0</span></p>
  </td>
  <td width=215 style='width:161.4pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>状态字节0</span></p>
  </td>
 </tr>
 <tr style='height:15.65pt'>
  <td width=28 style='width:21.35pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.5pt;border-right:solid black 1.0pt;
  background:#CCCCCC;padding:0cm 0cm 0cm 0cm;height:15.65pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>2</span></p>
  </td>
  <td width=275 colspan=8 style='width:206.3pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.65pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>C</span></p>
  </td>
  <td width=215 style='width:161.4pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.5pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.65pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>磁头所在磁道号</span></p>
  </td>
 </tr>
</table>

</div>

<p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
style='font-family:华文中宋'>图（<span lang=EN-US>56</span>） 检测中断状态命令（<span
lang=EN-US>FD_SENSEI</span>）</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>

<p class=MsoListParagraph align=left style='margin-left:41.95pt;text-align:
left;text-indent:-21.0pt;line-height:150%'><span lang=EN-US style='font-family:
Wingdings'>l<span style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
style='font-family:华文中宋'>设定驱动器参数命令（<span lang=EN-US>FD_SPECIFY</span>）</span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt;
line-height:150%'><span style='font-family:华文中宋'>该命令用于设定软盘控制器内部的三个定时器初始值和选择传输方式，即把驱动器马达步进速率（<span
lang=EN-US>STR</span>）、磁头加载<span lang=EN-US>/</span>卸载（<span lang=EN-US>HLT/HUT</span>）时间和是否采用<span
lang=EN-US>DMA</span>方式来传输数据的信息送入软驱控制器。</span></p>

<div align=center>

<table class=TableNormal border=1 cellspacing=0 cellpadding=0 width=563
 style='width:422.35pt;border-collapse:collapse;border:none'>
 <tr style='height:15.55pt'>
  <td width=44 style='width:33.0pt;border-top:windowtext 1.5pt;border-left:
  windowtext 1.5pt;border-bottom:black 1.5pt;border-right:black 1.0pt;
  border-style:solid;padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>阶段</span></p>
  </td>
  <td width=28 style='width:21.35pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>序</span></p>
  </td>
  <td width=34 style='width:25.8pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>D7</span></p>
  </td>
  <td width=34 style='width:25.2pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>D6</span></p>
  </td>
  <td width=32 style='width:24.35pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>D5</span></p>
  </td>
  <td width=32 style='width:24.25pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>D4</span></p>
  </td>
  <td width=32 style='width:24.35pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>D3</span></p>
  </td>
  <td width=32 style='width:24.25pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-top:1.1pt;margin-right:
  6.75pt;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:
  center'><span lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>D2</span></p>
  </td>
  <td width=38 style='width:28.55pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>D1</span></p>
  </td>
  <td width=39 style='width:29.5pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>D0</span></p>
  </td>
  <td width=216 style='width:161.75pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.55pt'>
  <p class=TableParagraph align=center style='margin-left:0cm;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>说明</span></p>
  </td>
 </tr>
 <tr style='height:15.05pt'>
  <td width=44 rowspan=3 style='width:33.0pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:double black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.05pt'>
  <p class=TableParagraph align=center style='margin:0cm;margin-bottom:.0001pt;
  text-align:center'><span lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>命令</span></p>
  </td>
  <td width=28 style='width:21.35pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;background:
  #CCCCCC;padding:0cm 0cm 0cm 0cm;height:15.05pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>0</span></p>
  </td>
  <td width=34 style='width:25.8pt;border-top:none;border-left:none;border-bottom:
  solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.05pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>0</span></p>
  </td>
  <td width=34 style='width:25.2pt;border-top:none;border-left:none;border-bottom:
  solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.05pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>0</span></p>
  </td>
  <td width=32 style='width:24.35pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.05pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>0</span></p>
  </td>
  <td width=32 style='width:24.25pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.05pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>0</span></p>
  </td>
  <td width=32 style='width:24.35pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.05pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>0</span></p>
  </td>
  <td width=32 style='width:24.25pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.05pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  7.55pt;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:
  center'><span lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>0</span></p>
  </td>
  <td width=38 style='width:28.55pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.05pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>1</span></p>
  </td>
  <td width=39 style='width:29.5pt;border-top:none;border-left:none;border-bottom:
  solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.05pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>1</span></p>
  </td>
  <td width=216 style='width:161.75pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.05pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>设定参数命令码：0x03</span></p>
  </td>
 </tr>
 <tr style='height:14.7pt'>
  <td width=28 style='width:21.35pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;background:
  #CCCCCC;padding:0cm 0cm 0cm 0cm;height:14.7pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>1</span></p>
  </td>
  <td width=133 colspan=4 style='width:99.6pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:14.7pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>SRT（单位2ms）</span></p>
  </td>
  <td width=142 colspan=4 style='width:106.65pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:14.7pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>HUT（单位32ms）</span></p>
  </td>
  <td width=216 style='width:161.75pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:14.7pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  style='font-size:10.5pt;font-family:华文中宋'>马达步进速率、磁头卸载时间</span></p>
  </td>
 </tr>
 <tr style='height:15.05pt'>
  <td width=28 style='width:21.35pt;border-top:none;border-left:none;
  border-bottom:double black 1.0pt;border-right:solid black 1.0pt;background:
  #CCCCCC;padding:0cm 0cm 0cm 0cm;height:15.05pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>2</span></p>
  </td>
  <td width=236 colspan=7 style='width:176.75pt;border-top:none;border-left:
  none;border-bottom:double black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.05pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>HLT（单位4ms）</span></p>
  </td>
  <td width=39 style='width:29.5pt;border-top:none;border-left:none;border-bottom:
  double black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.05pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>ND</span></p>
  </td>
  <td width=216 style='width:161.75pt;border-top:none;border-left:none;
  border-bottom:double black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.05pt'>
  <p class=TableParagraph align=center style='margin-top:.6pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  style='font-size:10.5pt;font-family:华文中宋'>磁头加载时间、非<span lang=EN-US>DMA</span>方式</span></p>
  </td>
 </tr>
 <tr style='height:15.5pt'>
  <td width=44 style='width:33.0pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:double black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;
  height:15.5pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>执行</span></p>
  </td>
  <td width=28 style='width:21.35pt;border-top:none;border-left:none;
  border-bottom:double black 1.0pt;border-right:solid black 1.0pt;background:
  #CCCCCC;padding:0cm 0cm 0cm 0cm;height:15.5pt'>
  <p class=TableParagraph align=center style='margin:0cm;margin-bottom:.0001pt;
  text-align:center'><span lang=EN-US style='font-size:10.0pt;font-family:华文中宋'>&nbsp;</span></p>
  </td>
  <td width=275 colspan=8 style='width:206.25pt;border-top:none;border-left:
  none;border-bottom:double black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.5pt'>
  <p class=TableParagraph align=center style='margin:0cm;margin-bottom:.0001pt;
  text-align:center'><span lang=EN-US style='font-size:10.0pt;font-family:华文中宋'>&nbsp;</span></p>
  </td>
  <td width=216 style='width:161.75pt;border-top:none;border-left:none;
  border-bottom:double black 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.5pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  style='font-size:10.5pt;font-family:华文中宋'>设置控制器，不发生中断</span></p>
  </td>
 </tr>
 <tr style='height:15.65pt'>
  <td width=44 style='width:33.0pt;border-top:none;border-left:solid windowtext 1.5pt;
  border-bottom:solid windowtext 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.65pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>结果</span></p>
  </td>
  <td width=28 style='width:21.35pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.5pt;border-right:solid black 1.0pt;
  background:#CCCCCC;padding:0cm 0cm 0cm 0cm;height:15.65pt'>
  <p class=TableParagraph align=center style='margin:0cm;margin-bottom:.0001pt;
  text-align:center'><span lang=EN-US style='font-size:10.0pt;font-family:华文中宋'>&nbsp;</span></p>
  </td>
  <td width=275 colspan=8 style='width:206.25pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:15.65pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>无</span></p>
  </td>
  <td width=216 style='width:161.75pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.5pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:15.65pt'>
  <p class=TableParagraph align=center style='margin-top:1.2pt;margin-right:
  0cm;margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;font-family:华文中宋'>无</span></p>
  </td>
 </tr>
</table>

</div>

<p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
style='font-family:华文中宋'>图（<span lang=EN-US>57</span>） 设定驱动器参数命令（<span
lang=EN-US>FD_SPECIFY</span>）</span></p>

<p class=MsoListParagraph style='margin-left:42.0pt;text-indent:0cm'><span
lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>

<p class=MsoListParagraph style='margin-left:42.0pt;text-indent:-42.0pt;
line-height:150%'><span lang=EN-US style='font-family:华文中宋'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span>iii.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='font-family:华文中宋'>软盘控制器编程方法</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>在<span lang=EN-US>PC</span>机中，软盘控制器一般采用与<span
lang=EN-US>NEC PD765</span>或<span lang=EN-US>Intel 8287A</span>兼容的芯片，例如<span
lang=EN-US>Intel</span>的<span lang=EN-US>82078</span>。由于软盘的驱动程序比较复杂，因此下面对这类芯片构成的软盘控制器的编程方法进行较为详细的介绍。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>典型的磁盘操作不仅仅包括发送命令和等待控制器返回结果，的软盘驱动器的控制是一种低级操作，它需要程序在不同阶段对其执行状况进行干涉。</span></p>

<p class=MsoListParagraph style='margin-left:42.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
style='font-family:华文中宋'>命令与结果阶段的交互</span></p>

<p class=MsoListParagraph style='line-height:150%'><span style='font-family:
华文中宋'>在上述磁盘操作命令或参数发送到软盘控制器之前，必须首先查询控制器的主状态寄存器（<span lang=EN-US>MSR</span>），以获知驱动器的就绪状态和数据传输方向。软盘驱动程序中使用了一个<span
lang=EN-US>output_byte()</span>函数来专门实现该操作。该函数的程序框图如下所示。</span></p>

<p class=MsoNormal style='line-height:150%'><span lang=EN-US style='font-family:
华文中宋'><img width=597 height=257 src="/assets/source/OS/2020-08-09-OS_lab3.files/image029.png"></span></p>

<p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
style='font-family:华文中宋'>图（<span lang=EN-US>58</span>） 向软盘控制器发送命令或参数字节</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>根据该框图，可以写出这样的函数：</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#6A9955'>//
from:liunx floppy.c 447</span><span style='font-family:宋体;color:#6A9955'>行</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#569CD6'>static</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>void</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#DCDCAA'>output_byte</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>(</span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>char</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#9CDCFE'>byte</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>) </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>// </span><span style='font-family:
宋体;color:#6A9955'>用于</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>FDC</span><span style='font-family:宋体;color:#6A9955'>命令的输出，</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>FDC</span><span
style='font-family:宋体;color:#6A9955'>的每条命令需要确保上条命令已经完成</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>{</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>unsigned</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>char</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> status;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#C586C0'>if</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(reset)</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#C586C0'>return</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#C586C0'>for</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(</span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>int</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> counter = </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>0</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>; counter &lt; </span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>10000</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>; counter++)</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
{</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
status = </span><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>in_byte_delay</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(FD_STATUS) &amp; (STATUS_READY
| STATUS_DIR);</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#C586C0'>if</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(status == STATUS_READY)</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
{</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>out_byte</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(FD_DATA, byte);</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#C586C0'>return</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
}</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
}</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
reset = </span><span lang=EN-US style='font-family:Consolas;color:#B5CEA8'>1</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>printf_str</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(</span><span lang=EN-US
style='font-family:Consolas;color:#CE9178'>&quot;Unable to send byte to FDC</span><span
lang=EN-US style='font-family:Consolas;color:#D7BA7D'>\n</span><span
lang=EN-US style='font-family:Consolas;color:#CE9178'>&quot;</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>);</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>}</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>该函数一直循环到主状态寄存器的数据口就绪标志<span lang=EN-US>RQM</span>为<span
lang=EN-US>1</span>，并且方向标志<span lang=EN-US>DIO</span>是<span lang=EN-US>0</span>（<span
lang=EN-US>CPU</span>→<span lang=EN-US>FDC</span>），此时控制器就已准备好接受命令和参数字节。循环语句起超时计数功能，以应付控制器没有响应的情况。本驱动程序中把循环次数设置成了<span
lang=EN-US>10000</span>次。对这个循环次数的选择需要仔细，以避免程序作出不正确的超时判断。在<span lang=EN-US>Linux</span>内核版本<span
lang=EN-US>0.1x</span>至<span lang=EN-US>0.9x</span>中就经常会碰到需要调整这个循环次数的问题，因为当时人们所使用的<span
lang=EN-US>PC</span>机运行速度差别较大（<span lang=EN-US>16MHz - 40MHz</span>），因此循环所产生的实际延时也有很大的区别。这可以参见早期<span
lang=EN-US>Linux</span>的邮件列表中的许多文章。为了彻底解决这个问题，最好能使用系统硬件时钟来产生固定频率的延时值。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>对于读取控制器的结果字节串的结果阶段，也需要采取与发送命令相同的操作方法，只是此时数据传输方向标志要求是置位状态（<span
lang=EN-US>FDC</span>→<span lang=EN-US>CPU</span>）。本程序中对应的函数是<span lang=EN-US>result()</span>。该函数把读取的结果状态字节存放到了<span
lang=EN-US>reply_buffer[]</span>字节数组中。</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#569CD6'>static</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>int</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#DCDCAA'>result</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>()</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>{</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'>int</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> i = </span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, status;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#C586C0'>if</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(reset)</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#C586C0'>return</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> -</span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>1</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#C586C0'>for</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> (</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'>int</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> counter = </span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>; counter &lt; </span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>10000</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>; counter++)</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
{</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;status
= </span><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>in_byte_delay</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(FD_STATUS) &amp;
(STATUS_DIR | STATUS_READY | STATUS_BUSY);</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#C586C0'>if</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> (status == STATUS_READY)</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#C586C0'>return</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> i;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#C586C0'>if</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> (status == (STATUS_DIR |
STATUS_READY | STATUS_BUSY)) {</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#C586C0'>if</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> (i &gt;= MAX_REPLIES)</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#C586C0'>break</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#9CDCFE'>reply_buffer</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>[i++] = </span><span
lang=EN-US style='font-family:Consolas;color:#DCDCAA'>in_byte_delay</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(FD_DATA);</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;}</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
reset = </span><span lang=EN-US style='font-family:Consolas;color:#B5CEA8'>1</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#DCDCAA'>printf_str</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(</span><span lang=EN-US
style='font-family:Consolas;color:#CE9178'>&quot;Getstatus times out</span><span
lang=EN-US style='font-family:Consolas;color:#D7BA7D'>\n</span><span
lang=EN-US style='font-family:Consolas;color:#CE9178'>&quot;</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>);</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#C586C0'>return</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> -</span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>1</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>}</span></p>

<p class=MsoNormal style='line-height:150%'><span lang=EN-US style='font-family:
华文中宋'>&nbsp;</span></p>

<p class=MsoListParagraph style='margin-left:42.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
style='font-family:华文中宋'>软盘控制器初始化</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>对软盘控制器的初始化操作包括在控制器复位后对驱动器进行适当的参数配置。控制器复位操作是指对数字输出寄存器<span
lang=EN-US>DOR</span>的位<span lang=EN-US>2</span>（启动<span lang=EN-US>FDC</span>标志）置<span
lang=EN-US>0</span>然后再置<span lang=EN-US>1</span>。在机器复位之后，“指定驱动器参数”命令<span
lang=EN-US>SPECIFY</span>所设置的值就不再有效，需要重新建立。在<span lang=EN-US>floppy.c</span>程序中，复位操作在函数<span
lang=EN-US>reset_floppy()</span>和中断处理<span lang=EN-US>C</span>函数<span
lang=EN-US>reset_interrupt()</span>中。前一个函数用于修改<span lang=EN-US>DOR</span>寄存器的位<span
lang=EN-US>2</span>，让控制器复位，后一个函数用于在控制器复位后使用<span lang=EN-US>SPECIFY</span>命令重新建立控制器中的驱动器参数。在数据传输准备阶段，若判断出与实际的磁盘规格不同，
还在传输函数<span lang=EN-US>transfer()</span>开始处对其另行进行重新设置。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>在控制器复位后，还应该向数字控制寄存器<span lang=EN-US>DCR</span>发送指定的传输速率值，以重新初始化数据传输速率。如果机器执行了复位操作（例如热启动），则数据传输速率会变成默认值<span
lang=EN-US>250Kpbs</span>。但通过数字输出寄存器<span lang=EN-US>DOR</span>向控制器发出的复位操作并不会影响设置的数据传输速率。</span></p>

<p class=MsoNormal><span lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>

<p class=MsoListParagraph style='margin-left:42.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
style='font-family:华文中宋'>驱动器重新校正和磁头寻道</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>驱动器重新校正（<span lang=EN-US>FD_RECALIBRATE</span>）和磁头寻道<span
lang=EN-US>(FD_SEEK)</span>是两个磁头定位命令。重新校正命令让磁头移动到零磁道，而磁头寻道命令则让磁头移动到指定的磁道上。这两个磁头定位命令与典型的读<span
lang=EN-US>/</span>写命令不同，因为它们没有结果阶段。一旦发出这两个命令之一，控制器将立刻会在主状态寄存器（<span
lang=EN-US>MSR</span>）返回就绪状态，并以后台形式执行磁头定位操作。当定位操作完成后，控制器就会产生中断以请求服务。此时就应该发送一个“检测中断状态”
命令，以结束中断和读取定位操作后的状态。由于驱动器和马达启动信号是直接由数字输出寄存器（<span lang=EN-US>DOR</span>）控制的，因此，如果驱动器或马达还没有启动，那么写<span
lang=EN-US>DOR</span>的操作必须在发出定位命令之前进行。流程图如下图所示：</span></p>

<p class=MsoNormal style='line-height:150%'><span lang=EN-US style='font-family:
华文中宋'><img width=595 height=309 src="/assets/source/OS/2020-08-09-OS_lab3.files/image030.png"></span></p>

<p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
style='font-family:华文中宋'>图（<span lang=EN-US>59</span>） 重新校正和寻道操作</span></p>

<p class=MsoNormal style='line-height:150%'><span lang=EN-US style='font-family:
华文中宋'>&nbsp;</span></p>

<p class=MsoListParagraph style='margin-left:42.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
style='font-family:华文中宋'>数据读<span lang=EN-US>/</span>写操作</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>数据读或写操作需要分几步来完成。首先驱动器马达需要开启，并把磁头定位到正确的磁道上，然后初始化<span
lang=EN-US>DMA</span>控制器，最后发送数据读或写命令。另外，还需要定出发生错误时的处理方案。典型的操作流程图见下图所示：</span></p>

<p class=MsoNormal style='line-height:150%'><span lang=EN-US style='font-family:
华文中宋'><img width=626 height=474 src="/assets/source/OS/2020-08-09-OS_lab3.files/image031.png"></span></p>

<p class=MsoNormal align=center style='text-align:center;line-height:150%'><a
name="_Hlk10945435"><span style='font-family:华文中宋'>图（<span lang=EN-US>60</span>）
数据读<span lang=EN-US>/</span>写操作流程图</span></a></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>在对磁盘进行数据传输之前，磁盘驱动器的马达必须首先达到正常的运转速度。对于大多数<span
lang=EN-US>3.5</span>英寸软驱来讲，这段启动时间大约需要<span lang=EN-US>300ms</span>，而<span
lang=EN-US>5.5</span>英寸的软驱则需要大约<span lang=EN-US>500ms</span>。在<span lang=EN-US>floppy.c</span>程序中将这个启动延迟时间设置成了<span
lang=EN-US>500ms</span>。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>在马达启动后，就需要使用数字控制寄存器<span lang=EN-US>DCR</span>设置与当前磁盘介质匹配的数据传输率。如果隐式寻道方式没有开启，接下来就需要发送寻道命令<span
lang=EN-US>FD_SEEK</span>，把磁头定位到正确的磁道上。在寻道操作结束后，磁头还需要花费一段到位（加载）时间。对于大多数驱动器， 这段延迟时间起码需要<span
lang=EN-US>15ms</span>。当使用了隐式寻道方式，那么就可以使用“指定驱动器参数” 命令指定的磁头加载时间（<span
lang=EN-US>HLT</span>）来确定最小磁头到位时间。例如在数据传输速率为<span lang=EN-US>500Kbps</span>的情况下，若<span
lang=EN-US>HLT=8</span>，则有效磁头到位时间是<span lang=EN-US>16ms</span>。当然，如果磁头已经在正确的磁道上到位了，也就无须确保这个到位时间了。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>然后对<span lang=EN-US>DMA</span>控制器进行初始化操作，读写命令也随即执行。通常，在数据传输完成后，<span
lang=EN-US>DMA</span>控制器会发出终止计数（<span lang=EN-US>TC</span>）信号，此时软盘控制器就会完成当前数据传输并发出中断请求信号，表明操作已到达结果阶段。如果在操作过程中出现错误或者最后一个扇区号等于磁道最后一个扇区（<span
lang=EN-US>EOT</span>），那么软盘控制器也会马上进入结果阶段。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>根据上面流程图，如果在读取结果状态字节后发现错误，则会通过重新初始化<span lang=EN-US>DMA</span>控制器，再尝试重新开始执行数据读或写操作命令。持续的错误通常表明寻道操作并没有让磁头到达指定的磁道，此时应该多次重复对磁头执行重新校准，并再次执行寻道操作。若此后还是出错，则最终控制器就会向驱动程序报告读写操作失败。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:11.0pt'><span
lang=EN-US>&nbsp;</span></p>

<p class=4 style='margin-left:21.0pt;text-indent:-21.0pt'><a name="_Toc10938204"></a><a
name="_Toc10655608"></a><a name="_Toc10252894"></a><a name="_Toc10138947"><b><span
lang=EN-US>4)<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></b><b>文件系统驱动</b></a></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><a
name="_Hlk10940553"><span style='font-family:华文中宋'>本部分对应源代码“<span lang=EN-US>include\fat12.h</span>”。</span></a></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>目前<span lang=EN-US>lsyOS</span>的文件驱动并不是一个完善的文件驱动，从驱动的头文件名便可看出是仅支持<span
lang=EN-US>FAT12</span>文件系统的驱动程序。既然驱动基于<span lang=EN-US>FAT12</span>实现，此处便不再赘述原理，仅用表格形式解释其中的结构体与函数。</span></p>

<div align=center>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=47 valign=top style='width:35.2pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>序号</span></p>
  </td>
  <td width=506 valign=top style='width:379.6pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid windowtext 1.0pt;border-right:none;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>结构体或函数声明及描述</span></p>
  </td>
 </tr>
 <tr>
  <td width=47 style='width:35.2pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>1</span></p>
  </td>
  <td width=506 valign=top style='width:379.6pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='line-height:150%'><span lang=EN-US
  style='font-family:华文中宋'>struct root_entry {}</span></p>
  <p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
  style='font-family:华文中宋'>描述根目录区条目内容的结构体。</span></p>
  </td>
 </tr>
 <tr>
  <td width=47 style='width:35.2pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>2</span></p>
  </td>
  <td width=506 valign=top style='width:379.6pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='line-height:150%'><span lang=EN-US
  style='font-family:华文中宋'>unsigned char *get_file_extname(unsigned char
  *file_name)</span></p>
  <p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
  style='font-family:华文中宋'>从完整的文件名中分离出文件名和扩展名，原先的<span lang=EN-US>&quot;.&quot;</span>处将会被修改为<span
  lang=EN-US>&quot;\0&quot;</span>。</span></p>
  </td>
 </tr>
 <tr>
  <td width=47 style='width:35.2pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>3</span></p>
  </td>
  <td width=506 valign=top style='width:379.6pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='line-height:150%'><span lang=EN-US
  style='font-family:华文中宋'>static bool strcasecmp_file_name(const char
  *entry_file_name,</span></p>
  <p class=MsoNormal style='line-height:150%'><span lang=EN-US
  style='font-family:华文中宋'>const char *file_name, const int file_name_len)</span></p>
  <p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
  style='font-family:华文中宋'>忽略大小写的比较字符串，用于比较文件名或扩展名是否相同。若二者相同返回<span lang=EN-US>true</span>，否则返回<span
  lang=EN-US>false</span>。</span></p>
  <p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
  style='font-family:华文中宋'>其中，<span lang=EN-US>entry_file_name</span>表示条目中以空格结尾的最大长度为<span
  lang=EN-US>file_name_len</span>的文件名，<span lang=EN-US>file_name</span>是一个正常的以空字符结尾的文件名字符串。</span></p>
  </td>
 </tr>
 <tr>
  <td width=47 style='width:35.2pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.5pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>4</span></p>
  </td>
  <td width=506 valign=top style='width:379.6pt;border:none;border-bottom:solid windowtext 1.5pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='line-height:150%'><span lang=EN-US
  style='font-family:华文中宋'>bool read_file_by_name</span></p>
  <p class=MsoNormal style='line-height:150%'><span lang=EN-US
  style='font-family:华文中宋'>(unsigned char *file_name, unsigned char *file_extname,
  char *buf)</span></p>
  <p class=MsoNormal style='line-height:150%'><span style='font-family:华文中宋'>将文件名为<span
  lang=EN-US>file_name</span>，扩展名为<span lang=EN-US>file_extname</span>的文件从软盘中读入<span
  lang=EN-US>buf</span>，成功返回<span lang=EN-US>true</span>，失败返回<span lang=EN-US>false</span>。</span></p>
  </td>
 </tr>
</table>

</div>

<p class=MsoNormal><a name="_Toc10938205"></a><a name="_Toc10748870"></a><a
name="_Toc10655609"></a><a name="_Toc10252895"></a><a name="_Toc10138949"></a><a
name="_Toc9694034"></a><a name="_Toc9550140"></a><a name="_Toc9539610"></a><a
name="_Toc9539573"></a><a name="_Toc9539538"></a><a name="_Toc9342829"></a><a
name="_Toc9342635"><span lang=EN-US>&nbsp;</span></a></p>

<p class=3 style='margin-left:0cm;text-indent:0cm'><span lang=EN-US>10.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span>终端与shell</p>

<p class=4 style='margin-left:21.0pt;text-indent:-21.0pt'><a name="_Toc10938206"></a><a
name="_Toc10655610"><b><span lang=EN-US>1)<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;
</span></span></b><b>终端</b></a></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>本部分对应源代码“<span lang=EN-US>include\terminal.h</span>”。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>终端是一个可视化的命令输入界面，用于提供一个命令的输入输出环境，它将用户输入的命令送给<span
lang=EN-US>shell</span>解析，并把命令的执行结果在屏幕中显示出来。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>我们的终端采用<span lang=EN-US>Liunx</span>风格的提示语，即“计算机名<span
lang=EN-US>@</span>用户名<span lang=EN-US>:~</span>当前文件路径 <span lang=EN-US>$</span>”的格式，于是可以编写<span
lang=EN-US>print_user_info()</span>函数，用于显示提示语。</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#569CD6'>static</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>void</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#DCDCAA'>print_user_info</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>()</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>{</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>printf_str_with_colour</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(</span><span lang=EN-US
style='font-family:Consolas;color:#CE9178'>&quot;lsyOS@LSY&quot;</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>, </span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0x0A</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>); </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>// 0x0A</span><span
style='font-family:宋体;color:#6A9955'>：浅绿</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>printf_char</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(</span><span lang=EN-US
style='font-family:Consolas;color:#CE9178'>':'</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>);</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>printf_char_with_colour</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(</span><span lang=EN-US
style='font-family:Consolas;color:#CE9178'>'~'</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>, </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>0x09</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>); </span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>// 0x09</span><span
style='font-family:宋体;color:#6A9955'>：浅蓝</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>printf_str</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(</span><span lang=EN-US
style='font-family:Consolas;color:#CE9178'>&quot;$ &quot;</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>);</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>}</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>前面说过，当内核被初始化时，会调用<span lang=EN-US>init_terminal()</span>函数初始化终端，而这个初始化的过程其实很简单，只是调用<span
lang=EN-US>print_user_info()</span>打印一个最初的提示信息罢了。</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#569CD6'>void</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#DCDCAA'>init_terminal</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>()</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>{</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>print_user_info</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>();</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>}</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>接下来的<span lang=EN-US>key_process()</span>函数由时钟中断引发的键盘驱动中的<span
lang=EN-US>keyboard_read()</span>函数调用，用于对缓冲区中的字符进行处理，处理方式分为<span lang=EN-US>3</span>类：</span></p>

<p class=MsoListParagraph style='margin-left:42.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
style='font-family:华文中宋'>若当前处理的字符为可打印字符且当前字符缓冲区未满，将该字符加入缓冲区，并在屏幕上打印该字符；</span></p>

<p class=MsoListParagraph style='margin-left:42.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
style='font-family:华文中宋'>若当前处理的字符为回车符，则将缓冲区指针位置的字符标记为空字符终止符，而后进行一个换行操作，将缓冲区内容送至<span
lang=EN-US>shell</span>解析，清空字符缓冲区，打印新的提示信息；</span></p>

<p class=MsoListParagraph style='margin-left:42.0pt;text-indent:-21.0pt;
line-height:150%'><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
style='font-family:华文中宋'>若当前处理的字符为退格符且字符缓冲区非空，则将缓冲区指针位置的字符前移一位，且清除屏幕上的最后一个字符。</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#C586C0'>#define</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'> </span><span lang=EN-US
style='font-family:Consolas;color:#DCDCAA'>FLAG_EXT</span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0x0100</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#C586C0'>#define</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'> </span><span lang=EN-US
style='font-family:Consolas;color:#DCDCAA'>MASK_RAW</span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>&nbsp;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0x01FF</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#C586C0'>#define</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'> </span><span lang=EN-US
style='font-family:Consolas;color:#DCDCAA'>ENTER</span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(</span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0x03</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'> </span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>+</span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'> FLAG_EXT)&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>/*
Enter&nbsp;&nbsp;&nbsp;&nbsp;*/</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#C586C0'>#define</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'> </span><span lang=EN-US
style='font-family:Consolas;color:#DCDCAA'>BACKSPACE</span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>&nbsp;&nbsp;&nbsp;(</span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0x04</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'> </span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>+</span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'> FLAG_EXT)&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>/*
BackSpace&nbsp;&nbsp;&nbsp;&nbsp;*/</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#C586C0'>#define</span><span
lang=EN-US style='font-family:Consolas;color:#569CD6'> </span><span lang=EN-US
style='font-family:Consolas;color:#DCDCAA'>chr_buf_size</span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'> </span><span lang=EN-US
style='font-family:Consolas;color:#B5CEA8'>128</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#569CD6'>void</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><a
name="_Hlk10941440"><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>key_process</span></a><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(</span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>unsigned</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>int</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#9CDCFE'>key</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>)</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>{</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>static</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>unsigned</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#569CD6'>char</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'> </span><span lang=EN-US
style='font-family:Consolas;color:#9CDCFE'>char_buf</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>[chr_buf_size], *char_buf_ptr =
char_buf;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#C586C0'>if</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(!(key &amp; FLAG_EXT)) </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>// </span><span
style='font-family:宋体;color:#6A9955'>为可打印字符</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
{</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#C586C0'>if</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(char_buf_ptr - char_buf
&lt; chr_buf_size - </span><span lang=EN-US style='font-family:Consolas;
color:#B5CEA8'>1</span><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>)
</span><span lang=EN-US style='font-family:Consolas;color:#6A9955'>// </span><span
style='font-family:宋体;color:#6A9955'>字符缓冲区未满，</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>-1</span><span style='font-family:
宋体;color:#6A9955'>是为了留一个位置给</span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>'\0'</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
{</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
*char_buf_ptr = (</span><span lang=EN-US style='font-family:Consolas;
color:#569CD6'>unsigned</span><span lang=EN-US style='font-family:Consolas;
color:#D4D4D4'> </span><span lang=EN-US style='font-family:Consolas;color:#569CD6'>char</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>)(key &amp; </span><span
lang=EN-US style='font-family:Consolas;color:#B5CEA8'>0xff</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>);</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>printf_char</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(*char_buf_ptr++);</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
}</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
}</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#C586C0'>else</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
{</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#C586C0'>switch</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(key &amp; MASK_RAW)</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
{</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#C586C0'>case</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> ENTER:</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
*char_buf_ptr = </span><span lang=EN-US style='font-family:Consolas;color:#CE9178'>'</span><span
lang=EN-US style='font-family:Consolas;color:#D7BA7D'>\0</span><span
lang=EN-US style='font-family:Consolas;color:#CE9178'>'</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>printf_char</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(</span><span lang=EN-US
style='font-family:Consolas;color:#CE9178'>'</span><span lang=EN-US
style='font-family:Consolas;color:#D7BA7D'>\n</span><span lang=EN-US
style='font-family:Consolas;color:#CE9178'>'</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>);</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>command_process</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(char_buf); </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>// </span><span
style='font-family:宋体;color:#6A9955'>处理输入的命令</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
char_buf_ptr = char_buf; </span><span lang=EN-US style='font-family:Consolas;
color:#6A9955'>// </span><span style='font-family:宋体;color:#6A9955'>清空字符缓冲区</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>print_user_info</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(); </span><span
lang=EN-US style='font-family:Consolas;color:#6A9955'>// </span><span
style='font-family:宋体;color:#6A9955'>打印提示信息</span><span lang=EN-US
style='font-family:Consolas;color:#6A9955'>“lsyOS@LSY”</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#C586C0'>break</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#C586C0'>case</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'> BACKSPACE:</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#C586C0'>if</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(char_buf_ptr &gt;
char_buf) </span><span lang=EN-US style='font-family:Consolas;color:#6A9955'>//
</span><span style='font-family:宋体;color:#6A9955'>字符缓冲区不空</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
{</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
char_buf_ptr--; </span><span lang=EN-US style='font-family:Consolas;color:#6A9955'>//
</span><span style='font-family:宋体;color:#6A9955'>清除字符缓冲区当前位置的字符</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#DCDCAA'>printf_char</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>(</span><span lang=EN-US
style='font-family:Consolas;color:#CE9178'>'</span><span lang=EN-US
style='font-family:Consolas;color:#D7BA7D'>\b</span><span lang=EN-US
style='font-family:Consolas;color:#CE9178'>'</span><span lang=EN-US
style='font-family:Consolas;color:#D4D4D4'>);</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
}</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang=EN-US style='font-family:Consolas;color:#C586C0'>break</span><span
lang=EN-US style='font-family:Consolas;color:#D4D4D4'>;</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
}</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>&nbsp;&nbsp;&nbsp;
}</span></p>

<p class=MsoNormal align=left style='text-align:left;line-height:14.25pt;
background:#1E1E1E'><span lang=EN-US style='font-family:Consolas;color:#D4D4D4'>}</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>

<p class=4 style='margin-left:21.0pt;text-indent:-21.0pt'><a name="_Toc10938207"></a><a
name="_Toc10655611"><b><span lang=EN-US>2)<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;
</span></span></b><b><span lang=EN-US>shell</span></b></a></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>本部分对应源代码“<span lang=EN-US>include\shell.h</span>”。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>通常<span lang=EN-US>shell</span>是一个命令解释器，它解释由用户输入的命令并且把它们送到内核。但在我们的系统中，它作为内核的一部分，兼济着执行命令的功能。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>目前，<span lang=EN-US>shell</span>支持的命令如下表所示：</span></p>

<div align=center>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=47 style='width:35.2pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>序号</span></p>
  </td>
  <td width=66 style='width:49.85pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>命令</span></p>
  </td>
  <td width=66 style='width:49.65pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>参数</span></p>
  </td>
  <td width=373 style='width:280.1pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid windowtext 1.0pt;border-right:none;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>含义</span></p>
  </td>
 </tr>
 <tr>
  <td width=47 style='width:35.2pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>1</span></p>
  </td>
  <td width=66 style='width:49.85pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>ll</span></p>
  </td>
  <td width=66 style='width:49.65pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>无</span></p>
  </td>
  <td width=373 style='width:280.1pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>ls -l</span><span style='font-family:
  华文中宋'>的别名，列出当前文件夹下文件的详细信息</span></p>
  </td>
 </tr>
 <tr style='height:16.65pt'>
  <td width=47 rowspan=2 style='width:35.2pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt;height:16.65pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>2</span></p>
  </td>
  <td width=66 rowspan=2 style='width:49.85pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt;height:16.65pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>ls</span></p>
  </td>
  <td width=66 style='width:49.65pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt;height:16.65pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>无</span></p>
  </td>
  <td width=373 style='width:280.1pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt;height:16.65pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>列出当前文件夹下文件的信息</span></p>
  </td>
 </tr>
 <tr style='height:16.65pt'>
  <td width=66 style='width:49.65pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt;height:16.65pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>-l</span></p>
  </td>
  <td width=373 style='width:280.1pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt;height:16.65pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>列出当前文件夹下文件的详细信息</span></p>
  </td>
 </tr>
 <tr>
  <td width=47 style='width:35.2pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>3</span></p>
  </td>
  <td width=66 style='width:49.85pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>bat</span></p>
  </td>
  <td width=66 style='width:49.65pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>文件名</span></p>
  </td>
  <td width=373 style='width:280.1pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>执行批处理<span lang=EN-US>(*.bat)</span></span></p>
  </td>
 </tr>
 <tr>
  <td width=47 style='width:35.2pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>4</span></p>
  </td>
  <td width=66 style='width:49.85pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>exe</span></p>
  </td>
  <td width=66 style='width:49.65pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>文件名</span></p>
  </td>
  <td width=373 style='width:280.1pt;border:none;border-bottom:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>执行文件<span lang=EN-US>(*.lsy)</span></span></p>
  <p class=MsoListParagraph align=left style='margin-left:39.0pt;text-align:
  left;text-indent:-18.0pt;line-height:150%'><span lang=EN-US style='font-family:
  华文中宋'>★<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span><span
  style='font-family:华文中宋'>该指令后可接多个文件名，</span></p>
  <p class=MsoListParagraph align=left style='margin-left:39.0pt;text-align:
  left;text-indent:0cm;line-height:150%'><span style='font-family:华文中宋'>系统会依次执行相应文件</span></p>
  </td>
 </tr>
 <tr>
  <td width=47 style='width:35.2pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.5pt;border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>5</span></p>
  </td>
  <td width=66 style='width:49.85pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.5pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  lang=EN-US style='font-family:华文中宋'>clear</span></p>
  </td>
  <td width=66 style='width:49.65pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.5pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>无</span></p>
  </td>
  <td width=373 style='width:280.1pt;border:none;border-bottom:solid windowtext 1.5pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
  style='font-family:华文中宋'>清屏</span></p>
  </td>
 </tr>
</table>

</div>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=3 style='margin-left:0cm;text-indent:0cm'><a name="_Toc10938208"></a><a
name="_Toc10748871"></a><a name="_Toc10655612"></a><a name="_Toc10252896"></a><a
name="_Toc10138950"></a><a name="_Toc9550141"></a><a name="_Toc9694035"><span
lang=EN-US>11.<span style='font:7.0pt "Times New Roman"'>&nbsp; </span></span>lsyOS的编译、镜像制作</a><a
name="_Toc9694036">和运行测试示例</a></p>

<p class=4 style='margin-left:21.0pt;text-indent:-21.0pt'><b><span lang=EN-US>1)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></b><b><span
lang=EN-US>lsyOS</span>的编译</b></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>首先，分别编译用户程序、引导程序和内核：</span></p>

<div align=center>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
 style='background:#F2F2F2;border-collapse:collapse;border:none'>
 <tr>
  <td width=553 valign=top style='width:414.8pt;border:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span style='font-family:宋体'>编译用户程序（</span><span
  lang=EN-US>\user_program</span><span style='font-family:宋体'>）：</span></p>
  <p class=MsoNormal><span lang=EN-US>nasm -o letter.lsy letter.asm</span></p>
  <p class=MsoNormal><span lang=EN-US>nasm -o about.lsy about.asm</span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal><span style='font-family:宋体'>编译引导程序（</span><span
  lang=EN-US>\boot</span><span style='font-family:宋体'>）：</span></p>
  <p class=MsoNormal><span lang=EN-US>nasm -o boot boot.asm</span></p>
  <p class=MsoNormal><span lang=EN-US>nasm -o loader loader.asm</span></p>
  <p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>
  <p class=MsoNormal><span style='font-family:宋体'>编译内核：</span></p>
  <p class=MsoNormal><span lang=EN-US>nasm -f elf32 -o _start.o
  include/_start.asm</span></p>
  <p class=MsoNormal><span lang=EN-US>gcc -mgeneral-regs-only -O2 -m32 -c -o
  interrupt.o include/interrupt.c</span></p>
  <p class=MsoNormal><span lang=EN-US>gcc -O2 -m32 -c -o kernel.o
  include/kernel.c -fno-stack-protector -fno-builtin</span></p>
  <p class=MsoNormal><span lang=EN-US>ld -m elf_i386 -s -Ttext 0x21000 -o
  kernel _start.o interrupt.o kernel.o</span></p>
  </td>
 </tr>
</table>

</div>

<p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
style='font-family:华文中宋'>图（<span lang=EN-US>61</span>）<span lang=EN-US> lsyOS</span>的编译</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>因为目前我们普遍使用的是<span lang=EN-US>64</span>位系统，那么在编译时我们需要额外指定编译参数，以使编译器编译出<span
lang=EN-US>32</span>位的指令。对于<span lang=EN-US>nasm</span>，该参数为<span lang=EN-US>elf32</span>；对于<span
lang=EN-US>gcc</span>，该参数为<span lang=EN-US>-m32</span>；对于<span lang=EN-US>ld</span>，该参数为<span
lang=EN-US>elf_i386</span>。此外，我们在编译内核时使用参数<span lang=EN-US>-fno-stack-protector</span>关闭了堆栈检查，否则在<span
lang=EN-US>ld</span>时将无法成功链接目标文件。同时，因为我们的<span lang=EN-US>C</span>函数库是自己实现的，使用参数<span
lang=EN-US>-fno-builtin</span>可让编译器忽略与库函数名的重名检查。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>在<span lang=EN-US>ld</span>时，还使用了<span lang=EN-US>-Ttext
0x21000</span>参数，指定<span lang=EN-US>ELF</span>被加载到内存中后的地址为<span lang=EN-US>0x21000</span>，这是在二次引导程序<span
lang=EN-US>loader</span>中设定的内核被加载到内存中的起始地址。</span></p>

<p class=4 style='margin-left:21.0pt;text-indent:-21.0pt'><b><span lang=EN-US>2)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></b><b><span
lang=EN-US>lsyOS</span>的镜像制作</b></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>将二次引导程序<span lang=EN-US>loader</span>、内核<span
lang=EN-US>kernel</span>、测试用批处理<span lang=EN-US>command.bat</span>、用户程序<span
lang=EN-US>letter.lsy</span>和<span lang=EN-US>about.lsy</span>放入内核映像中，用<span
lang=EN-US>WinImage</span>保存。</span></p>

<table class=MsoTableGrid border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=553 valign=top style='width:414.8pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US><img
  width=285 height=162 id="图片 1" src="/assets/source/OS/2020-08-09-OS_lab3.files/image032.png"></span></p>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-family:华文中宋'>图（<span lang=EN-US>62</span>）<span lang=EN-US> lsyOS</span>镜像的制作</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>其中，批处理用于测试操作系统是否可以执行事先放在磁盘中的<span lang=EN-US>shell</span>指令，批处理的内容如下：</span></p>

<div align=center>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
 style='background:#F2F2F2;border-collapse:collapse;border:none'>
 <tr>
  <td width=113 valign=top style='width:84.8pt;border:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US>ll</span></p>
  <p class=MsoNormal><span lang=EN-US>ls</span></p>
  <p class=MsoNormal><span lang=EN-US>lsy test</span></p>
  <p class=MsoNormal><span lang=EN-US>ls -l</span></p>
  </td>
 </tr>
</table>

</div>

<p class=MsoNormal align=center style='text-align:center'><span
style='font-family:华文中宋'>图（<span lang=EN-US>63</span>） 批处理<span lang=EN-US>command.bat</span>的内容</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>批处理中的第三条指令“<span lang=EN-US>lsy test</span>”并不是一条合法的指令，因为<span
lang=EN-US>shell</span>中并不支持“<span lang=EN-US>lsy</span>”这个指令。这样写的目的在于测试<span
lang=EN-US>shell</span>对非法输入的健壮性。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>而用户程序<span lang=EN-US>letter.lsy</span>和<span
lang=EN-US>about.lsy</span>便是实验<span lang=EN-US>2</span>中完成的程序，前者是“字符碰撞”程序，后者是关于本系统的一些介绍。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>接着，使用自制的<span lang=EN-US>lsy_floopy_boot_replace</span>将<span
lang=EN-US>Winimage</span>默认的引导扇区替换为自己制作的引导扇区。</span></p>

<table class=MsoTableGrid border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=553 valign=top style='width:414.8pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><span lang=EN-US><img
  width=258 height=77 id="图片 281" src="/assets/source/OS/2020-08-09-OS_lab3.files/image033.png"></span></p>
  <p class=MsoNormal align=center style='text-align:center'><span
  style='font-family:华文中宋'>图（<span lang=EN-US>64</span>）<span lang=EN-US> lsyOS</span>镜像引导扇区的替换</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>也许你此时会产生疑问，明明一个批处理能做到的事情，为什么要自己编写程序实现呢？这是为了长远的规划着想，因为后续我们将完善<span
lang=EN-US>lsy_floopy_boot_replace</span>这个软件，使之可以对<span lang=EN-US>FAT12</span>镜像中的文件进行添加、删除等操作，逐步解除对<span
lang=EN-US>Winimage</span>的依赖。同时，可以利用在这个软件下的代码，稍作修改，放入我们的操作系统中，以使得现有的文件系统驱动更为完善。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>此时，<span lang=EN-US>lsyOS</span>的镜像便已制作完毕，可以利用虚拟机进行测试了。</span></p>

<p class=4 style='margin-left:21.0pt;text-indent:-21.0pt'><b><span lang=EN-US>3)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></b><b><span
lang=EN-US>lsyOS</span>的运行测试示例</b></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>启动虚拟机，进入系统，屏幕上如下显示：</span></p>

<p class=MsoNormal style='line-height:150%'><span lang=EN-US><img width=554
height=308 id="图片 283" src="/assets/source/OS/2020-08-09-OS_lab3.files/image034.png"></span></p>

<p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
style='font-family:华文中宋'>图（<span lang=EN-US>65</span>）<span lang=EN-US> lsyOS</span>启动界面</span>
</p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>映入眼帘的是左上角打印出的提示信息和右下角实时更新的时间。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>接下来，对<span lang=EN-US>shell</span>支持的命令进行逐个测试。</span></p>

<p class=MsoListParagraph style='margin-left:21.0pt;text-indent:-21.0pt;
text-autospace:none'><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
style='font-family:华文中宋'>任意输入的不存在的命令和空命令</span></p>

<p class=MsoNormal align=center style='text-align:center;line-height:150%;
text-autospace:none'><span lang=EN-US><img width=151 height=61 id="图片 289"
src="/assets/source/OS/2020-08-09-OS_lab3.files/image035.png"></span></p>

<p class=MsoNormal align=center style='text-align:center;line-height:150%'><span
style='font-family:华文中宋'>图（<span lang=EN-US>66</span>） </span><span
style='line-height:150%;font-family:华文中宋'>不存在的命令和空命令输入测试</span> </p>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt;
line-height:150%;text-autospace:none'><span style='line-height:150%;font-family:
华文中宋'>可以看出，当输入</span><span lang=EN-US style='line-height:150%;font-family:Consolas'>shell</span><span
style='line-height:150%;font-family:华文中宋'>中不存在的命令和空命令（直接回车）时，屏幕上会提示“</span><span
lang=EN-US style='line-height:150%;font-family:Consolas'>No command found</span><span
style='line-height:150%;font-family:华文中宋'>”，表明我们的</span><span lang=EN-US
style='line-height:150%;font-family:Consolas'>shell</span><span
style='line-height:150%;font-family:华文中宋'>对命令的解析具有一定的健壮性。</span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt;
text-autospace:none'><span lang=EN-US style='font-family:Consolas'>&nbsp;</span></p>

<p class=MsoListParagraph style='margin-left:21.0pt;text-indent:-21.0pt;
text-autospace:none'><span lang=EN-US style='font-family:Wingdings'>l<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span lang=EN-US
style='font-family:Consolas'>ll</span><span style='font-family:华文中宋'>和</span><span
lang=EN-US style='font-family:Consolas'>ls -l</span><span style='font-family:
华文中宋'>命令</span></p>

<p class=MsoNormal align=center style='text-align:center'><span lang=EN-US><img
width=326 height=166 id="图片 284" src="/assets/source/OS/2020-08-09-OS_lab3.files/image036.png"></span></p>

<p class=MsoNormal align=center style='text-align:center'><span
style='font-family:华文中宋'>图（<span lang=EN-US>67</span>） </span><span lang=EN-US
style='font-family:Consolas'>ll</span><span style='font-family:华文中宋'>和</span><span
lang=EN-US style='font-family:Consolas'>ls -l</span><span style='font-family:
华文中宋'>命令测试</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>可以看到，屏幕上打印了磁盘中所有文件的文件名、修改时间和大小。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>

<p class=MsoListParagraph style='margin-left:21.0pt;text-indent:-21.0pt;
line-height:150%;text-autospace:none'><span lang=EN-US style='line-height:150%;
font-family:Wingdings'>l<span style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
lang=EN-US style='line-height:150%;font-family:Consolas'>ls</span><span
style='line-height:150%;font-family:华文中宋'>命令</span></p>

<p class=MsoNormal align=center style='text-align:center;line-height:150%;
text-autospace:none'><span lang=EN-US><img width=487 height=63 id="图片 286"
src="/assets/source/OS/2020-08-09-OS_lab3.files/image037.png"></span></p>

<p class=MsoNormal align=center style='text-align:center'><span
style='font-family:华文中宋'>图（<span lang=EN-US>68</span>） </span><span lang=EN-US
style='font-family:Consolas'>ls</span><span style='font-family:华文中宋'>和</span><span
lang=EN-US style='font-family:Consolas'>ls</span><span style='font-family:华文中宋'>的错误参数命令测试</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>可以看到，当仅输入<span lang=EN-US>ls</span>时，屏幕上打印了磁盘中所有文件的文件名。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>而当用错误的<span lang=EN-US>ls</span>的参数“<span lang=EN-US>test</span>”作为错误输入测试时，将会提示“<span
lang=EN-US>test: Parameters of mismatched command ‘ls’</span>”。表明<span
lang=EN-US>ls</span>命令本身对参数的解析具有一定的健壮性。</span></p>

<p class=MsoNormal style='line-height:150%;text-autospace:none'><span
lang=EN-US style='line-height:150%;font-family:Consolas'>&nbsp;</span></p>

<p class=MsoListParagraph style='margin-left:21.0pt;text-indent:-21.0pt;
line-height:150%;text-autospace:none'><span lang=EN-US style='line-height:150%;
font-family:Wingdings'>l<span style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
lang=EN-US style='line-height:150%;font-family:Consolas'>bat</span><span
style='line-height:150%;font-family:华文中宋'>命令</span></p>

<p class=MsoNormal align=center style='text-align:center;line-height:150%;
text-autospace:none'><span lang=EN-US><img width=486 height=271 id="图片 291"
src="/assets/source/OS/2020-08-09-OS_lab3.files/image038.png"></span></p>

<p class=MsoNormal align=center style='text-align:center'><span
style='font-family:华文中宋'>图（<span lang=EN-US>69</span>） </span><span lang=EN-US
style='font-family:Consolas'>bat</span><span style='font-family:华文中宋'>命令测试</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>可以看到，当正确输入“<span lang=EN-US>bat command.bat</span>”时，系统依次执行了批处理文件中先前先前保存的<span
lang=EN-US>4</span>个命令，且用批处理执行的命令附带有蓝色字体的“<span lang=EN-US>Bat command</span>”提示。第三个非法指令也顺利通过了测试。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>而当用错误的非批处理文件“<span lang=EN-US>about.lsy</span>”的参数作为错误输入测试时，将会提示“<span
lang=EN-US>lsy: File format of mismatched command ‘bat’</span>”。表明<span
lang=EN-US>bat</span>命令本身对参数的解析具有一定的健壮性。</span></p>

<p class=MsoNormal align=center style='text-align:center;line-height:150%;
text-autospace:none'><span lang=EN-US style='line-height:150%;font-family:Consolas'>&nbsp;</span></p>

<p class=MsoListParagraph style='margin-left:21.0pt;text-indent:-21.0pt;
line-height:150%;text-autospace:none'><span lang=EN-US style='line-height:150%;
font-family:Wingdings'>l<span style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
lang=EN-US style='line-height:150%;font-family:Consolas'>exe</span><span
style='line-height:150%;font-family:华文中宋'>命令</span></p>

<p class=MsoNormal align=center style='text-align:center;line-height:150%;
text-autospace:none'><span lang=EN-US><img width=476 height=265 id="图片 293"
src="/assets/source/OS/2020-08-09-OS_lab3.files/image039.png"></span></p>

<p class=MsoNormal align=center style='text-align:center;line-height:150%;
text-autospace:none'><span lang=EN-US><img width=476 height=265 id="图片 294"
src="/assets/source/OS/2020-08-09-OS_lab3.files/image040.png"></span></p>

<p class=MsoNormal align=center style='text-align:center;line-height:150%;
text-autospace:none'><span lang=EN-US><img width=476 height=265 id="图片 296"
src="/assets/source/OS/2020-08-09-OS_lab3.files/image041.png"></span></p>

<p class=MsoNormal align=center style='text-align:center;text-autospace:none'><span
style='font-family:华文中宋'>图（<span lang=EN-US>70</span>） <span lang=EN-US>exe</span></span><span
style='font-family:华文中宋'>命令测试</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>当使用“<span lang=EN-US>exe about.lsy letter.lsy
about.lsy</span>”命令时，系统依次执行了<span lang=EN-US>about.lsy</span>、<span lang=EN-US>letter.lsy</span>和<span
lang=EN-US>about.lsy</span>。</span></p>

<p class=MsoListParagraph style='margin-left:21.0pt;text-indent:-21.0pt;
line-height:150%;text-autospace:none'><span lang=EN-US style='line-height:150%;
font-family:Wingdings'>l<span style='font:7.0pt "Times New Roman"'>&nbsp; </span></span><span
lang=EN-US style='line-height:150%;font-family:Consolas'>clear</span><span
style='line-height:150%;font-family:华文中宋'>命令</span></p>

<p class=MsoNormal style='line-height:150%;text-autospace:none'><span
lang=EN-US><img width=554 height=308 id="图片 297"
src="/assets/source/OS/2020-08-09-OS_lab3.files/image042.png"></span></p>

<p class=MsoNormal align=center style='text-align:center;line-height:150%;
text-autospace:none'><span style='font-family:华文中宋'>图（<span lang=EN-US>71</span>）
<span lang=EN-US>clear</span></span><span style='line-height:150%;font-family:
华文中宋'>命令执行前</span></p>

<p class=MsoNormal style='line-height:150%;text-autospace:none'><span
lang=EN-US><img width=554 height=308 id="图片 299"
src="/assets/source/OS/2020-08-09-OS_lab3.files/image043.png"></span></p>

<p class=MsoNormal align=center style='text-align:center;line-height:150%;
text-autospace:none'><span style='font-family:华文中宋'>图（<span lang=EN-US>72</span>）
<span lang=EN-US>clear</span></span><span style='line-height:150%;font-family:
华文中宋'>命令执行后</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>可以看到，使用“<span lang=EN-US>clear</span>”命令后，屏幕清空，重新打印了新的提示信息。</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
lang=EN-US style='font-family:华文中宋'>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:21.0pt;line-height:150%'><span
style='font-family:华文中宋'>至此，<span lang=EN-US>lsyOS</span>的运行测试便已结束。</span></p>

<p class=MsoNormal style='line-height:150%;text-autospace:none'><span
lang=EN-US style='line-height:150%;font-family:Consolas'>&nbsp;</span></p>

<p class=MsoNormal style='line-height:150%;text-autospace:none'><span
lang=EN-US style='line-height:150%;font-family:Consolas'>&nbsp;</span></p>

<p class=MsoNormal style='line-height:150%;text-autospace:none'><span
lang=EN-US style='line-height:150%;font-family:Consolas'>&nbsp;</span></p>

<p class=MsoSubtitle style='margin-left:0cm;text-indent:0cm'><a
name="_Toc10938209"></a><a name="_Toc10748872"></a><a name="_Toc10655613"></a><a
name="_Toc10252897"></a><a name="_Toc10138951"></a><a name="_Toc9694037"></a><a
name="_Toc9550142"></a><a name="_Toc9539611"></a><a name="_Toc9539574"></a><a
name="_Toc9539539"></a><a name="_Toc9342830"></a><a name="_Toc9342636"></a><a
name="_Toc9361269"></a><a name="_Toc9340661"></a><a name="_Toc9282828"></a><a
name="_Toc9270567"></a><a name="_Toc9103887"></a><a name="_Toc9103826">五、<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='font-family:华文中宋'>实验总结</span></a></p>

<p class=MsoNormal style='text-indent:21.05pt;line-height:150%;text-autospace:
none'><span style='line-height:150%;font-family:华文中宋'>唉，其实实验早就做完了，但写实验报告真的太耗时间了，算满一天24小时，前前后后至少花了15个整整24小时在上面，而且撰写实验报告的时间远远长于做操作系统的时间。深切地感受到，这样实验安排对保护模式确实不太友好。</span></p>

<p class=MsoNormal style='text-indent:21.05pt;line-height:150%;text-autospace:
none'><span style='line-height:150%;font-family:华文中宋'>由于本人从本实验开始，改做保护模式下的操作系统，那么前两个实验的许多成果便不可再用。并且在本实验中，若只是想实现一个实验要求，可能也得需要从底层键盘驱动、软盘驱动、文件系统驱动、中断服务子程序写起。</span></p>

<p class=MsoNormal style='text-indent:21.05pt;line-height:150%;text-autospace:
none'><span style='line-height:150%;font-family:华文中宋'>而且，本人想在自己的操作系统中创新性地采用几乎纯GCC编写。即，仅使用GCC+内联汇编完成操作系统内核的设计。这样的构思，意味着包括中断服务子程序的建立也要使用纯GCC完成。</span></p>

<p class=MsoNormal style='text-indent:21.05pt;line-height:150%;text-autospace:
none'><span style='line-height:150%;font-family:华文中宋'>而其中尤为重要的一点是，CPU跳入中断服务子程序前，除了通常函数调用会压入的cs、ip外，还会压入eflags，这也就意味着中断服务子程序若仍作为C语言中的一个普通函数，那么在它返回时会调用的是ret，而非把eflags也弹出的iret。如何把这个ret换成iret，便成了我制作过程中的一大难点。因为国内自己实现操作系统的人并不多，因而动手写操作系统方面的资料便比较少。纯GCC写操作系统的人更是搜寻不到相关信息，那么用GCC写中断服务子程序的教程更是没有了。于是，本人只能查阅GCC编译器的官方手册，才有了一些头绪。但很奇怪的是，我下载了一份最新的本地版手册，里面提到了在ARM、MIPS等架构下的中断编程，然而在有关X86和X86_64的内容中，却丝毫没有提到“中断”二字（当然，按事实来说应该是没有提到这个单词）。这又让我陷入了困境，甚至是一度陷入了僵局，我开始反思自己用纯GCC写内核的想法是否不太妥当，是否应该放弃，转向GCC+NASM的怀抱中。就这样，纠结了几天，依然没有任何进展。</span></p>

<p class=MsoNormal style='text-indent:21.05pt;line-height:150%;text-autospace:
none'><span style='line-height:150%;font-family:华文中宋'>然而，阴差阳错的是，我偶然又打开了原来下载GCC手册的页面，正是在这同一个GNU
GCC的手册页面上，我发现网页版的手册竟涵盖着使用GCC编写中断服务子程序的说明。于是，立刻地，我十分兴奋地按照说明编写了自己的中断服务子程序。但是，令人沮丧的是，CPU抛出了DOUBLE
FAULT的异常。虽然这一连串的挫折真的会一步步击垮人的心理防线，但操作系统的诱人之处还是吸引着我去解决问题。抛出异常，虽然不是我们想要的结果，但是至少证明了我们的中断服务子程序运行了，成功干扰了CPU的工作，因此，还是有一些令人兴奋的。接着，我学会了如何用bochs调试操作系统，而最后，也成功地解决了用纯GCC写中断服务子程序的问题。</span></p>

<p class=MsoNormal style='text-indent:21.05pt;line-height:150%;text-autospace:
none'><span style='line-height:150%;font-family:华文中宋'>虽然用从零开始研究用纯GCC写中断服务子程序是如此痛苦的事情，但这件事情还是带来了一定的好处的。例如，编译器会自动判断中断函数中哪一些寄存器的值会被修改，然后会在函数的开头保护这些寄存器的值。这就比自己用汇编写中断服务子程序时无脑pushad，或是用自己的逻辑思维考虑代码段改变了哪些寄存器的值，而后再手动保护相应的寄存器的方式在执行效率和开发效率上都要高一些。</span></p>

<p class=MsoNormal style='text-indent:21.05pt;line-height:150%;text-autospace:
none'><span style='line-height:150%;font-family:华文中宋'>当然GCC也不总是给人带来便利，还常常给人带来麻烦。因为我的代码中有许多的内联汇编形式下的内联函数，因而，为了使得编译器实现内联功能，我选择开启编译优化。但只要一开启O1优化，各种奇奇怪怪的问题就出现了，例如会导致编译失败，GCC提示“error:
unsupported size for integer register”，而关于这个报错的资料却少得可怜。经自己慢慢摸索，才知道其实导致这个问题的原因和编译器报错的文字信息几乎无关，是由于内联汇编内联到相应代码段后，由于原函数中编译器会“自作聪明地”将一些变量作为寄存器变量，这时候内联汇编代码中的使用的寄存器将与之冲突，使得编译器没有办法找到更多的寄存器来暂存数据，从而导致编译失败。这时，只要换用更高级别的优化，如O2优化，编译器就可以使用更少的寄存器来完成这些指令，从而避免了这个编译错误。</span></p>

<p class=MsoNormal style='text-indent:21.05pt;line-height:150%;text-autospace:
none'><span style='line-height:150%;font-family:华文中宋'>但使用O2优化后，更更古怪的事情发生了，例如我用内联汇编来实现这么一个C标准中定义的函数：int
strcmp(const char *src, const char *dst)，运行结果显示，在函数中修改的src指针的值竟然会对原指针产生影响，虽然这里是C语言，但用C++的说法便也就相当于把指针的引用传了进来。于是我只能放弃效率，改为相信编译优化，使用纯C语言来完成这个函数甚至其他许多函数的功能。</span></p>

<p class=MsoNormal style='text-indent:21.05pt;line-height:150%;text-autospace:
none'><span style='line-height:150%;font-family:华文中宋'>唉，当GCC内联函数遇上内联汇编，真是可以擦除奇妙的火花，遇上千年难遇的bug啊！编译优化竟能改变语意，不开高级别的编译优化居然无法通过编译！原先只是听说Liunx内核不开O2优化会产生编译错误，没想到这种事情在现在还如此渺小的lsyOS中也能遇到，也算是三生有幸了吧。</span></p>

<p class=MsoNormal style='text-indent:21.05pt;line-height:150%;text-autospace:
none'><span style='line-height:150%;font-family:华文中宋'>一个操作系统的诞生往往还需要经历九九八十一难，这些问题也只是劫难的开始，而远非结束。</span></p>

<p class=MsoNormal style='text-indent:21.05pt;line-height:150%;text-autospace:
none'><span style='line-height:150%;font-family:华文中宋'>随着操作系统功能的完善，与软盘驱动器的交互便显得尤为重要了。而保护模式下，无法直接再调用实模式下的BIOS中断，“读软盘”便成为了一件很麻烦的事情。虽然我们可以在需要“读软盘”时暂时切回实模式，亦或是采用虚拟8086模式完成这一操作，但怎么看，这些都只是权宜之策，并不适合我们这一真正的32位操作系统。于是，我打算自己实现软盘驱动，完成对软盘的读写。</span></p>

<p class=MsoNormal style='text-indent:21.05pt;line-height:150%;text-autospace:
none'><span style='line-height:150%;font-family:华文中宋'>这个想法是很好，但操作起来确实十分困难，甚至可以说它的操作难度，并不亚于用纯GCC写中断服务子程序。也许我们有时候可以用ugly
beauty评价某些事物，但对于软盘驱动而言，我只能用ugly这个词语形容。这也难怪liunx之父在它的软盘驱动源码中写下了“This file is
certainly a mess”、“Urgel”诸如此类的注释。</span></p>

<p class=MsoNormal style='text-indent:21.05pt;line-height:150%;text-autospace:
none'><span style='line-height:150%;font-family:华文中宋'>软盘及其驱动的ugly体现在以下这些方面：</span></p>

<p class=MsoNormal style='text-indent:21.05pt;line-height:150%;text-autospace:
none'><span style='line-height:150%;font-family:华文中宋'>1、设计年代久远，以节约内存空间为主导的设计理念让许多指令的形式和发送指令的方式变得很ugly，十分不人性化。</span></p>

<p class=MsoNormal style='text-indent:21.05pt;line-height:150%;text-autospace:
none'><span style='line-height:150%;font-family:华文中宋'>2、由于设计年代久远，加之人们在互联网普及前就几乎已经放弃了对它的使用，而转向硬盘、光盘的使用，导致目前互联网上有关软盘及其驱动的编写资料稀有，即使偶尔找到一些，但很有可能存在错误。</span></p>

<p class=MsoNormal style='text-indent:21.05pt;line-height:150%;text-autospace:
none'><span style='line-height:150%;font-family:华文中宋'>3、涉及硬件过多，资料分散，学习起来不方便。</span></p>

<p class=MsoNormal style='text-indent:21.05pt;line-height:150%;text-autospace:
none'><span style='line-height:150%;font-family:华文中宋'>这是自己在完成软盘驱动后体悟出来的一些东西，其中的故事便不再细说，只能说这东西耗费了我很多的精力，甚至让我怀疑老师的教学方式，让我们在学期中做这些工作是否有些浪费时间，毕竟还是有很多功课要做的。这虽然能让我们对操作系统的理解更为深入，但是否有可能造成只是在某一方面研究得深入，而忽视了广度呢。这对于工程来说是件好事，但对于以通识教育为主的本科学习是否有一些不太合适呢。唉，反正这一次实验，让人花了许多时间，也让人思考了很多，多次经历在“绝望的人生”和“自己的兴趣”间艰难抉择的心路历程。让人觉得这其实并不是什么技术活儿，而是体力活。但最近偶然看到华为遭此一役，感到我们现在所使用的操作系统在不久后的将来也会面临同样的状况，觉得自己做的东西还是很有意义的。</span></p>

<p class=MsoNormal style='text-indent:21.05pt;line-height:150%;text-autospace:
none'><span style='line-height:150%;font-family:华文中宋'>还好，我坚持下来了，完成了这项任务。现在，回头想想制作系统的那些日子，还是有一些佩服自己的。</span></p>

<p class=MsoNormal style='line-height:150%;text-autospace:none'><b><span
style='line-height:150%;font-family:华文中宋'>&nbsp;</span></b></p>

<p class=MsoNormal style='line-height:150%;text-autospace:none'><b><span
style='line-height:150%;font-family:华文中宋'>&nbsp;</span></b></p>

<p class=MsoNormal style='line-height:150%;text-autospace:none'><b><span
style='line-height:150%;font-family:华文中宋'>&nbsp;</span></b></p>

<p class=MsoNormal style='line-height:150%;text-autospace:none'><b><span
style='line-height:150%;font-family:华文中宋'>&nbsp;</span></b></p>

<p class=MsoNormal style='line-height:150%;text-autospace:none'><b><span
style='line-height:150%;font-family:华文中宋'>&nbsp;</span></b></p>

<p class=MsoNormal style='line-height:150%;text-autospace:none'><b><span
style='line-height:150%;font-family:华文中宋'>&nbsp;</span></b></p>

<p class=MsoSubtitle style='margin-left:0cm;text-indent:0cm'><a
name="_Toc10938210"></a><a name="_Toc10748873"></a><a name="_Toc10655614"></a><a
name="_Toc10252898"></a><a name="_Toc10138952"></a><a name="_Toc9694038"></a><a
name="_Toc9550143"></a><a name="_Toc9539612"></a><a name="_Toc9539575"></a><a
name="_Toc9539540"></a><a name="_Toc9342831"></a><a name="_Toc9342637"></a><a
name="_Toc9361270"></a><a name="_Toc9340662"></a><a name="_Toc9282829"></a><a
name="_Toc9270568"></a><a name="_Toc9103888"></a><a name="_Toc9103827">六、<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='font-family:华文中宋'>参考文献</span></a></p>

<p class=a style='margin-left:21.0pt;text-indent:-21.0pt;line-height:150%'><span
lang=EN-US style='line-height:150%;font-family:"Georgia",serif'>[1]<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
style='line-height:150%;font-family:华文中宋'>周杰英，张萍，郭雪梅，黄方军．微机原理、汇编语言与接口技术，北京：人民邮电出版社，<span
lang=EN-US>2011</span>．</span></p>

<p class=a style='margin-left:21.0pt;text-indent:-21.0pt;line-height:150%'><span
lang=EN-US style='line-height:150%;font-family:"Georgia",serif'>[2]<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
style='line-height:150%;font-family:华文中宋'>于渊．<span lang=EN-US>Orange'S</span>：一个操作系统的实现，北京：电子工业出版社，<span
lang=EN-US>2009</span>．</span></p>

<p class=a align=left style='margin-left:21.0pt;text-align:left;text-indent:
-21.0pt;line-height:150%'><span lang=EN-US style='line-height:150%;font-family:
"Georgia",serif'>[3]<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US style='line-height:150%;font-family:"Times New Roman",serif'>Microsoft</span><span
style='line-height:150%;font-family:华文中宋'>．</span><i><span lang=EN-US
style='line-height:150%;font-family:"Times New Roman",serif'>Microsoft Extensible
Firmware Initiative FAT32 File System Specification</span></i></p>

<p class=a align=left style='margin-left:21.0pt;text-align:left;text-indent:
0cm;line-height:150%'><span lang=EN-US style='line-height:150%;font-family:
"Times New Roman",serif'>[DB/CD]</span><span style='line-height:150%;
font-family:华文中宋'>，</span><span lang=EN-US style='font-family:"Times New Roman",serif'>https://msdn.microsoft.com/zh-cn/windows/hardware/gg463080</span><span
style='line-height:150%;font-family:华文中宋'>，<span lang=EN-US>2000</span>．</span></p>

<p class=a align=left style='margin-left:21.0pt;text-align:left;text-indent:
-21.0pt;line-height:150%'><span lang=EN-US style='line-height:150%;font-family:
"Georgia",serif'>[4]<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US style='line-height:150%;font-family:"Times New Roman",serif'>Lance
Costanzo</span><span style='line-height:150%;font-family:华文中宋'>．</span><i><span
lang=EN-US style='line-height:150%;font-family:"Times New Roman",serif'>Intel
80386 Programmer's Reference Manual</span></i><span lang=EN-US
style='line-height:150%;font-family:"Times New Roman",serif'> [DB/CD]</span><span
style='line-height:150%;font-family:华文中宋'>，</span><span lang=EN-US
style='line-height:150%;font-family:"Times New Roman",serif'>http://www.logix.cz/michal/doc/i386/</span><span
style='line-height:150%;font-family:华文中宋'>，</span><span lang=EN-US
style='line-height:150%'>1997</span><span style='line-height:150%;font-family:
华文中宋'>．</span></p>

<p class=a align=left style='margin-left:21.0pt;text-align:left;text-indent:
-21.0pt;line-height:150%'><span lang=EN-US style='line-height:150%;font-family:
"Georgia",serif'>[5]<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US style='line-height:150%;font-family:"Times New Roman",serif'>Intel</span><span
style='line-height:150%;font-family:华文中宋'>．</span><i><span lang=EN-US
style='line-height:150%;font-family:"Times New Roman",serif'>82371AB PCI-TO-ISA
/ IDE XCELERATOR (PIIX4)</span></i><span lang=EN-US> </span><span lang=EN-US
style='line-height:150%;font-family:"Times New Roman",serif'>[DB/CD] </span><span
style='line-height:150%;font-family:华文中宋'>，</span><span lang=EN-US
style='line-height:150%;font-family:"Times New Roman",serif'>https://www.intel.com/Assets/PDF/datasheet/290562.pdf</span><span
style='line-height:150%;font-family:华文中宋'>，<span lang=EN-US>1997</span>．</span></p>

<p class=a align=left style='margin-left:21.0pt;text-align:left;text-indent:
-21.0pt;line-height:150%'><span lang=EN-US style='line-height:150%;font-family:
"Georgia",serif'>[6]<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US style='line-height:150%;font-family:"Times New Roman",serif'>Sandeep
S</span><span style='line-height:150%;font-family:华文中宋'>．</span><i><span
lang=EN-US style='line-height:150%;font-family:"Times New Roman",serif'>GCC-Inline-Assembly-HOWTO
</span></i><span lang=EN-US style='line-height:150%;font-family:"Times New Roman",serif'>[DB/CD]</span><span
style='line-height:150%;font-family:华文中宋'>，</span><span lang=EN-US
style='font-family:"Times New Roman",serif'>https://www.ibiblio.org/gferg/ldp/GCC-Inline-Assembly-HOWTO.html</span><span
style='line-height:150%;font-family:华文中宋'>，<span lang=EN-US>2003</span>．</span></p>

<p class=a style='margin-left:21.0pt;text-indent:-21.0pt;line-height:150%'><span
lang=EN-US style='line-height:150%;font-family:"Georgia",serif'>[7]<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US style='line-height:150%;font-family:"Times New Roman",serif'>Free
Software Foundation</span><span style='line-height:150%;font-family:华文中宋'>．</span><i><span
lang=EN-US style='line-height:150%;font-family:"Times New Roman",serif'>Using
the GNU Compiler Collection (GCC) </span></i><span lang=EN-US style='line-height:
150%;font-family:"Times New Roman",serif'>[DB/CD]</span><span style='line-height:
150%;font-family:华文中宋'>，</span><span lang=EN-US style='font-family:"Times New Roman",serif'>https://gcc.gnu.org/onlinedocs/gcc/</span><span
style='line-height:150%;font-family:华文中宋'>，<span lang=EN-US>2019</span>．</span></p>

<p class=a style='margin-left:21.0pt;text-indent:-21.0pt;line-height:150%'><span
lang=EN-US style='line-height:150%;font-family:"Georgia",serif'>[8]<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
style='line-height:150%;font-family:华文中宋'>赵炯．<span lang=EN-US>Liunx</span>内核<span
lang=EN-US>0.11</span>完全注释（修正版<span lang=EN-US>3.0</span>）</span><span
lang=EN-US style='line-height:150%;font-family:"Times New Roman",serif'>[DB/CD]</span><span
style='line-height:150%;font-family:华文中宋'>，上海：同济大学</span><span lang=EN-US
style='font-family:"Times New Roman",serif'>http://www.oldlinux.org/Book-Lite/</span><span
style='line-height:150%;font-family:华文中宋'>，<span lang=EN-US>2017</span>．</span></p>

<p class=a style='margin-left:21.0pt;text-indent:-21.0pt;line-height:150%'><span
lang=EN-US style='line-height:150%;font-family:"Georgia",serif'>[9]<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US style='line-height:150%;font-family:华文中宋'>Linus Benedict Torvalds</span><span
style='line-height:150%;font-family:华文中宋'>等为<span lang=EN-US>Liunx</span>内核做出贡献的伟大先驱．<span
lang=EN-US>Liunx 0.11</span>、<span lang=EN-US>Liunx 1.00</span>内核源码．</span></p>

</div>

</body>

</html>